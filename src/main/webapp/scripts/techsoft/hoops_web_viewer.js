var __awaiter=this&&this.__awaiter||function(a,h,e,f){return new (e||(e=Promise))(function(d,c){function b(b){try{l(f.next(b))}catch(g){c(g)}}function g(b){try{l(f["throw"](b))}catch(g){c(g)}}function l(c){c.done?d(c.value):(new e(function(b){b(c.value)})).then(b,g)}l((f=f.apply(a,h||[])).next())})},__generator=this&&this.__generator||function(a,h){function e(b){return function(c){return f([b,c])}}function f(l){if(c)throw new TypeError("Generator is already executing.");for(;d;)try{if(c=1,b&&(g=b[l[0]&
2?"return":l[0]?"throw":"next"])&&!(g=g.call(b,l[1])).done)return g;if(b=0,g)l=[0,g.value];switch(l[0]){case 0:case 1:g=l;break;case 4:return d.label++,{value:l[1],done:!1};case 5:d.label++;b=l[1];l=[0];continue;case 7:l=d.ops.pop();d.trys.pop();continue;default:if(!(g=d.trys,g=0<g.length&&g[g.length-1])&&(6===l[0]||2===l[0])){d=0;continue}if(3===l[0]&&(!g||l[1]>g[0]&&l[1]<g[3]))d.label=l[1];else if(6===l[0]&&d.label<g[1])d.label=g[1],g=l;else if(g&&d.label<g[2])d.label=g[2],d.ops.push(l);else{g[2]&&
d.ops.pop();d.trys.pop();continue}}l=h.call(a,d)}catch(f){l=[6,f],b=0}finally{c=g=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}var d={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},c,b,g,l;return l={next:e(0),"throw":e(1),"return":e(2)},"function"===typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},Communicator;
(function(a){var h;(function(a){a[a.Unknown=0]="Unknown";a[a.v1_0=1]="v1_0";a[a.v2_0=2]="v2_0";a[a.v2_1=3]="v2_1"})(h=a.BCFVersion||(a.BCFVersion={}));(function(a){a[a.Unknown=0]="Unknown";a[a.TopicFolder=1]="TopicFolder";a[a.Version=2]="Version";a[a.Markup=3]="Markup";a[a.Snapshot=4]="Snapshot";a[a.Viewpoint=5]="Viewpoint";a[a.Schema=6]="Schema";a[a.Project=7]="Project"})(a.BCFFileType||(a.BCFFileType={}));var e=function(){function a(d,c){this._version=h.Unknown;this._topicsMap=new Map;this._bcfFileName=
d;this._id=c}a.prototype.exportBCF=function(d){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(g){switch(g.label){case 0:return c=new XMLSerializer,b=new JSZip,b.file("bcf.version",'<?xml version="1.0" encoding="UTF-8"?><Version VersionId="2.1" xsi:noNamespaceSchemaLocation="version.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><DetailedVersion>2.1</DetailedVersion></Version>'),this._topicsMap.forEach(function(g,d){var a=b.folder(d);d=c.serializeToString(g.getMarkup().export());
a.file("markup.bcf",d);g.getViewpointMap().forEach(function(b,g){b=c.serializeToString(b.export());a.file(g,b)});g.getSnapshotMap().forEach(function(b,c){a.file(c,b.getData())})}),[4,b.generateAsync({type:"blob"}).then(function(b){saveAs(b,d+".bcf")})];case 1:return g.sent(),[2]}})})};a.prototype.addTopic=function(d,c){this._topicsMap.set(d,c)};a.prototype.getTopics=function(){return this._topicsMap};a.prototype.getTopic=function(d){return this._topicsMap.get(d)||null};a.prototype.getVersion=function(){return this._version};
a.prototype.setVersion=function(d){this._version=d};a.prototype.getFilename=function(){return this._bcfFileName};a.prototype.getId=function(){return this._id};return a}();a.BCFData=e})(Communicator||(Communicator={}));
(function(a){function h(b,c,g){void 0!==g&&null!==g&&b.setAttribute(c,g)}function e(b,c,g,l){b=b.createElement(g);b.innerHTML=l;c.appendChild(b)}function f(b,c,g,l){void 0!==l&&null!==l&&e(b,c,g,l)}function d(b){return void 0===b||null===b?null:b.toISOString()}function c(b){return void 0===b||null===b?null:b.toString()}function b(b){return void 0===b||null===b?null:b?"true":"false"}var g=function(){function b(c,g,l,d,a,f){this._ifcProject=c;this._ifcSpatialStructureElement=g;this._isExternal=l;this._filename=
d;this._date=a;this._reference=f}b.prototype.getIfcProject=function(){return this._ifcProject||null};b.prototype.getIfcSpacialStructureElement=function(){return this._ifcSpatialStructureElement||null};b.prototype.getIsExternal=function(){return this._isExternal||null};b.prototype.getBimFilename=function(){return this._filename||null};b.prototype.getBimDate=function(){return this._date||null};b.prototype.getReference=function(){return this._reference||null};return b}();a.BCFMarkupHeaderFile=g;var l=
function(){function b(c,g,l,d){this._index=this._snapshotFilename=this._viewpointFilename=void 0;this._guid=c;this._viewpointFilename=g;this._snapshotFilename=l;void 0!==d&&(this._index=parseInt(d))}b.prototype.getGuid=function(){return this._guid};b.prototype.getViewpointFilename=function(){return this._viewpointFilename||null};b.prototype.getSnapshotFilename=function(){return this._snapshotFilename||null};b.prototype.getIndex=function(){return this._index||null};return b}();a.BCFMarkupViewpoint=
l;var v=function(){function b(c,g,l,d,a,f,e){this._guid=c;this._date=g;this._author=l;this._text=d;this._viewpointGuid=a;this._modifiedDate=f;this._modifiedAuthor=e}b.prototype.getId=function(){return this._guid};b.prototype.getDate=function(){return this._date};b.prototype.setDate=function(b){this._date=b};b.prototype.getAuthor=function(){return this._author};b.prototype.setAuthor=function(b){this._author=b};b.prototype.getText=function(){return this._text};b.prototype.setText=function(b){this._text=
b};b.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};b.prototype.setViewpointGuid=function(b){this._viewpointGuid=null!==b?b:void 0};b.prototype.getModifiedDate=function(){return this._modifiedDate||null};b.prototype.setModifiedDate=function(b){this._modifiedDate=null!==b?b:void 0};b.prototype.getModifiedAuthor=function(){return this._modifiedAuthor||null};b.prototype.setModifiedAuthor=function(b){this._modifiedAuthor=null!==b?b:void 0};return b}();a.BCFComment=v;var p=function(){function p(b,
c,g){this._markupHeaderFiles=[];this._topic={guid:"",title:"",creationDate:new Date,creationAuthor:""};this._comments=new Map;this._viewpoints=new Map;this._filename=b;this._bcfTopic=g;this._parseDocument(c)}p.prototype._parseDocument=function(b){if(null!==b)for(b=b.documentElement.firstElementChild;null!==b;){var c=b.localName;if(null===c)break;switch(c){case "Header":this._parseHeader(b);break;case "Topic":this._parseTopic(b);break;case "Comment":this._parseComment(b);break;case "Viewpoints":this._parseViewpoint(b)}b=
b.nextElementSibling}};p.prototype._exportHeader=function(c){var g=c.createElement("Header");h(g,"ProjectGuid",this._projectGuid);this._markupHeaderFiles.forEach(function(l){var a=c.createElement("File");h(a,"IfcProject",l.getIfcProject());h(a,"IfcSpatialStructureElement",l.getIfcSpacialStructureElement());h(a,"isExternal",b(l.getIsExternal()));f(c,a,"Filename",l.getBimFilename());f(c,a,"Date",d(l.getBimDate()));f(c,a,"Reference",l.getReference());g.appendChild(a)});return g};p.prototype._exportTopicData=
function(b){var g=b.createElement("Topic");g.setAttribute("Guid",this._topic.guid);h(g,"TopicType",this._topic.topicType);h(g,"TopicStatus",this._topic.topicStatus);e(b,g,"Title",this._topic.title);e(b,g,"CreationDate",this._topic.creationDate.toISOString());e(b,g,"CreationAuthor",this._topic.creationAuthor);f(b,g,"ReferenceLink",this._topic.referenceLink);f(b,g,"Priority",this._topic.priority);f(b,g,"Index",c(this._topic.index));f(b,g,"ModifiedDate",d(this._topic.modifiedDate));f(b,g,"ModifiedAuthor",
this._topic.modifiedAuthor);f(b,g,"DueDate",d(this._topic.dueDate));f(b,g,"AssignedTo",this._topic.assignedTo);f(b,g,"Description",this._topic.description);f(b,g,"Stage",this._topic.stage);if(this._topic.labels){var l=b.createElement("Labels");this._topic.labels.forEach(function(c){e(b,l,"Label",c)});g.appendChild(l)}return g};p.prototype._exportBimSnippet=function(c,g){var l=c.createElement("BimSnippet");l.setAttribute("SnippetType",g.snippetType);h(l,"isExternal",b(g.isExternal));e(c,l,"Reference",
g.reference);f(c,l,"ReferenceSchema",g.referenceSchema);return l};p.prototype._exportDocumentReference=function(c,g){var l=c.createElement("DocumentReference");h(l,"Guid",g.guid);h(l,"isExternal",b(g.isExternal));f(c,l,"ReferencedDocument",g.referencedDocument);f(c,l,"Description",g.description);return l};p.prototype._exportRelatedTopic=function(b,c){b=b.createElement("RelatedTopic");b.setAttribute("Guid",c.guid);return b};p.prototype._exportTopic=function(b){var c=this,g=this._exportTopicData(b);
this._topic.bimSnippets&&this._topic.bimSnippets.forEach(function(l){g.appendChild(c._exportBimSnippet(b,l))});this._topic.documentReferences&&this._topic.documentReferences.forEach(function(l){g.appendChild(c._exportDocumentReference(b,l))});this._topic.relatedTopics&&this._topic.relatedTopics.forEach(function(l){g.appendChild(c._exportRelatedTopic(b,l))});return g};p.prototype._exportComment=function(b,c){var g=b.createElement("Comment");g.setAttribute("Guid",c.getId());e(b,g,"Date",c.getDate().toISOString());
e(b,g,"Author",c.getAuthor());e(b,g,"Comment",c.getText());f(b,g,"ModifiedDate",d(c.getModifiedDate()));f(b,g,"ModifiedAuthor",c.getModifiedAuthor());if(c=c.getViewpointGuid())b=b.createElement("Viewpoint"),b.setAttribute("Guid",c),g.appendChild(b);return g};p.prototype._exportViewpoint=function(b,g){var l=b.createElement("Viewpoints");l.setAttribute("Guid",g.getGuid());f(b,l,"Viewpoint",g.getViewpointFilename());f(b,l,"Snapshot",g.getSnapshotFilename());f(b,l,"Index",c(g.getIndex()));return l};p.prototype.export=
function(){var b=this,c=document.implementation.createDocument("","",null),g=c.createElement("Markup");g.appendChild(this._exportHeader(c));g.appendChild(this._exportTopic(c));this._comments.forEach(function(l){g.appendChild(b._exportComment(c,l))});this._viewpoints.forEach(function(l){g.appendChild(b._exportViewpoint(c,l))});c.appendChild(g);return c};p.prototype.getIfcProject=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcProject()||void 0};p.prototype.getIfcSpacialStructureElement=
function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIfcSpacialStructureElement()||void 0};p.prototype.getIsExternal=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getIsExternal()||void 0};p.prototype.getBimFilename=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimFilename()||void 0};p.prototype.getBimDate=function(){var b=this._markupHeaderFiles[0];if(void 0!==b)return b.getBimDate()||void 0};p.prototype.getReference=function(){var b=this._markupHeaderFiles[0];
if(void 0!==b)return b.getReference()||void 0};p.prototype.getProjectGuid=function(){return this._projectGuid||null};p.prototype.getMarkupHeaderFiles=function(){return this._markupHeaderFiles};p.prototype.getFilename=function(){return this._filename};p.prototype.getTopicType=function(){return this._topic.topicType||null};p.prototype.setTopicType=function(b){this._topic.topicType=null!==b?b:void 0};p.prototype.getTopicStatus=function(){return this._topic.topicStatus||null};p.prototype.setTopicStatus=
function(b){this._topic.topicStatus=null!==b?b:void 0};p.prototype.getTopicTitle=function(){return this._topic.title};p.prototype.setTopicTitle=function(b){this._topic.title=b};p.prototype.getTopicCreationDate=function(){return this._topic.creationDate};p.prototype.setTopicCreationDate=function(b){this._topic.creationDate=b};p.prototype.getTopicCreationAuthor=function(){return this._topic.creationAuthor};p.prototype.setTopicCreationAuthor=function(b){this._topic.creationAuthor=b};p.prototype.getTopicReferenceLink=
function(){return this._topic.referenceLink||null};p.prototype.setTopicReferenceLink=function(b){this._topic.referenceLink=null===b?void 0:b};p.prototype.getTopicPriority=function(){return this._topic.priority||null};p.prototype.setTopicPriority=function(b){this._topic.priority=null===b?void 0:b};p.prototype.getTopicIndex=function(){return this._topic.index||null};p.prototype.setTopicIndex=function(b){this._topic.index=null===b?void 0:b};p.prototype.getTopicLabels=function(){return void 0===this._topic.labels?
[]:this._topic.labels.slice()};p.prototype.setTopicLabels=function(b){this._topic.labels=b.slice()};p.prototype.getTopicModifiedDate=function(){return this._topic.modifiedDate||null};p.prototype.setTopicModifiedDate=function(b){this._topic.modifiedDate=null===b?void 0:b};p.prototype.getTopicModifiedAuthor=function(){return this._topic.modifiedAuthor||null};p.prototype.setTopicModifiedAuthor=function(b){this._topic.modifiedAuthor=null===b?void 0:b};p.prototype.getTopicDueDate=function(){return this._topic.dueDate||
null};p.prototype.setTopicDueDate=function(b){this._topic.dueDate=null===b?void 0:b};p.prototype.getTopicAssignedTo=function(){return this._topic.assignedTo||null};p.prototype.setTopicAssignedTo=function(b){this._topic.assignedTo=null===b?void 0:b};p.prototype.getTopicDescription=function(){return this._topic.description||null};p.prototype.setTopicDescription=function(b){this._topic.description=null===b?void 0:b};p.prototype.getTopicStage=function(){return this._topic.stage||null};p.prototype.setTopicState=
function(b){this._topic.stage=null===b?void 0:b};p.prototype.getComments=function(){return this._comments};p.prototype.addComment=function(b,c,g,l,d,f){var e=a.GUID.create();b=new v(e,b,c,g,l,d,f);this._comments.set(e,b);return b};p.prototype.updateComment=function(b){var c=b.getId();this._comments.set(c,b)};p.prototype.deleteComment=function(b){this._comments.delete(b)};p.prototype.getViewpoints=function(){return this._viewpoints};p.prototype._addFile=function(b){var c=this._getElementAttributes(b),
l=this._getChildData(b);b=l.get("Date");b=void 0===b?void 0:new Date(b);var d=l.get("Filename"),l=l.get("Reference"),a=c.get("IfcProject"),f=c.get("IfcSpatialStructureElement"),c="true"===c.get("isExternal");this._markupHeaderFiles.push(new g(a,f,c,d,b,l))};p.prototype._parseHeader=function(b){var c=this._getElementAttributes(b).get("ProjectGuid");void 0!==c&&(this._projectGuid=c);b=b.firstElementChild;null!==b&&this._addFile(b)};p.prototype._parseTopic=function(b){var c=this._getElementAttributes(b),
g=c.get("Guid");if(void 0!==g&&(this._topic.guid=g,this._topic.topicType=c.get("TopicType")||c.get("Status"),this._topic.topicStatus=c.get("TopicStatus")||c.get("VerbalStatus"),b=b.firstElementChild,null!==b))for(;null!==b;){var l=b.localName;if(null===l)break;c=this._getChildData(b);g=this._getElementAttributes(b);switch(l){case "BimSnippet":void 0===this._topic.bimSnippets&&(this._topic.bimSnippets=[]);var l=c.get("Reference"),d=g.get("SnippetType");void 0!==l&&void 0!==d&&(l={snippetType:d,reference:l},
g.get("isExternal")&&(l.isExternal="true"===g.get("isExternal")),c.get("ReferenceSchema")&&(l.referenceSchema=c.get("ReferenceSchema")),this._topic.bimSnippets.push(l));break;case "DocumentReference":void 0===this._topic.documentReferences&&(this._topic.documentReferences=[]);g={};c.get("Guid")&&(g.guid=c.get("Guid"));c.get("isExternal")&&(g.isExternal="true"===c.get("isExternal"));c.get("Description")&&(g.description=c.get("Description"));c.get("ReferencedDocument")&&(g.referencedDocument=c.get("ReferencedDocument"));
this._topic.documentReferences.push(g);break;case "RelatedTopic":void 0===this._topic.relatedTopics&&(this._topic.relatedTopics=[]);c=c.get("Guid");void 0!==c&&this._topic.relatedTopics.push({guid:c});break;case "ReferenceLink":b.textContent&&(this._topic.referenceLink=b.textContent);break;case "Title":b.textContent&&(this._topic.title=b.textContent);break;case "Priority":b.textContent&&(this._topic.priority=b.textContent);break;case "Index":b.textContent&&(this._topic.index=parseInt(b.textContent));
break;case "Labels":b.textContent&&(void 0===this._topic.labels&&(this._topic.labels=[]),this._topic.labels.push(b.textContent));break;case "CreationDate":b.textContent&&(this._topic.creationDate=new Date(b.textContent));break;case "CreationAuthor":b.textContent&&(this._topic.creationAuthor=b.textContent);break;case "ModifiedDate":b.textContent&&(this._topic.modifiedDate=new Date(b.textContent));break;case "ModifiedAuthor":b.textContent&&(this._topic.modifiedAuthor=b.textContent);break;case "DueDate":b.textContent&&
(this._topic.dueDate=new Date(b.textContent));break;case "AssignedTo":b.textContent&&(this._topic.assignedTo=b.textContent);break;case "Description":b.textContent&&(this._topic.description=b.textContent);break;case "Stage":b.textContent&&(this._topic.stage=b.textContent)}b=b.nextElementSibling}};p.prototype._parseComment=function(b){var c=new Date,g="",l="",d=void 0,a=void 0,f=void 0,e=this._getElementAttributes(b).get("Guid");if(e){b=b.firstElementChild;if(null!==b)for(;null!==b;){var p=b.localName;
if(null===p)break;switch(p){case "Date":b.textContent&&(c=new Date(b.textContent));break;case "Author":b.textContent&&(g=b.textContent);break;case "Comment":b.textContent&&(l=b.textContent);break;case "Viewpoint":d=this._getElementAttributes(b).get("Guid");break;case "ModifiedDate":b.textContent&&(a=new Date(b.textContent));break;case "ModifiedAuthor":b.textContent&&(f=b.textContent)}b=b.nextElementSibling}c=new v(e,c,g,l,d,a,f);this._comments.set(e,c)}};p.prototype._parseViewpoint=function(b){var c=
this._getElementAttributes(b).get("Guid");if(void 0!==c){var g=this._getChildData(b);b=g.get("Viewpoint");var l=g.get("Snapshot"),g=g.get("Index");this.addViewpoint(c,b,l,g)}};p.prototype.addViewpoint=function(b,c,g,d){this._viewpoints.set(b,new l(b,c,g,d))};p.prototype._getChildData=function(b){var c=new Map;for(b=b.firstElementChild;null!==b;){var g=b.localName,l=null;null===b.firstElementChild&&(l=b.textContent);null!==g&&null!==l&&c.set(g,l);b=b.nextElementSibling}return c};p.prototype._getElementAttributes=
function(b){b=b.attributes;for(var c=new Map,g=0;g<b.length;++g){var l=b[g];c.set(l.name,l.value)}return c};return p}();a.BCFMarkup=p})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(f,d){this._filename=f;this._data=d}a.createFromImage=function(f,d){d=a.snapshotDataFromImage(d);return new a(f,d)};a.prototype.getFilename=function(){return this._filename};a.prototype.getData=function(){return this._data};a.prototype.getUrl=function(){var a=new Blob([this._data],{type:"image/png"});return URL.createObjectURL(a,{oneTimeOnly:!0})};a.snapshotDataFromImage=function(f){return a._convertDataURIToBinary(f.src)};a._convertDataURIToBinary=function(a){var d=
a.indexOf(";base64,")+8;a=window.atob(a.substring(d));return Uint8Array.from(Array.prototype.map.call(a,function(c){return c.charCodeAt(0)}))};return a}();a.BCFSnapshot=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(a,d,c,b){this._viewpointMap=new Map;this._snapshotMap=new Map;this._viewer=b;this._topicId=c;this._bcfDataId=a;this._bcfFilename=d}e.createTopic=function(f,d,c,b,g){void 0===g&&(g=null);return __awaiter(this,void 0,void 0,function(){var l,v,p,k,r,m,h,q,t;return __generator(this,function(u){switch(u.label){case 0:return l=a.GUID.create(),v=new e(d,c,l,f),p=v.addMarkup("markup.bcf",null),p.setTopicTitle(b),k="viewpoint.bcfv",[4,a.BCFViewpoint.createViewpoint(f,
k,g)];case 1:return r=u.sent(),v.setViewpoint(k,r),m="snapshot.png",(q=null!==g?g.getSnapshotImage():null)?[3,3]:[4,f.takeSnapshot()];case 2:q=u.sent(),u.label=3;case 3:return h=q,t=a.BCFSnapshot.createFromImage(m,h),v.setSnapshot(m,t),[2,v]}})})};e.prototype.getTopicId=function(){return this._topicId};e.prototype.addMarkup=function(f,d){return this._markup=new a.BCFMarkup(f,d,this)};e.prototype.getMarkup=function(){return this._markup};e.prototype.addViewpoint=function(f,d,c,b,g){d=new a.BCFViewpoint(f,
d,c,b,g,this._viewer);this.setViewpoint(f,d);return d};e.prototype.setViewpoint=function(a,d){this._viewpointMap.set(a,d)};e.prototype.getViewpointMap=function(){return this._viewpointMap};e.prototype.getViewpoint=function(a){return this._viewpointMap.get(a)||null};e.prototype.addSnapshot=function(f,d){d=new a.BCFSnapshot(f,d);this.setSnapshot(f,d)};e.prototype.setSnapshot=function(a,d){this._snapshotMap.set(a,d)};e.prototype.getSnapshotMap=function(){return this._snapshotMap};e.prototype.getSnapshot=
function(a){return this._snapshotMap.get(this._massageSnapshotFilename(a))||null};e.prototype._massageSnapshotFilename=function(a){if("viewpoint.bcfv"===a)return"snapshot.png";var d=a.split(".");return"bcfv"===d[1]?d[0]+".png":a};return e}();a.BCFTopic=h})(Communicator||(Communicator={}));
(function(a){function h(b){return b?"true":"false"}function e(b,c){b=b.createElement("Component");b.setAttribute("IfcGuid",c.ifcGuid);c.originatingSystem&&b.setAttribute("OriginatingSystem",c.originatingSystem);c.authoringToolId&&b.setAttribute("AuthoringToolId",c.authoringToolId);return b}function f(b){return 1===b.length?"0"+b:b}function d(b,c){c=c?f(Math.round(c).toString(16)):"";var d=f(Math.round(b.r).toString(16)),a=f(Math.round(b.g).toString(16));b=f(Math.round(b.b).toString(16));return""+
c+d+a+b}function c(b,c,d){var a=b.createElement("X"),f=b.createElement("Y");b=b.createElement("Z");a.innerHTML=d.x.toString();f.innerHTML=d.y.toString();b.innerHTML=d.z.toString();c.appendChild(a);c.appendChild(f);c.appendChild(b)}var b=function(){function b(c,g,d,f,e,m){this._version=a.BCFVersion.Unknown;this._components={};this._lines=[];this._clippingPlanes=[];this._viewer=m;this._filename=c;this._version=d;this._modelBounding=f;this._unitScale=1E3/e;this._parseDocument(g)}b.createViewpoint=function(c,
d,f){void 0===f&&(f=null);return __awaiter(this,void 0,void 0,function(){var e,r,m,h,q,t,u,w,z,y,x,A,B,C,D,G;return __generator(this,function(E){switch(E.label){case 0:return e=function(b){var c=[];b.forEach(function(b){for(var g=null;null!==b&&null===g;)g=r.getNodeGenericId(b),b=r.getNodeParent(b);null!==g&&c.push(g)});return c},r=c.model,m=r.getAbsoluteRootNode(),[4,c.model.getVisibilityState(m)];case 1:return h=E.sent(),[4,r.getNodeColorMap(m,a.ElementType.Faces)];case 2:return q=E.sent(),[4,r.getModelBounding(!0,
!1)];case 3:return t=E.sent(),u=r.getNodeUnitMultiplier(m),w=new b(d,null,a.BCFVersion.v2_1,t,u,c),w.setDefaultVisibility(h.defaultVisibility),z=h.visibilityExceptions,y=[],z.forEach(function(b){y.push(b)}),x=e(y),w.setVisibilityExceptions(x),A=c.selectionManager.getResults(),B=A.map(function(b){return b.getNodeId()}),C=e(B),w.setSelection(C),D=new Map,0<q.size&&q.forEach(function(b,c){c=r.getNodeGenericId(c);if(null!==c){var g=D.get(b);void 0===g&&(g=new Set,D.set(b,g));g.add(c)}}),w.setColors(D),
w.setCamera(c.view.getCamera()),null!==f&&(G=b._markupRedlineToBcf(f.getMarkup(),c.view),w.setLines(G)),[2,w]}})})};b._markupRedlineToBcf=function(b,c){var g=function(b){b=c.projectPoint(b);return c.unprojectPoint(a.Point2.fromPoint3(b),0)},d=function(b,c,g){for(var l=2*Math.PI/g,d=[],f=0;f<=g;f++){var e=f*l;d.push(new a.Point2(b.x+Math.cos(e)*c,b.y+Math.sin(e)*c))}return d},f=function(b){for(var c=0;c<b.length-1;++c){var g=b[c],l=b[c+1];null!==g&&null!==l&&(g=[g.copy().scale(.001),l.copy().scale(.001)],
h.push(g))}},e=function(b){for(var c=0;c<b.length;++c){var g=b[c],l=b[(c+1)%b.length];null!==g&&null!==l&&(g=[g.copy().scale(.001),l.copy().scale(.001)],h.push(g))}},h=[];b.forEach(function(b){if(b instanceof a.Markup.Redline.RedlinePolyline){var l=b.getPoints().map(g);f(l)}else if(b instanceof a.Markup.Redline.RedlineCircle){var l=b.getCenter(),h=b.getRadiusPoint();b=a.Point2.fromPoint3(c.projectPoint(l));l=a.Point2.fromPoint3(c.projectPoint(h));l=a.Point2.subtract(l,b).length();l=d(b,l,40).map(function(b){return c.unprojectPoint(b,
0)});e(l)}else b instanceof a.Markup.Redline.RedlineRectangle&&(l=b.getPoint1(),h=b.getPoint2(),b=a.Point2.fromPoint3(c.projectPoint(l)),h=a.Point2.fromPoint3(c.projectPoint(h)),l=[],l.push(c.unprojectPoint(b,0)),l.push(c.unprojectPoint(new a.Point2(b.x,h.y),0)),l.push(c.unprojectPoint(h,0)),l.push(c.unprojectPoint(new a.Point2(h.x,b.y),0)),e(l))});return h};b.prototype._parseDocument=function(b){if(null!==b){b=b.documentElement;var c=b.attributes.getNamedItem("Guid");null!==c&&(this._viewpointGuid=
c.value);for(b=b.firstElementChild;null!==b;){c=b.localName;if(null===c)break;switch(c){case "Components":this._version>=a.BCFVersion.v2_1?this._parseComponents(b):this._parseComponentsV2_0(b);break;case "OrthogonalCamera":this._parseOrthogonalCamera(b);break;case "PerspectiveCamera":this._parsePerspectiveCamera(b);break;case "Lines":this._parseLines(b);break;case "ClippingPlanes":this._parseClippingPlanes(b)}b=b.nextElementSibling}}};b.prototype._exportComponents=function(b){var c=b.createElement("Components"),
g=b.createElement("ViewSetupHints"),a=this._components.viewSetupHints;a&&(c.setAttribute("SpacesVisible",h(a.spacesVisible)),c.setAttribute("SpaceBoundariesVisible",h(a.spaceBoundariesVisible)),c.setAttribute("OpeningsVisible",h(a.openingsVisible)));c.appendChild(g);var f=b.createElement("Selection");(g=this._components.selection)&&g.forEach(function(c){f.appendChild(e(b,c))});c.appendChild(f);var g=b.createElement("Visibility"),a=this._components.defaultVisibility,m=this._components.visibilityExceptions;
if(void 0!==a&&void 0!==m){g.setAttribute("DefaultVisibility",h(a));var n=b.createElement("Exceptions");m.forEach(function(c){n.appendChild(e(b,c))});g.appendChild(n)}c.appendChild(g);var q=b.createElement("Coloring");(g=this._components.coloring)&&g.forEach(function(c){var g=b.createElement("Color");g.setAttribute("Color",d(c.color,c.alpha));c.components.forEach(function(c){g.appendChild(e(b,c))});q.appendChild(g)});c.appendChild(q);return c};b.prototype._exportOrthogonalCamera=function(b,g){var d=
b.createElement("OrthogonalCamera"),a=b.createElement("CameraViewPoint"),f=b.createElement("CameraViewPoint"),e=b.createElement("CameraViewPoint");c(b,a,g.cameraViewPoint);c(b,f,g.cameraDirection);c(b,e,g.cameraUpVector);b=b.createElement("ViewToWorldScale");b.innerHTML=g.viewToWorldScale.toString();d.appendChild(a);d.appendChild(f);d.appendChild(e);d.appendChild(b);return d};b.prototype._exportPerspectiveCamera=function(b,g){var d=b.createElement("PerspectiveCamera"),a=b.createElement("CameraViewPoint"),
f=b.createElement("CameraViewPoint"),e=b.createElement("CameraViewPoint");c(b,a,g.cameraViewPoint);c(b,f,g.cameraDirection);c(b,e,g.cameraUpVector);b=b.createElement("FieldOfView");b.innerHTML=g.fieldOfView.toString();d.appendChild(a);d.appendChild(f);d.appendChild(e);d.appendChild(b);return d};b.prototype._exportLines=function(b){var g=b.createElement("Lines");this._lines.forEach(function(d){var a=b.createElement("Line"),f=b.createElement("StartPoint"),e=b.createElement("EndPoint");c(b,f,d.startPoint);
c(b,e,d.endPoint);a.appendChild(f);a.appendChild(e);g.appendChild(a)});return g};b.prototype._exportClippingPlanes=function(b){var g=b.createElement("ClippingPlanes");this._clippingPlanes.forEach(function(d){var a=b.createElement("ClippingPlane"),f=b.createElement("Location"),e=b.createElement("Direction");c(b,f,d.location);c(b,e,d.direction);a.appendChild(f);a.appendChild(e);g.appendChild(a)});return g};b.prototype.export=function(){var b=document.implementation.createDocument("","",null),c=b.createElement("VisualizationInfo");
c.appendChild(this._exportComponents(b));void 0!==this._viewpointGuid&&c.setAttribute("Guid",this._viewpointGuid);this._orthogonalCamera?c.appendChild(this._exportOrthogonalCamera(b,this._orthogonalCamera)):this._perspectiveCamera&&c.appendChild(this._exportPerspectiveCamera(b,this._perspectiveCamera));0<this._lines.length&&c.appendChild(this._exportLines(b));0<this._clippingPlanes.length&&c.appendChild(this._exportClippingPlanes(b));b.appendChild(c);return b};b.prototype.activate=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._activateCamera(),[4,this._activateComponentsVisibility()];case 1:return b.sent(),this._activateMarkup(),this._activateCuttingPlanes(),this._activateSelected(),[4,this._activateColors()];case 2:return b.sent(),[2]}})})};b.prototype._activateCamera=function(){var b=this.getCamera();null!==b&&this._viewer.view.setCamera(b,800)};b.prototype._activateComponentsVisibility=function(){return __awaiter(this,void 0,
void 0,function(){var b,c,g;return __generator(this,function(d){switch(d.label){case 0:return b=this._viewer.model,c=this._getDefaultVisibility(),g=b.getNodeIdsByGenericIds(this.getVisibilityExceptions()),g.length?[4,b.setNodesVisibility([-2],c)]:[3,3];case 1:return d.sent(),[4,b.setNodesVisibility(g,!c)];case 2:return d.sent(),[3,5];case 3:return[4,b.reset()];case 4:d.sent(),d.label=5;case 5:return[2]}})})};b.prototype._activateMarkup=function(){var b=this._viewer.lineManager;b.removeAllLines();
for(var c=0;c<this._lines.length;++c){var g=this._lines[c],g=new a.Markup.Line.LineMarkup(this._viewer,g.startPoint.copy().scale(1E3),g.endPoint.copy().scale(1E3));b.addLine(g)}};b.prototype._activateCuttingPlanes=function(){return __awaiter(this,void 0,void 0,function(){var b,c,g,d,f,e,h,q,t,u;return __generator(this,function(w){switch(w.label){case 0:return b=this._viewer.model,[4,b.getModelBounding(!0,!1)];case 1:return c=w.sent(),g=this._viewer.cuttingManager,[4,g.deactivateCuttingSections(!0)];
case 2:w.sent(),d=0,w.label=3;case 3:if(!(d<this._clippingPlanes.length))return[3,7];f=g.getCuttingSection(d);return[4,f.clear()];case 4:return w.sent(),e=this._clippingPlanes[d],h=e.location.copy().scale(1E3),q=e.direction.normalize(),t=a.Plane.createFromPointAndNormal(h,q),u=g.createReferenceGeometryFromFaceNormal(q,h,c),[4,f.addPlane(t,u)];case 5:w.sent(),w.label=6;case 6:return++d,[3,3];case 7:return[4,g.activateCuttingSections()];case 8:return w.sent(),[2]}})})};b.prototype._activateSelected=
function(){var b=this._getGenericIdsFromComponents(this._components.selection);if(b){b=this._viewer.model.getNodeIdsByGenericIds(b);this._viewer.selectionManager.clear();for(var c=0;c<b.length;++c)this._viewer.selectionManager.selectNode(b[c],a.SelectionMode.Add)}};b.prototype._activateColors=function(){return __awaiter(this,void 0,void 0,function(){var b,c,g,d,a;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.model,[4,b.resetNodesColor()];case 1:f.sent();if(void 0===
this._components.coloring)return[3,3];c=new Map;g=function(g){var a=d._components.coloring[g];g=d._getGenericIdsFromComponents(a.components);b.getNodeIdsByGenericIds(g).forEach(function(b){c.set(b,a.color)})};d=this;for(a=0;a<this._components.coloring.length;++a)g(a);return[4,this._viewer.model.setNodesColors(c)];case 2:f.sent(),f.label=3;case 3:return[2]}})})};b.prototype.getFilename=function(){return this._filename};b.prototype.getViewpointGuid=function(){return this._viewpointGuid||null};b.prototype._fromBCFPerspectiveCamera=
function(b,c){var g=new a.Camera;g.setProjection(a.Projection.Perspective);var d=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=a.Point3.add(d,c);var f=b.cameraUpVector.copy().normalize();g.setPosition(d);g.setTarget(c);g.setUp(f);b=a.Util.degreesToRadians(b.fieldOfView);b=Math.tan(b/2);b*=2*a.Point3.subtract(g.getTarget(),g.getPosition()).length();g.setWidth(b);g.setHeight(b);return g};b.prototype._fromBCFOrthogonalCamera=function(b,c){var g=new a.Camera;
g.setProjection(a.Projection.Orthographic);var d=b.cameraViewPoint.copy().scale(this._unitScale);c=b.cameraDirection.copy().normalize().scale(c);c=a.Point3.add(d,c);var f=b.cameraUpVector.copy().normalize();g.setPosition(d);g.setTarget(c);g.setUp(f);b=b.viewToWorldScale*this._unitScale*2;g.setWidth(b);g.setHeight(b);return g};b.prototype.getCamera=function(){var b=this._modelBounding.extents().length();return this._perspectiveCamera?this._fromBCFPerspectiveCamera(this._perspectiveCamera,b/40):this._orthogonalCamera?
this._fromBCFOrthogonalCamera(this._orthogonalCamera,b):null};b.prototype.setCamera=function(b){b.getProjection()===a.Projection.Perspective?(this._perspectiveCamera=this._toBCFPerspectiveCamera(b),this._orthogonalCamera=void 0):(this._orthogonalCamera=this._toBCFOrthogonalCamera(b),this._perspectiveCamera=void 0)};b.prototype._toBCFOrthogonalCamera=function(b){var c=b.getPosition(),g=b.getTarget(),g=a.Point3.subtract(g,c).normalize(),d=b.getUp().normalize(),c=c.copy().scale(1/this._unitScale);b=
b.getWidth()/(2*this._unitScale);return{cameraDirection:g,cameraUpVector:d,cameraViewPoint:c,viewToWorldScale:b}};b.prototype._toBCFPerspectiveCamera=function(b){var c=b.getPosition(),g=b.getTarget(),g=a.Point3.subtract(g,c).normalize(),d=b.getUp().normalize(),c=c.copy().scale(1/this._unitScale),f=b.getWidth();b=a.Point3.subtract(b.getTarget(),b.getPosition()).length();b=a.Util.radiansToDegrees(2*Math.atan(f/(2*b)));return{cameraDirection:g,cameraUpVector:d,cameraViewPoint:c,fieldOfView:b}};b.prototype.setDefaultVisibility=
function(b){this._components.defaultVisibility=b};b.prototype._getDefaultVisibility=function(){return void 0!==this._components.defaultVisibility?this._components.defaultVisibility:!0};b.prototype.setVisibilityExceptions=function(b){b=b.map(function(b){return{ifcGuid:b}});this._components.visibilityExceptions=b};b.prototype.getVisibilityExceptions=function(){return this._getGenericIdsFromComponents(this._components.visibilityExceptions)};b.prototype.setColors=function(b){var c=[];b.forEach(function(b,
g){var l=[];b.forEach(function(b){l.push({ifcGuid:b})});c.push({color:g,components:l})});this._components.coloring=c};b.prototype.getColors=function(){var b=new Map,c=this._components.coloring;void 0!==c&&c.forEach(function(c){var g=c.color.copy(),d=new Set;c.components.map(function(b){d.add(b.ifcGuid)});b.set(g,d)});return b};b.prototype.setLines=function(b){var c=this;this._lines=[];b.forEach(function(b){b={startPoint:b[0].copy(),endPoint:b[1].copy()};c._lines.push(b)})};b.prototype.getLines=function(){var b=
[];this._lines.forEach(function(c){b.push([c.startPoint.copy(),c.endPoint.copy()])});return b};b.prototype.setClippingPlanes=function(b){var c=this;this._clippingPlanes=[];b.forEach(function(b){b={location:b[0].copy(),direction:b[1].copy()};c._clippingPlanes.push(b)})};b.prototype.getClippingPlanes=function(){var b=[];this._clippingPlanes.forEach(function(c){b.push([c.location.copy(),c.direction.copy()])});return b};b.prototype.setSelection=function(b){b=b.map(function(b){return{ifcGuid:b}});this._components.selection=
b};b.prototype.getSelection=function(){var b=[],c=this._components.selection;void 0!==c&&c.forEach(function(c){b.push(c.ifcGuid)});return b};b.prototype._getGenericIdsFromComponents=function(b){if(!b)return[];for(var c=[],g=0;g<b.length;++g)c.push(b[g].ifcGuid);return c};b.prototype._parseComponentsV2_0=function(b){console.assert(this._version<=a.BCFVersion.v2_0);var c=[],g=[],d=[],f=!0;for(b=b.firstElementChild;null!==b;){var e=b.localName;if(null===e)break;switch(e){case "Component":var h=b.attributes,
q=h.getNamedItem("IfcGuid"),e=h.getNamedItem("Selected"),t=h.getNamedItem("Visible"),h=h.getNamedItem("Color");null!==q&&q.value&&(q={ifcGuid:q.value},null!==e&&"true"===e.value&&c.push(q),f=!1,null!==t&&"false"===t.value||g.push(q),null!==h&&h.value&&d.push(this._colorFromArgb(h.value,[q])))}b=b.nextElementSibling}this._components={defaultVisibility:f,selection:c,visibilityExceptions:g,coloring:d}};b.prototype._parseComponents=function(b){console.assert(this._version>=a.BCFVersion.v2_1);b=b.firstElementChild;
for(var c={spacesVisible:!1,spaceBoundariesVisible:!1,openingsVisible:!1},g=[],d=!0,f=[],e=[];null!==b;){var h=b.localName;if(null===h)break;var q=b.attributes;switch(h){case "ViewSetupHints":var h=q.getNamedItem("SpacesVisible"),t=q.getNamedItem("SpaceBoundariesVisible"),q=q.getNamedItem("OpeningsVisible");null!==h&&(c.spacesVisible="true"===h.value);null!==t&&(c.spaceBoundariesVisible="true"===t.value);null!==q&&(c.openingsVisible="true"===q.value);break;case "Selection":g=this._getComponents(b);
break;case "Visibility":(q=q.getNamedItem("DefaultVisibility"))&&(d="true"===q.value);q=b.firstElementChild;null!==q&&(f=this._getComponents(q));break;case "Coloring":e=this._getColoring(b)}b=b.nextElementSibling}this._components={viewSetupHints:c,selection:g,defaultVisibility:d,visibilityExceptions:f,coloring:e}};b.prototype._getCameraData=function(b){var c=[];for(b=b.firstElementChild;null!==b;)switch(b.nodeName){case "FieldOfView":case "ViewToWorldScale":b=b.textContent;null!==b&&c.push(parseFloat(b));
b=null;break;default:c.push(this._getPoint(b)),b=b.nextElementSibling}return c};b.prototype._parseOrthogonalCamera=function(b){b=this._getCameraData(b);4===b.length&&(this._orthogonalCamera={cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],viewToWorldScale:b[3]})};b.prototype._parsePerspectiveCamera=function(b){b=this._getCameraData(b);4===b.length&&(this._perspectiveCamera={cameraViewPoint:b[0],cameraDirection:b[1],cameraUpVector:b[2],fieldOfView:b[3]})};b.prototype._parseLines=function(b){for(b=
b.firstElementChild;null!==b;)this._lines.push(this._getLine(b)),b=b.nextElementSibling};b.prototype._parseClippingPlanes=function(b){for(b=b.firstElementChild;null!==b;)this._clippingPlanes.push(this._getClippingPlane(b)),b=b.nextElementSibling};b.prototype._getClippingPlane=function(b){b=b.firstElementChild;var c=a.Point3.zero(),g=a.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(g=this._getPoint(b)));return{location:c,direction:g}};b.prototype._getLine=function(b){b=
b.firstElementChild;var c=a.Point3.zero(),g=a.Point3.zero();null!==b&&(c=this._getPoint(b),b=b.nextElementSibling,null!==b&&(g=this._getPoint(b)));return{startPoint:c,endPoint:g}};b.prototype._getPoint=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var g=b.firstChild;null!==g&&c.push(parseFloat(g.wholeText));b=b.nextElementSibling}console.assert(3===c.length);return new a.Point3(c[0],c[1],c[2])};b.prototype._colorFromArgb=function(b,c){c={color:a.Color.black(),components:c};for(var g=[],
d=0;d<b.length;d+=2){var f=b.substr(d,2);g.push(parseInt(f,16))}3===g.length?c.color.set(g[0],g[1],g[2]):4===g.length&&(c.alpha=g[0],c.color.set(g[1],g[2],g[3]));return c};b.prototype._getColoring=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var g=b.attributes.getNamedItem("Color"),d=this._getComponents(b);g&&d.length&&c.push(this._colorFromArgb(g.value,d));b=b.nextElementSibling}return c};b.prototype._getComponents=function(b){var c=[];for(b=b.firstElementChild;null!==b;){var g=b.attributes,
d=g.getNamedItem("IfcGuid"),a=g.getNamedItem("OriginatingSystem"),g=g.getNamedItem("AuthoringToolId");null!==d&&(d={ifcGuid:d.value},null!==a&&(d.originatingSystem=a.value),null!==g&&(d.authoringToolId=g.value),c.push(d));b=b.nextElementSibling}return c};return b}();a.BCFViewpoint=b})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(f,d,c){this.x=f;this.y=d;this.z=c}a.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};a.prototype.set=function(a,d,c){this.x=a;this.y=d;this.z=c;return this};a.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z};a.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this};a.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};a.prototype.subtract=function(a){this.x-=a.x;this.y-=
a.y;this.z-=a.z;return this};a.prototype.copy=function(){return new a(this.x,this.y,this.z)};a.fromJson=function(f){return new a(f.x,f.y,f.z)};a.construct=function(f){return a.fromJson(f)};a.prototype.toJson=function(){return{x:this.x,y:this.y,z:this.z}};a.prototype.forJson=function(){return this.toJson()};a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z};a.prototype.equalsWithTolerance=function(a,d){return this.x-a.x<d&&this.x-a.x>-d&&this.y-a.y<d&&this.y-a.y>-d&&this.z-
a.z<d&&this.z-a.z>-d};a.prototype.isAxis=function(){return 1===Math.abs(this.x)&&0===this.y&&0===this.z||0===this.x&&1===Math.abs(this.y)&&0===this.z||0===this.x&&0===this.y&&1===Math.abs(this.z)};a.prototype.length=function(){return Math.sqrt(this.squaredLength())};a.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y+this.z*this.z};a.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};a.prototype.normalize=function(){return this.scale(1/this.length())};a.prototype.negate=
function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};a.zero=function(){return new a(0,0,0)};a.add=function(f,d){return new a(f.x+d.x,f.y+d.y,f.z+d.z)};a.subtract=function(f,d){return new a(f.x-d.x,f.y-d.y,f.z-d.z)};a.dot=function(a,d){return a.x*d.x+a.y*d.y+a.z*d.z};a.cross=function(f,d){return new a(f.y*d.z-f.z*d.y,f.z*d.x-f.x*d.z,f.x*d.y-f.y*d.x)};a.distance=function(f,d){return a.subtract(d,f).length()};a.scale=function(a,d){return a.copy().scale(d)};a.createFromArray=function(f){return new a(f[0],
f[1],f[2])};return a}();a.Point3=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(){this.loadIdentity()}e.prototype.loadIdentity=function(){this.m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};e.prototype.isIdentity=function(){var a=this.m;return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]};e.prototype.equals=function(a){for(var d=0;16>d;++d)if(this.m[d]!==a.m[d])return!1;return!0};e.prototype.equalsWithTolerance=function(a,
d){d=Math.abs(d);for(var c=0;16>c;++c)if(Math.abs(this.m[c]-a.m[c])>d)return!1;return!0};e.prototype.setScaleComponent=function(a,d,c){this.m[0]=a;this.m[5]=d;this.m[10]=c;return this};e.prototype.setTranslationComponent=function(a,d,c){this.m[12]=a;this.m[13]=d;this.m[14]=c;return this};e.prototype.copy=function(){var a=new e;a.m=this.m.slice();return a};e.prototype.assign=function(a){for(var d=0;d<a.m.length;d++)this.m[d]=a.m[d];return this};e.prototype.scale=function(a){for(var d=0;16>d;d++)this.m[d]*=
a;return this};e.prototype.transform=function(f,d){if(void 0===d)return d=a.Point3.zero(),this.transform(f,d),d;d.set(f.x*this.m[0]+f.y*this.m[4]+f.z*this.m[8]+this.m[12],f.x*this.m[1]+f.y*this.m[5]+f.z*this.m[9]+this.m[13],f.x*this.m[2]+f.y*this.m[6]+f.z*this.m[10]+this.m[14])};e.prototype.transform4=function(f,d){if(void 0===d)return d=a.Point4.zero(),this.transform4(f,d),d;d.set(f.x*this.m[0]+f.y*this.m[4]+f.z*this.m[8]+this.m[12]*f.w,f.x*this.m[1]+f.y*this.m[5]+f.z*this.m[9]+this.m[13]*f.w,f.x*
this.m[2]+f.y*this.m[6]+f.z*this.m[10]+this.m[14]*f.w,f.x*this.m[3]+f.y*this.m[7]+f.z*this.m[11]+this.m[15]*f.w)};e.prototype.transformArray=function(f,d){for(var c=0;c<f.length;c++){var b=f[c],b=new a.Point3(b.x*this.m[0]+b.y*this.m[4]+b.z*this.m[8]+this.m[12],b.x*this.m[1]+b.y*this.m[5]+b.z*this.m[9]+this.m[13],b.x*this.m[2]+b.y*this.m[6]+b.z*this.m[10]+this.m[14]);d[c]=b}};e.prototype.transformBox=function(f){if(f.isDegenerate())return a.Box.invalid();f=f.getCorners();for(var d=0;d<f.length;d++){var c=
f[d];this.transform(c,c)}for(var d=new a.Box(f[0],f[0]),b=1;b<f.length;++b)c=f[b],d.addPoint(c);return d};e.prototype.transpose=function(){var a;a=this.m[1];this.m[1]=this.m[4];this.m[4]=a;a=this.m[2];this.m[2]=this.m[8];this.m[8]=a;a=this.m[3];this.m[3]=this.m[12];this.m[12]=a;a=this.m[6];this.m[6]=this.m[9];this.m[9]=a;a=this.m[7];this.m[7]=this.m[13];this.m[13]=a;a=this.m[11];this.m[11]=this.m[14];this.m[14]=a;return this};e.createFromArray=function(a){var d=new e;d.m=a.slice();return d};e.createFromOffAxisRotation=
function(a,d){var c=Math.PI/180*d;d=Math.sin(c);var c=Math.cos(c),b=new e;a=a.copy().normalize();var g=1-c,l=g*a.x*a.y,v=g*a.x*a.z,p=g*a.y*a.z;b.m[0]=g*a.x*a.x+c;b.m[1]=d*a.z+l;b.m[2]=v-d*a.y;b.m[3]=0;b.m[4]=l-d*a.z;b.m[5]=g*a.y*a.y+c;b.m[6]=d*a.x+p;b.m[7]=0;b.m[8]=d*a.y+v;b.m[9]=p-d*a.x;b.m[10]=g*a.z*a.z+c;b.m[11]=0;b.m[12]=0;b.m[13]=0;b.m[14]=0;b.m[15]=1;return b};e.createFromBasis=function(a,d,c){var b=new e;b.m[0]=a.x;b.m[1]=a.y;b.m[2]=a.z;b.m[4]=d.x;b.m[5]=d.y;b.m[6]=d.z;b.m[8]=c.x;b.m[9]=c.y;
b.m[10]=c.z;return b};e.multiply=function(a,d){var c=new e;c.m[0]=a.m[0]*d.m[0]+a.m[1]*d.m[4]+a.m[2]*d.m[8]+a.m[3]*d.m[12];c.m[1]=a.m[0]*d.m[1]+a.m[1]*d.m[5]+a.m[2]*d.m[9]+a.m[3]*d.m[13];c.m[2]=a.m[0]*d.m[2]+a.m[1]*d.m[6]+a.m[2]*d.m[10]+a.m[3]*d.m[14];c.m[3]=a.m[0]*d.m[3]+a.m[1]*d.m[7]+a.m[2]*d.m[11]+a.m[3]*d.m[15];c.m[4]=a.m[4]*d.m[0]+a.m[5]*d.m[4]+a.m[6]*d.m[8]+a.m[7]*d.m[12];c.m[5]=a.m[4]*d.m[1]+a.m[5]*d.m[5]+a.m[6]*d.m[9]+a.m[7]*d.m[13];c.m[6]=a.m[4]*d.m[2]+a.m[5]*d.m[6]+a.m[6]*d.m[10]+a.m[7]*
d.m[14];c.m[7]=a.m[4]*d.m[3]+a.m[5]*d.m[7]+a.m[6]*d.m[11]+a.m[7]*d.m[15];c.m[8]=a.m[8]*d.m[0]+a.m[9]*d.m[4]+a.m[10]*d.m[8]+a.m[11]*d.m[12];c.m[9]=a.m[8]*d.m[1]+a.m[9]*d.m[5]+a.m[10]*d.m[9]+a.m[11]*d.m[13];c.m[10]=a.m[8]*d.m[2]+a.m[9]*d.m[6]+a.m[10]*d.m[10]+a.m[11]*d.m[14];c.m[11]=a.m[8]*d.m[3]+a.m[9]*d.m[7]+a.m[10]*d.m[11]+a.m[11]*d.m[15];c.m[12]=a.m[12]*d.m[0]+a.m[13]*d.m[4]+a.m[14]*d.m[8]+a.m[15]*d.m[12];c.m[13]=a.m[12]*d.m[1]+a.m[13]*d.m[5]+a.m[14]*d.m[9]+a.m[15]*d.m[13];c.m[14]=a.m[12]*d.m[2]+
a.m[13]*d.m[6]+a.m[14]*d.m[10]+a.m[15]*d.m[14];c.m[15]=a.m[12]*d.m[3]+a.m[13]*d.m[7]+a.m[14]*d.m[11]+a.m[15]*d.m[15];return c};e.prototype.inverseAndDeterminant=function(){var a=this.m[4]*this.m[9]-this.m[5]*this.m[8],d=this.m[4]*this.m[10]-this.m[6]*this.m[8],c=this.m[4]*this.m[11]-this.m[7]*this.m[8],b=this.m[4]*this.m[13]-this.m[5]*this.m[12],g=this.m[4]*this.m[14]-this.m[6]*this.m[12],l=this.m[4]*this.m[15]-this.m[7]*this.m[12],v=this.m[5]*this.m[10]-this.m[6]*this.m[9],p=this.m[5]*this.m[11]-
this.m[7]*this.m[9],k=this.m[5]*this.m[14]-this.m[6]*this.m[13],r=this.m[5]*this.m[15]-this.m[7]*this.m[13],h=this.m[6]*this.m[11]-this.m[7]*this.m[10],n=this.m[6]*this.m[15]-this.m[7]*this.m[14],q=this.m[8]*this.m[13]-this.m[9]*this.m[12],t=this.m[8]*this.m[14]-this.m[10]*this.m[12],u=this.m[8]*this.m[15]-this.m[11]*this.m[12],w=this.m[9]*this.m[14]-this.m[10]*this.m[13],z=this.m[9]*this.m[15]-this.m[11]*this.m[13],y=this.m[10]*this.m[15]-this.m[11]*this.m[14],x=new e;x.m[0]=this.m[5]*y-this.m[6]*
z+this.m[7]*w;x.m[1]=this.m[2]*z-this.m[3]*w-this.m[1]*y;x.m[2]=this.m[1]*n-this.m[2]*r+this.m[3]*k;x.m[3]=this.m[2]*p-this.m[3]*v-this.m[1]*h;x.m[4]=this.m[6]*u-this.m[7]*t-this.m[4]*y;x.m[5]=this.m[0]*y-this.m[2]*u+this.m[3]*t;x.m[6]=this.m[2]*l-this.m[3]*g-this.m[0]*n;x.m[7]=this.m[0]*h-this.m[2]*c+this.m[3]*d;x.m[8]=this.m[4]*z-this.m[5]*u+this.m[7]*q;x.m[9]=this.m[1]*u-this.m[3]*q-this.m[0]*z;x.m[10]=this.m[0]*r-this.m[1]*l+this.m[3]*b;x.m[11]=this.m[1]*c-this.m[3]*a-this.m[0]*p;x.m[12]=this.m[5]*
t-this.m[6]*q-this.m[4]*w;x.m[13]=this.m[0]*w-this.m[1]*t+this.m[2]*q;x.m[14]=this.m[1]*g-this.m[2]*b-this.m[0]*k;x.m[15]=this.m[0]*v-this.m[1]*d+this.m[2]*a;a=this.m[0]*x.m[0]-this.m[1]*-x.m[4]+this.m[2]*x.m[8]-this.m[3]*-x.m[12];if(0===a)return[null,0];x.scale(1/a);return[x,a]};e.inverse=function(a){return a.inverseAndDeterminant()[0]};e.prototype.upperLeft3x3Determinant=function(){return this.m[0]*(this.m[5]*this.m[10]-this.m[9]*this.m[6])-this.m[4]*(this.m[1]*this.m[10]-this.m[9]*this.m[2])+this.m[8]*
(this.m[1]*this.m[6]-this.m[5]*this.m[2])};e.prototype.normalMatrix=function(){var a=this.copy().setTranslationComponent(0,0,0).inverseAndDeterminant()[0];return a?a.transpose():null};e.prototype.toJson=function(){return this.m.slice()};e.prototype.forJson=function(){return this.toJson()};e.fromJson=function(a){return e.createFromArray(a)};e.construct=function(a){return e.fromJson(a)};e.toMatrix12=function(a){return[a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10],a[12],a[13],a[14]]};e.xAxisRotation=
function(f){var d=new e,c=a.Util.degreesToRadians(f);f=Math.cos(c);c=Math.sin(c);d.m[5]=f;d.m[6]=-c;d.m[9]=c;d.m[10]=f;return d};e.yAxisRotation=function(f){var d=new e,c=a.Util.degreesToRadians(f);f=Math.cos(c);c=Math.sin(c);d.m[0]=f;d.m[2]=c;d.m[8]=-c;d.m[10]=f;return d};e.zAxisRotation=function(f){var d=new e,c=a.Util.degreesToRadians(f);f=Math.cos(c);c=Math.sin(c);d.m[0]=f;d.m[1]=-c;d.m[4]=c;d.m[5]=f;return d};return e}();a.Matrix=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(e,d,c){this.set(e,d,c)}a.prototype.assign=function(a){this.set(a.r,a.g,a.b);return this};a.prototype.copy=function(){return new a(this.r,this.g,this.b)};a.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b};a.prototype.set=function(a,d,c){this.r=a;this.g=d;this.b=c};a.prototype.setFromFloat=function(a,d,c){this.r=255*a;this.g=255*d;this.b=255*c};a.prototype.fromFloatArray=function(a){return this.setFromFloat(a[0],a[1],a[2])};a.prototype.getFloatArray=
function(){return[this.r/255,this.g/255,this.b/255]};a.prototype.toFloatArray=function(a){a[0]=this.r/255;a[1]=this.g/255;a[2]=this.b/255};a.fromJson=function(f){return new a(f.r,f.g,f.b)};a.prototype.toJson=function(){return{r:this.r,g:this.g,b:this.b}};a.prototype.forJson=function(){return this.toJson()};a.createFromFloat=function(f,d,c){var b=a.black();b.setFromFloat(f,d,c);return b};a.createFromFloatArray=function(f){var d=a.black();d.fromFloatArray(f);return d};a.red=function(){return new a(255,
0,0)};a.green=function(){return new a(0,255,0)};a.blue=function(){return new a(0,0,255)};a.yellow=function(){return new a(255,255,0)};a.white=function(){return new a(255,255,255)};a.black=function(){return new a(0,0,0)};return a}();a.Color=h;h=function(){return function(a,f){this.top=a;this.bottom=f}}();a.VerticalGradient=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(e){var d=this;this._position=new a.Point2(0,0);this._viewportSize=new a.Point2(200,200);this._anchor=a.OverlayAnchor.LowerLeftCorner;this._instanceKeys=[];this._firstAttachment=this._enabled=!1;this._sceneReadyCompleted=a.Util.OpenPromise.create();this._geometryCreated=!1;this._viewer=e;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(d,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._createViewport()];
case 1:return c.sent(),this._updateVisibility(),[4,this._createGeometry()];case 2:return c.sent(),this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(d,void 0,void 0,function(){var c,b,g,a,d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._sceneReadyCompleted];case 1:e.sent();c=this._viewer.model;b=0;for(g=this._instanceKeys;b<g.length;b++)a=g[b],d=c._getNodeFromInstanceInc(!0,0,a,!0),c._preventNodeDeletion(d);return[2]}})})},_firstAttachment:function(){return __awaiter(d,
void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._firstAttachment=!0,[4,this._onCameraUpdate()];case 1:return c.sent(),this._updateVisibility(),[2]}})})},modelSwitchStart:function(){d._firstAttachment=!1}})}e.prototype.setAxisColor=function(e,d){return __awaiter(this,void 0,void 0,function(){var c,b,g;return __generator(this,function(l){switch(l.label){case 0:return[4,this._sceneReadyCompleted];case 1:l.sent();switch(e){case a.Axis.X:c=this._instanceKeys[0];
b=this._instanceKeys[3];break;case a.Axis.Y:c=this._instanceKeys[1];b=this._instanceKeys[4];break;case a.Axis.Z:c=this._instanceKeys[2];b=this._instanceKeys[5];break;default:return[2]}g=this._getScEngine();g.setPartColor([0,c],a.ElementType.Faces,d);g.setPartColor([0,b],a.ElementType.Lines,d);return[2]}})})};e.prototype.setAnchor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=a,[4,this._sceneReadyCompleted];
case 1:return d.sent(),[2,this._updateViewport()]}})})};e.prototype.getAnchor=function(){return this._anchor};e.prototype.enable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){this._enabled=!0;this._updateVisibility();return[2]})})};e.prototype.disable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){this._enabled=!1;this._updateVisibility();return[2]})})};e.prototype._updateVisibility=function(){this._enabled&&
this._firstAttachment?this._showOverlay():this._hideOverlay()};e.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(a.BuiltinOverlayIndex.AxisTriad,!1)};e.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(a.BuiltinOverlayIndex.AxisTriad,!0)};e.prototype.getEnabled=function(){return this._enabled};e.prototype.getOverlayId=function(){return a.BuiltinOverlayIndex.AxisTriad};e.prototype._updateViewport=function(){return this._viewer.overlayManager.setViewport(a.BuiltinOverlayIndex.AxisTriad,
this._anchor,this._position.x,a.OverlayUnit.Pixels,this._position.y,a.OverlayUnit.Pixels,this._viewportSize.x,a.OverlayUnit.Pixels,this._viewportSize.y,a.OverlayUnit.Pixels)};e.prototype._createViewport=function(){var f=this._viewer.overlayManager;this._updateViewport();var d=new a.Camera;d.setPosition(new a.Point3(0,0,10));d.setTarget(a.Point3.zero());d.setUp(new a.Point3(0,1,0));d.setWidth(e._fieldSize);d.setHeight(e._fieldSize);d.setProjection(a.Projection.Orthographic);return f.setCamera(a.BuiltinOverlayIndex.AxisTriad,
d)};e.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var f,d,c,b,g,l,v;return __generator(this,function(p){switch(p.label){case 0:if(this._geometryCreated)return[2];f=[this._createAxis(e._xRotMatrix,0,e._xColor),this._createAxis(e._yRotMatrix,1,e._yColor),this._createAxis(e._zRotMatrix,2,e._zColor),this._createAxisLabel(a.Axis.X,e._xColor,3),this._createAxisLabel(a.Axis.Y,e._yColor,4),this._createAxisLabel(a.Axis.Z,e._zColor,5)];return[4,Promise.all(f)];case 1:d=
p.sent();this._onCameraUpdate();c=[];b=0;for(g=d;b<g.length;b++)l=g[b],c.push(0,l);v=this._getScEngine();v.setPartVisibility(c,!0,!0);this._createGeomCallbacks();this._geometryCreated=!0;return[2]}})})};e.prototype._createGeomCallbacks=function(){var a=this;this._viewer.setCallbacks({camera:function(){a._onCameraUpdate()}})};e.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};e.prototype._insideOverlay=function(e){var d=this._viewer.view.getCanvasSize(),c=a.Point2.zero();
if(this._anchor===a.OverlayAnchor.LowerRightCorner||this._anchor===a.OverlayAnchor.UpperRightCorner||this._anchor===a.OverlayAnchor.RightCenter)c.x=d.x-this._viewportSize.x;else if(this._anchor===a.OverlayAnchor.Center||this._anchor===a.OverlayAnchor.TopCenter||this._anchor===a.OverlayAnchor.BottomCenter)c.x=.5*(d.x-this._viewportSize.x);if(this._anchor===a.OverlayAnchor.LowerLeftCorner||this._anchor===a.OverlayAnchor.LowerRightCorner||this._anchor===a.OverlayAnchor.BottomCenter)c.y=d.y-this._viewportSize.y;
else if(this._anchor===a.OverlayAnchor.Center||this._anchor===a.OverlayAnchor.LeftCenter||this._anchor===a.OverlayAnchor.RightCenter)c.y=.5*(d.y-this._viewportSize.y);return e.x>=c.x&&e.x<=this._viewportSize.x+c.x&&e.y>=c.y&&e.y<=this._viewportSize.y+c.y};e.prototype._getOverlayOffset=function(){return this._viewer.overlayManager._getOverlayOffset(this._anchor,this._viewportSize)};e.prototype._getViewportSize=function(){return this._viewportSize};e.prototype.getSelectionAxis=function(e){console.assert(this._enabled);
if(null===e||!e.isFaceSelection()||e.overlayIndex()!==a.BuiltinOverlayIndex.AxisTriad)return null;var d=this._viewer.model;e=e.getNodeId();d=d._gatherInstanceIncsFromNodeIds([e],1);if(2!==d.length||0!==d[0])return null;d=d[1];for(e=0;e<this._instanceKeys.length;++e)if(this._instanceKeys[e]===d)switch(e%3){case 0:return a.Axis.X;case 1:return a.Axis.Y;case 2:return a.Axis.Z}return null};e.prototype._onClickSelection=function(e){return __awaiter(this,void 0,void 0,function(){var d,c,b,g,l,v,p;return __generator(this,
function(k){switch(k.label){case 0:d=this.getSelectionAxis(e);if(null===d)return[2];c=this._viewer.model;b=this._viewer.view;switch(d){case a.Axis.X:g=34;break;case a.Axis.Y:g=68;break;case a.Axis.Z:g=24}return[4,c.getModelBounding(!0,!1)];case 1:return l=k.sent(),v=b.getCamera(),p=this._alignedFitBounding(g,!1,!1,l),v.equals(p)&&(p=this._alignedFitBounding(g,!0,!1,l)),[2,b._setCameraPromise(p,a.DefaultTransitionDuration)]}})})};e.prototype._getScEngine=function(){return this._viewer._getScEngine()};
e.prototype._createInstance=function(e,d,c,b,g,l){return __awaiter(this,void 0,void 0,function(){var v,p,k,r,h;return __generator(this,function(n){switch(n.label){case 0:return[4,this._viewer.model.createMesh(e)];case 1:return v=n.sent(),p=new a.MeshInstanceData(v),p.setCreationFlags(l|a.MeshInstanceCreationFlags.DoNotCut|a.MeshInstanceCreationFlags.DoNotExplode|a.MeshInstanceCreationFlags.ExcludeBounding|a.MeshInstanceCreationFlags.Invisible),p.setOverlayIndex(a.BuiltinOverlayIndex.AxisTriad),p.setFaceColor(c),
p.setLineColor(b),p.setMatrix(g),k=this._getScEngine(),[4,k.createMeshInstance(p)];case 2:return r=n.sent(),h=r[1],this._instanceKeys[d]=h,[2,h]}})})};e.prototype._createAxis=function(e,d,c){var b=a.Util.generateConeCylinderMeshData(.2,20,2,.4,.5,.1);return this._createInstance(b,d,c,a.Color.black(),e,a.MeshInstanceCreationFlags.None)};e.prototype._createAxisLabel=function(e,d,c){var b=new a.MeshData;b.setFaceWinding(a.FaceWinding.Clockwise);var g=new a.Matrix;e===a.Axis.X?(b.addPolyline([.15,.25,
0,-.15,-.25,0]),b.addPolyline([-.15,.25,0,.15,-.25,0]),g.setTranslationComponent(3.1,0,0)):e===a.Axis.Y?(b.addPolyline([-.15,.25,0,0,0,0]),b.addPolyline([0,0,0,.15,.25,0]),b.addPolyline([0,0,0,0,-.3125,0]),g.setTranslationComponent(0,3.1,0)):e===a.Axis.Z&&(b.addPolyline([-.15,.25,0,.15,.25,0]),b.addPolyline([.15,.25,0,-.15,-.25,0]),b.addPolyline([-.15,-.25,0,.15,-.25,0]),g.setTranslationComponent(0,0,3.1));return this._createInstance(b,c,a.Color.black(),d,g,a.MeshInstanceCreationFlags.ScreenOriented)};
e.prototype._onCameraUpdate=function(){var f=new a.Camera,d=this._viewer.view.getCamera();f.setPosition(d.getPosition().subtract(d.getTarget()).normalize());f.setTarget(a.Point3.zero());f.setUp(d.getUp());f.setProjection(a.Projection.Orthographic);f.setWidth(e._fieldSize);f.setHeight(e._fieldSize);return this._viewer.overlayManager.setCamera(a.BuiltinOverlayIndex.AxisTriad,f)};e.prototype._alignedFitBounding=function(e,d,c,b){var g=a.Point3.subtract(b.max,b.min).length();b=a.Point3.add(a.Point3.scale(b.min,
.5),a.Point3.scale(b.max,.5));var l=new a.Point3(b.x,b.y,b.z+g),l=a.Point3.subtract(b,l),v=-l.length();c=c?-1:1;0===e?(e=new a.Point3(0,c,0),d&&l.negate()):(d&&(v=-v),0!==(e&2)?l=new a.Point3(v,0,0):0!==(e&4)?l=new a.Point3(0,v,0):(console.assert(0!==(e&8)),l=new a.Point3(0,0,v)),0!==(e&16)?e=new a.Point3(c,0,0):0!==(e&32)?e=new a.Point3(0,c,0):(console.assert(0!==(e&64)),e=new a.Point3(0,0,c)));d=a.Point3.subtract(b,l);c=this._viewer.view.getCamera();return a.Camera.create(d,b,e,c.getProjection(),
g,g,c.getNearLimit())};e._xRotMatrix=a.Matrix.createFromOffAxisRotation(new a.Point3(0,0,1),-90);e._yRotMatrix=new a.Matrix;e._zRotMatrix=a.Matrix.createFromOffAxisRotation(new a.Point3(1,0,0),90);e._xColor=new a.Color(168,56,59);e._yColor=new a.Color(96,166,50);e._zColor=new a.Color(41,81,185);e._fieldSize=8;return e}();a.AxisTriad=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(a){this._id=0;this._bcfMap=new Map;this._viewer=a}e.prototype._getId=function(){return++this._id};e.prototype.getBCFMap=function(){return this._bcfMap};e.prototype.getBCFData=function(a){return this._bcfMap.get(a)||null};e.prototype.removeBCFData=function(a){this._bcfMap.delete(a);this._viewer.trigger("bcfRemoved",a)};e.prototype.createBCFData=function(e){var d=this._getId();e=new a.BCFData(e,d);this._bcfMap.set(d,e);return e};e.prototype.addBCFFromFile=function(a){return __awaiter(this,
void 0,void 0,function(){var d,c;return __generator(this,function(b){switch(b.label){case 0:return d=this.createBCFData(a),[4,new JSZip.external.Promise(function(b,c){JSZipUtils.getBinaryContent(a,function(a,d){a?c(a):b(d)})})];case 1:return c=b.sent(),[4,this._loadBCFData(c,d)];case 2:return b.sent(),[2]}})})};e.prototype.addBCFFromBuffer=function(a,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return c=this.createBCFData(d),[4,
this._loadBCFData(a,c)];case 1:return b.sent(),[2]}})})};e.prototype._getVersion=function(e){return __awaiter(this,void 0,void 0,function(){var d,c,b,g;return __generator(this,function(l){switch(l.label){case 0:return d=e.file("bcf.version"),null!==d?[3,1]:[2,a.BCFVersion.v1_0];case 1:return[4,this._getDocument(d)];case 2:c=l.sent();b=c.documentElement;g=b.firstElementChild;if(null!==g&&null!==g.textContent)switch(g.textContent){case "2.0 RC":return[2,a.BCFVersion.v2_0];case "2.1":return[2,a.BCFVersion.v2_1]}return[2,
a.BCFVersion.Unknown]}})})};e.prototype._loadBCFData=function(e,d){return __awaiter(this,void 0,void 0,function(){var c=this,b,g,l,v,p,k,r,h,n;return __generator(this,function(q){switch(q.label){case 0:return b=this._viewer.model,[4,b.getModelBounding(!0,!1)];case 1:return g=q.sent(),l=b.getNodeUnitMultiplier(b.getAbsoluteRootNode()),v=d.getId(),p=d.getFilename(),[4,JSZip.loadAsync(e)];case 2:return k=q.sent(),h=(r=d).setVersion,[4,this._getVersion(k)];case 3:return h.apply(r,[q.sent()]),n=[],k.forEach(function(b){return __awaiter(c,
void 0,void 0,function(){var c,e,f,r,h,m,q,C,D,G,E,I,F,K,L,H,M;return __generator(this,function(J){switch(J.label){case 0:c=a.Util.OpenPromise.create();n.push(c);e=this._getFileType(b);if(e!==a.BCFFileType.Markup&&e!==a.BCFFileType.Snapshot&&e!==a.BCFFileType.Viewpoint)return[3,7];f=b.split("/");r=f[0];h=f[1];m=d.getTopic(r);null===m&&(m=new a.BCFTopic(v,p,r,this._viewer),d.addTopic(r,m));if(!h.length)return[3,7];q=k.file(b);if(null===q)return[3,7];C=e;switch(C){case a.BCFFileType.Markup:return[3,
1];case a.BCFFileType.Viewpoint:return[3,3];case a.BCFFileType.Snapshot:return[3,5]}return[3,7];case 1:return G=(D=m).addMarkup,E=[h],[4,this._getDocument(q)];case 2:return G.apply(D,E.concat([J.sent()])),[3,7];case 3:return F=(I=m).addViewpoint,K=[h],[4,this._getDocument(q)];case 4:return F.apply(I,K.concat([J.sent(),d.getVersion(),g,l])),[3,7];case 5:return H=(L=m).addSnapshot,M=[h],[4,q.async("uint8array")];case 6:return H.apply(L,M.concat([J.sent()])),[3,7];case 7:return c.resolve(),[2]}})})}),
[4,a.Util.waitForAll(n)];case 4:return q.sent(),this._viewer.trigger("bcfLoaded",v,p),[2]}})})};e.prototype._getDocument=function(a){return __awaiter(this,void 0,void 0,function(){var d,c,b;return __generator(this,function(g){switch(g.label){case 0:return d=new DOMParser,b=(c=d).parseFromString,[4,a.async("text")];case 1:return[2,b.apply(c,[g.sent(),"application/xml"])]}})})};e.prototype._getFileType=function(e){if("/"===e.slice(-1))return a.BCFFileType.TopicFolder;e=e.split(".");console.assert(2===
e.length);switch(e[1]){case "bcf":return a.BCFFileType.Markup;case "bcfv":return a.BCFFileType.Viewpoint;case "png":return a.BCFFileType.Snapshot;case "version":return a.BCFFileType.Version;case "xsd":return a.BCFFileType.Schema;case "bcfp":return a.BCFFileType.Project}return a.BCFFileType.Unknown};return e}();a.BCFManager=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(e,d){void 0===e&&(e=a.Point3.zero());void 0===d&&(d=a.Point3.zero());this.min=e.copy();this.max=d.copy()}e.prototype.copy=function(){return new e(this.min,this.max)};e.prototype.equals=function(a){return this.min.equals(a.min)&&this.max.equals(a.max)};e.prototype.center=function(){var e=a.Point3.add(this.min,this.max);e.scale(.5);return e};e.prototype.extents=function(){return a.Point3.subtract(this.max,this.min)};e.prototype.addBox=function(a){a.isDegenerate()||
(this.addPoint(a.min),this.addPoint(a.max))};e.prototype.addPoint=function(a){a.x<this.min.x&&(this.min.x=a.x);a.y<this.min.y&&(this.min.y=a.y);a.z<this.min.z&&(this.min.z=a.z);a.x>this.max.x&&(this.max.x=a.x);a.y>this.max.y&&(this.max.y=a.y);a.z>this.max.z&&(this.max.z=a.z)};e.prototype.toJson=function(){return{min:this.min.toJson(),max:this.max.toJson()}};e.prototype.forJson=function(){return this.toJson()};e.fromJson=function(f){var d=a.Point3.fromJson(f.min);f=a.Point3.fromJson(f.max);return new e(d,
f)};e.construct=function(a){return e.fromJson(a)};e.prototype.getCorners=function(){var a=[];a[0]=this.min.copy();a[1]=this.min.copy();a[2]=this.min.copy();a[1].x=this.max.x;a[2].y=this.max.y;a[3]=a[2].copy();a[3].x=this.max.x;a[4]=a[0].copy();a[5]=a[1].copy();a[6]=a[2].copy();a[7]=a[3].copy();a[4].z=this.max.z;a[5].z=this.max.z;a[6].z=this.max.z;a[7].z=this.max.z;return a};e.invalid=function(){return new e(new a.Point3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),new a.Point3(Number.NEGATIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY))};e.prototype.isDegenerate=function(){return this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z};return e}();a.Box=h})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(){var a=this;this._aliasMap=new Map;this._callbackMap=new Map;this._activeTriggerDepth=0;this._pendingClearUnboundFilteredNames=new Set;this._aliasMap.set("sceneRendered","frameDrawn");this.bind({selectionArray:function(c){a._triggerDeprecatedSelectionCallback(c)},incrementalSelectionBatchBegin:function(){return a.unsafeTrigger("volumeSelectionBatchBegin")},incrementalSelectionBatchEnd:function(){return a.unsafeTrigger("volumeSelectionBatchEnd")},
incrementalSelectionEnd:function(){return a.unsafeTrigger("volumeSelectionEnd")},visibilityChanged:function(c,b){a.unsafeTrigger("partsVisibilityShown",c);a.unsafeTrigger("partsVisibilityHidden",b)}})}e.prototype._triggerDeprecatedSelectionCallback=function(d){if(0===d.length)this.unsafeTrigger("selection",[a.Event.NodeSelectionEvent._createNull()]);else if(100>=d.length)this.unsafeTrigger("selection",d);else{var c=0;for(d=h.chunkify(d,100);c<d.length;c++)this.unsafeTrigger("selection",d[c])}};e.prototype._filterName=
function(a){var c=this._aliasMap.get(a);return void 0===c?a:c};e.prototype.bind=function(a,c){for(var b=0,g=Object.keys(a);b<g.length;b++){var l=g[b],e=a[l];if("function"===typeof e){var l=this._filterName(l),f=this._callbackMap.get(l);void 0===f?this._callbackMap.set(l,[e]):c?f.unshift(e):f.push(e)}}};e.prototype.unbind=function(a){for(var c=0,b=Object.keys(a);c<b.length;c++){var g=b[c],l=this._filterName(g),e=this._callbackMap.get(l);if(void 0!==e)for(var g=a[g],f=0;f<e.length;f++)e[f]===g&&(e[f]=
null,this._pendingClearUnboundFilteredNames.add(l))}this._clearUnboundCallbacks()};e.prototype._clearUnboundCallbacks=function(){var a=this;0!==this._pendingClearUnboundFilteredNames.size&&0===this._activeTriggerDepth&&(this._pendingClearUnboundFilteredNames.forEach(function(c){var b=a._callbackMap.get(c);void 0!==b&&(b=b.filter(function(b){return null!==b}),0===b.length?a._callbackMap.delete(c):a._callbackMap.set(c,b))}),this._pendingClearUnboundFilteredNames.clear())};e.prototype.promiseTrigger=
function(a,c){for(var b=[],g=2;g<arguments.length;g++)b[g-2]=arguments[g];return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(e){switch(e.label){case 0:console.assert(a!==c),e.label=1;case 1:return e.trys.push([1,3,4,5]),[4,this._unsafePromiseTrigger(a,b)];case 2:return e.sent(),[3,5];case 3:return g=e.sent(),console.log("Rejected promise in '"+a+"' callback:"),console.log(g),[3,5];case 4:return null!==c&&this.unsafeTrigger(c,b),[7];case 5:return[2]}})})};e.prototype._unsafePromiseTrigger=
function(d,c){var b=this._filterName(d),b=this._callbackMap.get(b),g=[];if(void 0!==b){++this._activeTriggerDepth;for(var l=0;l<b.length;l++){var e=b[l];if(null!==e)try{g.push(e.apply(null,c))}catch(f){console.log("Unhandled exception in '"+d+"' callback:"),console.log(f)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}return a.Util.waitForAll(g)};e.prototype.trigger=function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];this.unsafeTrigger(a,c)};e.prototype.unsafeTrigger=
function(a,c){var b=this._filterName(a),b=this._callbackMap.get(b);if(void 0!==b){++this._activeTriggerDepth;for(var g=0;g<b.length;g++){var l=b[g];if(null!==l)try{l.apply(null,c)}catch(e){console.log("Unhandled exception in '"+a+"' callback:"),console.log(e)}}--this._activeTriggerDepth;this._clearUnboundCallbacks()}};return e}();h.CallbackManager=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){a[a.LoadModel=0]="LoadModel";a[a.CreateNode=1]="CreateNode";a[a.CreateInstance=2]="CreateInstance";a[a.CreatePmi=3]="CreatePmi"})(a.NodeSource||(a.NodeSource={}));(function(a){a[a.Desktop=0]="Desktop";a[a.Mobile=1]="Mobile"})(a.ScreenConfiguration||(a.ScreenConfiguration={}));(function(a){a[a.Faces=0]="Faces";a[a.Lines=1]="Lines";a[a.Points=2]="Points"})(a.ElementType||(a.ElementType={}));(function(a){a[a.Orthographic=0]="Orthographic";a[a.Perspective=1]="Perspective"})(a.Projection||
(a.Projection={}));(function(a){a[a.Top=0]="Top";a[a.Bottom=1]="Bottom";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Front=4]="Front";a[a.Back=5]="Back";a[a.Iso=6]="Iso";a[a.TopRightFront=7]="TopRightFront";a[a.TopLeftFront=8]="TopLeftFront";a[a.TopLeftBack=9]="TopLeftBack";a[a.TopRightBack=10]="TopRightBack";a[a.TopBack=11]="TopBack";a[a.TopFront=12]="TopFront";a[a.TopLeft=13]="TopLeft";a[a.TopRight=14]="TopRight";a[a.BottomRightBack=15]="BottomRightBack";a[a.BottomLeftBack=16]="BottomLeftBack";a[a.BottomLeftFront=
17]="BottomLeftFront";a[a.BottomRightFront=18]="BottomRightFront";a[a.BottomFront=19]="BottomFront";a[a.BottomBack=20]="BottomBack";a[a.BottomLeft=21]="BottomLeft";a[a.BottomRight=22]="BottomRight";a[a.RightBottomBack=23]="RightBottomBack";a[a.RightBottomFront=24]="RightBottomFront";a[a.RightTopFront=25]="RightTopFront";a[a.RightTopBack=26]="RightTopBack";a[a.RightTop=27]="RightTop";a[a.RightBottom=28]="RightBottom";a[a.RightFront=29]="RightFront";a[a.RightBack=30]="RightBack";a[a.LeftBottomFront=
31]="LeftBottomFront";a[a.LeftBottomBack=32]="LeftBottomBack";a[a.LeftTopBack=33]="LeftTopBack";a[a.LeftTopFront=34]="LeftTopFront";a[a.LeftTop=35]="LeftTop";a[a.LeftBottom=36]="LeftBottom";a[a.LeftBack=37]="LeftBack";a[a.LeftFront=38]="LeftFront";a[a.FrontBottomRight=39]="FrontBottomRight";a[a.FrontTopRight=40]="FrontTopRight";a[a.FrontTopLeft=41]="FrontTopLeft";a[a.FrontBottomLeft=42]="FrontBottomLeft";a[a.FrontRight=43]="FrontRight";a[a.FrontLeft=44]="FrontLeft";a[a.FrontTop=45]="FrontTop";a[a.FrontBottom=
46]="FrontBottom";a[a.BackTopRight=47]="BackTopRight";a[a.BackBottomRight=48]="BackBottomRight";a[a.BackBottomLeft=49]="BackBottomLeft";a[a.BackTopLeft=50]="BackTopLeft";a[a.BackLeft=51]="BackLeft";a[a.BackRight=52]="BackRight";a[a.BackBottom=53]="BackBottom";a[a.BackTop=54]="BackTop"})(a.ViewOrientation||(a.ViewOrientation={}));(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(a.Axis||(a.Axis={}));(function(a){a[a.None=-1]="None";a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(a.Button||
(a.Button={}));(function(a){a[a.None=0]="None";a[a.Left=1]="Left";a[a.Right=2]="Right";a[a.Middle=4]="Middle"})(a.Buttons||(a.Buttons={}));(function(a){a[a.Axis=0]="Axis";a[a.Plane=1]="Plane";a[a.ViewPlane=2]="ViewPlane";a[a.Rotate=3]="Rotate"})(a.HandleType||(a.HandleType={}));(function(a){a[a.Translate=0]="Translate";a[a.Rotate=1]="Rotate"})(a.HandleEventType||(a.HandleEventType={}));(function(a){a[a.Invalid=-1]="Invalid";a[a.None=0]="None";a[a.Navigate=1]="Navigate";a[a.Orbit=2]="Orbit";a[a.Pan=
3]="Pan";a[a.Zoom=4]="Zoom";a[a.Walk=5]="Walk";a[a.KeyboardWalk=6]="KeyboardWalk";a[a.WalkMode=7]="WalkMode";a[a.Turntable=8]="Turntable";a[a.Select=9]="Select";a[a.AreaSelect=10]="AreaSelect";a[a.RayDrillSelect=11]="RayDrillSelect";a[a.RedlineCircle=12]="RedlineCircle";a[a.RedlineText=13]="RedlineText";a[a.RedlineRectangle=14]="RedlineRectangle";a[a.RedlinePolyline=15]="RedlinePolyline";a[a.MeasureEdgeLength=16]="MeasureEdgeLength";a[a.MeasureFaceFaceDistance=17]="MeasureFaceFaceDistance";a[a.MeasurePointPointDistance=
18]="MeasurePointPointDistance";a[a.MeasureFaceFaceAngle=19]="MeasureFaceFaceAngle";a[a.Note=20]="Note";a[a.Cutting=21]="Cutting";a[a.Handle=22]="Handle";a[a.NavCube=23]="NavCube";a[a.AxisTriad=24]="AxisTriad"})(a.OperatorId||(a.OperatorId={}));(function(a){a[a.MouseDown=0]="MouseDown";a[a.MouseMove=1]="MouseMove";a[a.MouseUp=2]="MouseUp";a[a.Mousewheel=3]="Mousewheel";a[a.TouchStart=4]="TouchStart";a[a.TouchMove=5]="TouchMove";a[a.TouchEnd=6]="TouchEnd";a[a.KeyDown=7]="KeyDown";a[a.KeyUp=8]="KeyUp";
a[a.ViewOrientationChange=9]="ViewOrientationChange"})(a.EventType||(a.EventType={}));(function(a){a[a.None=0]="None";a[a.Shift=2]="Shift";a[a.Alt=4]="Alt";a[a.Control=8]="Control";a[a.Command=16]="Command"})(a.KeyModifiers||(a.KeyModifiers={}));(function(a){a[a.Down=0]="Down";a[a.Up=1]="Up";a[a.Move=2]="Move";a[a.Wheel=3]="Wheel"})(a.MouseInputType||(a.MouseInputType={}));(function(a){a[a.Start=0]="Start";a[a.Move=1]="Move";a[a.End=2]="End"})(a.TouchInputType||(a.TouchInputType={}));(function(a){a[a.Down=
0]="Down";a[a.Up=1]="Up"})(a.KeyInputType||(a.KeyInputType={}));(function(a){a[a.Forward=0]="Forward";a[a.Backward=1]="Backward";a[a.Left=2]="Left";a[a.Right=3]="Right";a[a.Up=4]="Up";a[a.Down=5]="Down";a[a.RotateRight=6]="RotateRight";a[a.RotateLeft=7]="RotateLeft";a[a.TiltUp=8]="TiltUp";a[a.TiltDown=9]="TiltDown"})(a.WalkDirection||(a.WalkDirection={}));(function(a){a[a.Backspace=8]="Backspace";a[a.Shift=16]="Shift";a[a.Escape=27]="Escape";a[a.PgUp=33]="PgUp";a[a.PgDown=34]="PgDown";a[a.LeftArrow=
37]="LeftArrow";a[a.UpArrow=38]="UpArrow";a[a.RightArrow=39]="RightArrow";a[a.DownArrow=40]="DownArrow";a[a.Delete=46]="Delete";a[a.a=65]="a";a[a.b=66]="b";a[a.c=67]="c";a[a.d=68]="d";a[a.e=69]="e";a[a.f=70]="f";a[a.g=71]="g";a[a.h=72]="h";a[a.i=73]="i";a[a.j=74]="j";a[a.k=75]="k";a[a.l=76]="l";a[a.m=77]="m";a[a.n=78]="n";a[a.o=79]="o";a[a.p=80]="p";a[a.q=81]="q";a[a.r=82]="r";a[a.s=83]="s";a[a.t=84]="t";a[a.u=85]="u";a[a.v=86]="v";a[a.w=87]="w";a[a.x=88]="x";a[a.y=89]="y";a[a.z=90]="z";a[a._0=48]=
"_0";a[a._1=49]="_1";a[a._2=50]="_2";a[a._3=51]="_3";a[a._4=52]="_4";a[a._5=53]="_5";a[a._6=54]="_6";a[a._7=55]="_7";a[a._8=56]="_8";a[a._9=57]="_9";a[a.NumPad_0=96]="NumPad_0";a[a.NumPad_1=97]="NumPad_1";a[a.NumPad_2=98]="NumPad_2";a[a.NumPad_3=99]="NumPad_3";a[a.NumPad_4=100]="NumPad_4";a[a.NumPad_5=101]="NumPad_5";a[a.NumPad_6=102]="NumPad_6";a[a.NumPad_7=103]="NumPad_7";a[a.NumPad_8=104]="NumPad_8";a[a.NumPad_9=105]="NumPad_9"})(a.KeyCode||(a.KeyCode={}));(function(a){a[a.None=0]="None";a[a.Face=
1]="Face";a[a.Line=2]="Line";a[a.Point=4]="Point";a[a.All=7]="All"})(a.SelectionMask||(a.SelectionMask={}));(function(a){a[a.None=0]="None";a[a.Face=1]="Face";a[a.Line=2]="Line";a[a.Point=3]="Point";a[a.Part=4]="Part"})(a.SelectionType||(a.SelectionType={}));(function(a){a[a.Set=0]="Set";a[a.Add=1]="Add";a[a.Toggle=2]="Toggle"})(a.SelectionMode||(a.SelectionMode={}));(function(a){a[a.HighlightOnly=0]="HighlightOnly";a[a.OutlineOnly=1]="OutlineOnly";a[a.HighlightAndOutline=2]="HighlightAndOutline"})(a.SelectionHighlightMode||
(a.SelectionHighlightMode={}));(function(a){a[a.Info=0]="Info";a[a.Warning=1]="Warning";a[a.Error=2]="Error"})(a.InfoType||(a.InfoType={}));(function(a){a[a.Interactive=1]="Interactive";a[a.All=2]="All";a[a.OnDemand=4]="OnDemand";a[a.Default=1]="Default"})(a.StreamingMode||(a.StreamingMode={}));(function(a){a[a.Client=0]="Client";a[a.Server=1]="Server"})(a.RendererType||(a.RendererType={}));(function(a){a[a.Wireframe=0]="Wireframe";a[a.Shaded=1]="Shaded";a[a.WireframeOnShaded=2]="WireframeOnShaded";
a[a.HiddenLine=3]="HiddenLine";a[a.XRay=4]="XRay"})(a.DrawMode||(a.DrawMode={}));(function(a){a[a.Unsorted=0]="Unsorted";a[a.SingleLayer=1]="SingleLayer"})(a.XRayTransparencyMode||(a.XRayTransparencyMode={}));(function(a){a[a.SMAA=0]="SMAA";a[a.None=1]="None"})(a.AntiAliasingMode||(a.AntiAliasingMode={}));(function(a){a[a.DoNotExplode=0]="DoNotExplode";a[a.DoNotCut=1]="DoNotCut";a[a.DoNotSelect=2]="DoNotSelect";a[a.SuppressCameraScale=3]="SuppressCameraScale";a[a.OverrideSceneVisibility=4]="OverrideSceneVisibility";
a[a.DoNotLight=5]="DoNotLight";a[a.DoNotOutlineHighlight=6]="DoNotOutlineHighlight";a[a.ExcludeBounding=7]="ExcludeBounding";a[a.DoNotUseVertexColors=8]="DoNotUseVertexColors";a[a.AlwaysDraw=9]="AlwaysDraw";a[a.DoNotXRay=10]="DoNotXRay";a[a.ScreenOriented=11]="ScreenOriented";a[a.ScreenSpace=12]="ScreenSpace";a[a.ScreenSpaceStretched=13]="ScreenSpaceStretched";a[a.IgnoreExplosion=0]="IgnoreExplosion";a[a.IgnoreCutting=1]="IgnoreCutting";a[a.IgnoreSelection=2]="IgnoreSelection";a[a.IgnoreCameraScale=
3]="IgnoreCameraScale";a[a.IgnoreLighting=5]="IgnoreLighting";a[a.IgnoreOutlineHighlight=6]="IgnoreOutlineHighlight"})(a.InstanceModifier||(a.InstanceModifier={}));(function(a){a[a.None=0]="None";a[a.SuppressCameraScale=1]="SuppressCameraScale";a[a.ScreenOriented=2]="ScreenOriented";a[a.DoNotCut=4]="DoNotCut";a[a.DoNotExplode=8]="DoNotExplode";a[a.DoNotSelect=16]="DoNotSelect";a[a.DoNotLight=32]="DoNotLight";a[a.DoNotOutlineHighlight=64]="DoNotOutlineHighlight";a[a.ExcludeBounding=128]="ExcludeBounding";
a[a.DoNotUseVertexColors=256]="DoNotUseVertexColors";a[a.Invisible=512]="Invisible";a[a.DoNotXRay=1024]="DoNotXRay";a[a.AlwaysDraw=2048]="AlwaysDraw";a[a.OverrideSceneVisibility=4096]="OverrideSceneVisibility";a[a.ScreenSpace=8192]="ScreenSpace";a[a.ScreenSpaceStretched=16384]="ScreenSpaceStretched"})(a.MeshInstanceCreationFlags||(a.MeshInstanceCreationFlags={}));(function(a){a[a.None=0]="None";a[a.Model=1]="Model";a[a.Instance=2]="Instance";a[a.Ejected=4]="Ejected";a[a.All=7]="All"})(a.BoundingPreviewMode||
(a.BoundingPreviewMode={}));(function(a){a[a.CameraTarget=0]="CameraTarget";a[a.ModelCenter=1]="ModelCenter";a[a.OrbitTarget=2]="OrbitTarget"})(a.OrbitFallbackMode||(a.OrbitFallbackMode={}));(function(a){a[a.Mouse=0]="Mouse";a[a.Keyboard=1]="Keyboard"})(a.WalkMode||(a.WalkMode={}));(function(a){a[a.AssemblyNode=0]="AssemblyNode";a[a.PartInstance=1]="PartInstance";a[a.Part=2]="Part";a[a.BodyInstance=3]="BodyInstance";a[a.PmiBody=4]="PmiBody";a[a.PMIBody=4]="PMIBody";a[a.ViewFrame=5]="ViewFrame";a[a.Body=
6]="Body";a[a.BrepBody=7]="BrepBody";a[a.TessBody=8]="TessBody";a[a.WireBody=9]="WireBody";a[a.PointsBody=10]="PointsBody";a[a.Pmi=11]="Pmi";a[a.PMI=11]="PMI";a[a.CadView=12]="CadView";a[a.CADView=12]="CADView";a[a.DrawingSheet=13]="DrawingSheet";a[a.Unknown=14]="Unknown"})(a.NodeType||(a.NodeType={}));var h;(function(a){a[a.Unknown=0]="Unknown";a[a.Text=1]="Text";a[a.Dimension=2]="Dimension";a[a.Arrow=3]="Arrow";a[a.Balloon=4]="Balloon";a[a.CircleCenter=5]="CircleCenter";a[a.Coordinate=6]="Coordinate";
a[a.Datum=7]="Datum";a[a.Fastener=8]="Fastener";a[a.Gdt=9]="Gdt";a[a.Locator=10]="Locator";a[a.MeasurementPoint=11]="MeasurementPoint";a[a.Roughness=12]="Roughness";a[a.Welding=13]="Welding";a[a.Table=14]="Table";a[a.Other=15]="Other";a[a.GeometricalTolerance=16]="GeometricalTolerance"})(h=a.PmiType||(a.PmiType={}));a.PMIType=h;(function(a){a[a.Unknown=0]="Unknown";a[a.DatumIdent=1]="DatumIdent";a[a.DatumTarget=2]="DatumTarget";a[a.DimensionDistance=1]="DimensionDistance";a[a.DimensionDistanceOffset=
2]="DimensionDistanceOffset";a[a.DimensionDistanceCumulate=3]="DimensionDistanceCumulate";a[a.DimensionChamfer=4]="DimensionChamfer";a[a.DimensionSlope=5]="DimensionSlope";a[a.DimensionOrdinate=6]="DimensionOrdinate";a[a.DimensionRadius=7]="DimensionRadius";a[a.DimensionRadiusTangent=8]="DimensionRadiusTangent";a[a.DimensionRadiusCylinder=9]="DimensionRadiusCylinder";a[a.DimensionRadiusEdge=10]="DimensionRadiusEdge";a[a.DimensionDiameter=11]="DimensionDiameter";a[a.DimensionDiameterTangent=12]="DimensionDiameterTangent";
a[a.DimensionDiameterCylinder=13]="DimensionDiameterCylinder";a[a.DimensionDiameterEdge=14]="DimensionDiameterEdge";a[a.DimensionDiameterCone=15]="DimensionDiameterCone";a[a.DimensionLength=16]="DimensionLength";a[a.DimensionLengthCurvilinear=17]="DimensionLengthCurvilinear";a[a.DimensionLengthCircular=18]="DimensionLengthCircular";a[a.DimensionAngle=19]="DimensionAngle";a[a.GdtFcf=1]="GdtFcf";a[a.WeldingLine=1]="WeldingLine";a[a.WeldingSpot=2]="WeldingSpot";a[a.OtherSymbolUser=1]="OtherSymbolUser";
a[a.OtherSymbolUtility=2]="OtherSymbolUtility";a[a.OtherSymbolCustom=3]="OtherSymbolCustom";a[a.OtherGeometricReference=4]="OtherGeometricReference";a[a.OtherRegion=5]="OtherRegion"})(h=a.PmiSubType||(a.PmiSubType={}));a.PMISubType=h;(function(a){a[a.Unknown=-1]="Unknown";a[a.Context=1]="Context";a[a.Item=2]="Item";a[a.MultipleVertex=3]="MultipleVertex";a[a.UniqueVertex=4]="UniqueVertex";a[a.WireEdge=5]="WireEdge";a[a.Edge=6]="Edge";a[a.CoEdge=7]="CoEdge";a[a.Loop=8]="Loop";a[a.Face=9]="Face";a[a.Shell=
10]="Shell";a[a.Connex=11]="Connex";a[a.Body=12]="Body";a[a.SingleWireBody=13]="SingleWireBody";a[a.BrepData=14]="BrepData";a[a.WireBody=17]="WireBody"})(h=a.PmiTopoRef||(a.PmiTopoRef={}));a.PMITopoRef=h;(function(a){a[a.Unknown=0]="Unknown";a[a.Clockwise=1]="Clockwise";a[a.CounterClockwise=2]="CounterClockwise"})(a.FaceWinding||(a.FaceWinding={}));(function(a){a[a.UpperLeftCorner=0]="UpperLeftCorner";a[a.LowerLeftCorner=1]="LowerLeftCorner";a[a.LowerRightCorner=2]="LowerRightCorner";a[a.UpperRightCorner=
3]="UpperRightCorner";a[a.TopCenter=4]="TopCenter";a[a.LeftCenter=5]="LeftCenter";a[a.RightCenter=6]="RightCenter";a[a.BottomCenter=7]="BottomCenter";a[a.Center=8]="Center"})(a.OverlayAnchor||(a.OverlayAnchor={}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfCanvas=1]="ProportionOfCanvas";a[a.ProportionOfOtherDimension=2]="ProportionOfOtherDimension"})(a.OverlayUnit||(a.OverlayUnit={}));(function(a){a[a.ScreenPixels=0]="ScreenPixels";a[a.CSSPixels=1]="CSSPixels";a[a.World=2]="World";a[a.ProportionOfScreenWidth=
3]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=4]="ProportionOfScreenHeight";a[a.ProportionOfBoundingDiagonal=5]="ProportionOfBoundingDiagonal"})(a.PointSizeUnit||(a.PointSizeUnit={}));(function(a){a[a.Square=0]="Square";a[a.Disk=1]="Disk";a[a.Sphere=2]="Sphere"})(a.PointShape||(a.PointShape={}));h=function(){function a(){}Object.defineProperty(a.prototype,"bodyID",{get:function(){return this.bodyId},set:function(a){this.bodyId=a},enumerable:!0,configurable:!0});return a}();a.RefOnTopoItem=
h;(function(a){a[a.Hidden=0]="Hidden";a[a.Shown=1]="Shown";a[a.Mixed=2]="Mixed"})(a.BranchVisibility||(a.BranchVisibility={}));(function(a){a[a.Object=0]="Object";a[a.World=1]="World"})(a.CullingVectorSpace||(a.CullingVectorSpace={}));(function(a){a[a.First=8]="First";a[a.Handles=8]="Handles";a[a.AxisTriad=9]="AxisTriad";a[a.NavCube=10]="NavCube";a[a.TestFramework=11]="TestFramework"})(a.BuiltinOverlayIndex||(a.BuiltinOverlayIndex={}));h=function(){return function(){this.pos1=a.Point3.zero();this.pos2=
a.Point3.zero();this.distance=0}}();a.FaceFaceDistanceItem=h;h=function(){return function(){this.frontVector=new a.Point3(-1,0,0);this.upVector=new a.Point3(0,0,1)}}();a.ViewAxes=h;(function(a){a[a.Object=0]="Object";a[a.World=1]="World";a[a.ProportionOfScreenWidth=2]="ProportionOfScreenWidth";a[a.ProportionOfScreenHeight=3]="ProportionOfScreenHeight"})(a.LinePatternLengthUnit||(a.LinePatternLengthUnit={}));(function(a){a[a.Selected=0]="Selected";a[a.Unselected=1]="Unselected"})(a.XRayGroup||(a.XRayGroup=
{}));(function(a){a[a.Pixels=0]="Pixels";a[a.ProportionOfWidth=1]="ProportionOfWidth";a[a.ProportionOfHeight=2]="ProportionOfHeight"})(a.BlurIntervalUnit||(a.BlurIntervalUnit={}));(function(a){a[a.Undefined=0]="Undefined";a[a.Int=1]="Int";a[a.Float=2]="Float";a[a.Time=3]="Time";a[a.String=4]="String"})(a.AttributeType||(a.AttributeType={}));h=function(){return function(a,f){this.isInclusive=a;this.nodeIds=f}}();a.FilteredNodes=h;h=function(){return function(a,f){this.defaultVisibility=a;this.visibilityExceptions=
f}}();a.VisibilityState=h;h=function(){function a(){this.additionalMatrix=null;this.attachInvisibly=this.allowMissingExternalModels=!1;this.implicitlyLoadXmlExternalModels=!0}a.prototype.copy=function(){var f=new a;f.additionalMatrix=this.additionalMatrix;null!==f.additionalMatrix&&(f.additionalMatrix=f.additionalMatrix.copy());f.allowMissingExternalModels=this.allowMissingExternalModels;f.attachInvisibly=this.attachInvisibly;f.implicitlyLoadXmlExternalModels=this.implicitlyLoadXmlExternalModels;
return f};return a}();a.LoadSubtreeConfig=h;(function(a){a[a.Unknown=0]="Unknown";a[a.Catia=2]="Catia";a[a.CatiaV5=3]="CatiaV5";a[a.Cadds=4]="Cadds";a[a.Unigraphics=5]="Unigraphics";a[a.Parasolid=6]="Parasolid";a[a.Euclid=7]="Euclid";a[a.Iges=9]="Iges";a[a.Unisurf=10]="Unisurf";a[a.Vda=11]="Vda";a[a.Stl=12]="Stl";a[a.Wrl=13]="Wrl";a[a.Dxf=14]="Dxf";a[a.Acis=15]="Acis";a[a.ProE=16]="ProE";a[a.Step=18]="Step";a[a.Ideas=19]="Ideas";a[a.Jt=20]="Jt";a[a.Slw=22]="Slw";a[a.Cgr=23]="Cgr";a[a.Prc=24]="Prc";
a[a.Xvl=25]="Xvl";a[a.Hpgl=26]="Hpgl";a[a.TopSolid=27]="TopSolid";a[a.OneSpaceDesigner=28]="OneSpaceDesigner";a[a._3dxml=29]="_3dxml";a[a.Inventor=30]="Inventor";a[a.PostScript=31]="PostScript";a[a.Pdp=32]="Pdp";a[a.U3d=33]="U3d";a[a.Ifc=34]="Ifc";a[a.Dwg=35]="Dwg";a[a.Dwf=36]="Dwf";a[a.Se=37]="Se";a[a.Obj=38]="Obj";a[a.Kmz=39]="Kmz";a[a.Dae=40]="Dae";a[a._3ds=41]="_3ds";a[a.Rhino=43]="Rhino";a[a.Xml=44]="Xml";a[a._3mf=45]="_3mf";a[a.Scs=46]="Scs";a[a._3dHtml=47]="_3dHtml";a[a.Hsf=48]="Hsf";a[a.Gltf=
49]="Gltf";a[a.Revit=50]="Revit";a[a.Fbx=51]="Fbx"})(a.FileType||(a.FileType={}));(function(a){a[a.World=0]="World";a[a.ProportionOfBoundingHeight=1]="ProportionOfBoundingHeight"})(a.SimpleReflectionAttenuationUnit||(a.SimpleReflectionAttenuationUnit={}))})(Communicator||(Communicator={}));(function(a){a=a.Internal||(a.Internal={});a=a.AttachType||(a.AttachType={});a[a.Direct=0]="Direct";a[a.Indirect=1]="Indirect"})(Communicator||(Communicator={}));
(function(a){a=a.Internal||(a.Internal={});a=a.CameraFlags||(a.CameraFlags={});a[a.None=0]="None";a[a.Position=1]="Position";a[a.Target=2]="Target";a[a.Up=4]="Up";a[a.Width=8]="Width";a[a.Height=16]="Height";a[a.Projection=32]="Projection";a[a.NearLimit=64]="NearLimit"})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(){this._position=new a.Point3(0,0,1);this._target=a.Point3.zero();this._up=new a.Point3(0,1,0);this._height=this._width=0;this._projection=a.Projection.Orthographic;this._nearLimit=.01;this._cameraFlags=a.Internal.CameraFlags.None}e.prototype._clearFlags=function(){this._cameraFlags=a.Internal.CameraFlags.None};e.prototype._getFlags=function(){return this._cameraFlags};e.prototype.copy=function(){return e.create(this._position,this._target,this._up,this._projection,
this._width,this._height,this._nearLimit)};e.prototype.setPosition=function(f){this._position.assign(f);this._cameraFlags|=a.Internal.CameraFlags.Position};e.prototype.getPosition=function(){return this._position.copy()};e.prototype.setTarget=function(f){this._target.assign(f);this._cameraFlags|=a.Internal.CameraFlags.Target};e.prototype.getTarget=function(){return this._target.copy()};e.prototype.setUp=function(f){this._up.assign(f);this._cameraFlags|=a.Internal.CameraFlags.Up};e.prototype.getUp=
function(){return this._up.copy()};e.prototype.setWidth=function(f){this._width=f;this._cameraFlags|=a.Internal.CameraFlags.Width};e.prototype.getWidth=function(){return this._width};e.prototype.setHeight=function(f){this._height=f;this._cameraFlags|=a.Internal.CameraFlags.Height};e.prototype.getHeight=function(){return this._height};e.prototype.setProjection=function(f){this._projection=f;this._cameraFlags|=a.Internal.CameraFlags.Projection};e.prototype.getProjection=function(){return this._projection};
e.prototype.setNearLimit=function(f){this._nearLimit=f;this._cameraFlags|=a.Internal.CameraFlags.NearLimit};e.prototype.getNearLimit=function(){return this._nearLimit};e.prototype.equals=function(a){return this._position.equals(a._position)&&this._target.equals(a._target)&&this._up.equals(a._up)&&this._width===a._width&&this._height===a._height&&this._projection===a._projection&&this._nearLimit===a._nearLimit};e.prototype.dolly=function(a){this._position.subtract(a);this._target.subtract(a)};e.prototype.getCameraPlaneIntersectionPoint=
function(f,d){var c=a.Point3.subtract(this._position,this._target).normalize(),c=a.Plane.createFromPointAndNormal(this._target,c);f=d.raycastFromPoint(f);if(null===f)return null;d=a.Point3.zero();return c.intersectsRay(f,d)?d:null};e.prototype.getViewMatrix=function(a){return a._getScEngine().getViewMatrix(this)};e.prototype.getProjectionMatrix=function(a){return a._getScEngine().getProjectionMatrix(this)};e.prototype.getFullMatrix=function(a){return a._getScEngine().getFullCameraMatrix(this)};e.prototype.getMatrixFromCamera=
function(){var f=a.Point3.subtract(this.getTarget(),this.getPosition()).normalize(),d=this.getUp().normalize(),d=a.Point3.cross(d,f),c=a.Point3.cross(f,d);return a.Matrix.createFromBasis(d,c,f)};e.create=function(a,d,c,b,g,l,v){var p=new e;p._position.assign(a);p._target.assign(d);p._up.assign(c);p._projection=b;p._width=g;p._height=l;void 0!==v&&(p._nearLimit=v);return p};e.prototype.toJson=function(){return{position:this._position.toJson(),target:this._target.toJson(),up:this._up.toJson(),width:this._width,
height:this._height,projection:this._projection,nearLimit:this._nearLimit,className:"Communicator.Camera"}};e.prototype.forJson=function(){return this.toJson()};e.fromJson=function(f){var d=a.Point3.fromJson(f.position),c=a.Point3.fromJson(f.target),b=a.Point3.fromJson(f.up);return e.create(d,c,b,f.projection,f.width,f.height,f.nearLimit)};e.construct=function(a){return e.fromJson(a)};e.prototype.transform=function(f){if(f.isIdentity())return this.copy();var d=Math.abs(this._width),c=Math.abs(this._height),
b=this.getUp().normalize().scale(c),c=a.Point3.subtract(this._position,this._target),g=a.Point3.cross(b,c).normalize().scale(d),d=this.getTarget(),g=a.Point3.add(d,g),b=a.Point3.add(d,b),l=a.Point3.add(d,c);f.transform(d,d);f.transform(g,g);f.transform(b,b);f.transform(l,l);f=a.Point3.subtract(g,d);c=a.Point3.subtract(b,d);b=a.Point3.subtract(l,d);b=a.Point3.add(d,b);g=c.copy().normalize();f=f.length();c=c.length();0>this._width&&(f=-f);0>this._height&&(c=-c);return e.create(b,d,g,this._projection,
f,c,this._nearLimit)};return e}();a.Camera=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(f,d,c,b){var g=this;this._cuttingSections=[];this._isInit=!1;this._standinGeometryPickable=!0;this._cappingFaceColor=a.Color.createFromFloat(.5,.5,.5);this._cappingLineColor=a.Color.createFromFloat(.5,.5,.5);this._cappingIdleCallbackEnabled=!1;this._cappingIdlePromise=null;this._conservativeIsCappingIdle=!1;this._viewer=f;this._model=d;this._callbackManager=c;this._engine=b;f.setCallbacks({cappingIdle:function(b){(g._conservativeIsCappingIdle=b)&&null!==g._cappingIdlePromise&&
(g._cappingIdlePromise.resolve(),g._cappingIdlePromise=null)},_resetAssemblyTreeBegin:function(){null!==g._cappingIdlePromise&&(g._cappingIdlePromise.reject(new a.CommunicatorError("Model became reset.")),g._cappingIdlePromise=null);return Promise.resolve()}})}e.prototype.createReferenceGeometryFromAxis=function(f,d){var c=[];switch(f){case a.Axis.X:c.push(new a.Point3(0,d.max.y,d.min.z));c.push(new a.Point3(0,d.max.y,d.max.z));c.push(new a.Point3(0,d.min.y,d.max.z));c.push(new a.Point3(0,d.min.y,
d.min.z));break;case a.Axis.Y:c.push(new a.Point3(d.min.x,0,d.min.z));c.push(new a.Point3(d.max.x,0,d.min.z));c.push(new a.Point3(d.max.x,0,d.max.z));c.push(new a.Point3(d.min.x,0,d.max.z));break;case a.Axis.Z:c.push(new a.Point3(d.min.x,d.max.y,0)),c.push(new a.Point3(d.max.x,d.max.y,0)),c.push(new a.Point3(d.max.x,d.min.y,0)),c.push(new a.Point3(d.min.x,d.min.y,0))}return c};e.prototype.createReferenceGeometryFromFaceNormal=function(f,d,c){var b=[],g=(new a.Plane).setFromPointAndNormal(d,f).d,g=
d.copy().add(a.Point3.scale(f,g));d=c.center();d=a.Point3.add(d,a.Point3.scale(f,a.Point3.dot(f,a.Point3.subtract(g,d))));c=c.extents().length()/2;var g=a.Point3.subtract(d,g),l=a.Point3.cross(f,g),v=g.copy().scale(-1),e=l.copy().scale(-1);f=a.Point3.add(g,l).normalize().scale(c).add(d);l=a.Point3.add(v,l).normalize().scale(c).add(d);v=a.Point3.add(v,e).normalize().scale(c).add(d);d=a.Point3.add(g,e).normalize().scale(c).add(d);b.push(f);b.push(l);b.push(v);b.push(d);return b};e.prototype.activateCuttingSections=
function(){for(var f=[],d=0,c=this._cuttingSections;d<c.length;d++)f.push(c[d].activate());return a.Util.waitForAll(f)};e.prototype.deactivateCuttingSections=function(f){void 0===f&&(f=!1);for(var d=[],c=0,b=this._cuttingSections;c<b.length;c++){var g=b[c];f?d.push(g.clear()):d.push(g.deactivate())}return a.Util.waitForAll(d)};e.prototype.setCuttingPlaneColor=function(f){for(var d=[],c=0,b=this._cuttingSections;c<b.length;c++)d.push(b[c].setColor(f));return a.Util.waitForAll(d)};e.prototype.setCappingFaceColor=
function(a){this._cappingFaceColor=a?a.copy():null;return this._engine.setCappingFaceColor(this._cappingFaceColor)};e.prototype.getCappingFaceColor=function(){return this._cappingFaceColor?this._cappingFaceColor.copy():null};e.prototype.setCappingLineColor=function(a){this._cappingLineColor=a?a.copy():null;return this._engine.setCappingLineColor(this._cappingLineColor)};e.prototype.getCappingLineColor=function(){return this._cappingLineColor?this._cappingLineColor.copy():null};e.prototype.getCuttingSection=
function(a){return this._isInit&&a<this._cuttingSections.length?this._cuttingSections[a]:null};e.prototype.getCuttingSectionCapacity=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingPlanesPerSection:0};e.prototype.getCuttingSectionCount=function(){return void 0!==this._cuttingLimits?this._cuttingLimits.maxCuttingSections:0};e.prototype.getCuttingSectionFromNodeId=function(a){if(null!==a)for(var d=0,c=this._cuttingSections;d<c.length;d++){var b=c[d];if(0<=b._getInstanceNodeIds().indexOf(a))return b}return null};
e.prototype.setStandinGeometryPickable=function(f){this._standinGeometryPickable=f;var d=this._gatherStandinGeometryIds();return this._model.setInstanceModifier(a.InstanceModifier.IgnoreSelection,d,!f)};e.prototype.getStandinGeometryPickable=function(){return this._standinGeometryPickable};e.prototype.setCappingDelay=function(a){this._engine.setCappingDelay(a)};e.prototype.delayCapping=function(){this._engine.delayCapping()};e.prototype.enableCappingIdleCallback=function(f){f!==this._cappingIdleCallbackEnabled&&
(this._cappingIdleCallbackEnabled=f,this._conservativeIsCappingIdle=!1,f||null===this._cappingIdlePromise||(this._cappingIdlePromise.reject(new a.CommunicatorError("Capping idle callback became disabled.")),this._cappingIdlePromise=null));return this._engine.enableCappingIdleCallback(f)};e.prototype.waitForCappingIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){if(!this._cappingIdleCallbackEnabled)throw console.assert(null===this._cappingIdlePromise),
new a.CommunicatorError("Capping idle callback is not enabled.");if(this._conservativeIsCappingIdle)return[2];null===this._cappingIdlePromise&&(this._cappingIdlePromise=a.Util.OpenPromise.create());return[2,this._cappingIdlePromise]})})};e.prototype.setCappingGeometryVisibility=function(a){return this._engine.setCappingGeometryVisibility(a)};e.prototype.getCappingGeometryVisibility=function(){return this._engine.getCappingGeometryVisibility()};e.prototype.getActiveCuttingSectionCount=function(){var a=
0;if(this._cuttingLimits)for(var d=0;d<this._cuttingLimits.maxCuttingSections;d++){var c=this.getCuttingSection(d);null!==c&&(a+=c.getCount())}return a};e.prototype._init=function(){if(!this._isInit){this._cuttingLimits=this._engine.getCuttingSectionLimits();for(var f=0;f<this._cuttingLimits.maxCuttingSections;f++){var d=new a.CuttingSection(this._viewer,this._model,this._callbackManager,this,this._engine);this._cuttingSections.push(d)}this._isInit=!0}return Promise.resolve()};e.prototype._isInitialized=
function(){return this._isInit};e.prototype.refreshPlaneGeometry=function(){for(var f=[],d=0,c=this._cuttingSections;d<c.length;d++)for(var b=c[d],g=0;g<b.getCount();g++){var l=b.getPlane(g);null!==l&&f.push(b.updatePlane(g,l,new a.Matrix,!1,!1))}return a.Util.waitForAll(f)};e.prototype.hasActiveCuttingSection=function(){if(this._cuttingLimits)for(var a=0;a<this._cuttingLimits.maxCuttingSections;a++){var d=this.getCuttingSection(a);if(null!==d&&d.isActive())return!0}return!1};e.prototype.toJson=function(){for(var a=
[],d=0;d<this._cuttingSections.length;d++)a[d]=this._cuttingSections[d].toJson();return{cuttingSections:a,cappingGeometryVisibility:this.getCappingGeometryVisibility(),cappingFaceColor:this.getCappingFaceColor(),cappingLineColor:this.getCappingLineColor(),pickable:this.getStandinGeometryPickable()}};e.prototype.forJson=function(){return this.toJson()};e.prototype.fromJson=function(f){return __awaiter(this,void 0,void 0,function(){var d,c,b,g,l,v;return __generator(this,function(e){switch(e.label){case 0:d=
a.Internal.deepClone(f);c=[];b=d.cuttingSections;for(g=0;g<b.length;g++)l=b[g],v=this._cuttingSections[g],c.push(v.fromJson(l));c.push(this.setCappingGeometryVisibility(d.cappingGeometryVisibility));c.push(this.setCappingFaceColor(a.Color.fromJson(d.cappingFaceColor)));c.push(this.setCappingLineColor(a.Color.fromJson(d.cappingLineColor)));c.push(this.setStandinGeometryPickable(d.pickable));return[4,a.Util.waitForAll(c)];case 1:return e.sent(),[2,this._callbackManager.promiseTrigger("_cuttingSectionsLoaded",
null)]}})})};e.prototype._gatherStandinGeometryIds=function(){for(var a=[],d=0,c=this._cuttingSections;d<c.length;d++)for(var b=0,g=c[d]._getInstanceNodeIds();b<g.length;b++)a.push(g[b]);return a};return e}();a.CuttingManager=h})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function f(a,c,b,g,l){this._container=a;this._canvasContainerElement=c;this._markupSvgElement=b;this._redlineSvgElement=g;this._redlineElement=l}f.prototype.getCanvasContainerElement=function(){return this._canvasContainerElement};f.prototype.getMarkupSvgElement=function(){return this._markupSvgElement};f.prototype.getRedlineSvgElement=function(){return this._redlineSvgElement};f.prototype.getRedlineElement=function(){return this._redlineElement};f.prototype.shutdown=
function(){this._container.removeChild(this._markupSvgElement);this._container.removeChild(this._redlineSvgElement);this._container.removeChild(this._redlineElement);this._container.removeChild(this._canvasContainerElement)};f.createFromElement=function(d){var c=d.id;0===c.length&&(c=a.GUID.create());var b=c+"-canvas-container",g=c+"-svg",l=c+"-redline-svg",c=c+"-redline",v=document.createElement("div");v.id=b;v.style.width="100%";v.style.height="100%";v.style.position="absolute";v.tabIndex=-1;v.classList.add("webviewer-canvas");
v.oncontextmenu=function(){return!1};d.appendChild(v);b=f._createSvgElement(g);d.appendChild(b);l=f._createSvgElement(l);d.appendChild(l);g=document.createElement("div");g.id=c;g.style.position="absolute";g.style.width="100%";g.style.height="100%";g.style.pointerEvents="none";d.appendChild(g);return new f(d,v,b,l,g)};f.createFromId=function(a){a=document.getElementById(a);return null===a?null:this.createFromElement(a)};f._createSvgElement=function(a){var c=document.createElementNS("http://www.w3.org/2000/svg",
"svg");c.id=a;c.style.width="100%";c.style.height="100%";c.style.position="absolute";c.style.pointerEvents="none";c.style.overflow="hidden";c.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");return c};return f}();h.DomElements=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var f in e)e.hasOwnProperty(f)&&(a[f]=e[f])};return function(h,e){function f(){this.constructor=h}a(h,e);h.prototype=null===e?Object.create(e):(f.prototype=e.prototype,new f)}}();
(function(a){var h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(Error);a.CommunicatorError=h;var e=function(a){function c(b){b=a.call(this,"Invalid index ("+b+").")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);a.InvalidIndexError=e;e=function(a){function c(){var b=a.call(this,"Selection invalidated.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);a.SelectionInvalidatedError=
e;e=function(a){function c(){var b=a.call(this,"Internal logic error.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);a.InternalLogicError=e;e=function(a){function c(b){var g=a.call(this,"Invalid node ("+b+").")||this;Object.setPrototypeOf(g,c.prototype);g.nodeId=b;return g}__extends(c,a);return c}(h);a.InvalidNodeIdError=e;e=function(d){function c(b,g){for(var l=[],f=2;f<arguments.length;f++)l[f-2]=arguments[f];l.push(g);for(var f=[],e=0;e<l.length;e++){var k=l[e];
switch(k){case 0:f.push(a.NodeType.DrawingSheet,a.NodeType.PartInstance,a.NodeType.AssemblyNode);break;case 1:f.push(a.NodeType.BodyInstance);f.push(a.NodeType.PmiBody);f.push(a.NodeType.ViewFrame);break;case 2:f.push(a.NodeType.BodyInstance);break;case 3:f.push(a.NodeType.CadView);break;default:a.Util.TypeAssertNever(k)}}f.sort();l=[];for(e=0;e<f.length;e++)l.push(a.NodeType[f[e]]);l=d.call(this,"Expected node ("+b+") to be of "+(1===l.length?"type ("+l[0]+")":"types "+l)+".")||this;Object.setPrototypeOf(l,
c.prototype);l.nodeId=b;l.expectedTypes=f;return l}__extends(c,d);return c}(h);a.InvalidNodeTypeError=e;e=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);a.LoadError=e;var f=function(a){function c(){var b=a.call(this,"Load cancelled.")||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(e);a.LoadCancelledError=f;e=function(a){function c(b){b=a.call(this,"Missing model: '"+b+"'.")||this;Object.setPrototypeOf(b,
c.prototype);return b}__extends(c,a);return c}(e);a.MissingModelError=e;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);a.ParseError=h;e=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);a.AssemblyDataParseError=e;a.MetaDataParseError=e;h=function(a){function c(b){b=a.call(this,b)||this;Object.setPrototypeOf(b,c.prototype);return b}__extends(c,a);return c}(h);
a.XmlParseError=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(f,d,c){var b=this;this._explodeActive=!1;this._explodeMagnitude=0;this._model=f;this._engine=d;c.bind({_modelSwitched:function(){return b.stop()}})}a.prototype.start=function(a,d){this.getActive()&&this.stop();return this._doExplode(a,d)};a.prototype.setMagnitude=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return 0<a&&!this._explodeActive?[4,this.start()]:[3,2];case 1:return d.sent(),
[3,3];case 2:0===a&&this._explodeActive&&this.stop(),d.label=3;case 3:return this._explodeActive?(this._explodeMagnitude=a,[2,this._engine.setExplodeMagnitude(a)]):[2]}})})};a.prototype.stop=function(){this._engine.stopExplode();this._explodeMagnitude=0;this._explodeActive=!1;this._engine.setExplodeMagnitude(0);return Promise.resolve()};a.prototype.getMagnitude=function(){return this._explodeMagnitude};a.prototype.getActive=function(){return this._explodeActive};a.prototype._doExplode=function(a,
d){return __awaiter(this,void 0,void 0,function(){var c,b;return __generator(this,function(g){switch(g.label){case 0:return this._explodeActive=!0,c=void 0!==a&&0<a.length?this._model._gatherInstanceIncsFromNodeIds(a):[],d?[3,2]:[4,this._model.getModelBounding(!0,!1)];case 1:return b=g.sent(),this._engine.startExplode(c,b.center()),[3,3];case 2:this._engine.startExplode(c,d),g.label=3;case 3:return[2]}})})};return a}();a.ExplodeManager=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(){}a.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var d=16*Math.random()|0;return("x"===a?d:d&3|8).toString(16)})};return a}();a.GUID=h})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function f(){this._obscuredLineColor=a.Color.black();this._obscuredLineOpacity=.2;this._visibleLineColor=a.Color.black();this._visibleLineOpacity=1;this._backgroundColor=a.Color.white()}f.prototype.getObscuredLineColor=function(){return this._obscuredLineColor.copy()};f.prototype.setObscuredLineColor=function(a){this._obscuredLineColor.assign(a)};f.prototype.getObscuredLineOpacity=function(){return this._obscuredLineOpacity};f.prototype.getObscuredLineTransparency=
function(){return this.getObscuredLineOpacity()};f.prototype.setObscuredLineOpacity=function(a){0<=a&&1>=a&&(this._obscuredLineOpacity=a)};f.prototype.setObscuredLineTransparency=function(a){this.setObscuredLineOpacity(a)};f.prototype.getVisibleLineColor=function(){return this._visibleLineColor.copy()};f.prototype.setVisibleLineColor=function(a){this._visibleLineColor.assign(a)};f.prototype.getVisibleLineOpacity=function(){return this._visibleLineOpacity};f.prototype.getVisibleLineTransparency=function(){return this.getVisibleLineOpacity()};
f.prototype.setVisibleLineOpacity=function(a){0<=a&&1>=a&&(this._visibleLineOpacity=a)};f.prototype.setVisibleLineTransparency=function(a){this.setVisibleLineOpacity(a)};f.prototype.getBackgroundColor=function(){return this._backgroundColor.copy()};f.prototype.setBackgroundColor=function(a){this._backgroundColor.assign(a)};return f}();h.HiddenLineSettings=e})(a.Settings||(a.Settings={}))})(Communicator||(Communicator={}));
(function(a){(function(h){h._isMouseEventType=function(f){switch(f){case a.EventType.MouseDown:return!0;case a.EventType.MouseMove:return!0;case a.EventType.MouseUp:return!0;case a.EventType.Mousewheel:return!0;case a.EventType.TouchStart:return!1;case a.EventType.TouchMove:return!1;case a.EventType.TouchEnd:return!1;case a.EventType.KeyDown:return!1;case a.EventType.KeyUp:return!1;case a.EventType.ViewOrientationChange:return!1}};var e=function(){function a(){this._date=new Date;this._handled=!1;
this._compositePickResult=null}a.prototype._setCompositePickResult=function(a){this._compositePickResult=a};a.prototype._getCompositePickResult=function(){return this._compositePickResult};a.prototype._getPickResult=function(a){return null===this._compositePickResult?null:this._compositePickResult.fetchMostRelevant(a)};a.prototype.getHandled=function(){return this._handled};a.prototype.setHandled=function(a){this._handled=a};a.prototype.getDate=function(){return this._date};return a}();h.InputEvent=
e})(a.Event||(a.Event={}))})(Communicator||(Communicator={}));(function(a){(function(a){var e=function(a){function d(c,b,g){var d=a.call(this)||this;b;d._keyCode=c;d._eventType=g;return d}__extends(d,a);d.prototype.getKeyCode=function(){return this._keyCode};d.prototype.getEventType=function(){return this._eventType};return d}(a.InputEvent);a.KeyInputEvent=e})(a.Event||(a.Event={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function d(a,b){this._callbackManager=a;this._operatorManager=b;this._contextEventChecker=new f(this._callbackManager)}d.prototype.injectMouseDownEvent=function(c,b,g,d,f){c=new a.Event.MouseInputEvent(c,b,g,d,f,a.MouseInputType.Down);b=a.EventType.MouseDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onMouseDownEvent(c)};d.prototype.injectMouseMoveEvent=function(c,b,g,
d,f){c=new a.Event.MouseInputEvent(c,b,g,d,f,a.MouseInputType.Move);b=a.EventType.MouseMove;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b)};d.prototype.injectMouseUpEvent=function(c,b,g,d,f){c=new a.Event.MouseInputEvent(c,b,g,d,f,a.MouseInputType.Up);b=a.EventType.MouseUp;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onMouseUpEvent(c)};d.prototype.injectMousewheelEvent=
function(c,b,g,d,f){c=new a.Event.MouseWheelInputEvent(c,b,g,d,f,a.MouseInputType.Wheel);b=a.EventType.Mousewheel;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b)};d.prototype.injectKeyDownEvent=function(c,b){c=new a.Event.KeyInputEvent(c,b,a.KeyInputType.Down);b=a.EventType.KeyDown;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};d.prototype.injectKeyUpEvent=function(c,b){c=new a.Event.KeyInputEvent(c,
b,a.KeyInputType.Up);b=a.EventType.KeyUp;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager.injectEvent(c,b)};d.prototype.injectTouchStartEvent=function(c,b,g,d){c=new a.Event.TouchInputEvent(c,b,g,d,a.TouchInputType.Start);b=a.EventType.TouchStart;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onTouchStartEvent(c)};d.prototype.injectTouchMoveEvent=function(c,b,g,d){c=new a.Event.TouchInputEvent(c,
b,g,d,a.TouchInputType.Start);b=a.EventType.TouchMove;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onTouchMoveEvent(c)};d.prototype.injectTouchEndEvent=function(c,b,g,d){c=new a.Event.TouchInputEvent(c,b,g,d,a.TouchInputType.End);b=a.EventType.TouchEnd;this._callbackManager.trigger("_inputInteraction",c,b);this._operatorManager._injectSelectionEvent(c,b);this._contextEventChecker.onTouchEndEvent(c)};d.prototype.injectViewOrientationChangeEvent=
function(){this._operatorManager._injectViewOrientationChangeEvent()};return d}();h.EventDispatcher=e;var f=function(){function d(c){this._contextMenuMouseButton=a.Button.Right;this._contextMenuPositionStart=a.Point2.zero();this._touchTimer=new h.Timer;this._activeTouchCount=0;this._initialPosition=a.Point2.zero();this._callbackManager=c}d.prototype.onMouseDownEvent=function(a){a.getHandled()||this._contextMenuPositionStart.assign(a.getPosition())};d.prototype.onMouseUpEvent=function(a){if(!a.getHandled()){var b=
a.getPosition();a.getButton()===this._contextMenuMouseButton&&this._contextMenuPositionStart.equals(b)&&this._callbackManager.trigger("contextMenu",b,a.getModifiers())}};d.prototype.onTouchStartEvent=function(c){var b=this,g=c.getPosition().copy();0===this._activeTouchCount&&(this._initialPosition=g);++this._activeTouchCount;c.getHandled()||this._touchTimer.set(600,function(){b._callbackManager.trigger("contextMenu",g,a.KeyModifiers.None)})};d.prototype.onTouchMoveEvent=function(c){if(!this._touchTimer.isIdle(0)){c=
a.Point2.subtract(this._initialPosition,c.getPosition());c=Math.abs(c.squaredLength());var b=.02*window.outerHeight;c>b*b&&this._touchTimer.clear()}};d.prototype.onTouchEndEvent=function(a){0<this._activeTouchCount&&--this._activeTouchCount;this._touchTimer.clear()};return d}()})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(f,d){this.x=f;this.y=d}a.prototype.assign=function(a){this.x=a.x;this.y=a.y;return this};a.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};a.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};a.prototype.scale=function(a){this.x*=a;this.y*=a;return this};a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};a.prototype.set=function(a,d){this.x=a;this.y=d;return this};a.prototype.copy=function(){return new a(this.x,
this.y)};a.prototype.length=function(){return Math.sqrt(this.squaredLength())};a.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y};a.prototype.toJson=function(){return{x:this.x,y:this.y}};a.prototype.forJson=function(){return this.toJson()};a.subtract=function(f,d){return new a(f.x-d.x,f.y-d.y)};a.add=function(f,d){return new a(f.x+d.x,f.y+d.y)};a.distance=function(f,d){return a.subtract(d,f).length()};a.zero=function(){return new a(0,0)};a.fromPoint3=function(f){return new a(f.x,
f.y)};return a}();a.Point2=h})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){return function(){this.top=this.left=0}}(),f=function(){function d(c,b){this._isFirefox=this._isIE=!1;this._canvas=null;this._canvasEventFunctions=new Map;this._documentEventFunctions=new Map;this._pointerEventsEnabled=!0;this._captureInput=this._dragStarted=this._eventsBound=this._processInput=!1;this._elementOffset=new e;this._pointerUp=!1;this._buttons=a.Buttons.None;this._eventDispatcher=c;this._timeoutMonitor=b;this._document=document;c=navigator.userAgent.toLowerCase();
this._isIE=0<=c.indexOf("trident")||0<=c.indexOf("edge");this._isFirefox=-1<c.indexOf("firefox")}d.prototype._tryLockEventDispatcher=function(){return d._activeEventDispatcherLocked&&d._activeEventDispatcher!==this._eventDispatcher?!1:(d._activeEventDispatcher=this._eventDispatcher,d._activeOffset=this._elementOffset,d._activeEventDispatcherLocked=!0)};d.prototype._unlockEventDispatcher=function(){d._activeEventDispatcherLocked=!1};d.prototype.shutdown=function(){this.unbindEvents()};d.prototype.setDocument=
function(a){this._unbindDocumentEvents();this._document=a;this._initDocumentEvents()};d.prototype.setOptions=function(a){a.hasOwnProperty("usePointerEvents")&&this.setPointerEventsEnabled(!!a.usePointerEvents)};d.prototype.elementResize=function(){this._calculateElementOffset()};d.prototype.setPointerEventsEnabled=function(a){this._pointerEventsEnabled=a};d.prototype.getPointerEventsEnabled=function(){return this._pointerEventsEnabled};d.prototype._getCanvasEvents=function(){return this._canvasEventFunctions};
d.prototype._getDocumentEvents=function(){return this._documentEventFunctions};d.prototype._browserSupportsPointerEvents=function(){return window.hasOwnProperty("PointerEvent")};d.prototype._usePointerEvents=function(){return this._browserSupportsPointerEvents()&&this._pointerEventsEnabled&&this._isIE};d.prototype._calculateElementOffset=function(){this._elementOffset.left=0;this._elementOffset.top=0;if(null!==this._canvas)for(var a=this._canvas;a;)this._elementOffset.left+=a.offsetLeft,this._elementOffset.top+=
a.offsetTop,a=a.offsetParent};d.prototype._initDocumentEvents=function(){var a=this;this._usePointerEvents()?(this._documentEventFunctions.set("pointermove",function(b){a._processDocumentPointerMove(b)}),this._documentEventFunctions.set("pointerup",function(b){a._processDocumentPointerUp(b)})):(this._documentEventFunctions.set("mousemove",function(b){a._processDocumentMouseMove(b)}),this._documentEventFunctions.set("mouseup",function(b){a._processDocumentMouseUp(b)}));this._documentEventFunctions.forEach(function(b,
g){a._document.addEventListener(g,b)})};d.prototype._initCanvasEvents=function(){var a=this;null!==this._canvas&&(this._usePointerEvents()?(this._canvasEventFunctions.set("pointerdown",function(b){a._processPointerDown(b)}),this._canvasEventFunctions.set("pointermove",function(b){a._processPointerMove(b)}),this._canvasEventFunctions.set("pointerup",function(b){a._processPointerUp(b)}),this._canvasEventFunctions.set("pointerenter",function(b){a._processPointerEnter(b)}),this._canvasEventFunctions.set("pointerleave",
function(b){a._processPointerLeave(b)})):(this._canvasEventFunctions.set("mousedown",function(b){a._processMouseDown(b)}),this._canvasEventFunctions.set("mousemove",function(b){a._processMouseMove(b)}),this._canvasEventFunctions.set("mouseup",function(b){a._processMouseUp(b)}),this._canvasEventFunctions.set("mouseenter",function(b){a._processMouseEnter(b)}),this._canvasEventFunctions.set("mouseleave",function(b){a._processMouseLeave(b)}),this._canvasEventFunctions.set("touchstart",function(b){a._processTouchStart(b)}),
this._canvasEventFunctions.set("touchmove",function(b){a._processTouchMove(b)}),this._canvasEventFunctions.set("touchend",function(b){a._processTouchEnd(b)}),this._canvasEventFunctions.set("touchcancel",function(b){a._processTouchEnd(b)})),this._isFirefox?this._canvasEventFunctions.set("DOMMouseScroll",function(b){a._processMousewheel(b)}):this._canvasEventFunctions.set("mousewheel",function(b){a._processMousewheel(b)}),this._canvasEventFunctions.set("keydown",function(b){a._processKeyDownEvent(b)}),
this._canvasEventFunctions.set("keyup",function(b){a._processKeyUpEvent(b)}),this._canvasEventFunctions.forEach(function(b,g){a._canvas.addEventListener(g,b)}))};d.prototype.bindEvents=function(a){this._eventsBound||(this._canvas=a,this._processInput=!0,this._initCanvasEvents(),this._initDocumentEvents(),this._calculateElementOffset(),this._eventsBound=!0,this._tryLockEventDispatcher())};d.prototype._unbindDocumentEvents=function(){var a=this;this._documentEventFunctions.forEach(function(b,g){a._document.removeEventListener(g,
b)});this._documentEventFunctions.clear()};d.prototype._unbindCanvasEvents=function(){var a=this;null!==this._canvas&&(this._canvasEventFunctions.forEach(function(b,g){a._canvas.removeEventListener(g,b)}),this._canvasEventFunctions.clear());console.assert(0===this._canvasEventFunctions.size)};d.prototype.unbindEvents=function(){this._unbindCanvasEvents();this._unbindDocumentEvents();this._eventsBound=this._processInput=!1;d._activeEventDispatcher===this._eventDispatcher&&this._unlockEventDispatcher()};
d.prototype._convertEventCoordsToTargetCoords=function(c,b){var g;g=null!==d._activeOffset?d._activeOffset:this._elementOffset;return new a.Point2(c-g.left,b-g.top)};d.prototype.focusInput=function(a){null!==this._canvas&&(a?this._canvas.focus():this._canvas.blur())};d.prototype._processMouseDown=function(c){if(this._tryLockEventDispatcher()){switch(c.button){case 0:this._buttons|=a.Buttons.Left;break;case 1:this._buttons|=a.Buttons.Middle;break;case 2:this._buttons|=a.Buttons.Right}c.preventDefault();
this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY),g=this._getEventModifiers(c);d._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,c.button,this._buttons,g);this._dragStarted=!0}}};d.prototype._processMouseMove=function(c){c.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY);c=this._getEventModifiers(c);null!==d._activeEventDispatcher&&d._activeEventDispatcher.injectMouseMoveEvent(b.x,
b.y,a.Button.None,this._buttons,c)}};d.prototype._processMouseUp=function(c){this._unlockEventDispatcher();switch(c.button){case 0:this._buttons&=~a.Buttons.Left;break;case 1:this._buttons&=~a.Buttons.Middle;break;case 2:this._buttons&=~a.Buttons.Right}c.preventDefault();c.stopPropagation();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(c.pageX,c.pageY),g=this._getEventModifiers(c);null!==d._activeEventDispatcher?d._activeEventDispatcher.injectMouseUpEvent(b.x,
b.y,c.button,this._buttons,g):this._eventDispatcher.injectMouseUpEvent(b.x,b.y,c.button,this._buttons,g);this._captureInput=this._dragStarted=!1}};d.prototype._processMousewheel=function(a){a.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(a.pageX,a.pageY),g=this._getEventModifiers(a);this._eventDispatcher.injectMousewheelEvent(b.x,b.y,this._isFirefox?0<a.detail?-1:1:0<a.wheelDelta?1:-1,this._buttons,g)}};d.prototype._processDocumentMouseMove=
function(a){this._dragStarted&&this._captureInput&&this._processMouseMove(a)};d.prototype._processDocumentMouseUp=function(a){this._dragStarted&&this._captureInput&&this._processMouseUp(a)};d.prototype._processMouseLeave=function(a){this._unlockEventDispatcher();a;this._dragStarted&&(this._captureInput=!0)};d.prototype._processMouseEnter=function(a){this._tryLockEventDispatcher()&&(a,this._dragStarted&&(this._captureInput=!1))};d.prototype._isFunctionKey=function(a){return 112<=a.which&&123>=a.which};
d.prototype._processKeyDownEvent=function(a){this._isFunctionKey(a)||a.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(a);this._eventDispatcher.injectKeyDownEvent(a.which,b)}};d.prototype._processKeyUpEvent=function(a){a.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._getEventModifiers(a);this._eventDispatcher.injectKeyUpEvent(a.which,b)}};d.prototype._processTouchStart=function(a){a.preventDefault();
this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<a.changedTouches.length;b++){var g=a.changedTouches.item(b),d=this._convertEventCoordsToTargetCoords(g.pageX,g.pageY);this._eventDispatcher.injectTouchStartEvent(g.identifier,d.x,d.y,this._buttons)}};d.prototype._processTouchMove=function(a){a.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<a.changedTouches.length;b++){var g=a.changedTouches.item(b),d=this._convertEventCoordsToTargetCoords(g.pageX,
g.pageY);this._eventDispatcher.injectTouchMoveEvent(g.identifier,d.x,d.y,this._buttons)}};d.prototype._processTouchEnd=function(a){a.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput)for(var b=0;b<a.changedTouches.length;b++){var g=a.changedTouches.item(b),d=this._convertEventCoordsToTargetCoords(g.pageX,g.pageY);this._eventDispatcher.injectTouchEndEvent(g.identifier,d.x,d.y,this._buttons)}};d.prototype._processPointerDown=function(a){if(this._tryLockEventDispatcher()&&(a.preventDefault(),
this._timeoutMonitor.resetTimeout(),this._processInput)){var b=this._convertEventCoordsToTargetCoords(a.pageX,a.pageY),g=this._getEventModifiers(a);"mouse"===a.pointerType?d._activeEventDispatcher.injectMouseDownEvent(b.x,b.y,a.button,this._buttons,g):"touch"===a.pointerType&&d._activeEventDispatcher.injectTouchStartEvent(a.pointerId,b.x,b.y,this._buttons);this._pointerUp=!1}};d.prototype._processPointerMove=function(a){a.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=
this._convertEventCoordsToTargetCoords(a.pageX,a.pageY),g=this._getEventModifiers(a);null!==d._activeEventDispatcher&&("mouse"===a.pointerType?d._activeEventDispatcher.injectMouseMoveEvent(b.x,b.y,a.button,this._buttons,g):"touch"===a.pointerType&&d._activeEventDispatcher.injectTouchMoveEvent(a.pointerId,b.x,b.y,this._buttons))}};d.prototype._processPointerUp=function(a){this._unlockEventDispatcher();a.preventDefault();this._timeoutMonitor.resetTimeout();if(this._processInput){var b=this._convertEventCoordsToTargetCoords(a.pageX,
a.pageY),g=this._getEventModifiers(a);"mouse"!==a.pointerType||this._pointerUp?"touch"===a.pointerType&&this._eventDispatcher.injectTouchEndEvent(a.pointerId,b.x,b.y,this._buttons):null!==d._activeEventDispatcher?d._activeEventDispatcher.injectMouseUpEvent(b.x,b.y,a.button,this._buttons,g):this._eventDispatcher.injectMouseUpEvent(b.x,b.y,a.button,this._buttons,g);this._captureInput=this._dragStarted=!1;this._pointerUp=!0}};d.prototype._processPointerEnter=function(a){a;this._pointerUp||(this._captureInput=
!1)};d.prototype._processPointerLeave=function(a){a;this._pointerUp||(this._captureInput=!0)};d.prototype._processDocumentPointerMove=function(a){!this._pointerUp&&this._captureInput&&this._processPointerMove(a)};d.prototype._processDocumentPointerUp=function(a){!this._pointerUp&&this._captureInput&&this._processPointerUp(a)};d.prototype._getEventModifiers=function(c){var b=a.KeyModifiers.None;c.altKey&&(b|=a.KeyModifiers.Alt);c.ctrlKey&&(b|=a.KeyModifiers.Control);c.shiftKey&&(b|=a.KeyModifiers.Shift);
c.metaKey&&(b|=a.KeyModifiers.Command);return b};d._activeEventDispatcher=null;d._activeEventDispatcherLocked=!1;d._activeOffset=null;return d}();h.InputMonitor=f})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){a[a.Directional=0]="Directional"})(a.LightType||(a.LightType={}));(function(a){a[a.World=0]="World";a[a.Camera=1]="Camera"})(a.LightSpace||(a.LightSpace={}));var h=function(){return function(a,f,d,c){this.type=a;this.space=f;this.position=d;this.color=c}}();a.Light=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(){}a.prototype.exportMarkup=function(){return[]};a.prototype.loadData=function(a){a;return Promise.resolve([])};return a}();a.MarkupTypeManager=h})(Communicator||(Communicator={}));
(function(a){var h=function(e){function f(a,c){var b=e.call(this)||this;b._markupArray=[];b._viewer=a;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){b.removeAllLines()}});return b}__extends(f,e);f.prototype.addLine=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return this._markupArray.push(a),[4,a.updateLine()];case 1:return c.sent(),this._callbackManager.trigger("lineCreated",a),[2]}})})};f.prototype.removeLine=
function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:c=0,b.label=1;case 1:return c<this._markupArray.length?this._markupArray[c].getId()!==a.getId()?[3,3]:[4,a.removeLine()]:[3,4];case 2:b.sent(),this._markupArray.splice(c,1),this._callbackManager.trigger("lineDeleted",a),b.label=3;case 3:return c++,[3,1];case 4:return[2]}})})};f.prototype.removeAllLines=function(){for(var d=this,c=[],b=function(b){var a=g._markupArray[b];c.push(a.removeLine().then(function(){d._callbackManager.trigger("lineDeleted",
a)}));g._markupArray.splice(b,1)},g=this,l=this._markupArray.length-1;0<=l;l--)b(l);return a.Util.waitForAll(c)};f.prototype.getAllLines=function(){return this._markupArray.slice(0)};f.prototype.removeLastLine=function(){0<this._markupArray.length&&this.removeLine(this._markupArray[this._markupArray.length-1])};f.prototype.getLineByNodeId=function(a){for(var c=0,b=this._markupArray;c<b.length;c++){var g=b[c],l=g.getNodeId();if(null!==l&&l===a)return g}return null};f.prototype.exportMarkup=function(){for(var a=
[],c=0,b=this._markupArray;c<b.length;c++)a.push(b[c].toJson());return a};f.prototype._handleLoadLine=function(d){return d instanceof a.Markup.Line.LineMarkup?(this.addLine(d),this._callbackManager.trigger("lineLoaded",d),!0):!1};f.prototype.loadData=function(d){for(var c=this,b=[],g=0;g<d.length;g++){var l=d[g];if(l.hasOwnProperty("className")){var f=a.Internal.classFromString(l.className);f&&(l=f.fromJson(l,this._viewer),l instanceof Promise?b.push(l.then(function(b){return c._handleLoadLine(b)})):
b.push(Promise.resolve(this._handleLoadLine(l))))}}return Promise.all(b)};return f}(a.MarkupTypeManager);a.LineManager=h})(Communicator||(Communicator={}));
var __decorate=this&&this.__decorate||function(a,h,e,f){var d=arguments.length,c=3>d?h:null===f?f=Object.getOwnPropertyDescriptor(h,e):f,b;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(a,h,e,f);else for(var g=a.length-1;0<=g;g--)if(b=a[g])c=(3>d?b(c):3<d?b(h,e,c):b(h,e))||c;return 3<d&&c&&Object.defineProperty(h,e,c),c};
(function(a){var h=function(){function e(f,d,c,b,g,l,v){this._markupTypeMap=new Map;this._domElements=f;this._callbackManager=b;this._viewer=v;this._sheetManager=g;this._sheetManager.setMarkupManager(this);this._noteTextManager=l;this._renderer=new a.Internal.SVG.SVGMarkupRenderer;this._itemManager=new a.Internal.MarkupItemManager(this._callbackManager,this._domElements,this._renderer);this._viewManager=new a.Internal.MarkupViewManager(this._viewer,this._itemManager,this._callbackManager,v.explodeManager,
v.cuttingManager,this._sheetManager);this._measurementManager=d;this._lineManager=c}e.deprecated=function(a,d,c){a;var b=c.value;c.value=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._callbackManager.trigger("deprecated","MarkupManager",d);return b.apply(this,a)};return c};e.prototype.registerMarkupTypeManager=function(a,d){this._markupTypeMap.set(a,d)};e.prototype.createMarkupView=function(a,d,c,b,g){void 0===d&&(d=!0);void 0===c&&(c=null);void 0===b&&(b=null);void 0===
g&&(g=null);var l=this._viewer.getActiveSheetId();return this._viewManager.createView(a,d,l,c,b,g).getUniqueId()};e.prototype.getMarkupView=function(a){return this._viewManager.getView(a)};e.prototype.getMarkupViewKeys=function(){return this._viewManager.getViewKeys()};e.prototype.activateMarkupViewWithPromise=function(f,d){void 0===d&&(d=a.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._viewManager.activateView(f,d)]})})};
e.prototype.activateMarkupView=function(f,d){void 0===d&&(d=a.DefaultTransitionDuration);return this._viewManager.deprecatedActivateView(f,d)};e.prototype.getActiveMarkupView=function(){return this._itemManager.getActiveView()};e.prototype.deleteMarkupView=function(a){return this._viewManager.deleteView(a)};e.prototype.registerMarkup=function(a){a=this._itemManager.registerMarkupItem(a);this.updateLater();return a};e.prototype.unregisterMarkup=function(a){this._itemManager.unregisterMarkupItem(a);
this.updateLater()};e.prototype.addMarkupElement=function(f){var d=a.GUID.create();f.id=d;this._domElements.getRedlineElement().appendChild(f);return d};e.prototype.removeMarkupElement=function(a){for(var d=this._domElements.getRedlineElement(),c=0;c<d.children.length;c++){var b=d.children.item(c);null!==b&&b.id===a&&d.removeChild(b)}};e.prototype.refreshMarkup=function(){this.updateLater()};e.prototype.updateLater=function(){this._itemManager.updateLater()};e.prototype.pickMarkupItem=function(a){return this._itemManager.pick(a)};
e.prototype.selectMarkup=function(a){this._itemManager.select(a)};e.prototype.getSelectedMarkup=function(){return this._itemManager.getSelected()};e.prototype.exportMarkup=function(){var a={views:this._viewManager.exportMarkup(),notes:this._noteTextManager.exportMarkup(),measurement:this._measurementManager.exportMarkup(),lines:this._lineManager.exportMarkup()};this._markupTypeMap.forEach(function(d,c){a[c]=d.exportMarkup()});return a};e.prototype.loadMarkupData=function(a){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(d){"string"===typeof a&&(a=JSON.parse(a));return[2,this._loadMarkupData(a)]})})};e.prototype._loadMarkupData=function(f){return __awaiter(this,void 0,void 0,function(){var d,c;return __generator(this,function(b){d=[];f.hasOwnProperty("views")&&(c=this._viewManager.loadData(f.views).then(a.Internal.all),d.push(c));f.hasOwnProperty("notes")&&(c=this._noteTextManager.loadData(f.notes).then(a.Internal.all),d.push(c));f.hasOwnProperty("measurement")&&
(c=this._measurementManager.loadData(f.measurement).then(a.Internal.all),d.push(c));f.hasOwnProperty("lines")&&(c=this._lineManager.loadData(f.lines).then(a.Internal.all),d.push(c));this._markupTypeMap.forEach(function(b,c){f.hasOwnProperty(c)&&(b=b.loadData(f[c]).then(a.Internal.all),d.push(b))});return[2,Promise.all(d).then(a.Internal.all)]})})};e.prototype.getRenderer=function(){return this._renderer};e.prototype._shutdown=function(){this._itemManager.shutdown();this._renderer._clear()};e.prototype._update=
function(){this._itemManager.update()};e.prototype._setActiveMarkupView=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._itemManager.setActiveView(a)]})})};e.prototype._getItemManager=function(){return this._itemManager};__decorate([e.deprecated],e.prototype,"activateMarkupView",null);return e}();a.MarkupManager=h})(Communicator||(Communicator={}));
(function(a){var h=function(e){function f(d,c){var b=e.call(this)||this;b._markupArray=[];b._color=new a.Color(0,0,0);b._edgeColor=new a.Color(0,0,0);b._viewer=d;b._callbackManager=c;b._callbackManager.bind({modelSwitched:function(){b.removeAllMeasurements()}});return b}__extends(f,e);f.prototype.addMeasurement=function(a){this._markupArray.push(a);var c=this._viewer.markupManager.registerMarkup(a);a._setId(c);return c};f.prototype.finalizeMeasurement=function(a){this._callbackManager.trigger("measurementCreated",
a)};f.prototype.removeMeasurement=function(a){for(var c=0;c<this._markupArray.length;c++)if(this._markupArray[c]._getId()===a._getId()){this._markupArray.splice(c,1);this._viewer.markupManager.unregisterMarkup(a._getId());this._callbackManager.trigger("measurementDeleted",a);break}};f.prototype.removeAllMeasurements=function(){for(var a=this._markupArray.length-1;0<=a;a--){var c=this._markupArray[a];this._viewer.markupManager.unregisterMarkup(c._getId());this._markupArray.splice(a,1);this._callbackManager.trigger("measurementDeleted",
c)}};f.prototype.getAllMeasurements=function(){return this._markupArray.slice(0)};f.prototype.removeLastMeasurement=function(){0<this._markupArray.length&&this.removeMeasurement(this._markupArray[this._markupArray.length-1])};f.prototype.setMeasurementColor=function(a){this._color.assign(a)};f.prototype.getMeasurementColor=function(){return this._color.copy()};f.prototype.setMeasurementEdgeColor=function(a){this._edgeColor.assign(a)};f.prototype.getMeasurementEdgeColor=function(){return this._edgeColor.copy()};
f.prototype.exportMarkup=function(){for(var a=[],c=0,b=this._markupArray;c<b.length;c++)a.push(b[c].toJson());return a};f.prototype._handleLoadMeasurement=function(d){return d instanceof a.Markup.Measure.MeasureMarkup?(this.addMeasurement(d),this._callbackManager.trigger("measurementLoaded",d),!0):!1};f.prototype.loadData=function(d){for(var c=this,b=[],g=0;g<d.length;g++){var l=d[g];if(l.hasOwnProperty("className")){var f=a.Internal.classFromString(l.className);f&&(l=f.fromJson(l,this._viewer),l instanceof
Promise?b.push(l.then(function(b){return c._handleLoadMeasurement(b)})):b.push(Promise.resolve(this._handleLoadMeasurement(l))))}}return Promise.all(b)};return f}(a.MarkupTypeManager);a.MeasureManager=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(){this._faceMeshData=[];this._pointMeshData=[];this._polylineMeshData=[];this._faceWinding=a.FaceWinding.CounterClockwise;this._isManifold=this._backfacesEnabled=!1}e.prototype.addFaces=function(f,d,c,b,g){void 0===g&&(g=0);this._faceMeshData.push(new a.Internal.FaceMeshData(f,d,c,b,g))};e.prototype.addPoints=function(f,d,c){void 0===c&&(c=0);this._pointMeshData.push(new a.Internal.PointMeshData(f,d,c))};e.prototype.addPolyline=function(f,d,c){void 0===c&&
(c=0);this._polylineMeshData.push(new a.Internal.PolylineMeshData(f,d,c))};e.prototype.clear=function(){this._faceMeshData.length=0;this._pointMeshData.length=0;this._polylineMeshData.length=0};e.prototype.setFaceWinding=function(a){this._faceWinding=a};e.prototype.getFaceWinding=function(){return this._faceWinding};e.prototype.setBackfacesEnabled=function(a){this._backfacesEnabled=a};e.prototype.getBackfacesEnabled=function(){return this._backfacesEnabled};e.prototype.setManifold=function(a){this._isManifold=
a};e.prototype.isManifold=function(){return this._isManifold};e.prototype._getFaceData=function(){return this._faceMeshData};e.prototype._getPointData=function(){return this._pointMeshData};e.prototype._getPolylineData=function(){return this._polylineMeshData};return e}();a.MeshData=h;h=function(){function e(f,d,c,b,g,l,v){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=
a.MeshInstanceCreationFlags.None;this._overlayIndex=0;f&&(this._meshId=f.slice());d&&(this._matrix=d.copy());c&&(this._instanceName=c);b&&(this._faceColor=b.copy());g&&(this._lineColor=g.copy());l&&(this._pointColor=l.copy());v&&(this._creationFlags=v)}e.prototype.clear=function(){this._instanceName=this._pointColor=this._lineColor=this._faceColor=this._matrix=this._meshId=null;this._pointOpacity=this._lineOpacity=this._faceOpacity=1;this._creationFlags=a.MeshInstanceCreationFlags.None;this._overlayIndex=
0};e.prototype.getMeshId=function(){return null!==this._meshId?this._meshId.slice():null};e.prototype.getMeshKey=function(){return this.getMeshId()};e.prototype.setMeshId=function(a){this._meshId=a.slice()};e.prototype.setMeshKey=function(a){this.setMeshId(a)};e.prototype.getMatrix=function(){return null!==this._matrix?this._matrix.copy():null};e.prototype.getCreationFlags=function(){return this._creationFlags};e.prototype.setCreationFlags=function(a){this._creationFlags=a};e.prototype.setMatrix=
function(a){this._matrix=a.copy()};e.prototype.getInstanceName=function(){return this._instanceName};e.prototype.setInstanceName=function(a){this._instanceName=a};e.prototype.setFaceColor=function(a){this._faceColor=a.copy()};e.prototype.getFaceColor=function(){return null!==this._faceColor?this._faceColor.copy():null};e.prototype.setLineColor=function(a){this._lineColor=a.copy()};e.prototype.getLineColor=function(){return null!==this._lineColor?this._lineColor.copy():null};e.prototype.setPointColor=
function(a){this._pointColor=a.copy()};e.prototype.getPointColor=function(){return null!==this._pointColor?this._pointColor.copy():null};e.prototype.setPointOpacity=function(a){this._pointOpacity=a};e.prototype.getPointOpacity=function(){return this._pointOpacity};e.prototype.setLineOpacity=function(a){this._lineOpacity=a};e.prototype.getLineOpacity=function(){return this._lineOpacity};e.prototype.setOpacity=function(a){this._faceOpacity=a};e.prototype.setTransparency=function(a){this._faceOpacity=
a};e.prototype.getOpacity=function(){return this._faceOpacity};e.prototype.getTransparency=function(){return this._faceOpacity};e.prototype.setOverlayIndex=function(a){this._overlayIndex=a};e.prototype.getOverlayIndex=function(){return this._overlayIndex};return e}();a.MeshInstanceData=h})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){return function(a,d,c,b,g){void 0===g&&(g=0);this.vertexData=a;this.normalData=d;this.rgba32data=c;this.uvData=b;this.bits=g}}();a.FaceMeshData=e;e=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();a.PolylineMeshData=e;e=function(){return function(a,d,c){void 0===c&&(c=0);this.vertexData=a;this.rgba32data=d;this.bits=c}}();a.PointMeshData=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator=
{}));(function(a){(function(a){(function(a){function f(d){console.assert(d!==a.invalidNodeId);return d>a.invalidNodeId}a.invalidNodeId=-1;a.isAuthoredId=f;a.getAuthoredId=function(a){console.assert(f(a));return a};a.getRuntimeId=function(d,c){return f(d)?a.towardInclusionContext(c).toRuntimeId(d):d}})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){a.DefaultTransitionDuration=400;a.EmptyModelName="_empty";a.InvalidNodeId=a.Internal.Tree.invalidNodeId;var h=function(){function e(f,d){var c=this;this._pmiColor=a.Color.black();this._pmiColorOverride=!1;this._viewAxes=new a.ViewAxes;this._viewAxesSet=!1;this._firstModelRootId=a.InvalidNodeId;this._engine=f;this._callbackManager=d;this._callbackManager.bind({_firstModelLoaded:function(a){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){this._firstModelRootId=
a[0];return[2]})})},_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(b){this._viewAxes=new a.ViewAxes;this._viewAxesSet=!1;return[2]})})}})}e.deprecated=function(a,d,c){a;var b=c.value;c.value=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._callbackManager.trigger("deprecated","Model",d);return b.apply(this,a)};return c};e.prototype._setModelStructure=function(a){console.assert(void 0===this._modelStructure);
this._modelStructure=a};e.prototype.getClientDimensions=function(){return this._engine.getClientDimensions()};e.prototype.setViewAxes=function(f,d){if(f.isAxis()&&d.isAxis()&&!f.equals(d))this._viewAxes.frontVector=f,this._viewAxes.upVector=d,this._callbackManager.trigger("viewAxes",f,d),this._viewAxesSet=!0;else throw new a.CommunicatorError("The upVector and frontVector must be unique, cardinal axes.");};e.prototype.viewAxesHaveBeenSet=function(){return this._viewAxesSet};e.prototype.getViewAxes=
function(){return this._viewAxes};e.prototype.getModelBounding=function(a,d,c){void 0===c&&(c=!1);return this._engine.getModelBounding(a,d,c)};e.prototype._preventNodeDeletion=function(a){return this._modelStructure.preventNodeDeletion(a)};e.prototype._preventMeshDeletion=function(a){console.assert(0===a[0]);return this._modelStructure.preventMeshDeletion(a[1])};e.prototype._getNodeFromInstanceInc=function(a,d,c,b){return this._modelStructure.getNodeFromInstanceInc(a,d,c,b)};e.prototype.getNodesBounding=
function(a,d){var c=7,b=!1,g=!1;void 0!==d&&(!1===d.bodyInstance&&(c&=-2),!1===d.pmiBody&&(c&=-3),!1===d.viewFrame&&(c&=-5),d.ignoreInvisible&&(b=!0),d.tightBounding&&(g=!0));return this._modelStructure.getBounding(a,c,b,g)};e.prototype.getNodeRealBounding=function(f){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){d=this._modelStructure.gatherInstanceIncsFromNodeIds([f],7,a.Internal.Tree.WalkRestriction.None);if(0===d.length)throw new a.CommunicatorError("Cannot get bounding of node without geometry.");
return[2,this._engine.getDrawnPartsBounding(d)]})})};e.prototype.setNodesVisibilities=function(f,d){void 0===d&&(d=null);f=a.Internal.fromIntegerMap(f);return this._modelStructure.setVisibilitiesByMap(f,d)};e.prototype.setNodesVisibility=function(a,d,c){void 0===c&&(c=null);return this._modelStructure.setVisibilitiesByValue(a,d,c)};e.prototype.resetNodesVisibility=function(){return this._modelStructure.resetAllVisibilities()};e.prototype.getVisibilityState=function(f){return __awaiter(this,void 0,
void 0,function(){var d;return __generator(this,function(c){d=this._modelStructure.lookupAnyTreeNode(f);if(null===d)throw new a.InvalidNodeIdError(f);return[2,a.Internal.Tree.getVisibilityState(d)]})})};e.prototype.resetNodesTransform=function(){return this._modelStructure.resetAllTransforms()};e.prototype.reset=function(){return this._modelStructure.reset()};e.prototype.clear=function(){return this._modelStructure.clear()};e.prototype.setNodesFaceColor=function(a,d){this._setNodesFaceColor(a,d);
return Promise.resolve()};e.prototype._setNodesFaceColor=function(f,d){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);0<f.length&&this._engine.setPartColor(f,a.ElementType.Faces,d)};e.prototype._unsetNodesColor=function(f,d){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);0<f.length&&this._engine.unsetPartColor(f,d)};e.prototype.unsetNodesFaceColor=function(f){this._unsetNodesColor(f,a.ElementType.Faces);
return Promise.resolve()};e.prototype.setNodesLineColor=function(a,d){this._setNodesLineColor(a,d);return Promise.resolve()};e.prototype._setNodesLineColor=function(f,d){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);0<f.length&&this._engine.setPartColor(f,a.ElementType.Lines,d)};e.prototype.unsetNodesLineColor=function(f){this._unsetNodesColor(f,a.ElementType.Lines);return Promise.resolve()};e.prototype.setNodesHighlighted=function(f,d){if(0===f.length)return Promise.resolve();
f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<f.length&&this._engine.highlightParts(f,d);return Promise.resolve()};e.prototype.getNodesHighlighted=function(a){a=this._getInstanceIncsFromLeafNodes(a);return 0<a.length?this._engine.getPartHighlighted(a):Promise.resolve([])};e.prototype.setNodesColors=function(f,d){void 0===d&&(d=!1);f=a.Internal.fromIntegerMap(f);this._setNodesColors(f,d);return Promise.resolve()};e.prototype._setNodesColors=
function(f,d){var c=this,b=new Set;f.forEach(function(g,l){l=c._modelStructure.lookupAnyTreeNode(l);null!==l&&(l=a.Internal.Tree.gatherInstanceIncsSync(l,7,!1,b,a.Internal.Tree.WalkRestriction.None),0<l.length&&(c._engine.setPartColor(l,a.ElementType.Faces,g),d&&c._engine.setPartColor(l,a.ElementType.Lines,g)))})};e.prototype.getPmis=function(){return this._modelStructure.getPmis()};e.prototype.getPMIs=function(){return this.getPmis()};e.prototype.getPmiType=function(a){return this._modelStructure.getPmiType(a)};
e.prototype.getPMIType=function(a){return this.getPmiType(a)};e.prototype.getPmiSubtype=function(a){return this._modelStructure.getPmiSubType(a)};e.prototype.getPMISubtype=function(a){return this.getPmiSubtype(a)};e.prototype.setPmiColor=function(a){this._pmiColor.assign(a)};e.prototype.setPMIColor=function(a){this.setPmiColor(a)};e.prototype.getPmiColor=function(){return this._pmiColor.copy()};e.prototype.getPMIColor=function(){return this.getPmiColor()};e.prototype.setPmiColorOverride=function(a,
d){(this._pmiColorOverride=a)?this._modelStructure.setPmiColor(this._pmiColor,d):this._modelStructure.resetPmiColor(d);return Promise.resolve()};e.prototype.setPMIColorOverride=function(a){return this.setPmiColorOverride(a)};e.prototype.getPmiColorOverride=function(){return this._pmiColorOverride};e.prototype.getPMIColorOverride=function(){return this.getPmiColorOverride()};e.prototype.computeMinimumBodyBodyDistance=function(f,d){var c=this._modelStructure.lookupAnyBody(f);if(null===c)throw new a.InvalidNodeTypeError(f,
1);f=this._modelStructure.lookupAnyBody(d);if(null===f)throw new a.InvalidNodeTypeError(d,1);d=c.getInstanceInc();c=f.getInstanceInc();return this._engine.computeMininimumBodyBodyDistance(d,c)};e.prototype.computeMinimumFaceFaceDistance=function(f,d,c,b){var g=this._modelStructure.lookupAnyBody(f);if(null===g)throw new a.InvalidNodeTypeError(f,1);f=this._modelStructure.lookupAnyBody(c);if(null===f)throw new a.InvalidNodeTypeError(c,1);c=g.getInstanceInc();g=f.getInstanceInc();return this._engine.computeMininimumFaceFaceDistance([c[0],
c[1]],d,[g[0],g[1]],b)};e.prototype.computeMinimumFaceRayDistance=function(f,d,c){var b=this._modelStructure.lookupAnyBody(f);if(null===b)throw new a.InvalidNodeTypeError(f,1);f=b.getInstanceInc();return this._engine.computeMinimumFaceRayDistance(f,d,c)};e.prototype.computeMinimumFaceLineDistance=function(f,d,c){var b=this._modelStructure.lookupAnyBody(f);if(null===b)throw new a.InvalidNodeTypeError(f,1);f=b.getInstanceInc();return this._engine.computeMinimumFaceLineDistance(f,d,c)};e.prototype.setNodeFaceColor=
function(a,d,c){this._setNodeFaceColor(a,d,c);return Promise.resolve()};e.prototype._setNodeFaceColor=function(f,d,c){f=this._modelStructure.gatherInstanceIncsFromNodeIds([f],7,a.Internal.Tree.WalkRestriction.None);2===f.length&&this._engine.setElementColor(f,a.ElementType.Faces,d,1,c)};e.prototype._unsetElementColor=function(a,d,c){a=this._getInstanceIncFromSingleLeafNode(a);this._engine.unsetElementColor(a,d,c,1)};e.prototype.unsetNodeFaceColor=function(f,d){this._unsetElementColor(f,a.ElementType.Faces,
d);return Promise.resolve()};e.prototype.setNodeFaceHighlighted=function(a,d,c){this._setNodeFaceHighlighted(a,d,c);return Promise.resolve()};e.prototype._setNodeFaceHighlighted=function(f,d,c){f=this._modelStructure.gatherInstanceIncsFromNodeIds([f],7,a.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<f.length&&this._engine.highlightElements(f,a.ElementType.Faces,d,1,c)};e.prototype._getElementHighlighted=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,
function(l){switch(l.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getElementHighlighted(b,d,c)];case 1:return g=l.sent()[0],[2,g]}})})};e.prototype.getNodeFaceHighlighted=function(f,d){return this._getElementHighlighted(f,a.ElementType.Faces,d)};e.prototype.setNodeLineColor=function(a,d,c){this._setNodeLineColor(a,d,c);return Promise.resolve()};e.prototype._setNodeLineColor=function(f,d,c){var b=this._modelStructure.lookupAnyBody(f);if(null===b)throw new a.InvalidNodeTypeError(f,
1);f=b.getInstanceInc();this._engine.setElementColor(f,a.ElementType.Lines,d,1,c)};e.prototype.unsetNodeLineColor=function(f,d){this._unsetElementColor(f,a.ElementType.Lines,d);return Promise.resolve()};e.prototype.setNodeLineHighlighted=function(a,d,c){this._setNodeLineHighlighted(a,d,c);return Promise.resolve()};e.prototype._setNodeLineHighlighted=function(f,d,c){f=this._modelStructure.gatherInstanceIncsFromNodeIds([f],7,a.Internal.Tree.WalkRestriction.LoadedNodesOnly);0<f.length&&this._engine.highlightElements(f,
a.ElementType.Lines,d,1,c)};e.prototype.getNodeLineHighlighted=function(f,d){return this._getElementHighlighted(f,a.ElementType.Lines,d)};e.prototype.setNodePointHighlighted=function(a,d,c){this._setNodePointHighlighted(a,d,c);return Promise.resolve()};e.prototype._setNodePointHighlighted=function(f,d,c){var b=this._modelStructure.lookupAnyBody(f);if(null===b)throw new a.InvalidNodeTypeError(f,1);f=b.getInstanceInc();this._engine.highlightElements(f,a.ElementType.Points,d,1,c)};e.prototype.getNodePointHighlighted=
function(f,d){return this._getElementHighlighted(f,a.ElementType.Points,d)};e.prototype.resetNodesColor=function(){this._engine.resetColors();return Promise.resolve()};e.prototype.setNodesOpacity=function(f,d){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);0<f.length&&this._engine.setPartOpacity(f,d)};e.prototype.setNodesTransparency=function(a,d){this.setNodesOpacity(a,d);return Promise.resolve()};e.prototype.getNodesHaveTransparency=function(f){f=
this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);return 0<f.length?this._engine.getPartHasTransparency(f):Promise.resolve([])};e.prototype.setNodesOpacities=function(f){var d=this;f=a.Internal.fromIntegerMap(f);var c=new Set;f.forEach(function(b,g){g=d._modelStructure.lookupAnyTreeNode(g);null!==g&&(g=a.Internal.Tree.gatherInstanceIncsSync(g,1,!1,c,a.Internal.Tree.WalkRestriction.None),0<g.length&&d._engine.setPartOpacity(g,b))})};e.prototype.setNodesTransparencies=
function(a){this.setNodesOpacities(a);return Promise.resolve()};e.prototype.resetModelOpacity=function(){this._engine.resetOpacity();this._callbackManager.trigger("_resetOpacity")};e.prototype.resetModelTransparency=function(){this.resetModelOpacity();return Promise.resolve()};e.prototype.resetModelHighlight=function(){this._engine.clearHighlight();return Promise.resolve()};e.prototype.resetNodesOpacity=function(f){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);
0<f.length&&this._engine.unsetPartOpacity(f)};e.prototype.resetNodesTransparency=function(a){this.resetNodesOpacity(a);return Promise.resolve()};e.prototype._getNodesColor=function(f,d){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);return 0<f.length?this._engine.getPartColor(f,d):Promise.resolve([])};e.prototype._getNodesEffectiveColor=function(f,d){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);return 0<
f.length?this._engine.getEffectivePartColor(f,d):Promise.resolve([])};e.prototype.getNodesFaceColor=function(f){return this._getNodesColor(f,a.ElementType.Faces)};e.prototype.getNodesEffectiveFaceColor=function(f){return this._getNodesEffectiveColor(f,a.ElementType.Faces)};e.prototype.getNodesLineColor=function(f){return this._getNodesColor(f,a.ElementType.Lines)};e.prototype.getNodesEffectiveLineColor=function(f){return this._getNodesEffectiveColor(f,a.ElementType.Lines)};e.prototype.getNodeColorMap=
function(f,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){c=this._modelStructure.lookupAnyTreeNode(f);if(null!==c)return[2,a.Internal.Tree.getNodeColorMap(c,this._engine,d)];throw new a.InvalidNodeIdError(f);})})};e.prototype.getNodesOpacity=function(a){return Promise.resolve(this._getNodesOpacity(a))};e.prototype.getNodesTransparency=function(a){return this.getNodesOpacity(a)};e.prototype._getNodesOpacity=function(a){a=this._getInstanceIncsFromLeafNodes(a);
return 0<a.length?this._engine.getPartOpacity(a):[]};e.prototype.getNodesEffectiveOpacity=function(a,d){return(a=this._getInstanceIncsFromLeafNodes(a))&&0<a.length?this._engine.getEffectivePartOpacity(a,d):Promise.resolve([])};e.prototype.getNodesEffectiveTransparency=function(a,d){return this.getNodesEffectiveOpacity(a,d)};e.prototype._getNodeColor=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,function(l){switch(l.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),
[4,this._engine.getElementColor(b,d,c)];case 1:return g=l.sent()[0],[2,g]}})})};e.prototype._getNodeEffectiveColor=function(a,d,c){return __awaiter(this,void 0,void 0,function(){var b,g;return __generator(this,function(l){switch(l.label){case 0:return b=this._getInstanceIncFromSingleLeafNode(a),[4,this._engine.getEffectiveElementColor(b,d,c)];case 1:return g=l.sent()[0],[2,g]}})})};e.prototype.getNodeFaceColor=function(f,d){return this._getNodeColor(f,a.ElementType.Faces,d)};e.prototype.getNodeEffectiveFaceColor=
function(f,d){return this._getNodeEffectiveColor(f,a.ElementType.Faces,d)};e.prototype.getNodeLineColor=function(f,d){return this._getNodeColor(f,a.ElementType.Lines,d)};e.prototype.getNodeEffectiveLineColor=function(f,d){return this._getNodeEffectiveColor(f,a.ElementType.Lines,d)};e.prototype.getOutOfHierarchy=function(a){return this._modelStructure.isOutOfHierarchy(a)};e.prototype.getAbsoluteRootNode=function(){return this._modelStructure.getAbsoluteRootNodeId()};e.prototype.getRootNode=function(){return this.getAbsoluteRootNode()};
e.prototype.getNodeChildren=function(a,d){return this._modelStructure.getChildIds(a,d||!1)};e.prototype.getNodesInstancingSamePart=function(a){return this._modelStructure.getPartReferrers(a)};e.prototype.getUnitMultiplier=function(){return this._getUnitMultiplier()};e.prototype._getUnitMultiplier=function(){var f=this._firstModelRootId!==a.InvalidNodeId?this._firstModelRootId:this.getAbsoluteRootNode();return this.getNodeUnitMultiplier(f)};e.prototype.getNodeUnitMultiplier=function(a){return this._modelStructure.getUnit(a)};
e.prototype.createCadView=function(a,d,c,b,g,l,v,e,k){b||(b=[]);g||(g=[]);l||(l=[]);v||(v=[]);void 0===e&&(e=null);void 0===k&&(k=null);a=this._modelStructure.createCadView(a,d,c,b,g,l,v,e,k);null!==a&&this._callbackManager.trigger("cadViewCreated",a);return a};e.prototype.createCADView=function(a,d,c,b,g,l,v,e,k){return this.createCadView(a,d,c,b,g,l,v,e,k)};e.prototype.getCadViews=function(){return this._modelStructure.getCadViews()};e.prototype.getCADViews=function(){return this.getCadViews()};
e.prototype.activateCadView=function(f,d){void 0===d&&(d=a.DefaultTransitionDuration);return this._modelStructure.activateCadView(f,d)};e.prototype.activateCADView=function(a,d){return this.activateCadView(a,d)};e.prototype.getCadViewPmis=function(a){return this._modelStructure.getCadViewPmis(a)};e.prototype.getCADViewPMIs=function(a){return this.getCadViewPmis(a)};e.prototype._cadConfigurationsEnabled=function(){return this._modelStructure.cadConfigurationsEnabled()};e.prototype.getCadConfigurations=
function(){return this._modelStructure.getCadConfigurations()};e.prototype.getCADConfigurations=function(){return this.getCadConfigurations()};e.prototype.getDefaultCadConfiguration=function(){return this._modelStructure.getDefaultCadConfiguration()};e.prototype.getCADDefaultConfiguration=function(){return this.getDefaultCadConfiguration()};e.prototype.getActiveCadConfiguration=function(){return this._modelStructure.getActiveCadConfiguration()};e.prototype.getCADActiveConfiguration=function(){return this.getActiveCadConfiguration()};
e.prototype.activateCadConfiguration=function(a){return this._modelStructure.activateCadConfiguration(a)};e.prototype.activateCADConfiguration=function(a){return this.activateCadConfiguration(a)};e.prototype.activateDefaultCadConfiguration=function(){return this._modelStructure.activateDefaultCadConfiguration()};e.prototype.activateCADDefaultConfiguration=function(){return this.activateDefaultCadConfiguration()};e.prototype.getEdgeCount=function(a){return this._modelStructure.getEdgeCount(a)};e.prototype.getEdgeAttributes=
function(a,d){return this._modelStructure.getEdgeAttributes(a,d)};e.prototype.getEdgeProperty=function(a,d){return this._modelStructure.getEdgeProperty(a,d)};e.prototype.getFaceCount=function(a){return this._modelStructure.getFaceCount(a)};e.prototype.getFaceAttributes=function(a,d){return this._modelStructure.getFaceAttributes(a,d)};e.prototype.getFaceProperty=function(a,d){return this._modelStructure.getFaceProperty(a,d)};e.prototype.setEdgeProperty=function(a,d,c){this._modelStructure.setEdgeProperty(a,
d,c)};e.prototype.setFaceProperty=function(a,d,c){this._modelStructure.setFaceProperty(a,d,c)};e.prototype.getNodeMeshData=function(f){return __awaiter(this,void 0,void 0,function(){var d,c,b;return __generator(this,function(g){switch(g.label){case 0:d=this._modelStructure.gatherInstanceIncsFromNodeIds([f],7,a.Internal.Tree.WalkRestriction.None);if(0===d.length)throw new a.CommunicatorError("Node does not refer to a mesh instance");if(2<d.length)throw new a.CommunicatorError("Node refers to multiple mesh instances");
c=d;return[4,this._engine.getInstancesMeshData(c)];case 1:return b=g.sent(),[2,this._engine.getMeshData(b)]}})})};e.prototype.getNodeMatrix=function(a){return this._modelStructure.getMatrix(a)};e.prototype.setNodeMatrix=function(a,d,c){void 0===c&&(c=!1);return this._modelStructure.setMatrix(a,d,c)};e.prototype.resetNodeMatrixToInitial=function(a){return this._modelStructure.resetToInitialMatrix(a)};e.prototype.getNodeNetMatrix=function(a){return this._modelStructure.getNetMatrix(a)};e.prototype.getNodeParent=
function(a){return this._modelStructure.getParentId(a)};e.prototype.getNodeType=function(a){return this._modelStructure.getType(a)};e.prototype.getNodeProperties=function(a){return this._modelStructure.getProperties(a)};e.prototype.addPropertyToNode=function(a,d,c){return this._modelStructure.addProperty(a,d,c)};e.prototype.setPhysicalProperties=function(a,d,c,b){return this._modelStructure.setPhysicalProperties(a,d,c,b)};e.prototype.requestNodes=function(a){return this._modelStructure.requestNodes(a)};
e.prototype.getNodeName=function(a){return this._modelStructure.getName(a)||null};e.prototype.getNodeExchangeId=function(a){return this._modelStructure.getNodeExchangeId(a)};e.prototype.getFilters=function(){return this._modelStructure.getFilters()};e.prototype.getFilterName=function(a){return this._modelStructure.getFilterName(a)};e.prototype.getFiltersWithNode=function(a){return this._modelStructure.getFiltersWithNode(a)};e.prototype.getNodesFromFiltersId=function(a){return this._modelStructure.getNodesFromFiltersId(a)};
e.prototype.getLayers=function(){return this._modelStructure.getLayers()};e.prototype.getUniqueLayerNames=function(){return this._modelStructure.getUniqueLayerNames()};e.prototype.getLayerName=function(a){return this._modelStructure.getLayerName(a)};e.prototype.getLayerIdsFromName=function(a){return this._modelStructure.getLayerIdsFromName(a)};e.prototype.getNodeLayerId=function(a){return this._modelStructure.getNodeLayerId(a)};e.prototype.getNodesFromLayer=function(a,d){return this._modelStructure.getNodesFromLayer(a,
d)};e.prototype.getNodesFromLayers=function(a,d){return this._modelStructure.getNodesFromLayers(a,d)};e.prototype.getNodesFromLayerName=function(a,d){return this._modelStructure.getNodesFromLayerName(a,d)};e.prototype.getNodeVisibility=function(a){return this._modelStructure.isVisible(a)};e.prototype.getBranchVisibility=function(f){f=this._modelStructure.getBranchVisibility(f);if(2===f)return a.BranchVisibility.Shown;if(1===f)return a.BranchVisibility.Hidden;console.assert(3===f);return a.BranchVisibility.Mixed};
e.prototype.getDataFromIds=function(a){return this._engine.getDataFromIds(a)};e.prototype.getDataFromKeys=function(a){return this.getDataFromIds(a)};e.prototype.createMesh=function(a){return this._engine.createMesh(a)};e._flatArrayToPairArray=function(a){for(var d=[],c=0;c<a.length;c+=2)d.push([a[c],a[c+1]]);return d};e._pairArrayToFlatArray=function(a){for(var d=[],c=0;c<a.length;c++){var b=a[c];d.push(b[0],b[1])}return d};e.prototype.getMeshIds=function(f){return __awaiter(this,void 0,void 0,function(){var d,
c;return __generator(this,function(b){switch(b.label){case 0:return d=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None),[4,this._engine.getInstancesMeshData(d)];case 1:return c=b.sent(),[2,e._flatArrayToPairArray(c)]}})})};e.prototype.replaceMesh=function(a,d){return this._engine.replaceMesh(a,d)};e.prototype.createMeshInstance=function(a,d,c,b){void 0===d&&(d=null);c||(c=!1);b||(b=!1);return this._createMeshInstance(a,d,c,b)};e.prototype._createMeshInstance=
function(f,d,c,b){return __awaiter(this,void 0,void 0,function(){var g,l,v,e,k,r;return __generator(this,function(h){switch(h.label){case 0:return g=f.getMatrix(),l=null!==g||null!==d,v=f.getCreationFlags(),console.assert(!d||!b,"Out of hierarchy instances should not have a parent node."),l&&f.setCreationFlags(v|a.MeshInstanceCreationFlags.Invisible),[4,this._engine.createMeshInstance(f)];case 1:e=h.sent();k=this._modelStructure.createMeshInstance(e[0],e[1],f.getInstanceName(),d,c,b);if(!l)return[3,
3];r=g?g:new a.Matrix;return[4,this.setNodeMatrix(k,r,!0)];case 2:h.sent(),0===(v&a.MeshInstanceCreationFlags.Invisible)&&this._engine.setPartVisibility(e,!0,!0),h.label=3;case 3:return null===d?[3,5]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[k],a.NodeSource.CreateInstance)];case 4:h.sent(),h.label=5;case 5:return[2,k]}})})};e.prototype.createPmiInstance=function(f,d,c,b,g){return __awaiter(this,void 0,void 0,function(){var l,v,e,k,r,h,n,q;return __generator(this,function(t){switch(t.label){case 0:void 0===
g&&(g=null);l=[];v=0;for(e=b;v<e.length;v++){k=e[v];r=this._modelStructure.lookupBodyInstance(k.bodyId);if(null===r)throw new a.InvalidNodeIdError(k.bodyId);h=a.Internal.Tree.ReferenceOnTopology.fromBodyInstance(r,k.subElementType,k.subElementIndex);l.push(h)}return[4,this._engine.createMeshInstance(f)];case 1:return n=t.sent(),q=this._modelStructure.createPmiInstance(n[0],n[1],d,c,l,f.getInstanceName(),g),null===g?[3,3]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[q],
a.NodeSource.CreatePmi)];case 2:t.sent(),t.label=3;case 3:return[2,q]}})})};e.prototype.createPMIInstance=function(a,d,c,b,g){return this.createPmiInstance(a,d,c,b,g)};e.prototype.createImage=function(a,d){return this._engine.createImage(a,d)};e.prototype.deleteImages=function(a){return this._engine.destroyImages(e._pairArrayToFlatArray(a))};e.prototype.setNodesTexture=function(a,d){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.setTexture(a,d)};e.prototype.unsetNodesTexture=function(a){a=
this._getInstanceIncsFromLeafNodes(a);this._engine.unsetTexture(a)};e.prototype.deleteMeshes=function(a){return this._engine.destroyMeshes(e._pairArrayToFlatArray(a))};e.prototype.deleteMeshInstances=function(f){var d=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None),c=[];if(0<d.length){for(var b=0;b<f.length;b++)c.push(this._modelStructure.deleteNode(f[b]));c.push(this._engine.destroyLocalInstances(d))}return a.Util.waitForAll(c)};e.prototype._obtainLoadSubtreeConfig=
function(f){if(f[0]instanceof a.LoadSubtreeConfig)var d=f[0];else d=new a.LoadSubtreeConfig,d.additionalMatrix=f[0]||null,d.allowMissingExternalModels=!!f[1];return d.copy()};e.prototype.loadSubtreeFromXmlFile=function(f,d,c){for(var b=[],g=3;g<arguments.length;g++)b[g-3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);c||(c=a.Internal.identity);return this._modelStructure.loadSubtreeFromXmlFile(f,d,c,b)};e.prototype.loadSubtreeFromXmlBuffer=function(f,d,c){for(var b=[],g=3;g<arguments.length;g++)b[g-
3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);c||(c=a.Internal.identity);return this._modelStructure.loadSubtreeFromXmlDoc(f,d,c,b)};e.prototype.loadSubtreeFromScsXmlFile=function(f,d,c){for(var b=[],g=3;g<arguments.length;g++)b[g-3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);c||(c=a.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlFile(f,d,c,b)};e.prototype.loadSubtreeFromScsXmlBuffer=function(f,d,c){for(var b=[],g=3;g<arguments.length;g++)b[g-3]=arguments[g];b=this._obtainLoadSubtreeConfig(b);
c||(c=a.Internal.identity);return this._modelStructure.loadSubtreeFromScsXmlDoc(f,d,c,b)};e.prototype.loadSubtreeFromModel=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromStream(a,d,c)};e.prototype.loadSubtreeFromScsFile=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsFile(a,d,c)};e.prototype.loadSubtreeFromScsBuffer=
function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];c=this._obtainLoadSubtreeConfig(c);return this._modelStructure.loadSubtreeFromScsBuffer(a,d,c)};e.prototype.loadSubtreeFromUrl=function(a,d){return this.loadSubtreeFromXmlFile(a,d)};e.prototype.loadSubtreeFromXML=function(a,d){return this.loadSubtreeFromXmlBuffer(a,d)};e.prototype.switchToModel=function(a){this._callbackManager.trigger("modelLoadBegin");return this._modelStructure.switchToModel(a)};e.prototype.createNode=function(f,
d,c,b,g){void 0===f&&(f=null);void 0===c&&(c=null);void 0===b&&(b=null);if(void 0===g||null===g)g=!0;f=this._modelStructure.createNode(f,d,c,b,g);null!==f&&(d=this._callbackManager.promiseTrigger("_subtreeLoaded","subtreeLoaded",[f],a.NodeSource.CreateNode),d);return f};e.prototype.deleteNode=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._modelStructure.deleteNode(a)];case 1:return d.sent(),this._callbackManager.trigger("subtreeDeleted",
[a]),[2]}})})};e.prototype.createPart=function(a){void 0===a&&(a=null);return this._modelStructure.createPart(a)};e.prototype.setPart=function(a,d){return void 0===a||null===a||void 0===d||null===d?!1:this._modelStructure.setPart(a,d)};e.prototype.createAndAddRepresentationItem=function(a,d){if(void 0===a||null===a)return null;void 0===d&&(d=null);return this._modelStructure.createAndAddRepItem(a,d)};e.prototype.createAndAddBody=function(a,d){return this.createAndAddRepresentationItem(a,d)};e.prototype.getLowestAvailableNodeId=
function(){return this._modelStructure.getLowestAvailableNodeId()};e.prototype.getLowestAvailableNodeID=function(){return this.getLowestAvailableNodeId()};e.prototype.setInstanceModifier=function(a,d,c){this._setInstanceModifier(a,d,c,7);return Promise.resolve()};e.prototype._setInstanceModifier=function(f,d,c,b){d=this._modelStructure.gatherInstanceIncsFromNodeIds(d,b,a.Internal.Tree.WalkRestriction.None);0<d.length&&this._engine.setInstanceModifier(f,d,c)};e.prototype.getSCInstanceKey=function(a){a=
this._modelStructure.lookupBodyInstance(a);return null!==a?a.getInstanceInc():null};e.prototype.getNodeIDFromSCInstanceKey=function(a,d){return this._modelStructure.getNodeFromInstanceInc(!1,a,d,!1)};e.prototype.getPrimaryModelKey=function(){return this._engine.getPrimaryModelKey()};e.prototype.getPrimaryModelId=function(){return this.getPrimaryModelKey()};e.prototype.getAssociatedModelKey=function(a){a=this._modelStructure.getAssociatedModelKey(a);return Promise.resolve(a)};e.prototype.hasDepthRange=
function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.hasDepthRange(a)};e.prototype.setDepthRange=function(a,d,c){this._setDepthRange(a,d,c);return Promise.resolve()};e.prototype._setDepthRange=function(f,d,c){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);this._engine.setDepthRange(f,d,c)};e.prototype.unsetDepthRange=function(f){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);this._engine.unsetDepthRange(f)};
e.prototype._gatherInstanceIncsFromNodeIds=function(f,d){void 0===d&&(d=7);return this._modelStructure.gatherInstanceIncsFromNodeIds(f,d,a.Internal.Tree.WalkRestriction.None)};e.prototype._getInstanceIncsFromLeafNodes=function(f){for(var d=[],c=0;c<f.length;c++){var b=this._modelStructure.gatherInstanceIncsFromNodeIds([f[c]],7,a.Internal.Tree.WalkRestriction.None);if(2===b.length)d.push(b[0],b[1]);else throw new a.CommunicatorError("Non-leaf node encountered");}return d};e.prototype._getInstanceIncFromSingleLeafNode=
function(f){f=this._modelStructure.gatherInstanceIncsFromNodeIds([f],7,a.Internal.Tree.WalkRestriction.None);if(2===f.length)return f;throw new a.CommunicatorError("Non-leaf node encountered");};e.prototype.setMeshLevel=function(a,d){this._modelStructure.setMeshLevel(a,d);return Promise.resolve()};e.prototype.setEnableAutomaticUnitScaling=function(a){return this._modelStructure.setEnableAutomaticUnitScaling(a)};e.prototype.setBehaviorInitiallyHidden=function(a){return this._modelStructure.setBehaviorInitiallyHidden(a)};
e.prototype.isDrawing=function(){return this._modelStructure.isACadDrawing()};e.prototype.isMeasurable=function(){return this._modelStructure.isMeasurable()};e.prototype.getModelFileNameFromNode=function(a){return this._modelStructure.getModelFileNameFromNode(a)};e.prototype.getModelFileTypeFromNode=function(a){return this._modelStructure.getModelFileTypeFromNode(a)};e.prototype.getNodeGenericType=function(a){return this._modelStructure.getNodeGenericType(a)};e.prototype.getNodeGenericId=function(a){return this._modelStructure.getNodeGenericId(a)};
e.prototype.registerBimNodes=function(f,d,c){void 0===c&&(c=null);return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){b=this._modelStructure.lookupAnyTreeNode(f);if(null===b)return[2];"boolean"===typeof c&&(c=c?"TYPE":null);return[2,a.Internal.Tree.registerBimNodes(d,this._engine,this._modelStructure,b,c)]})})};e.prototype.getGenericTypeIdMap=function(){return this._modelStructure.getGenericTypeIdMap()};e.prototype.getIfcNodeIds=function(){return this.getGenericTypeIdMap()};
e.prototype.getIfcTypeByNodeId=function(a){return this._modelStructure.getNodeGenericType(a)};e.prototype.getNodesByGenericType=function(a){return this._modelStructure.getNodesByGenericType(a)};e.prototype.getNodesByIfcType=function(a){return this.getNodesByGenericType(a)};e.prototype.getGenericTypes=function(){return this._modelStructure.getGenericTypes()};e.prototype.getIfcTypes=function(){return this.getGenericTypes()};e.prototype._hasEffectiveGenericType=function(a,d){return this._modelStructure.hasEffectiveGenericType(a,
d)};e.prototype.registerIfcNodes=function(f,d){void 0===d&&(d=null);return this.registerBimNodes(f,a.Internal.Tree.ifcAttributeToBimMask,d)};e.prototype.isAnnotationView=function(a){return this._modelStructure.isAnnotationView(a)};e.prototype.setNodesCullingVector=function(a,d,c,b){this._setNodesCullingVector(a,d,c,b);return Promise.resolve()};e.prototype._setNodesCullingVector=function(f,d,c,b){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);return this._engine.setCullingVector(f,
d,c,b)};e.prototype.unsetNodesCullingVectors=function(a){this._unsetNodesCullingVectors(a);return Promise.resolve()};e.prototype._unsetNodesCullingVectors=function(f){f=this._modelStructure.gatherInstanceIncsFromNodeIds(f,7,a.Internal.Tree.WalkRestriction.None);this._engine.unsetCullingVector(f)};e.prototype.getNodesCullingVectors=function(a){a=this._getInstanceIncsFromLeafNodes(a);return this._engine.getCullingVector(a)};e.prototype.getNodeIdOffset=function(a){return this._modelStructure.getIdOffset(a)};
e.prototype.isNodeLoaded=function(a){return this._modelStructure.isNodeLoaded(a)};e.prototype.triangulatePolygon=function(f,d){d=a.Internal.toVec3(d);return this._engine.triangulatePolygon(f,d)};e.prototype.setNodesLinePattern=function(a,d,c,b){a=this._gatherInstanceIncsFromNodeIds(a);this._engine.setLinePattern(a,d,c,b)};e.prototype.unsetNodesLinePattern=function(a){a=this._gatherInstanceIncsFromNodeIds(a);this._engine.unsetLinePattern(a)};e.prototype._hwfAwaitAssemblyTreeReady=function(){return __awaiter(this,
void 0,void 0,function(){var f,d,c;return __generator(this,function(b){switch(b.label){case 0:f=this.getAbsoluteRootNode();d=this._modelStructure.lookupAnyTreeNode(f);if(null===d)throw new a.InternalLogicError;c=a.Internal.Tree.towardLoadContext(d);return[4,a.Internal.Tree.WalkerAsync.forceLazyPromises(c)];case 1:return b.sent(),[4,a.Internal.Tree.markContextsLoaded([c])];case 2:return b.sent(),[2]}})})};e.prototype.getNodeUserDataIndices=function(a){return this._modelStructure.getUserDataIndices(a)};
e.prototype.getNodeUserData=function(a,d){return this._modelStructure.getUserData(a,d)};e.prototype.getNodeIdsByGenericIds=function(a){for(var d=[],c=0;c<a.length;c++){var b=this._modelStructure.getNodeByGenericId(a[c]);null!==b&&d.push(b)}return d};e.prototype.getNodeIdsByIfcGuids=function(a){return this.getNodeIdsByGenericIds(a)};e.prototype._isReady=function(){return this._modelStructure.isReady()};e.prototype._getModelStructure=function(){return this._modelStructure};e.prototype._isWithinExternalModel=
function(a){return this._modelStructure.isWithinExternalModel(a)};e.prototype._firstAssemblyDataHeader=function(){return this._modelStructure.firstAssemblyDataHeader()};__decorate([e.deprecated],e.prototype,"getPMIs",null);__decorate([e.deprecated],e.prototype,"getPMIType",null);__decorate([e.deprecated],e.prototype,"getPMISubtype",null);__decorate([e.deprecated],e.prototype,"setPMIColor",null);__decorate([e.deprecated],e.prototype,"getPMIColor",null);__decorate([e.deprecated],e.prototype,"setPMIColorOverride",
null);__decorate([e.deprecated],e.prototype,"getPMIColorOverride",null);__decorate([e.deprecated],e.prototype,"setNodesTransparency",null);__decorate([e.deprecated],e.prototype,"setNodesTransparencies",null);__decorate([e.deprecated],e.prototype,"resetModelTransparency",null);__decorate([e.deprecated],e.prototype,"resetNodesTransparency",null);__decorate([e.deprecated],e.prototype,"getNodesTransparency",null);__decorate([e.deprecated],e.prototype,"getNodesEffectiveTransparency",null);__decorate([e.deprecated],
e.prototype,"getRootNode",null);__decorate([e.deprecated],e.prototype,"getUnitMultiplier",null);__decorate([e.deprecated],e.prototype,"createCADView",null);__decorate([e.deprecated],e.prototype,"getCADViews",null);__decorate([e.deprecated],e.prototype,"activateCADView",null);__decorate([e.deprecated],e.prototype,"getCADViewPMIs",null);__decorate([e.deprecated],e.prototype,"getCADConfigurations",null);__decorate([e.deprecated],e.prototype,"getCADDefaultConfiguration",null);__decorate([e.deprecated],
e.prototype,"getCADActiveConfiguration",null);__decorate([e.deprecated],e.prototype,"activateCADConfiguration",null);__decorate([e.deprecated],e.prototype,"activateCADDefaultConfiguration",null);__decorate([e.deprecated],e.prototype,"getDataFromKeys",null);__decorate([e.deprecated],e.prototype,"createPMIInstance",null);__decorate([e.deprecated],e.prototype,"loadSubtreeFromUrl",null);__decorate([e.deprecated],e.prototype,"loadSubtreeFromXML",null);__decorate([e.deprecated],e.prototype,"createAndAddBody",
null);__decorate([e.deprecated],e.prototype,"getLowestAvailableNodeID",null);__decorate([e.deprecated],e.prototype,"getSCInstanceKey",null);__decorate([e.deprecated],e.prototype,"getNodeIDFromSCInstanceKey",null);__decorate([e.deprecated],e.prototype,"getPrimaryModelKey",null);__decorate([e.deprecated],e.prototype,"getPrimaryModelId",null);__decorate([e.deprecated],e.prototype,"getIfcNodeIds",null);__decorate([e.deprecated],e.prototype,"getIfcTypeByNodeId",null);__decorate([e.deprecated],e.prototype,
"getNodesByIfcType",null);__decorate([e.deprecated],e.prototype,"getIfcTypes",null);__decorate([e.deprecated],e.prototype,"getNodeIdsByIfcGuids",null);return e}();a.Model=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(f){var d=this;this._position=new a.Point2(0,0);this._viewportSize=new a.Point2(200,200);this._anchor=a.OverlayAnchor.UpperRightCorner;this._dimension=3;this._fieldSize=8;this._instanceKeys=[];this._enabled=!1;this._selectionFaceColor=new a.Color(76,186,240);this._outlineColor=new a.Color(17,94,133);this._lastSelectedNodes=[];this._nodeIds=[];this._adjacentFaces=[];this._cameraRotation=0;this._lastFaceIndex=this._lastCamera=this._lastOrientation=null;this._textWidths=
[];this._sceneReadyCompleted=a.Util.OpenPromise.create();this._firstAttachment=this._geometryCreated=this._texturesReady=!1;this._viewer=f;this._fontSize=25;this._fontInfo=this._fontSize+"px Arial";this._textureSize=512;this._viewer.setCallbacks({sceneReady:function(){return __awaiter(d,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._createViewport()];case 1:return a.sent(),this._updateVisibility(),[4,this._createGeometry()];case 2:return a.sent(),
this._sceneReadyCompleted.resolve(),[2]}})})},_assemblyTreeReady:function(){return __awaiter(d,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._sceneReadyCompleted];case 1:return a.sent(),[2,this._setTextures()]}})})},_firstAttachment:function(){return __awaiter(d,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._firstAttachment=!0,[4,this._onCameraUpdate()];case 1:return a.sent(),this._updateVisibility(),
[2]}})})},modelSwitchStart:function(){d._firstAttachment=!1},camera:function(){d._onCameraUpdate()},transitionEnd:function(){d._onCameraUpdate()},viewAxes:function(){d._updateOrientationMatrices()},_resetOpacity:function(){d._viewer.model.setNodesOpacity(d._nodeIds.slice(1),0)},viewOrientation:function(a){d._lastOrientation=a;d._cameraRotation=0;d._lastCamera=d._viewer.view.getCamera()}})}e.prototype.setAnchor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._anchor=
a,[4,this._sceneReadyCompleted];case 1:return d.sent(),[2,this._updateViewport()]}})})};e.prototype.getAnchor=function(){return this._anchor};e.prototype.enable=function(){this._enabled=!0;this._updateVisibility();return Promise.resolve()};e.prototype.disable=function(){this._enabled=!1;this._updateVisibility();return Promise.resolve()};e.prototype._updateVisibility=function(){this._enabled&&this._texturesReady&&this._firstAttachment?this._showOverlay():this._hideOverlay()};e.prototype._hideOverlay=
function(){this._viewer.overlayManager.setVisibility(a.BuiltinOverlayIndex.NavCube,!1)};e.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(a.BuiltinOverlayIndex.NavCube,!0)};e.prototype.getEnabled=function(){return this._enabled};e.prototype.getOverlayId=function(){return a.BuiltinOverlayIndex.NavCube};e.prototype._setTextures=function(){return __awaiter(this,void 0,void 0,function(){var a,d,c,b,g;return __generator(this,function(l){switch(l.label){case 0:if(!this._textImageId||
0<this._nodeIds.length||0>=this._instanceKeys.length)return[2];a=this._viewer.model;d=0;for(c=this._instanceKeys;d<c.length;d++)b=c[d],g=a._getNodeFromInstanceInc(!0,0,b,!0),this._nodeIds.push(g),a._preventNodeDeletion(g);a.setNodesOpacity(this._nodeIds.slice(1),0);return[4,a.setNodesTexture([this._nodeIds[0]],{imageId:this._textImageId})];case 1:return l.sent(),this._texturesReady=!0,this._updateVisibility(),[2]}})})};e.prototype._updateViewport=function(){return this._viewer.overlayManager.setViewport(a.BuiltinOverlayIndex.NavCube,
this._anchor,this._position.x,a.OverlayUnit.Pixels,this._position.y,a.OverlayUnit.Pixels,this._viewportSize.x,a.OverlayUnit.Pixels,this._viewportSize.y,a.OverlayUnit.Pixels)};e.prototype._createViewport=function(){var f=this._viewer.overlayManager;this._updateViewport();var d=new a.Camera;d.setPosition(new a.Point3(0,0,10));d.setTarget(a.Point3.zero());d.setUp(new a.Point3(0,1,0));d.setWidth(this._fieldSize);d.setHeight(this._fieldSize);d.setProjection(a.Projection.Orthographic);return f.setCamera(a.BuiltinOverlayIndex.NavCube,
d)};e.prototype._createGeometry=function(){return __awaiter(this,void 0,void 0,function(){var f,d,c,b,g,l,v,e,k,r,h,n,q,t,u,w,z,y,x,A,B,C,D,G,E,I,F,K,L,H,M,J,Q,P;return __generator(this,function(O){switch(O.label){case 0:if(this._geometryCreated)return[2];f=this._initializeTextures();d=0;c=[];c.push(this._createCube(d++,this._dimension));b=[];b.push(this._makeRotationMatrixX(-.5*Math.PI));b.push(this._makeRotationMatrixX(.5*Math.PI));b.push(this._makeRotationMatrixY(.5*Math.PI));b.push(this._makeRotationMatrixY(-.5*
Math.PI));b.push(this._makeRotationMatrixZ(.5*Math.PI));b.push(this._makeRotationMatrixZ(-.5*Math.PI));g=this._dimension/4;l=this._dimension/2;v=[];e=new a.Point3(0,0,0);k=new a.Point3(0,0,0);r=new a.Point3(0,0,0);for(h=0;h<b.length;h++)n=this._dimension,q=b[h],t=!1,h===b.length-1&&(t=!0,e.z+=this._dimension+.02),k=new a.Point3(.5*n-g,-.5*n+g,-.5*n+-.01),r=new a.Point3(k.x+g,k.y-g,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(-.5*n,-.5*n+g,-.5*n+-.01),r=new a.Point3(k.x+g,
k.y-g,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(-.5*n,.5*n,-.5*n+-.01),r=new a.Point3(k.x+g,k.y-g,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(.5*n-g,.5*n,-.5*n+-.01),r=new a.Point3(k.x+g,k.y-g,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(-.5*n+g,.5*n,-.5*n+-.01),r=new a.Point3(k.x+l,k.y-g,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(-.5*n+g,-.5*n+g,-.5*n+-.01),r=new a.Point3(k.x+l,k.y-g,k.z),
c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(-.5*n,.5*n-g,-.5*n+-.01),r=new a.Point3(k.x+g,k.y-l,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(.5*n-g,.5*n-g,-.5*n+-.01),r=new a.Point3(k.x+g,k.y-l,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v)),k=new a.Point3(-.5*n+g,.5*n-g,-.5*n+-.01),r=new a.Point3(k.x+l,k.y-l,k.z),c.push(this._createSelectionFace(d++,k,r,q,t,e,v));for(u=0;u<v.length;u++){w=Math.floor(u/9);z=[];y=v[u];for(x=0;x<y.length;x+=2)for(A=
y[x],B=y[x+1],C=0;C<v.length;C++)if(D=Math.floor(C/9),D!==w)for(G=v[C],E=0;E<G.length;E+=2)I=G[E],F=G[E+1],this._isSameEdge(A,B,I,F)&&z.push(C);this._adjacentFaces.push(z)}return[4,Promise.all(c)];case 1:K=O.sent();this._updateOrientationMatrices();L=this._onCameraUpdate();L;H=[];M=0;for(J=K;M<J.length;M++)Q=J[M],H.push(0,Q);P=this._getScEngine();P.setPartVisibility(H,!0,!0);this._geometryCreated=!0;return[2,f]}})})};e.prototype._createTexture=function(f,d){f=f.getImageData(0,0,d,d).data;d=new ArrayBuffer(d*
d*3);d=new Uint8Array(d);for(var c=0,b=0;b<f.length;b+=4)d[c]=f[b],d[c+1]=f[b],d[c+2]=f[b],c+=3;return this._viewer.model.createImage({format:a.ImageFormat.Rgb24,data:d,width:this._textureSize,height:this._textureSize})};e.prototype._geometryHasBeenCreated=function(){return this._geometryCreated};e.prototype._insideOverlay=function(a){var d=this._getOverlayOffset();return a.x>=d.x&&a.y>=d.y&&a.x<=d.x+this._viewportSize.x&&a.y<=d.y+this._viewportSize.y};e.prototype._getOverlayOffset=function(){return this._viewer.overlayManager._getOverlayOffset(this._anchor,
this._viewportSize)};e.prototype._getViewportSize=function(){return this._viewportSize};e.prototype._onNoSelection=function(){this._enabled&&0<this._lastSelectedNodes.length&&(this._viewer.model.setNodesOpacity(this._lastSelectedNodes,0),this._lastSelectedNodes.length=0)};e.prototype._onClickSelection=function(f){console.assert(this._enabled);null!==f&&f.isFaceSelection()&&f.overlayIndex()===a.BuiltinOverlayIndex.NavCube?(f=this._getFaceIndexFromNodeId(f.getNodeId()),f<this._nodeIds.length&&0<f&&
this._setViewOrientation(f)):this._onNoSelection()};e.prototype._onMoveSelection=function(f){console.assert(this._enabled);if(null!==f&&f.isFaceSelection()&&f.overlayIndex()===a.BuiltinOverlayIndex.NavCube){var d=f.getNodeId(),c=this._getFaceIndexFromNodeId(d)-1;if(0<=c&&d!==this._nodeIds[0]){f=this._viewer.model;f.setNodesOpacity(this._lastSelectedNodes,0);this._lastSelectedNodes.length=0;this._lastSelectedNodes.push(d);console.assert(c<this._adjacentFaces.length);d=0;for(c=this._adjacentFaces[c];d<
c.length;d++){var b=this._getNodeIdFromFaceIndex(c[d]+1);this._lastSelectedNodes.push(b)}f.setNodesOpacity(this._lastSelectedNodes,1)}}else this._onNoSelection()};e.prototype._getViewOrientationFromFaceIndex=function(f){switch(f){case 1:f=a.ViewOrientation.LeftBottomBack;break;case 2:f=a.ViewOrientation.LeftBottomFront;break;case 3:f=a.ViewOrientation.LeftTopFront;break;case 4:f=a.ViewOrientation.LeftTopBack;break;case 5:f=a.ViewOrientation.LeftTop;break;case 6:f=a.ViewOrientation.LeftBottom;break;
case 7:f=a.ViewOrientation.LeftFront;break;case 8:f=a.ViewOrientation.LeftBack;break;case 9:f=a.ViewOrientation.Left;break;case 10:f=a.ViewOrientation.RightTopBack;break;case 11:f=a.ViewOrientation.RightTopFront;break;case 12:f=a.ViewOrientation.RightBottomFront;break;case 13:f=a.ViewOrientation.RightBottomBack;break;case 14:f=a.ViewOrientation.RightBottom;break;case 15:f=a.ViewOrientation.RightTop;break;case 16:f=a.ViewOrientation.RightFront;break;case 17:f=a.ViewOrientation.RightBack;break;case 18:f=
a.ViewOrientation.Right;break;case 19:f=a.ViewOrientation.BackTopRight;break;case 20:f=a.ViewOrientation.BackBottomRight;break;case 21:f=a.ViewOrientation.BackBottomLeft;break;case 22:f=a.ViewOrientation.BackTopLeft;break;case 23:f=a.ViewOrientation.BackLeft;break;case 24:f=a.ViewOrientation.BackRight;break;case 25:f=a.ViewOrientation.BackBottom;break;case 26:f=a.ViewOrientation.BackTop;break;case 27:f=a.ViewOrientation.Back;break;case 28:f=a.ViewOrientation.FrontBottomRight;break;case 29:f=a.ViewOrientation.FrontTopRight;
break;case 30:f=a.ViewOrientation.FrontTopLeft;break;case 31:f=a.ViewOrientation.FrontBottomLeft;break;case 32:f=a.ViewOrientation.FrontLeft;break;case 33:f=a.ViewOrientation.FrontRight;break;case 34:f=a.ViewOrientation.FrontTop;break;case 35:f=a.ViewOrientation.FrontBottom;break;case 36:f=a.ViewOrientation.Front;break;case 37:f=a.ViewOrientation.BottomRightFront;break;case 38:f=a.ViewOrientation.BottomLeftFront;break;case 39:f=a.ViewOrientation.BottomLeftBack;break;case 40:f=a.ViewOrientation.BottomRightBack;
break;case 41:f=a.ViewOrientation.BottomBack;break;case 42:f=a.ViewOrientation.BottomFront;break;case 43:f=a.ViewOrientation.BottomLeft;break;case 44:f=a.ViewOrientation.BottomRight;break;case 45:f=a.ViewOrientation.Bottom;break;case 46:f=a.ViewOrientation.TopLeftBack;break;case 47:f=a.ViewOrientation.TopRightBack;break;case 48:f=a.ViewOrientation.TopRightFront;break;case 49:f=a.ViewOrientation.TopLeftFront;break;case 50:f=a.ViewOrientation.TopFront;break;case 51:f=a.ViewOrientation.TopBack;break;
case 52:f=a.ViewOrientation.TopRight;break;case 53:f=a.ViewOrientation.TopLeft;break;case 54:f=a.ViewOrientation.Top;break;default:f=a.ViewOrientation.Front}return f};e.prototype._setViewOrientation=function(f){return __awaiter(this,void 0,void 0,function(){var d,c,b,g,l,v,e,k,r,h,n,q,t,u;return __generator(this,function(w){switch(w.label){case 0:return d=this._viewer.view,c=this._getViewOrientationFromFaceIndex(f),[4,d.getViewOrientationCamera(c)];case 1:b=w.sent();g=!1;console.assert(0<=f-1);console.assert(f-
1<this._adjacentFaces.length);l=this._adjacentFaces[f-1];v=0;for(e=l;v<e.length;v++)if(k=e[v],r=k+1,r===this._lastFaceIndex){g=!0;break}this._lastFaceIndex=f;h=null!==this._lastCamera&&this._lastCamera.equals(d.getCamera());this._cameraRotation=(n=this._lastOrientation===c||g)&&h?(this._cameraRotation+90)%360:0;this._lastOrientation=c;0<this._cameraRotation&&(q=a.Point3.subtract(b.getPosition(),b.getTarget()).normalize(),t=a.Matrix.createFromOffAxisRotation(q,this._cameraRotation),u=b.getUp(),t.transform(u,
u),b.setUp(u));return[4,d.fitWorld(a.DefaultTransitionDuration,b)];case 2:return w.sent(),this._lastCamera=d.getCamera(),[2]}})})};e.prototype._getScEngine=function(){return this._viewer._getScEngine()};e.prototype._createInstance=function(f,d){return __awaiter(this,void 0,void 0,function(){var c,b,g,l,v;return __generator(this,function(e){switch(e.label){case 0:return[4,this._viewer.model.createMesh(f)];case 1:return c=e.sent(),b=new a.MeshInstanceData(c),b.setCreationFlags(a.MeshInstanceCreationFlags.DoNotCut|
a.MeshInstanceCreationFlags.DoNotExplode|a.MeshInstanceCreationFlags.ExcludeBounding|a.MeshInstanceCreationFlags.DoNotLight|a.MeshInstanceCreationFlags.Invisible),b.setOverlayIndex(a.BuiltinOverlayIndex.NavCube),g=this._getScEngine(),[4,g.createMeshInstance(b)];case 2:return l=e.sent(),v=l[1],this._instanceKeys[d]=v,[2,v]}})})};e.prototype._createCube=function(f,d){for(var c=[],b=[],g=[],l=[],v=this._textWidths[0],e=0,k=this._textWidths;e<k.length;e++){var r=k[e];r>v&&(v=r)}v+=10;c.push(new a.Point3(.5*
d,.5*d,.5*d));c.push(new a.Point3(-.5*d,.5*d,-.5*d));c.push(new a.Point3(-.5*d,.5*d,.5*d));c.push(new a.Point3(.5*d,.5*d,-.5*d));c.push(new a.Point3(-.5*d,.5*d,-.5*d));c.push(new a.Point3(.5*d,.5*d,.5*d));b.push(new a.Point3(0,1,0));b.push(new a.Point3(0,1,0));b.push(new a.Point3(0,1,0));b.push(new a.Point3(0,1,0));b.push(new a.Point3(0,1,0));b.push(new a.Point3(0,1,0));var e=22/this._textureSize,k=82/this._textureSize,e=1-e,k=1-k,h=(v-this._textWidths[0])/2,r=-(h/this._textureSize),h=(this._textWidths[0]+
h)/this._textureSize;g.push(new a.Point2(r,e));g.push(new a.Point2(h,k));g.push(new a.Point2(h,e));g.push(new a.Point2(r,k));g.push(new a.Point2(h,k));g.push(new a.Point2(r,e));l.push(new a.Point3(-.5*d,.5*d,-.5*d));l.push(new a.Point3(.5*d,.5*d,-.5*d));l.push(new a.Point3(.5*d,.5*d,-.5*d));l.push(new a.Point3(.5*d,.5*d,.5*d));l.push(new a.Point3(.5*d,.5*d,.5*d));l.push(new a.Point3(-.5*d,.5*d,.5*d));l.push(new a.Point3(-.5*d,.5*d,.5*d));l.push(new a.Point3(-.5*d,.5*d,-.5*d));c.push(new a.Point3(-.5*
d,-.5*d,.5*d));c.push(new a.Point3(-.5*d,-.5*d,-.5*d));c.push(new a.Point3(.5*d,-.5*d,.5*d));c.push(new a.Point3(.5*d,-.5*d,.5*d));c.push(new a.Point3(-.5*d,-.5*d,-.5*d));c.push(new a.Point3(.5*d,-.5*d,-.5*d));b.push(new a.Point3(0,-1,0));b.push(new a.Point3(0,-1,0));b.push(new a.Point3(0,-1,0));b.push(new a.Point3(0,-1,0));b.push(new a.Point3(0,-1,0));b.push(new a.Point3(0,-1,0));e-=60/this._textureSize;k-=60/this._textureSize;h=(v-this._textWidths[1])/2;r=-(h/this._textureSize);h=(this._textWidths[1]+
h)/this._textureSize;g.push(new a.Point2(r,e));g.push(new a.Point2(r,k));g.push(new a.Point2(h,e));g.push(new a.Point2(h,e));g.push(new a.Point2(r,k));g.push(new a.Point2(h,k));l.push(new a.Point3(-.5*d,-.5*d,-.5*d));l.push(new a.Point3(.5*d,-.5*d,-.5*d));l.push(new a.Point3(.5*d,-.5*d,-.5*d));l.push(new a.Point3(.5*d,-.5*d,.5*d));l.push(new a.Point3(.5*d,-.5*d,.5*d));l.push(new a.Point3(-.5*d,-.5*d,.5*d));l.push(new a.Point3(-.5*d,-.5*d,.5*d));l.push(new a.Point3(-.5*d,-.5*d,-.5*d));c.push(new a.Point3(-.5*
d,.5*d,.5*d));c.push(new a.Point3(-.5*d,.5*d,-.5*d));c.push(new a.Point3(-.5*d,-.5*d,-.5*d));c.push(new a.Point3(-.5*d,.5*d,.5*d));c.push(new a.Point3(-.5*d,-.5*d,-.5*d));c.push(new a.Point3(-.5*d,-.5*d,.5*d));b.push(new a.Point3(-1,0,0));b.push(new a.Point3(-1,0,0));b.push(new a.Point3(-1,0,0));b.push(new a.Point3(-1,0,0));b.push(new a.Point3(-1,0,0));b.push(new a.Point3(-1,0,0));e-=60/this._textureSize;k-=60/this._textureSize;h=(v-this._textWidths[2])/2;r=-(h/this._textureSize);h=(this._textWidths[2]+
h)/this._textureSize;g.push(new a.Point2(r,e));g.push(new a.Point2(r,k));g.push(new a.Point2(h,k));g.push(new a.Point2(r,e));g.push(new a.Point2(h,k));g.push(new a.Point2(h,e));l.push(new a.Point3(-.5*d,.5*d,-.5*d));l.push(new a.Point3(-.5*d,.5*d,.5*d));l.push(new a.Point3(-.5*d,.5*d,.5*d));l.push(new a.Point3(-.5*d,-.5*d,.5*d));l.push(new a.Point3(-.5*d,-.5*d,.5*d));l.push(new a.Point3(-.5*d,-.5*d,-.5*d));l.push(new a.Point3(-.5*d,-.5*d,-.5*d));l.push(new a.Point3(-.5*d,.5*d,-.5*d));c.push(new a.Point3(.5*
d,.5*d,.5*d));c.push(new a.Point3(.5*d,-.5*d,-.5*d));c.push(new a.Point3(.5*d,.5*d,-.5*d));c.push(new a.Point3(.5*d,.5*d,.5*d));c.push(new a.Point3(.5*d,-.5*d,.5*d));c.push(new a.Point3(.5*d,-.5*d,-.5*d));b.push(new a.Point3(1,0,0));b.push(new a.Point3(1,0,0));b.push(new a.Point3(1,0,0));b.push(new a.Point3(1,0,0));b.push(new a.Point3(1,0,0));b.push(new a.Point3(1,0,0));e-=60/this._textureSize;k-=60/this._textureSize;h=(v-this._textWidths[3])/2;r=-(h/this._textureSize);h=(this._textWidths[3]+h)/this._textureSize;
g.push(new a.Point2(h,e));g.push(new a.Point2(r,k));g.push(new a.Point2(h,k));g.push(new a.Point2(h,e));g.push(new a.Point2(r,e));g.push(new a.Point2(r,k));l.push(new a.Point3(.5*d,.5*d,-.5*d));l.push(new a.Point3(.5*d,.5*d,.5*d));l.push(new a.Point3(.5*d,.5*d,.5*d));l.push(new a.Point3(.5*d,-.5*d,.5*d));l.push(new a.Point3(.5*d,-.5*d,.5*d));l.push(new a.Point3(.5*d,-.5*d,-.5*d));l.push(new a.Point3(.5*d,-.5*d,-.5*d));l.push(new a.Point3(.5*d,.5*d,-.5*d));c.push(new a.Point3(.5*d,-.5*d,-.5*d));c.push(new a.Point3(-.5*
d,-.5*d,-.5*d));c.push(new a.Point3(-.5*d,.5*d,-.5*d));c.push(new a.Point3(.5*d,.5*d,-.5*d));c.push(new a.Point3(.5*d,-.5*d,-.5*d));c.push(new a.Point3(-.5*d,.5*d,-.5*d));b.push(new a.Point3(0,0,-1));b.push(new a.Point3(0,0,-1));b.push(new a.Point3(0,0,-1));b.push(new a.Point3(0,0,-1));b.push(new a.Point3(0,0,-1));b.push(new a.Point3(0,0,-1));e-=60/this._textureSize;k-=60/this._textureSize;h=(v-this._textWidths[4])/2;r=-(h/this._textureSize);h=(this._textWidths[4]+h)/this._textureSize;g.push(new a.Point2(r,
k));g.push(new a.Point2(h,k));g.push(new a.Point2(h,e));g.push(new a.Point2(r,e));g.push(new a.Point2(r,k));g.push(new a.Point2(h,e));c.push(new a.Point3(-.5*d,.5*d,.5*d));c.push(new a.Point3(-.5*d,-.5*d,.5*d));c.push(new a.Point3(.5*d,-.5*d,.5*d));c.push(new a.Point3(-.5*d,.5*d,.5*d));c.push(new a.Point3(.5*d,-.5*d,.5*d));c.push(new a.Point3(.5*d,.5*d,.5*d));b.push(new a.Point3(0,0,1));b.push(new a.Point3(0,0,1));b.push(new a.Point3(0,0,1));b.push(new a.Point3(0,0,1));b.push(new a.Point3(0,0,1));
b.push(new a.Point3(0,0,1));e-=60/this._textureSize;k-=60/this._textureSize;h=(v-this._textWidths[5])/2;r=-(h/this._textureSize);h=(this._textWidths[5]+h)/this._textureSize;g.push(new a.Point2(r,e));g.push(new a.Point2(r,k));g.push(new a.Point2(h,k));g.push(new a.Point2(r,e));g.push(new a.Point2(h,k));g.push(new a.Point2(h,e));d=new a.MeshData;d.setFaceWinding(a.FaceWinding.CounterClockwise);v=[];k=[];r=[];for(e=h=0;e<c.length;e++){var n=c[e];v.push(n.x);v.push(n.y);v.push(n.z);n=b[e];k.push(n.x);
k.push(n.y);k.push(n.z);n=g[e];r.push(n.x);r.push(n.y);if(18<=v.length){for(var n=[[0,255,0,255],[0,255,0,255],[255,0,0,255],[255,0,0,255],[0,0,255,255],[0,0,255,255]][h],q=[],t=0;6>t;t++)q.push(n[0]),q.push(n[1]),q.push(n[2]),q.push(n[3]);d.addFaces(v,k,new Uint8Array(q),r);v=[];k=[];r=[];++h}}v=[];c=new Uint8Array(4*l.length);for(e=0;e<l.length;e++)b=l[e],v.push(b.x),v.push(b.y),v.push(b.z),b=4*e,c[b]=this._outlineColor.r,c[b+1]=this._outlineColor.g,c[b+2]=this._outlineColor.b,c[b+3]=255;d.addPolyline(v,
c);return this._createInstance(d,f)};e.prototype._onCameraUpdate=function(){var f=new a.Camera,d=this._viewer.view.getCamera();f.setPosition(d.getPosition().subtract(d.getTarget()).normalize());f.setTarget(a.Point3.zero());f.setUp(d.getUp());f.setProjection(a.Projection.Orthographic);f.setWidth(this._fieldSize);f.setHeight(this._fieldSize);return this._viewer.overlayManager.setCamera(a.BuiltinOverlayIndex.NavCube,f)};e.prototype._updateOrientationMatrices=function(){var f=this._viewer.model.getViewAxes(),
d=f.upVector.copy(),c=f.frontVector.copy(),b=a.Point3.cross(d,c.copy().scale(-1)),f=new a.Matrix;f.m[0]=-c.x;f.m[1]=-c.y;f.m[2]=-c.z;f.m[4]=b.x;f.m[5]=b.y;f.m[6]=b.z;f.m[8]=d.x;f.m[9]=d.y;f.m[10]=d.z;for(var d=this._getScEngine(),c=[],b=0,g=this._instanceKeys;b<g.length;b++)c.push(0,g[b]);d.setInstancesMatrix(c,f)};e.prototype._createSelectionFace=function(f,d,c,b,g,l,v){var e=new a.MeshData;e.setFaceWinding(a.FaceWinding.CounterClockwise);var k=[];this._createQuad(d,c,k,b,l,g);d=[];c=[];b=[];for(l=
0;l<k.length;l++){var r=k[l];d.push(r.x);d.push(r.y);d.push(r.z);c.push(0);c.push(0);c.push(-1);b.push(this._selectionFaceColor.r);b.push(this._selectionFaceColor.g);b.push(this._selectionFaceColor.b);b.push(128)}l=[];r=[this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,255,this._outlineColor.r,this._outlineColor.g,this._outlineColor.b,255];e.addFaces(d,c,new Uint8Array(b));d=[];g?(d.push(k[4].x,k[4].y,k[4].z),d.push(k[5].x,k[5].y,k[5].z)):(d.push(k[0].x,k[0].y,k[0].z),d.push(k[1].x,
k[1].y,k[1].z));e.addPolyline(d,new Uint8Array(r));l.push(new a.Point3(d[0],d[1],d[2]),new a.Point3(d[3],d[4],d[5]));d=[];d.push(k[1].x,k[1].y,k[1].z);d.push(k[2].x,k[2].y,k[2].z);e.addPolyline(d,new Uint8Array(r));l.push(new a.Point3(d[0],d[1],d[2]),new a.Point3(d[3],d[4],d[5]));d=[];d.push(k[3].x,k[3].y,k[3].z);d.push(k[4].x,k[4].y,k[4].z);e.addPolyline(d,new Uint8Array(r));l.push(new a.Point3(d[0],d[1],d[2]),new a.Point3(d[3],d[4],d[5]));d=[];g?(d.push(k[3].x,k[3].y,k[3].z),d.push(k[2].x,k[2].y,
k[2].z)):(d.push(k[5].x,k[5].y,k[5].z),d.push(k[3].x,k[3].y,k[3].z));e.addPolyline(d,new Uint8Array(r));l.push(new a.Point3(d[0],d[1],d[2]),new a.Point3(d[3],d[4],d[5]));v.push(l);return this._createInstance(e,f)};e.prototype._createQuad=function(f,d,c,b,g,l){void 0===l&&(l=!1);f=new a.Point3(f.x,f.y,f.z);d=new a.Point3(d.x,d.y,d.z);g&&(f.x+=g.x,f.y+=g.y,f.z+=g.z,d.x+=g.x,d.y+=g.y,d.z+=g.z);g=c.length;var v=new a.Point3(d.x,d.y,f.z),v=b.transform(v);c.push(v);v=new a.Point3(f.x,d.y,f.z);v=b.transform(v);
c.push(v);v=new a.Point3(f.x,f.y,f.z);v=b.transform(v);c.push(v);v=new a.Point3(d.x,f.y,f.z);v=b.transform(v);c.push(v);v=new a.Point3(d.x,d.y,f.z);v=b.transform(v);c.push(v);v=new a.Point3(f.x,f.y,f.z);v=b.transform(v);c.push(v);if(l)for(b=0;3>b;b++)l=g+b,f=c[g+b],f=new a.Point3(f.x,f.y,f.z),d=g+(6-b-1),c[l].x=c[d].x,c[l].y=c[d].y,c[l].z=c[d].z,c[d].x=f.x,c[d].y=f.y,c[d].z=f.z};e.prototype._makeRotationMatrixX=function(f){var d=Math.cos(f);f=Math.sin(f);var c=new a.Matrix;c.m[5]=d;c.m[6]=-f;c.m[9]=
f;c.m[10]=d;return c};e.prototype._makeRotationMatrixY=function(f){var d=Math.cos(f);f=Math.sin(f);var c=new a.Matrix;c.m[0]=d;c.m[2]=f;c.m[8]=-f;c.m[10]=d;return c};e.prototype._makeRotationMatrixZ=function(f){var d=Math.cos(f);f=Math.sin(f);var c=new a.Matrix;c.m[0]=d;c.m[1]=-f;c.m[4]=f;c.m[5]=d;return c};e.prototype._getFaceIndexFromNodeId=function(a){for(var d=0;d<this._nodeIds.length;d++)if(this._nodeIds[d]===a)return d;return-1};e.prototype._getNodeIdFromFaceIndex=function(a){return this._nodeIds[a]};
e.prototype._isSameEdge=function(f,d,c,b){var g=a.Point3.subtract(f,c).squaredLength()+a.Point3.subtract(d,b).squaredLength();f=a.Point3.subtract(d,c).squaredLength()+a.Point3.subtract(f,b).squaredLength();return.03>Math.min(g,f)};e.prototype._initializeTextures=function(){return __awaiter(this,void 0,void 0,function(){var a,d,c,b,g,l,v;return __generator(this,function(p){switch(p.label){case 0:a=document.createElement("canvas");a.width=this._textureSize;a.height=this._textureSize;d=a.getContext("2d");
c=2*(this._fontSize+5);d.beginPath();d.rect(0,0,this._textureSize,this._textureSize);d.fillStyle="gray";d.fill();d.fillStyle="black";d.font=this._fontInfo;for(b=0;b<e._faceTexts.length;b++)g=e._faceTexts[b],d.fillText(g,0,c*(b+1)),l=d.measureText(g),this._textWidths.push(l.width);return[4,this._createTexture(d,this._textureSize)];case 1:return this._textImageId=v=p.sent(),[2]}})})};e._faceTexts="LEFT RIGHT FRONT BACK BOTTOM TOP".split(" ");return e}();a.NavCube=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(f){var d=this;this._operatorStack=[];this._operators=new Map;this._customOperatorIdCount=0;this._customOperatorIdIndex=1E4;this._viewer=f;this._viewer.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(d,void 0,void 0,function(){var c=this,b;return __generator(this,function(g){b=[];this._operators.forEach(function(a,g){a=c._deactivateOperator(g);void 0!==a&&b.push(a);a=c._activateOperator(g);void 0!==a&&b.push(a)});return[2,a.Util.waitForAll(b)]})})}})}
e.prototype._shutdown=function(){for(;void 0!==this.pop(););};e.prototype._registerOperator=function(a,d){this._operators.set(a,d)};e.prototype.registerCustomOperator=function(a){var d=this._customOperatorIdIndex+this._customOperatorIdCount++;this._operators.set(d,a);return d};e.prototype.unregisterCustomOperator=function(a){a>=this._customOperatorIdIndex&&this._operators.delete(a)};e.prototype.indexOf=function(a){for(var d=this.size()-1;0<=d;d--)if(this._operatorStack[d]===a)return d;return-1};e.prototype.push=
function(a){return this._isValid(a)&&!this._contains(a)?(this._operatorStack.push(a),this._activateOperator(a),!0):!1};e.prototype.set=function(a,d){var c=this._operatorStack[d];return a===c?!1:this._isValid(a)&&!this._contains(a)?(this._deactivateOperator(c),this._activateOperator(a),this._operatorStack[d]=a,!0):!1};e.prototype.pop=function(){var a=this._operatorStack.pop();void 0!==a&&this._deactivateOperator(a);return a};e.prototype.remove=function(a){var d=this.indexOf(a);-1!==d&&(this._operatorStack.splice(d,
1),this._deactivateOperator(a))};e.prototype.peek=function(){return 0<this.size()?this._operatorStack[this.size()-1]:a.OperatorId.Invalid};e.prototype.clear=function(){for(var a=this.size()-1;0<=a;a--)this.pop()};e.prototype.size=function(){return this._operatorStack.length};e.prototype.getOperator=function(a){a=this._operators.get(a);return void 0!==a?a:null};e.prototype.injectEvent=function(f,d){for(var c=this.size()-1;0<=c;c--){var b=this._operators.get(this._operatorStack[c]);if(void 0!==b)switch(d){case a.EventType.KeyDown:if(b.onKeyDown)b.onKeyDown(f);
break;case a.EventType.KeyUp:if(b.onKeyUp)b.onKeyUp(f);break;case a.EventType.MouseDown:if(b.onMouseDown)b.onMouseDown(f);break;case a.EventType.MouseMove:if(b.onMouseMove)b.onMouseMove(f);break;case a.EventType.MouseUp:if(b.onMouseUp)b.onMouseUp(f);break;case a.EventType.Mousewheel:if(b.onMousewheel)b.onMousewheel(f);break;case a.EventType.TouchStart:if(b.onTouchStart)b.onTouchStart(f);break;case a.EventType.TouchMove:if(b.onTouchMove)b.onTouchMove(f);break;case a.EventType.TouchEnd:if(b.onTouchEnd)b.onTouchEnd(f);
break;case a.EventType.ViewOrientationChange:if(b.onViewOrientationChange)b.onViewOrientationChange();break;default:a.Util.TypeAssertNever(d)}if(f.getHandled()){d!==a.EventType.MouseUp&&d!==a.EventType.TouchEnd||this._stopInteraction();break}}return Promise.resolve()};e.prototype._stopInteraction=function(){for(var f=[],d=this.size()-1;0<=d;d--){var c=this._operators.get(this._operatorStack[d]);c&&c.stopInteraction&&(c=c.stopInteraction(),void 0!==c&&f.push(c))}return a.Util.waitForAll(f)};e.prototype._buildSelectionSpecs=
function(f,d,c){for(var b=!1,g=a.SelectionMask.None,l=a.Operator.SelectionRequirements.None,v=!0,e=this.size()-1;0<=e;e--){var k=this._operators.get(this._operatorStack[e]);void 0!==k&&k.needsSelection&&k.needsSelection(f,d,c)&&(b=!0,g|=k._selectionMask(f),l|=k.selectionRequirements(f),v=v&&k._onlySelectOverlays(f))}return b?{mask:g,requirements:l,restrictToOverlays:v}:null};e.prototype._injectSelectionEvent=function(f,d){return __awaiter(this,void 0,void 0,function(){var c,b,g,l,v,e;return __generator(this,
function(k){switch(k.label){case 0:c=a.Button.None;f instanceof a.Event.MouseInputEvent&&(c=f.getButton());b=f.getPosition();f._setCompositePickResult(null);g=this._buildSelectionSpecs(d,c,b);if(null===g)return[2,this.injectEvent(f,d)];l=new a.PickConfig(g.mask);l.ignoreCappingGeometry=0!==(g.requirements&a.Operator.SelectionRequirements.IgnoreCapping);l.restrictToOverlays=g.restrictToOverlays;k.label=1;case 1:return k.trys.push([1,4,,5]),[4,this._viewer.view.compositePickFromPoint(b,l)];case 2:return v=
k.sent(),f._setCompositePickResult(v),[4,this.injectEvent(f,d)];case 3:return[2,k.sent()];case 4:return e=k.sent(),"reason"in e?console.log(e.reason):console.log(e),f._setCompositePickResult(null),[2,this.injectEvent(f,d)];case 5:return[2]}})})};e.prototype._injectViewOrientationChangeEvent=function(){for(var a=this.size()-1;0<=a;a--){var d=this._operators.get(this._operatorStack[a]);if(void 0!==d&&d.onViewOrientationChange)d.onViewOrientationChange()}};e.prototype._isValid=function(f){return this._operators.has(f)||
f===a.OperatorId.None};e.prototype._contains=function(a){return-1!==this.indexOf(a)};e.prototype._activateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onActivate)return a.onActivate()};e.prototype._deactivateOperator=function(a){a=this._operators.get(a);if(void 0!==a&&a.onDeactivate)return a.onDeactivate()};return e}();a.OperatorManager=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(a,d){this._viewer=a;this._engine=d}e.prototype.maxIndex=function(){return a.BuiltinOverlayIndex.First-1};e.prototype.setViewport=function(f,d,c,b,g,l,v,e,k,r){if(0===f)throw new a.CommunicatorError("Index 0 is reserved and may not be used to specify an overlay.");if(0>f)throw new a.CommunicatorError("Invalid index "+f+" specified when setting viewport.");this._validateUnit(c,b,"x");this._validateUnit(g,l,"y");this._validateUnit(v,e,"width");this._validateUnit(k,
r,"height");this._engine.setOverlayViewport(f,d,c,b,g,l,v,e,k,r);return Promise.resolve()};e.prototype.setVisibility=function(a,d){this._engine.setOverlayVisibility(a,d);return Promise.resolve()};e.prototype.destroy=function(a){this._engine.destroyOverlay(a);return Promise.resolve()};e.prototype.addNodes=function(a,d){d=this._viewer.model._gatherInstanceIncsFromNodeIds(d);0<d.length&&this._engine.addNodesToOverlay(d,a);return Promise.resolve()};e.prototype.setCamera=function(a,d){this._engine.setOverlayCamera(a,
d);return Promise.resolve()};e.prototype._getOverlayOffset=function(f,d){var c=this._viewer.view.getCanvasSize(),b=a.Point2.zero();if(f===a.OverlayAnchor.LowerRightCorner||f===a.OverlayAnchor.UpperRightCorner||f===a.OverlayAnchor.RightCenter)b.x=c.x-d.x;else if(f===a.OverlayAnchor.Center||f===a.OverlayAnchor.TopCenter||f===a.OverlayAnchor.BottomCenter)b.x=.5*(c.x-d.x);if(f===a.OverlayAnchor.LowerLeftCorner||f===a.OverlayAnchor.LowerRightCorner||f===a.OverlayAnchor.BottomCenter)b.y=c.y-d.y;else if(f===
a.OverlayAnchor.Center||f===a.OverlayAnchor.LeftCenter||f===a.OverlayAnchor.RightCenter)b.y=.5*(c.y-d.y);return b};e.prototype._validateUnit=function(f,d,c){if(d!==a.OverlayUnit.Pixels&&(0>f||1<f))throw new a.ParseError("value for "+c+" should be between 0.0 and 1.0 when specifying non pixel value");};return e}();a.OverlayManager=h})(Communicator||(Communicator={}));
(function(a){(function(a){a[a.None=0]="None";a[a.Floor=1]="Floor";a[a.Wall=2]="Wall";a[a.Door=4]="Door"})(a.BimMask||(a.BimMask={}));var h=function(){function e(f){void 0===f&&(f=a.SelectionMask.Face);this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=a.SelectionMask.None;this.restrictLinesAndPointsToSelectedFaceInstances=this.oneEntityPerTypePerInstance=this.respectDepthRange=!0;this.restrictToOverlays=this.ignoreOverlays=this.ignoreCappingGeometry=
this.enableProximityFaces=!1;this.selectionMask=f}Object.defineProperty(e.prototype,"allowFaces",{get:function(){return 0!==(this.selectionMask&a.SelectionMask.Face)},set:function(f){this.selectionMask=a.Internal.setBit(this.selectionMask,a.SelectionMask.Face,f)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"allowLines",{get:function(){return 0!==(this.selectionMask&a.SelectionMask.Line)},set:function(f){this.selectionMask=a.Internal.setBit(this.selectionMask,a.SelectionMask.Line,
f)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"allowPoints",{get:function(){return 0!==(this.selectionMask&a.SelectionMask.Point)},set:function(f){this.selectionMask=a.Internal.setBit(this.selectionMask,a.SelectionMask.Point,f)},enumerable:!0,configurable:!0});return e}();a.PickConfig=h;h=function(){return function(e){void 0===e&&(e=a.SelectionMask.All);this.mustBeFullyContained=!1;this.respectVisibility=!0;this.forceEffectiveSceneVisibilityMask=this.forceEffectiveVisibilityMask=
a.SelectionMask.None;this.ignoreCuttingSections=this.allowPoints=this.allowLines=this.allowFaces=!0;this.ignoreUnrequestedInstances=this.onlyStreamedInstances=!1;this.allowFaces=0!==(e&a.SelectionMask.Face);this.allowLines=0!==(e&a.SelectionMask.Line);this.allowPoints=0!==(e&a.SelectionMask.Point)}}();a.IncrementalPickConfig=h})(Communicator||(Communicator={}));var SC;
(function(a){a.UnspecifiedMeasurementUnit=0;a.isError=function(a){return"object"===typeof a&&null!==a&&!0};a.getStateFailure=function(a){a=a.data;return"object"===typeof a&&null!==a&&"scStateFailure"in a?a.scStateFailure:null}})(SC||(SC={}));
(function(a){(function(h){function e(b){return null!==b?a.Color.createFromFloatArray(b):b}function f(a){return h.mapInPlace(a,e)}var d;(function(a){a[a.Add=0]="Add";a[a.Update=1]="Update"})(d||(d={}));var c=function(){return function(a){this.promise=h.OpenPromise.create();this.ids=a}}(),b=function(){function b(c,g){this._engineReadyPromise=h.OpenPromise.create();this._sessionStartedPromise=h.OpenPromise.create();this._connectionlessEmpty=!1;this._uri="ws://localhost:9999";this._streamingMode=a.StreamingMode.Default;
this._rendererType=a.RendererType.Client;this._memoryLimit=this._meshLevel=0;this._boundingPreviewMode=a.BoundingPreviewMode.All;this._streamCutoffScale=1;this._loadFinished=!1;this._statistics=new h.StatisticMap;this._cachedElementCount=this._cachedTriangleCount=null;this._windowSize=new a.Point2(0,0);this._cuttingSectionToKeyMap=new Map;this._cappingQuantizationGranularity=-1E4;this._cappingMaterialDirty=this._cappingGeometryVisibility=this._cappingLinesEnabled=this._cappingFacesEnabled=!0;this._cappingDelayTimeoutId=
null;this._cappingDelay=500;this._requestBatchCountByType=[];this._pendingRequestsByType=[];this._xRayMaterials=[];this._callbackManager=c;this._applyOptions(g);for(c=0;1>c;++c)this._requestBatchCountByType.push(0),this._pendingRequestsByType.push([])}b.prototype.getNetworkModelName=function(){console.assert(1===this._sessionType);if(void 0!==this._model)return this._model;throw new a.InternalLogicError;};b.prototype.logMessage=function(a){console.log(a)};b.prototype.setTimeout=function(a,b){return setTimeout(a,
b)};b.prototype.sleep=function(a){return h.sleep(a)};b.prototype.getScsInfo=function(){console.assert(2===this._sessionType);return void 0!==this._buffer?this._buffer:/^wss?:\/\//i.test(this._uri)?null:this._uri};b.prototype._applyOptions=function(a){void 0!==a.empty&&(this._connectionlessEmpty=a.empty);void 0!==a.endpointUri&&(this._uri=a.endpointUri);a.model&&(this._model=a.model);void 0!==a.sessionToken&&(this._sessionToken=a.sessionToken);void 0!==a.buffer&&(this._buffer=a.buffer);void 0!==a.streamingMode&&
(this._streamingMode=a.streamingMode);void 0!==a.rendererType&&(this._rendererType=a.rendererType);void 0!==a.defaultMeshLevel&&(this._meshLevel=a.defaultMeshLevel);void 0!==a.memoryLimit&&(this._memoryLimit=a.memoryLimit);void 0!==a.boundingPreviewMode&&(this._boundingPreviewMode=a.boundingPreviewMode);void 0!==a.streamCutoffScale&&this._setStreamCutoffScale(a.streamCutoffScale)};b.prototype.start=function(a,b){var c=this;this._canvasContainer=a;this._initOptions=b;_SC.createInstance({container:a,
onReady:function(a){c._onEngineReady(a)},onError:function(a){c._callbackManager.trigger("modelLoadFailure",c._model||"","failed to load engine: "+a)},enginePath:b.enginePath});return!0};b.prototype.setPickTolerance=function(a){this._scSelectionManager.setPickTolerance(a)};b.prototype.getPickTolerance=function(){return this._scSelectionManager.getPickTolerance()};b.prototype._onEngineReady=function(a){var b=this;this._sc=a;this._sessionType=0;this._matrixCache=new h.ScMatrixCache(this);this._materialCache=
new h.ScMaterialCache(this);this._scSelectionManager=new h.ScSelectionManager(this._sc);this.resize();this._callbackManager.bind({_firstBoundingReady:function(){return b._regenerateCapping()}});this._sc.setEventHandler("session_started",function(){var a=function(){b._callbackManager.unbind(c);return b._sessionStartedPromise},c={_sessionStarted:function(){return b._onSessionStarted()},_assemblyTreeReady:a,_modelSwitched:a};b._callbackManager.bind(c);b._sessionStartedPromise.resolve(b._callbackManager.promiseTrigger("_sessionStarted",
null))});this._sc.setEventHandler("announce_model",function(a,c,g){b._callbackManager.trigger("_announceModel",c,g)});this._sc.setEventHandler("first_instance",function(){b._callbackManager.trigger("_firstInstance")});this._sc.setEventHandler("inclusion",function(a,c,g,d){b._callbackManager.trigger("_inclusion",c,g,d)});this._sc.setEventHandler("remap_model",function(a,c,g,d){b._callbackManager.trigger("_remapModel",c,g,d)});this._sc.setEventHandler("remap_inclusion",function(a,c,g,d,l){b._callbackManager.trigger("_remapInclusion",
c,g,d,l)});this._sc.setEventHandler("capping_idle",function(a,c,g){b._callbackManager.trigger("cappingIdle",c,g)});this._sc.setEventHandler("stream_active",this._initOptions.streamingActivated);this._sc.setEventHandler("stream_idle",this._initOptions.streamingDeactivated);this._sc.setEventHandler("open_model_failed",function(a,c){switch(c.reason){case "UNKNOWN_MODEL":a="Unknown model";break;case "BAD_NETWORK_VERSION":a="Client/Server network version mismatch";break;case "BAD_STREAM_VERSION":case "BAD_STORE_VERSION":a=
"Unsupported file version";break;default:a="Internal Error"}b._callbackManager.trigger("modelLoadFailure",b._model||"",a)});this._sc.setEventHandler("missing_model",function(a,c,g){b._callbackManager.trigger("_missingModel",c,g);b._callbackManager.trigger("missingModel",g)});this._sc.setEventHandler("bad_data",function(a,c){switch(c.type){case "TRUNCATED_BLOCK":a="Failed to parse truncated data block.";break;case "ZFRAME_DECOMPRESS_FAILED":a="Failed to decompress data.";break;case "UNMATCHED_CODE":a=
"Unknown opcode.";break;case "STORE_VERSION_MISMATCHED":a="Store version mismatched."+(" Expected='"+c.expected+"'.");a+=" Actual='"+c.actual+"'.";break;case "STREAM_VERSION_MISMATCHED":a="Stream version mismatched."+(" Expected='"+c.expected+"'.");a+=" Actual='"+c.actual+"'.";break;case "PARSE_BOUNDING_TREE_FAILED":a="Failed to parse bounding tree.";break;default:a="Unknown error."}b._callbackManager.trigger("modelLoadFailure",b._model||"",a)});this._sc.setEventHandler("socket_open_failed",function(){b._callbackManager.trigger("modelLoadFailure",
b._model||"","WebSocket connection failed.")});this._sc.setEventHandler("post_draw",function(a,c,g){b._syncedCamera=g;b._renderComplete(c)});this._sc.setEventHandler("priority_meta_data_sent",function(a,c,g){b._initOptions.priorityMetaDataSent(c,g)});this.setAllowHighDpi(!0);this._sc.setEventHandler("meta_data",function(a,c,g,d){0>c&&(c+=4294967296);b._callbackManager.trigger("_metaData",c,g,d)});this._sc.setEventHandler("draw_complete",function(){b._callbackManager.trigger("_drawComplete")});this._sc.setEventHandler("webgl_context_lost",
function(){b._callbackManager.trigger("webGlContextLost")});this._sc.setEventHandler("websocket_connection_closed",function(){b._callbackManager.trigger("websocketConnectionClosed")});this._initOptions.engineReady(this._sessionStartedPromise);this._engineReadyPromise.resolve()};b.prototype.loadFinished=function(){return this._loadFinished};b.prototype.resetCachedStatistics=function(){this._cachedTriangleCount=this._cachedElementCount=null};b.prototype.setAmbientOcclusionEnabled=function(a){this._sc.setAmbientOcclusionEnabled(a)};
b.prototype.setAmbientOcclusionRadius=function(a){this._sc.setAmbientOcclusionRadius(a)};b.prototype.setLightingEnabled=function(a){this._sc.setLightingEnabled(a)};b.prototype._fillStatTotalCounts=function(){null!==this._cachedElementCount&&null!==this._cachedTriangleCount&&(this._statistics.total_element_count=this._cachedElementCount,this._statistics.total_triangle_count=this._cachedTriangleCount)};b.prototype._renderComplete=function(a){this._statistics=a;this._initOptions.renderComplete();this._fillStatTotalCounts()};
b.prototype._updateCachedStats=function(){return __awaiter(this,void 0,void 0,function(){var a,b,c;return __generator(this,function(g){switch(g.label){case 0:return a=this._sc.getElementCount(),b=this._sc.getTriangleCount(),[4,Promise.all([a,b])];case 1:return c=g.sent(),this._cachedElementCount=c[0],this._cachedTriangleCount=c[1],this._fillStatTotalCounts(),[2]}})})};b.prototype._toVector3=function(a){var b=[0,0,0];a.toArray(b);return b};b.prototype.startExplode=function(a,b){this.delayCapping();
this._sc.startExplode(a,this._toVector3(b))};b.prototype.setExplodeMagnitude=function(a){this._callbackManager.trigger("explode",a);this.delayCapping();this._sc.explode(a)};b.prototype.stopExplode=function(){this.delayCapping();this._sc.resetExplode()};b.prototype.getStatistics=function(a){void 0===a&&(a=!1);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return!a||this.loadFinished()?[3,2]:[4,this._updateCachedStats()];case 1:return b.sent(),
this._fillStatTotalCounts(),[2,this._statistics];case 2:return this.loadFinished()&&null===this._cachedTriangleCount?[4,this._updateCachedStats()]:[3,4];case 3:return b.sent(),this._fillStatTotalCounts(),[2,this._statistics];case 4:return this._fillStatTotalCounts(),[2,this._statistics]}})})};b.prototype.setStreamIdleMarker=function(){return this._sc.setStreamIdleMarker()};b.prototype.hasDepthRange=function(a){return this._sc.MeshInstance.hasDepthRange(a)};b.prototype.setDepthRange=function(a,b,c){this._sc.MeshInstance.setDepthRange(a,
b,c)};b.prototype.unsetDepthRange=function(a){this._sc.MeshInstance.unsetDepthRange(a)};b.prototype.setDefaultDepthRange=function(a,b){this._sc.setDefaultDepthRange(a,b)};b.prototype._getScPlaneArray=function(a){for(var b=[],c=0;c<a.getCount();c++){var g=a.getPlane(c);if(null!==g){var d=[];g.normal.toArray(d);d[3]=g.d;b.push(d)}}return b};b.prototype.getCuttingSectionLimits=function(){return this._sc.cuttingSectionLimits()};b.prototype._addCuttingSection=function(b,c){return __awaiter(this,void 0,
void 0,function(){var g,f,e;return __generator(this,function(h){switch(h.label){case 0:return console.assert(!this._cuttingSectionToKeyMap.has(b)),g=4294967295,f=this._getScPlaneArray(b),0<f.length?[4,this._sc.addCuttingSection(f)]:[3,2];case 1:g=h.sent();if(4294967295===g)throw e=c===d.Add?"add":"update",new a.CommunicatorError("Failed to "+e+" cutting section.");h.label=2;case 2:return console.assert(!this._cuttingSectionToKeyMap.has(b)),this._cuttingSectionToKeyMap.set(b,g),c===d.Add&&this._callbackManager.trigger("addCuttingSection",
b),[2]}})})};b.prototype.addCuttingSection=function(a){return this._addCuttingSection(a,d.Add)};b.prototype.removeCuttingSection=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){b=this._cuttingSectionToKeyMap.get(a);if(void 0===b)return console.assert(!1),[2];this._cuttingSectionToKeyMap.delete(a);this._callbackManager.trigger("removeCuttingSection");return 4294967295===b?[2]:[2,this._sc.removeCuttingSections([b])]})})};b.prototype.removeAllCuttingSections=
function(){this._cuttingSectionToKeyMap.clear();this._callbackManager.trigger("removeCuttingSection");return this._sc.removeAllCuttingSections()};b.prototype.updateCuttingSection=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(g){b=this._cuttingSectionToKeyMap.get(a);if(void 0===b)return console.assert(!1),[2];if(4294967295===b)return[2,this._addCuttingSection(a,d.Update)];c=this._getScPlaneArray(a);return[2,this._sc.replaceCuttingSection(c,b)]})})};
b.prototype.setCappingDelay=function(a){this._cappingDelay=a};b.prototype.enableCappingIdleCallback=function(a){return this._sc.setCappingIdleHookEnabled(a)};b.prototype.delayCapping=function(){var a=this;null===this._cappingDelayTimeoutId?this._sc.pauseCapping():clearTimeout(this._cappingDelayTimeoutId);this._cappingDelayTimeoutId=setTimeout(function(){a._cappingDelayTimeoutId=null;a._sc.resumeCapping()},this._cappingDelay)};b.prototype.setCappingGeometryVisibility=function(a){return __awaiter(this,
void 0,void 0,function(){var b,c;return __generator(this,function(g){console.assert(void 0!==this._cappingLineMaterialId);console.assert(void 0!==this._cappingFaceMaterialId);if(this._cappingGeometryVisibility!==a||this._cappingMaterialDirty){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null);this._cappingMaterialDirty=!1;if(this._cappingGeometryVisibility=a)return b=this._cappingLinesEnabled?this._cappingLineMaterialId:[0,4294967295],
c=this._cappingFacesEnabled?this._cappingFaceMaterialId:[0,4294967295],[2,this._sc.enableCapping(b,c,this._cappingQuantizationGranularity)];this._sc.disableCapping()}return[2]})})};b.prototype._regenerateCapping=function(){this._cappingMaterialDirty=!0;return this.setCappingGeometryVisibility(this._cappingGeometryVisibility)};b.prototype.getCappingGeometryVisibility=function(){return this._cappingGeometryVisibility};b.prototype.setDiffuseColor=function(a,b){return this._sc.Material.setDiffuseColor(a,
b)};b.prototype._toRgb=function(a){var b=[0,0,0];a.toFloatArray(b);return b};b.prototype._toRgba=function(a,b){b=[0,0,0,b];a.toFloatArray(b);return b};b.prototype.setCappingFaceColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._cappingMaterialDirty=!0,this._cappingFacesEnabled=!!a,a?[4,this.setDiffuseColor(this._cappingFaceMaterialId,this._toRgba(a,1))]:[3,2];case 1:b.sent(),b.label=2;case 2:return[2,this._regenerateCapping()]}})})};
b.prototype.setCappingLineColor=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._cappingMaterialDirty=!0,this._cappingLinesEnabled=!!a,a?[4,this.setDiffuseColor(this._cappingLineMaterialId,this._toRgba(a,1))]:[3,2];case 1:b.sent(),b.label=2;case 2:return[2,this._regenerateCapping()]}})})};b.prototype._onSessionStarted=function(){return __awaiter(this,void 0,void 0,function(){var b=this,c,g,d,f,e,h,q,t;return __generator(this,
function(u){switch(u.label){case 0:this._sc.suspendDrawing();this._sc.setDrawMode(1);this._sc.setHighlightedInstanceFilter(3);this._sc.setUnhighlightedFilter(0);this._sc.setHighlightMode(1);this._sc.setAntiAliasingMode(1);c=[];c.push(this._matrixCache.init());g=[.5,.5,.5,1];d=function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){this._cappingMaterialDirty=!0;return void 0!==this._cappingFaceMaterialId&&void 0!==this._cappingLineMaterialId?[2,this.setCappingGeometryVisibility(this.getCappingGeometryVisibility())]:
[2]})})};c.push(this.createMaterial().then(function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.setDiffuseColor(a,g)];case 1:return b.sent(),this._cappingFaceMaterialId=a,[2,d()]}})})}));c.push(this.createMaterial().then(function(a){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this.setDiffuseColor(a,g)];case 1:return b.sent(),this._cappingLineMaterialId=a,
[2,d()]}})})}));f=function(g){e._xRayMaterials[g]=[];for(var d=function(a){c.push(e.createMaterial().then(function(c){b._xRayMaterials[g][a]={id:c,color:null}}))},f=0,p=[a.ElementType.Faces,a.ElementType.Lines,a.ElementType.Points];f<p.length;f++)d(p[f])};e=this;h=0;for(q=[a.XRayGroup.Selected,a.XRayGroup.Unselected];h<q.length;h++)t=q[h],f(t);return[4,Promise.all(c)];case 1:return u.sent(),this._initOptions.sceneReady(),this._sc.resumeDrawing(),[2]}})})};b.prototype.isInit=function(){return void 0!==
this._sc};b.prototype.setRemoteEndpoint=function(a,b){this._uri=a;this._model=b};b.prototype.getSessionType=function(){return this._sessionType};b.prototype._awaitEmptyLoad=function(){var b=this,c=h.OpenPromise.create(),g={_attached:function(d){b._callbackManager.unbind(g);0===d?c.resolve():c.reject(new a.InternalLogicError)}};this._callbackManager.bind(g);return c};b.prototype.loadEmpty=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,
this._engineReadyPromise];case 1:c.sent();try{if(0!==this._sessionType)throw new a.LoadError("Incompatible load types.");b=this._awaitEmptyLoad();this._sessionType=this._connectionlessEmpty||void 0!==this._buffer||void 0===this._model?this._loadEmptyScs():this._loadEmptyNetwork();return[2,b]}catch(g){throw this._callbackManager.trigger("modelLoadFailure",this._model||"",g.message),g;}}})})};b.prototype._loadEmpty=function(a){var b=this;console.assert(void 0===a.XHRonprogress);console.assert(void 0===
a.XHRonerror);console.assert(void 0===a.XHRonloadend);a.XHRonprogress=function(a){b._callbackManager.trigger("XHRonprogress",a)};a.XHRonerror=function(a){b._callbackManager.trigger("XHRonerror",a)};a.XHRonloadend=function(a,c,g){b._callbackManager.trigger("XHRonloadend",a,c,g)};return this._sc.load(a)};b.prototype._loadEmptyScs=function(){console.assert(void 0===this._model);var b={empty:!0};this._streamingMode===a.StreamingMode.OnDemand&&(b.streamInstancesOnDemand=!0);return this._loadEmpty(b)};
b.prototype._loadEmptyNetwork=function(){console.assert(void 0!==this._model);var b={model:a.EmptyModelName,uri:this._uri,serverSideRendering:this._rendererType===a.RendererType.Server,meshLevel:this._meshLevel,streamCutoffScale:this._streamCutoffScale};void 0!==this._sessionToken&&(b.sessionToken=this._sessionToken);0<this._memoryLimit&&(b.limitMiB=this._memoryLimit);(this._boundingPreviewMode&a.BoundingPreviewMode.Model)===a.BoundingPreviewMode.Model&&(b.streamModelBoundingPreviews=!0);(this._boundingPreviewMode&
a.BoundingPreviewMode.Instance)===a.BoundingPreviewMode.Instance&&(b.streamInstanceBoundingPreviews=!0);(this._boundingPreviewMode&a.BoundingPreviewMode.Ejected)===a.BoundingPreviewMode.Ejected&&(b.streamEjectedBoundingPreviews=!0);switch(this._streamingMode){case a.StreamingMode.OnDemand:b.streamInstancesOnDemand=!0;break;case a.StreamingMode.All:b.streamCulled=!0,b.streamMetaDataOnIdle=!0}return this._loadEmpty(b)};b.prototype.setProjection=function(a){var b=this.getCamera();b.getProjection()!==
a&&(b.setProjection(a),this.setCamera(b))};b.prototype.getViewMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return a.Matrix.createFromArray(b.viewMatrix())};b.prototype.getProjectionMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return a.Matrix.createFromArray(b.projectionMatrix())};b.prototype.getFullCameraMatrix=function(b){b=void 0!==b?this._toCamera(b):this._sc.getCamera();return a.Matrix.createFromArray(b.fullMatrix())};b.prototype.getSynchedViewMatrix=
function(){return this._syncedCamera?a.Matrix.createFromArray(this._syncedCamera.viewMatrix()):new a.Matrix};b.prototype.getSynchedProjectionMatrix=function(){return this._syncedCamera?a.Matrix.createFromArray(this._syncedCamera.projectionMatrix()):new a.Matrix};b.prototype.getPrimaryModelKey=function(){return this._sc.primaryModelKey()};b.prototype.getPartsBounding=function(a,b,c){return this.getBounding(a,b,!1,c)};b.prototype.getDrawnPartsBounding=function(b){return __awaiter(this,void 0,void 0,
function(){var c,g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.MeshInstance.getDrawnWorldSpaceBounding(b)];case 1:return c=d.sent(),g=new a.Box,g.min.fromArray(c.min),g.max.fromArray(c.max),[2,g]}})})};b.prototype.getBounding=function(b,c,g,d){return __awaiter(this,void 0,void 0,function(){var f,e;return __generator(this,function(h){switch(h.label){case 0:return[4,this._sc.MeshInstance.getWorldSpaceBounding(b,c,g,d)];case 1:return f=h.sent(),e=new a.Box,e.min.fromArray(f.min),
e.max.fromArray(f.max),[2,e]}})})};b.prototype.getClientDimensions=function(){var a=this._sc.container;return[a.clientWidth,a.clientHeight]};b.prototype.getModelBounding=function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this.getBounding([],a,b,c)]})})};b.prototype.pickFromScreen=function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.pickFromScreen(a,b,c)]})})};b.prototype.pickAllFromScreen=
function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.pickAllFromScreen(a,b,c)]})})};b.prototype.compositePickFromScreen=function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.compositePickFromScreen(a,b,c)]})})};b.prototype.beginScreenAreaSelection=function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,
this._scSelectionManager.beginScreenAreaSelection(a,b,c)]})})};b.prototype.beginRayDrillSelection=function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.beginRayDrillSelection(a,b,c)]})})};b.prototype.beginConvexPolyhedronSelection=function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.beginConvexPolyhedronSelection(a,b,c)]})})};b.prototype.beginSphereSelection=
function(a,b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){return[2,this._scSelectionManager.beginSphereSelection(a,b,c)]})})};b.prototype.endIncrementalSelection=function(a){this._scSelectionManager.endIncrementalSelection(a)};b.prototype.advanceIncrementalSelection=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._scSelectionManager.advanceIncrementalSelection(a,!1)]})})};b.prototype.flushMetaDataCache=
function(){this._sc.flushMetaDataCache()};b.prototype.safeGetMetaDatas=function(a,b){for(var c=[],g=0;g<b.length;g++)c.push(a,b[g]);return this.getDataFromIds(c).then(h.identity,function(){return null})};b.prototype.safeGetMetaData=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:return[4,this.safeGetMetaDatas(a,[b])];case 1:return c=g.sent(),null!==c?[2,c[0]]:[2,null]}})})};b.prototype.safeLoadMetaDatas=function(a){return this.getDataFromIds(a).then(h.nop,
h.nop)};b.prototype.getDataFromIds=function(a){if(0===this._requestBatchCountByType[0])return this._getDataFromIds(a);a=new c(a);this._pendingRequestsByType[0].push(a);return a.promise};b.prototype._getDataFromIds=function(a){return this._sc.getMetaData(a)};b.prototype.pickFromRay=function(a,b){return this._scSelectionManager.pickFromRay(a,b)};b.prototype.pickAllFromRay=function(a,b){return this._scSelectionManager.pickAllFromRay(a,b)};b.prototype.updateCamera=function(a){var b=a._getFlags(),c=this._sc.getCamera();
(b&h.CameraFlags.Position)===h.CameraFlags.Position&&c.setPosition(this._toVector3(a.getPosition()));(b&h.CameraFlags.Target)===h.CameraFlags.Target&&c.setTarget(this._toVector3(a.getTarget()));(b&h.CameraFlags.Up)===h.CameraFlags.Up&&c.setUpVector(this._toVector3(a.getUp()));this._setCamera(c);return this.getCamera()};b.prototype._toProjection=function(b){switch(b){default:case a.Projection.Orthographic:return 1;case a.Projection.Perspective:return 0}};b.prototype._toCamera=function(a){var b=this._sc.getCamera();
b.reset(this._toProjection(a.getProjection()),this._toVector3(a.getPosition()),this._toVector3(a.getTarget()),this._toVector3(a.getUp()),a.getWidth(),a.getHeight());b.setNearLimit(a.getNearLimit());return b};b.prototype.setCamera=function(a){a=this._toCamera(a);this._setCamera(a)};b.prototype._setCamera=function(a){this.delayCapping();this._sc.setCamera(a)};b.prototype.setInstancesMatrix=function(a,b){this._sc.MeshInstance.setAnonymousMatrix(a,b.m)};b.prototype.setMatrices=function(b,c){this._sc.requestMeshInstances(b,
!1,!0);for(var g=[],d=0;d<c.length;d++)g.push(this._sc.MeshInstance.setAnonymousMatrix([b[2*d],b[2*d+1]],c[d].m));return a.Util.waitForAll(g)};b.prototype.highlightParts=function(a,b){this._sc.MeshInstance.setHighlighted(a,b);this._sc.MeshInstance.setXRay(a,b)};b.prototype.getPartHighlighted=function(a){return this._sc.MeshInstance.getHighlighted(a)};b.prototype.highlightElements=function(a,b,c,g,d){this._sc.MeshInstance.setElementHighlighted(a,this._toElementType(b),c,g,d)};b.prototype.getElementHighlighted=
function(a,b,c){return this._sc.MeshInstance.getElementHighlighted(a,this._toElementType(b),c)};b.prototype.setNodeHighlightColor=function(a,b){a?(this._sc.setHighlightedInstanceFilter(3),a=this._toRgba(a,1),this._sc.setHiddenLineHighlightedInstanceFillColor(a),this._sc.setHighlightedInstanceColor(a)):this._sc.setHighlightedInstanceFilter(0);a=b?this._toRgba(b,1):[0,0,0,0];this._sc.setHiddenLineHighlightedInstanceOutlineColor(a);this._sc.setHighlightedInstanceOutlineColor(a)};b.prototype.setElementHighlightColor=
function(a,b){a?(this._sc.setHighlightedElementFilter(3),a=this._toRgba(a,1),this._sc.setHighlightedElementColor(a),this._sc.setHiddenLineHighlightedElementFillColor(a)):this._sc.setHighlightedElementFilter(0);a=b?this._toRgba(b,1):[0,0,0,0];this._sc.setHighlightedElementOutlineColor(a);this._sc.setHiddenLineHighlightedElementOutlineColor(a)};b.prototype.setHighlightColorizeCompression=function(a){this._sc.setHighlightColorizeCompression(a)};b.prototype.computeMininimumBodyBodyDistance=function(b,
c){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:if(2!==b.length||2!==c.length)throw new a.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalBodyBodyDistance(b,c)];case 1:return g=d.sent(),[2,h.makeFaceFaceDistanceItem(g)]}})})};b.prototype.computeMininimumFaceFaceDistance=function(b,c,g,d){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(e){switch(e.label){case 0:if(2!==
b.length||2!==g.length)throw new a.CommunicatorError("Invalid instance inc.");return[4,this._sc.MeshInstance.computeMinimalFaceFaceDistance(b,c,g,d)];case 1:return f=e.sent(),[2,h.makeFaceFaceDistanceItem(f)]}})})};b.prototype.computeMinimumFaceRayDistance=function(b,c,g){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:if(2!==b.length)throw new a.CommunicatorError("Invalid instance inc.");d=h.toScRay(g);return[4,this._sc.MeshInstance.computeMinimalFaceRayDistance(b,
c,d)];case 1:return f=e.sent(),[2,h.makeFaceFaceDistanceItem(f)]}})})};b.prototype.computeMinimumFaceLineDistance=function(b,c,g){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(e){switch(e.label){case 0:if(2!==b.length)throw new a.CommunicatorError("Invalid instance inc.");d=h.toScRay(g);return[4,this._sc.MeshInstance.computeMinimalFaceLineDistance(b,c,d)];case 1:return f=e.sent(),[2,h.makeFaceFaceDistanceItem(f)]}})})};b.prototype.pauseRendering=function(){this._sc.suspendDrawing()};
b.prototype.resumeRendering=function(){this._sc.resumeDrawing()};b.prototype.beginRequestBatch=function(a){++this._requestBatchCountByType[a]};b.prototype.endRequestBatch=function(a){0<this._requestBatchCountByType[a]&&--this._requestBatchCountByType[a];this._flushBatchedRequests(a)};b.prototype._flushBatchedRequests=function(b){var c=this._pendingRequestsByType[b];this._pendingRequestsByType[b]=[];for(var g=[],d=0;d<c.length;d++)for(var f=0,e=c[d].ids;f<e.length;f++)g.push(e[f]);switch(b){case 0:return this._flushBatchedMetaDataRequests(c,
g);default:return a.Util.TypeAssert(b),console.assert(!1),Promise.resolve()}};b.prototype._flushBatchedMetaDataRequests=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,g,d,f,e,h,t,u,w;return __generator(this,function(z){switch(z.label){case 0:return[4,this._getDataFromIds(b)];case 1:c=z.sent();d=g=0;for(f=a;d<f.length;d++){e=f[d];h=[];t=e.ids.length/2;for(u=0;u<t;++u)w=c[g++],h.push(w);e.promise.resolve(h)}console.assert(g===c.length);return[2]}})})};b.prototype.clearHighlight=
function(){this._sc.unsetAllHighlighted();this._sc.unsetAllXRay()};b.prototype.resetColors=function(){this._sc.unsetAllColors()};b.prototype.resetOpacity=function(){this._sc.unsetAllOpacity()};b.prototype.setPartOpacity=function(a,b){this._sc.MeshInstance.setOpacity(a,0,b);this._sc.MeshInstance.setOpacity(a,1,b)};b.prototype.unsetPartOpacity=function(a){this._sc.MeshInstance.unsetOpacity(a,0);this._sc.MeshInstance.unsetOpacity(a,1)};b.prototype.getPartOpacity=function(a){return this._sc.MeshInstance.getOpacity(a,
0)};b.prototype.getEffectivePartOpacity=function(a,b){return this._sc.MeshInstance.getEffectiveOpacity(a,this._toElementType(b))};b.prototype.getPartHasTransparency=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,g,d,f;return __generator(this,function(e){switch(e.label){case 0:return b=[],b.push(this._sc.MeshInstance.hasTransparency(a,0)),b.push(this._sc.MeshInstance.hasTransparency(a,1)),[4,Promise.all(b)];case 1:c=e.sent();g=c[0];d=c[1];for(f=0;f<g.length;++f)g[f]||(g[f]=d[f]);
return[2,g]}})})};b.prototype.setPartColor=function(a,b,c){this._sc.MeshInstance.setColor(a,this._toElementType(b),c.getFloatArray())};b.prototype.unsetPartColor=function(a,b){this._sc.MeshInstance.unsetColor(a,this._toElementType(b))};b.prototype.getPartColor=function(a,b){return this._sc.MeshInstance.getColor(a,this._toElementType(b)).then(f)};b.prototype.getEffectivePartColor=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,g;return __generator(this,function(d){switch(d.label){case 0:return c=
this._toElementType(b),[4,this._sc.MeshInstance.getEffectiveColor(a,c)];case 1:return g=d.sent(),[2,f(g)]}})})};b.prototype.setElementColor=function(a,b,c,g,d){this._sc.MeshInstance.setElementColor(a,this._toElementType(b),c,g,d.getFloatArray())};b.prototype.unsetElementColor=function(a,b,c,g){this._sc.MeshInstance.unsetElementColor(a,this._toElementType(b),c,g)};b.prototype.getElementColor=function(a,b,c){return this._sc.MeshInstance.getElementColor(a,this._toElementType(b),c).then(f)};b.prototype.getEffectiveElementColor=
function(a,b,c){return __awaiter(this,void 0,void 0,function(){var g,d;return __generator(this,function(e){switch(e.label){case 0:return g=this._toElementType(b),[4,this._sc.MeshInstance.getEffectiveElementColor(a,g,c)];case 1:return d=e.sent(),[2,f(d)]}})})};b.prototype.synchronizeVisibilities=function(a,b){0<a.length&&this._sc.MeshInstance.synchronizeVisibilities(a,b)};b.prototype.setPartVisibility=function(a,b,c){0<a.length&&this._sc.MeshInstance.setVisible(a,b,c)};b.prototype.setVisibilityByAttachment=
function(a,b){this._sc.setVisibilityByAttachment(a,b)};b.prototype.requestMeshInstances=function(a){this._sc.demandMeshInstances(a)};b.prototype.getRendererType=function(){return this._rendererType};b.prototype._toMeshDataBuilder=function(b){for(var c=b._getFaceData(),g=b._getPointData(),d=b._getPolylineData(),f=new this._sc.MeshDataBuilder,e=0;e<c.length;e++){var h=c[e];f.addFace(h.vertexData,{normals:h.normalData,rgba32s:h.rgba32data,uvs:h.uvData,bits:h.bits})}for(c=0;c<g.length;c++)h=g[c],f.addPoints(h.vertexData,
{rgba32s:h.rgba32data,bits:h.bits});for(g=0;g<d.length;g++)h=d[g],f.addPolyline(h.vertexData,{rgba32s:h.rgba32data,bits:h.bits});switch(b.getFaceWinding()){case a.FaceWinding.Clockwise:d=1;break;case a.FaceWinding.CounterClockwise:d=2;break;default:d=0}h=b.getBackfacesEnabled()?4:0;b=b.isManifold()?65536:0;f.formatBits=f.formatBits|d|h|b;return f};b.prototype.createMesh=function(a){a=this._toMeshDataBuilder(a);return this._sc.MeshData.create(a)};b.prototype.replaceMesh=function(a,b){b=this._toMeshDataBuilder(b);
return this._sc.MeshData.replace(a,b)};b.prototype.destroyMeshes=function(a){return this._sc.MeshData.destroy(a)};b.prototype._toImageFormat=function(b){switch(b){case a.ImageFormat.Gray8:return 2;case a.ImageFormat.GrayAlpha16:return 3;case a.ImageFormat.Rgb24:return 1;case a.ImageFormat.Rgba32:return 0;case a.ImageFormat.Jpeg:return 4;case a.ImageFormat.Png:return 5}};b.prototype._validateImage=function(b){if(void 0===b.format)throw new a.ParseError("missing 'format' property");if(void 0===b.data)throw new a.ParseError("missing 'data' property");
if((b.format===a.ImageFormat.Gray8||b.format===a.ImageFormat.GrayAlpha16||b.format===a.ImageFormat.Rgb24||b.format===a.ImageFormat.Rgba32)&&(void 0===b.width||0>=b.width||void 0===b.height||0>=b.height))throw new a.ParseError("uncompressed format requested but missing width or height");};b.prototype.createImage=function(a,b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(c){this._validateImage(a);return void 0!==b?(this._validateImage(b),[2,this._sc.Image.create(this._toImageFormat(a.format),
a.data,a.width,a.height,this._toImageFormat(b.format),b.data,b.width,b.height)]):[2,this._sc.Image.create(this._toImageFormat(a.format),a.data,a.width,a.height)]})})};b.prototype.destroyImages=function(a){return this._sc.Image.destroy(a)};b.prototype._toTextureTiling=function(b){switch(b){default:case a.TextureTiling.Repeat:return 0;case a.TextureTiling.Clamp:return 1}};b.prototype._toTextureInterpolation=function(a){return!1===a?1:0};b.prototype._toTextureMipMapping=function(a){return!1===a?1:0};
b.prototype._toTextureParameterization=function(b){switch(b){default:case a.TextureParameterization.UV:return 0}};b.prototype._toTextureModifier=function(b){switch(b){default:case 0:return 0;case a.TextureModifier.Decal:return 1}};b.prototype.setTexture=function(b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(g){if(void 0===c.imageId)throw new a.ParseError("missing 'imageId' property");return[2,this._sc.MeshInstance.setTexture(b,0,c.imageId,void 0!==c.matrix?c.matrix.m:
(new a.Matrix).m,this._toTextureTiling(c.tiling),this._toTextureInterpolation(c.interpolation),this._toTextureMipMapping(c.mipMapping),this._toTextureParameterization(c.parameterization),this._toTextureModifier(c.modifiers))]})})};b.prototype.unsetTexture=function(a){this._sc.MeshInstance.unsetTexture(a,0)};b.prototype.createMaterial=function(){return this._sc.Material.create()};b.prototype._getMaterialPromiseWithDiffuseColor=function(a,b,c,g){var d=new h.MaterialInfo;d.setDiffuseColor(null!==a?a:
c);d.setDiffuseTransparency(null!==b?b:g);return this._materialCache.getOrCreateMaterial(d)};b.prototype.createMatrix=function(a){return this._sc.Matrix.create(a)};b.prototype.createIdentityMatrix=function(){return this._sc.Matrix.create()};b.prototype.createMeshInstance=function(b){return __awaiter(this,void 0,void 0,function(){var c,g,d,f,e,h,q,t,u,w;return __generator(this,function(z){switch(z.label){case 0:c=b.getMeshId();if(null===c)throw new a.CommunicatorError("MeshId is not set");e=this._matrixCache.getIdentityInc();
h=[];if(q=b.getMatrix())t=this.createMatrix(q.m).then(function(a){e=a}),h.push(t);u=new a.Color(255,0,0);h.push(this._getMaterialPromiseWithDiffuseColor(b.getFaceColor(),b.getOpacity(),u,1).then(function(a){g=a}));h.push(this._getMaterialPromiseWithDiffuseColor(b.getLineColor(),b.getLineOpacity(),u,1).then(function(a){d=a}));h.push(this._getMaterialPromiseWithDiffuseColor(b.getPointColor(),b.getPointOpacity(),u,1).then(function(a){f=a}));return[4,Promise.all(h)];case 1:return z.sent(),[4,this._sc.MeshInstance.create(c,
e,g,d,f,b.getCreationFlags(),b.getOverlayIndex())];case 2:return w=z.sent(),this._callbackManager.trigger("_geometryCreated",w),[2,w]}})})};b.prototype.destroyLocalInstances=function(a){return this._sc.MeshInstance.destroy(a)};b.prototype._fromScCamera=function(b){var c=a.Projection.Orthographic;0===b.projection()&&(c=a.Projection.Perspective);return a.Camera.create(a.Point3.createFromArray(b.position()),a.Point3.createFromArray(b.target()),a.Point3.createFromArray(b.upVector()),c,b.fieldWidth(),
b.fieldHeight(),b.nearLimit())};b.prototype.getCameraPromise=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,this._sc.getCameraPromise()];case 1:return a=b.sent(),[2,this._fromScCamera(a)]}})})};b.prototype.getCamera=function(){var a=this._sc.getCamera();return this._fromScCamera(a)};b.prototype.resize=function(){this._sc.onResize();this._windowSize.set(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight)};
b.prototype.setFaceVisibility=function(a){this._sc.setFacesVisible(a)};b.prototype.setLineVisibility=function(a){this._sc.setLinesVisible(a)};b.prototype.getCanvasSize=function(){return this._windowSize.copy()};b.prototype.setBackgroundGradient=function(a,b){this._sc.setBackgroundGradient(a?this._toRgba(a,1):[0,0,0,0],b?this._toRgba(b,1):[0,0,0,0])};b.prototype.setServerRenderQuality=function(a,b,c,g){this._sc.setSsrQuality({jpegQualityLow:a,jpegQualityHigh:b,scaleLow:c,scaleHigh:g})};b.prototype.setMinimumFramerate=
function(a){this._sc.setMinFrameRate(a)};b.prototype.getMinimumFramerate=function(){return this._sc.getMinFrameRate()};b.prototype.setBackFacesVisible=function(a){this._sc.setBackFacesVisible(a)};b.prototype.setDrawMode=function(a){this._sc.setDrawMode(a)};b.prototype.enableHiddenLineRendering=function(a){this.setDrawMode(2);this._sc.setHiddenLineVisibleLineColor(this._toRgba(a.getVisibleLineColor(),a.getVisibleLineOpacity()));this._sc.setHiddenLineHiddenLineColor(this._toRgba(a.getObscuredLineColor(),
a.getObscuredLineOpacity()))};b.prototype.setAntiAliasingMode=function(b){switch(b){case a.AntiAliasingMode.None:this._sc.setAntiAliasingMode(0);break;case a.AntiAliasingMode.SMAA:this._sc.setAntiAliasingMode(1)}};b.prototype.setInstanceModifier=function(b,c,g){switch(b){case a.InstanceModifier.IgnoreCutting:this._sc.MeshInstance.setDoNotCut(c,g);break;case a.InstanceModifier.IgnoreExplosion:this._sc.MeshInstance.setDoNotExplode(c,g);break;case a.InstanceModifier.IgnoreSelection:this._sc.MeshInstance.setDoNotSelect(c,
g);break;case a.InstanceModifier.IgnoreCameraScale:this._sc.MeshInstance.setSuppressCameraScale(c,g);break;case a.InstanceModifier.OverrideSceneVisibility:this._sc.MeshInstance.setOverrideSceneVisibility(c,g);break;case a.InstanceModifier.IgnoreLighting:this._sc.MeshInstance.setDoNotLight(c,g);break;case a.InstanceModifier.IgnoreOutlineHighlight:this._sc.MeshInstance.setDoNotOutlineHighlight(c,g);break;case a.InstanceModifier.ExcludeBounding:this._sc.MeshInstance.setExcludeBounding(c,g);break;case a.InstanceModifier.DoNotUseVertexColors:this._sc.MeshInstance.setDoNotUseVertexColors(c,
g);break;case a.InstanceModifier.AlwaysDraw:this._sc.MeshInstance.setAlwaysDraw(c,g);break;case a.InstanceModifier.DoNotXRay:this._sc.MeshInstance.setDoNotXRay(c,g);break;case a.InstanceModifier.ScreenOriented:this._sc.MeshInstance.setScreenOriented(c,g);break;case a.InstanceModifier.ScreenSpace:this._sc.MeshInstance.setScreenSpace(c,g);break;case a.InstanceModifier.ScreenSpaceStretched:this._sc.MeshInstance.setScreenSpaceStretched(c,g)}};b.prototype.attachModel=function(a,b,c,g,d){return this._attachModels(a,
[[b,c]],g,d)};b.prototype.attachScsModelByKey=function(a,b,c,g,d){console.assert(2===this._sessionType);return this._sc.attachScsModelByKey(a,c,b,g,d)};b.prototype._attachModels=function(a,b,c,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.attachModels(a,b,c,g)];case 1:return d.sent(),this._callbackManager.trigger("_attached",a),[2]}})})};b.prototype.attachScsBuffer=function(a,b,c,g,d,f){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this._sc.attachScsBuffer(a,b,c,g,d,f)];case 1:return e.sent(),this._callbackManager.trigger("_attached",a),[2]}})})};b.prototype._parseKeyInfo=function(a,b,c){if(a||b)return c;a=new Map;for(b=0;b<c.length;++b){for(var g=c[b++],d=[];b<c.length&&4294967295!==c[b];++b)d.push(c[b]);a.set(g,d)}return a};b.prototype.instanceKeyInfo=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var g,d,f;return __generator(this,
function(e){switch(e.label){case 0:return g=1===b,d=1===c,[4,this._sc.meshInstanceKeyInfo(a,g,d)];case 1:return f=e.sent(),[2,this._parseKeyInfo(g,d,f)]}})})};b.prototype.metaDataKeyInfo=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._sc.metaDataKeyInfo(a,b,c)];case 1:return g=d.sent(),[2,this._parseKeyInfo(b,c,g)]}})})};b.prototype.modelKeysFromInclusionKeys=function(a){return this._sc.modelKeysFromInclusionKeys(a)};
b.prototype.detachInclusions=function(a){return this._sc.detachInclusions(a)};b.prototype.resetToEmpty=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,g,d,f;return __generator(this,function(e){switch(e.label){case 0:for(c=0;c<this._requestBatchCountByType.length;++c){g=this._requestBatchCountByType[c]=0;for(d=this._pendingRequestsByType[c];g<d.length;g++)f=d[g],f.promise.reject(f.ids);this._pendingRequestsByType[c].length=0}return[4,this._sc.resetToEmpty(a,b)];case 1:return e.sent(),
this.flushMetaDataCache(),[2]}})})};b.prototype.redraw=function(){this._sc.queueRedraw()};b.prototype.disconnectNetwork=function(){this._sc.disconnectNetwork()};b.prototype.shutdown=function(){null!==this._cappingDelayTimeoutId&&(clearTimeout(this._cappingDelayTimeoutId),this._cappingDelayTimeoutId=null);this._sessionType=0;this._sc.shutDown()};b.prototype.getVersionString=function(){return this._sc.getStreamVersion().toString()};b.prototype.setAllowHighDpi=function(a){this._sc.allowHighDpi=a;this.resize()};
b.prototype.getAllowHighDpi=function(){return this._sc.allowHighDpi};b.prototype.setMeshLevel=function(a,b){this._sc.MeshInstance.setMeshLevel(a,b)};b.prototype.setOverlayVisibility=function(a,b){this._sc.Overlay.setVisible(a,b)};b.prototype.setOverlayCamera=function(a,b){b=this._toCamera(b);this._sc.Overlay.setCamera(a,b)};b.prototype.destroyOverlay=function(a){this._sc.Overlay.destroy(a)};b.prototype._overlayUnit=function(b){switch(b){case a.OverlayUnit.ProportionOfCanvas:return 1;case a.OverlayUnit.ProportionOfOtherDimension:return 2;
default:return 0}};b.prototype.getMaxOverlayIndex=function(){return this._sc.Overlay.maxIndex()};b.prototype._overlayAnchor=function(b){switch(b){case a.OverlayAnchor.BottomCenter:return 7;case a.OverlayAnchor.Center:return 8;case a.OverlayAnchor.LeftCenter:return 5;case a.OverlayAnchor.LowerLeftCorner:return 1;case a.OverlayAnchor.LowerRightCorner:return 2;case a.OverlayAnchor.RightCenter:return 6;case a.OverlayAnchor.TopCenter:return 4;case a.OverlayAnchor.UpperRightCorner:return 3;default:return 0}};
b.prototype.setOverlayViewport=function(a,b,c,g,d,f,e,h,t,u){this._sc.Overlay.setViewport(a,this._overlayAnchor(b),c,this._overlayUnit(g),d,this._overlayUnit(f),e,this._overlayUnit(h),t,this._overlayUnit(u))};b.prototype.addNodesToOverlay=function(a,b){this._sc.MeshInstance.setOverlayIndex(a,b)};b.prototype.getInstancesMeshData=function(a){return this._sc.MeshInstance.getMeshData(a)};b.prototype.getMeshData=function(a){return this._sc.MeshData.getData(a)};b.prototype._toElementType=function(b){switch(b){case a.ElementType.Faces:return 0;
case a.ElementType.Lines:return 1;case a.ElementType.Points:return 2}};b.prototype._toXRayGroup=function(b){switch(b){case a.XRayGroup.Selected:return 0;case a.XRayGroup.Unselected:return 1}};b.prototype.setXRayColor=function(a,b,c){var g=this._xRayMaterials[a][b];if(g.color&&g.color.equals(c))return Promise.resolve();g.color=c;this.setDiffuseColor(g.id,this._toRgba(c,1));return this._sc.setXRayMaterial(this._toXRayGroup(a),this._toElementType(b),g.id)};b.prototype.unsetXRayColor=function(a,b){if(!this._xRayMaterials[a][b].color)return Promise.resolve();
this._xRayMaterials[a][b].color=null;return this._sc.unsetXRayMaterial(this._toXRayGroup(a),this._toElementType(b))};b.prototype.setXRayOpacity=function(a,b){void 0!==b?this._sc.setXRayOpacity(this._toElementType(b),a):(this._sc.setXRayOpacity(0,a),this._sc.setXRayOpacity(1,a),this._sc.setXRayOpacity(2,a))};b.prototype._xRayTransparencyMode=function(b){switch(b){case a.XRayTransparencyMode.Unsorted:return 0;case a.XRayTransparencyMode.SingleLayer:return 1}};b.prototype.setXRayTransparencyMode=function(a){this._sc.setXRayTransparencyMode(this._xRayTransparencyMode(a))};
b.prototype._toPointSizeUnit=function(b){switch(b){case a.PointSizeUnit.ScreenPixels:return 0;case a.PointSizeUnit.CSSPixels:return 1;case a.PointSizeUnit.World:return 2;case a.PointSizeUnit.ProportionOfScreenWidth:return 3;case a.PointSizeUnit.ProportionOfScreenHeight:return 4;case a.PointSizeUnit.ProportionOfBoundingDiagonal:return 5}};b.prototype._toPointShape=function(b){switch(b){case a.PointShape.Square:return 0;case a.PointShape.Disk:return 1;case a.PointShape.Sphere:return 2}};b.prototype._fromPointSizeUnit=
function(b){switch(b){default:case 0:return a.PointSizeUnit.ScreenPixels;case 1:return a.PointSizeUnit.CSSPixels;case 2:return a.PointSizeUnit.World;case 3:return a.PointSizeUnit.ProportionOfScreenWidth;case 4:return a.PointSizeUnit.ProportionOfScreenHeight;case 5:return a.PointSizeUnit.ProportionOfBoundingDiagonal}};b.prototype._fromPointShape=function(b){switch(b){default:case 0:return a.PointShape.Square;case 1:return a.PointShape.Disk;case 2:return a.PointShape.Sphere}};b.prototype.setPointSize=
function(a,b){this._sc.setPointSize(a,this._toPointSizeUnit(b))};b.prototype.getPointSize=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,Promise.all([this._sc.getPointSize(),this._sc.getPointSizeUnit()])];case 1:return a=b.sent(),[2,[a[0],this._fromPointSizeUnit(a[1])]]}})})};b.prototype.setPointShape=function(a){this._sc.setPointShape(this._toPointShape(a))};b.prototype.getPointShape=function(){return __awaiter(this,
void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return a=this._fromPointShape,[4,this._sc.getPointShape()];case 1:return[2,a.apply(this,[b.sent()])]}})})};b.prototype.setEyeDomeLightingEnabled=function(a){this._sc.setEyeDomeLightingEnabled(a)};b.prototype.getEyeDomeLightingEnabled=function(){return this._sc.getEyeDomeLightingEnabled()};b.prototype.setEyeDomeLightingBlurSamples=function(a){this._sc.setEyeDomeLightingBlurSamples(a)};b.prototype.getEyeDomeLightingBlurSamples=
function(){return this._sc.getEyeDomeLightingBlurSamples()};b.prototype.setEyeDomeLightingBlurInterval=function(a){this._sc.setEyeDomeLightingBlurInterval(a)};b.prototype.getEyeDomeLightingBlurInterval=function(){return this._sc.getEyeDomeLightingBlurInterval()};b.prototype.setEyeDomeLightingBlurEdgeDistance=function(a){this._sc.setEyeDomeLightingBlurEdgeDistance(a)};b.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._sc.getEyeDomeLightingBlurEdgeDistance()};b.prototype.setEyeDomeLightingShadingEdgeDistance=
function(a){this._sc.setEyeDomeLightingShadingEdgeDistance(a)};b.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._sc.getEyeDomeLightingShadingEdgeDistance()};b.prototype.setEyeDomeLightingOpacity=function(a){this._sc.setEyeDomeLightingOpacity(a)};b.prototype.getEyeDomeLightingOpacity=function(){return this._sc.getEyeDomeLightingOpacity()};b.prototype.setDisplayIncompleteFrames=function(a){this._sc.setDisplayIncompleteFrames(a)};b.prototype.setInteractiveDrawDelay=function(a){this._sc.setPostInputDelay(a)};
b.prototype._toCullingVectorSpace=function(b){switch(b){case a.CullingVectorSpace.Object:return 0;case a.CullingVectorSpace.World:return 1}};b.prototype._fromCullingVectorSpace=function(b){switch(b){default:case 0:return a.CullingVectorSpace.Object;case 1:return a.CullingVectorSpace.World}};b.prototype.setCullingVector=function(a,b,c,g){this._sc.MeshInstance.setCullingVector(a,this._toCullingVectorSpace(b),[c.x,c.y,c.z],g)};b.prototype.unsetCullingVector=function(a){this._sc.MeshInstance.unsetCullingVector(a)};
b.prototype.getCullingVector=function(b){return __awaiter(this,void 0,void 0,function(){var c,g,d,f,e;return __generator(this,function(h){switch(h.label){case 0:return[4,this._sc.MeshInstance.getCullingVector(b)];case 1:c=h.sent();g=[];d=0;for(f=c;d<f.length;d++)e=f[d],0===e.vector[0]&&0===e.vector[1]&&0===e.vector[2]?g.push(null):g.push({space:this._fromCullingVectorSpace(e.space),vector:a.Point3.createFromArray(e.vector),toleranceDegrees:e.toleranceDegrees});return[2,g]}})})};b.prototype._setStreamCutoffScale=
function(a){this._streamCutoffScale=Math.max(0,Math.min(a,2))};b.prototype.setStreamCutoffScale=function(a){this._setStreamCutoffScale(a);this._sc.setStreamCutoffScale(this._streamCutoffScale)};b.prototype.getStreamCutoffScale=function(){return this._streamCutoffScale};b.prototype.loseWebGlContext=function(){return this._sc._loseWebGlContext()};b.prototype.triangulatePolygon=function(a,b){a=this._sc.triangulatePolygon(a,b);return new Float32Array(a)};b.prototype.debug_log=function(a){return this._sc.debug_log(a)};
b.prototype.debug_stateFailure=function(a){return this._sc.debug_stateFailure(a)};b.prototype.debug_sync=function(){return this._sc.debug_sync()};b.prototype._toLinePatternLengthUnit=function(b){switch(b){case a.LinePatternLengthUnit.Object:return 0;case a.LinePatternLengthUnit.World:return 1;case a.LinePatternLengthUnit.ProportionOfScreenWidth:return 2;case a.LinePatternLengthUnit.ProportionOfScreenHeight:return 3}};b.prototype.setLinePattern=function(a,b,c,g){this._sc.MeshInstance.setLinePattern(a,
b,c,this._toLinePatternLengthUnit(g))};b.prototype.unsetLinePattern=function(a){this._sc.MeshInstance.unsetLinePattern(a)};b.prototype.exportToSvg=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(g){switch(g.label){case 0:return[4,this._sc.exportToSvg(a)];case 1:return b=g.sent(),c=b.map(function(a){return String.fromCharCode(a)}),[2,c.join("")]}})})};b.prototype.waitForImageDecoding=function(){return this._sc.waitForImageDecoding()};b.prototype.registerBimInstances=
function(a,b){return this._sc.registerBimInstances(a,b)};b.prototype.setAmbientLightColor=function(a){this._sc.setAmbientLightColor(this._toRgb(a))};b.prototype.clearLights=function(){this._sc.clearLights()};b.prototype._toLightType=function(b){switch(b){default:case a.LightType.Directional:return 0}};b.prototype._toLightSpace=function(b){switch(b){case a.LightSpace.World:return 0;default:case a.LightSpace.Camera:return 1}};b.prototype.addLight=function(a){this._sc.addLight(this._toLightType(a.type),
this._toLightSpace(a.space),this._toVector3(a.position),this._toRgb(a.color))};b.prototype.setBloomEnabled=function(a){this._sc.setBloomEnabled(a)};b.prototype.setBloomThreshold=function(a){this._sc.setBloomThreshold(a)};b.prototype.setBloomThresholdRampWidth=function(a){this._sc.setBloomThresholdRampWidth(a)};b.prototype.setBloomIntensityScale=function(a){this._sc.setBloomIntensityScale(a)};b.prototype._toBlurIntervalUnit=function(b){switch(b){default:case a.BlurIntervalUnit.Pixels:return 0;case a.BlurIntervalUnit.ProportionOfWidth:return 1;
case a.BlurIntervalUnit.ProportionOfHeight:return 2}};b.prototype.setBloomLayers=function(b){for(var c=0;c<b.length;c++){var g=b[c];if(void 0!==g.blurInterval&&2!==g.blurInterval.length)throw new a.CommunicatorError("'blurInterval' must be an array containing a number followed by a BlurIntervalUnit");}this._sc.suspendDrawing();this._sc.setBloomLayerCount(b.length);for(c=0;c<b.length;++c)g=b[c],void 0!==g.intensity&&this._sc.setBloomIntensity(c,g.intensity),void 0!==g.blurSamples&&this._sc.setBloomBlurSamples(c,
g.blurSamples),void 0!==g.blurInterval&&this._sc.setBloomBlurInterval(c,g.blurInterval[0],this._toBlurIntervalUnit(g.blurInterval[1]));this._sc.resumeDrawing()};b.prototype.startComparison=function(a,b,c){var g=c&&c.sameColor?this._toRgb(c.sameColor):[0,0,0],d=c&&c.only1Color?this._toRgb(c.only1Color):[1,0,0];c=c&&c.only2Color?this._toRgb(c.only2Color):[0,1,0];this._sc.setComparisonColors(g,d,c);this._sc.startComparison(a,b)};b.prototype.endComparison=function(){this._sc.endComparison()};b.prototype.setSimpleShadowColor=
function(a){this._sc.setSimpleShadowColor(this._toRgb(a))};b.prototype.setSimpleShadowEnabled=function(a){this._sc.setSimpleShadowEnabled(a)};b.prototype.setSimpleShadowOpacity=function(a){this._sc.setSimpleShadowOpacity(a)};b.prototype.setGroundPlane=function(a,b){void 0!==b?this._sc.setGroundPlaneWithPosition(this._toVector3(a),this._toVector3(b)):this._sc.setGroundPlane(this._toVector3(a))};b.prototype.setSimpleShadowResolution=function(a){this._sc.setSimpleShadowResolution(a)};b.prototype.setSimpleShadowBlurSamples=
function(a){this._sc.setSimpleShadowBlurSamples(a)};b.prototype.setSimpleShadowBlurInterval=function(a){this._sc.setSimpleShadowBlurInterval(a)};b.prototype.setSimpleShadowInteractiveUpdateEnabled=function(a){void 0===a&&(a=!0);this._sc.setSimpleShadowInteractiveUpdateEnabled(a)};b.prototype.setSilhouetteColor=function(a){this._sc.setSilhouetteColor(this._toRgb(a))};b.prototype.setSilhouetteEnabled=function(a){void 0===a&&(a=!0);this._sc.setSilhouetteEnabled(a)};b.prototype.setSilhouetteOpacity=function(a){this._sc.setSilhouetteOpacity(a)};
b.prototype.setSilhouetteThreshold=function(a){this._sc.setSilhouetteThreshold(a)};b.prototype.setSilhouetteThresholdRampWidth=function(a){this._sc.setSilhouetteThresholdRampWidth(a)};b.prototype.setSimpleReflectionEnabled=function(a){void 0===a&&(a=!0);this._sc.setSimpleReflectionEnabled(a)};b.prototype.setSimpleReflectionBlurInterval=function(a,b){this._sc.setSimpleReflectionBlurInterval(a,this._toBlurIntervalUnit(b))};b.prototype.setSimpleReflectionBlurSamples=function(a){this._sc.setSimpleReflectionBlurSamples(a)};
b.prototype.setSimpleReflectionFadeAngle=function(a){this._sc.setSimpleReflectionFadeAngle(a)};b.prototype.setSimpleReflectionOpacity=function(a){this._sc.setSimpleReflectionOpacity(a)};b.prototype.setSimpleReflectionAttenuation=function(b,c,g){void 0===g&&(g=a.SimpleReflectionAttenuationUnit.World);this._sc.setSimpleReflectionAttenuation(b,c,g)};b.prototype.throttleLoad=function(a,b){this._sc.throttleLoad(a,b)};return b}();h.ScEngine=b})(a.Internal||(a.Internal={}))})(Communicator||(Communicator=
{}));
(function(a){(function(h){var e=function(){function b(a,b,c,d,f,e,h){this._position=a.copy();this._normal=b.copy();this._elementIndex=c;this._elementBits=f;this._bounding=e.copy();this._overlayIndex=d;this._isProximityFace=h}b.prototype.isProximityFace=function(){return this._isProximityFace};b.prototype.isCappingGeometry=function(){return-1===this._elementIndex};b.prototype.toJson=function(){return{position:this._position.toJson(),normal:this._normal.toJson(),cadFaceIndex:this._elementIndex,cadFaceBits:this._elementBits,
bounding:this._bounding.toJson(),overlayIndex:this._overlayIndex,isProximityFace:this._isProximityFace}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var d=a.Point3.fromJson(c.position),f=a.Point3.fromJson(c.normal),e=a.Box.fromJson(c.bounding);return new b(d,f,c.cadFaceIndex,c.overlayIndex,c.cadFaceBits,e,!0===c.isProximityFace)};b.construct=function(a){return b.fromJson(a)};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getNormal=function(){return this._normal.copy()};
b.prototype.getCadFaceIndex=function(){return this._elementIndex};b.prototype.getCadFaceBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.FaceEntity=e;var f=function(){function b(b,c,d,f,e,r,h){this._lineSegmentVertices=[];this._elementIndex=b;this._elementBits=h;this._position=c.copy();this._bounding=e.copy();this._overlayIndex=r;if(d)for(0<=f&&(b=3*f,this._bestLineSegmentVertexIndex=
new a.Point3(d[b],d[b+1],d[b+2])),this._lineSegmentVertices.push(new a.Point3(d[0],d[1],d[2])),b=3;b<d.length;b+=6)this._lineSegmentVertices.push(new a.Point3(d[b],d[b+1],d[b+2]))}b.prototype.isCappingGeometry=function(){return-1===this._elementIndex};b.prototype.toJson=function(){for(var a=[],b=0,c=this._lineSegmentVertices;b<c.length;b++)a.push(c[b].toJson());return{lineId:this._elementIndex,lineBits:this._elementBits,position:this._position.toJson(),linePoints:a,bounding:this._bounding.copy(),
overlayIndex:this._overlayIndex}};b.prototype.forJson=function(){return this.toJson()};b.fromJson=function(c){var d=a.Point3.fromJson(c.position),f=a.Box.fromJson(c.bounding),d=new b(c.lineId,d,null,-1,f,c.overlayIndex,0),f=0;for(c=c.linePoints;f<c.length;f++){var e=a.Point3.fromJson(c[f]);d._lineSegmentVertices.push(e)}return d};b.construct=function(a){return b.fromJson(a)};b.prototype.getLineId=function(){return this._elementIndex};b.prototype.getPosition=function(){return this._position.copy()};
b.prototype.getPoints=function(){return this._lineSegmentVertices};b.prototype.getBestVertex=function(){return this._bestLineSegmentVertexIndex?this._bestLineSegmentVertexIndex.copy():null};b.prototype.getLineBits=function(){return this._elementBits};b.prototype.getBounding=function(){return this._bounding.copy()};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.LineEntity=f;var d=function(){function b(a,b,c,d){this._position=a.copy();this._elementIndex=b;this._overlayIndex=
c;this._elementBits=d}b.fromJson=function(c){var d=a.Point3.fromJson(c.position);return new b(d,c.pointId,c.pointBits,c.overlayIndex)};b.construct=function(a){return b.fromJson(a)};b.prototype.toJson=function(){return{pointId:this._elementIndex,pointBits:this._elementBits,position:this._position.toJson(),overlayIndex:this._overlayIndex}};b.prototype.forJson=function(){return this.toJson()};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.getPointBits=function(){return this._elementBits};
b.prototype.getPointId=function(){return this._elementIndex};b.prototype.overlayIndex=function(){return this._overlayIndex};return b}();h.PointEntity=d;var c=function(){return function(a){this._handle=a}}();h.IncrementalSelectionId=c;c=function(){function b(a,b,c,d,f){void 0===a&&(a=null);void 0===b&&(b=null);void 0===c&&(c=null);void 0===d&&(d=null);void 0===f&&(f=null);this._nodeId=a;this._inclusionKey=b;this._faceEntity=c;this._lineEntity=d;this._pointEntity=f}b.create=function(a,c,d,f,e){return new b(a,
c,d,f,e)};b.prototype.getSelectionType=function(){return null===this._nodeId?a.SelectionType.None:null!==this._faceEntity?a.SelectionType.Face:null!==this._lineEntity?a.SelectionType.Line:null!==this._pointEntity?a.SelectionType.Point:a.SelectionType.Part};b.prototype.toJson=function(){return{nodeId:this._nodeId,includeId:this._inclusionKey,faceEntity:this._faceEntity?this._faceEntity.toJson():null,lineEntity:this._lineEntity?this._lineEntity.toJson():null,pointEntity:this._pointEntity?this._pointEntity.toJson():
null}};b.prototype.forJson=function(){return this.toJson()};b._fromJson=function(a){return new b(a.nodeId,a.includeId,a.faceEntity?e.fromJson(a.faceEntity):null,a.lineEntity?f.fromJson(a.lineEntity):null,a.pointEntity?d.fromJson(a.pointEntity):null)};b.prototype.getFaceEntity=function(){return this._faceEntity};b.prototype.getLineEntity=function(){return this._lineEntity};b.prototype.getPointEntity=function(){return this._pointEntity};b.prototype.getNodeId=function(){return this._nodeId};b.prototype.getInclusionKey=
function(){return this._inclusionKey};b.prototype.getIncludeId=function(){return this.getInclusionKey()};b.prototype.getPosition=function(){return null!==this._faceEntity?this._faceEntity.getPosition():null!==this._lineEntity?this._lineEntity.getPosition():null!==this._pointEntity?this._pointEntity.getPosition():null};b.prototype.overlayIndex=function(){return this._faceEntity?this._faceEntity.overlayIndex():this._lineEntity?this._lineEntity.overlayIndex():this._pointEntity?this._pointEntity.overlayIndex():
null};b.prototype._setNodeId=function(a){this._nodeId=a};b.prototype.equals=function(a){return this._nodeId!==a._nodeId||this.getSelectionType()!==a.getSelectionType()?!1:this._faceEntity&&a._faceEntity?this._faceEntity.getCadFaceIndex()===a._faceEntity.getCadFaceIndex():this._lineEntity&&a._lineEntity?this._lineEntity.getLineId()===a._lineEntity.getLineId():this._pointEntity&&a._pointEntity?this._pointEntity.getPointId()===a._pointEntity.getPointId():!0};b.prototype._hash=function(){var a=null!==
this._nodeId?this._nodeId.toString(36):"",a=a+(";"+this.getSelectionType()+";");this._faceEntity&&(a+=this._faceEntity.getCadFaceIndex().toString(36));a+=";";this._lineEntity&&(a+=this._lineEntity.getLineId().toString(36));a+=";";this._pointEntity&&(a+=this._pointEntity.getPointId().toString(36));return a};b.prototype.isEntitySelection=function(){return null!==this._faceEntity||null!==this._lineEntity||null!==this._pointEntity};b.prototype.isNodeSelection=function(){return null!==this._nodeId};b.prototype.isNodeEntitySelection=
function(){return null!==this._nodeId&&this.isEntitySelection()};b.prototype.isFaceSelection=function(){return null!==this._nodeId&&null!==this._faceEntity};b.prototype.isLineSelection=function(){return null!==this._nodeId&&null!==this._lineEntity};b.prototype.isPointSelection=function(){return null!==this._nodeId&&null!==this._pointEntity};return b}();h.SelectionItem=c;c=function(){function b(a,b,c){this.faceItem=a;this.lineItem=b;this.pointItem=c}b.prototype.fetchMostRelevant=function(b){return null!==
this.pointItem&&0!==(b&a.SelectionMask.Point)?this.pointItem:null!==this.lineItem&&0!==(b&a.SelectionMask.Line)?this.lineItem:null!==this.faceItem&&0!==(b&a.SelectionMask.Face)?this.faceItem:null};return b}();h.CompositeSelectionItem=c})(a.Selection||(a.Selection={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(f,d,c){var b=a.Point2.subtract(c,d),g=b.length();b.scale(((f.x-d.x)*(c.x-d.x)+(f.y-d.y)*(c.y-d.y))/(g*g));return a.Point2.add(d,b)}h.hasBits=function(a,d){return(a&d)===d};h.setBit=function(a,d,c){return c?a|d:a&~d};h.sleep=function(a){return new Promise(function(d){setTimeout(d,a)})};h.classFromString=function(a){a=a.split(".");for(var d=window||this,c=0;c<a.length;c++){if(void 0===d)return null;d=d[a[c]]}return"function"!==typeof d?null:d};h.pointInRect=function(a,
d,c){return a.x<d.x||a.x>d.x+c.x||a.y<d.y||a.y>d.y+c.y?!1:!0};h.closestPointOnLine2d=e;h.pointOnLineSegment2d=function(f,d,c,b){var g=e(f,d,c);return a.Point2.distance(f,g)<=b?g.x<Math.min(d.x,c.x)||g.x>Math.max(d.x,c.x)||g.y<Math.min(d.y,c.y)||g.y>Math.max(d.y,c.y)?!1:!0:!1};h.projectOnto=function(f,d){f=a.Point3.dot(d,f);var c=d.squaredLength();return a.Point3.scale(d,f/c)};h.majorAxis=function(f){var d=Math.abs(f.x),c=Math.abs(f.y);f=Math.abs(f.z);d=+d.toFixed(6);c=+c.toFixed(6);f=+f.toFixed(6);
return d>c&&d>f?new a.Point3(1,0,0):c>d&&c>f?new a.Point3(0,1,0):f>d&&f>c?new a.Point3(0,0,1):null};h.deepClone=function(a){return JSON.parse(JSON.stringify(a))};h.getWithDefault=function(a,d){return void 0===a?d:a}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){var h=function(){return function(a){this.futureItemHash=null;this.pastItemHash=a}}(),e=function(){function d(){this.part=this.point=this.line=this.face=this.none=0}d.prototype.update=function(c,b){switch(c.getSelectionType()){case a.SelectionType.None:0===b?--this.none:++this.none;break;case a.SelectionType.Face:0===b?--this.face:++this.face;break;case a.SelectionType.Line:0===b?--this.line:++this.line;break;case a.SelectionType.Point:0===b?--this.point:++this.point;break;case a.SelectionType.Part:0===
b?--this.part:++this.part}};d.prototype.sum=function(){return this.none+this.face+this.line+this.point+this.part};return d}(),f=function(){function d(c,b,g,d,f){var e=this;this._selectedItemsPruned=new Map;this._selectedItemsFull=new Map;this._selectedNodeCounts=new Map;this._temporalLinks=new Map;this._newestItemHash=this._oldestItemHash=null;this._selectedLayers=new Set;this._selectedTypes=new Set;this._nodeSelectionColor=new a.Color(255,255,0);this._nodeSelectionOutlineColor=new a.Color(255,255,
0);this._elementSelectionColor=a.Color.red();this._elementSelectionOutlineColor=a.Color.red();this._nodeElementHighlightMode=this._nodeHighlightMode=a.SelectionHighlightMode.HighlightAndOutline;this._pruneSelectionDescendants=this._selectParentIfSelected=this._highlightPointElementSelection=this._highlightLineElementSelection=this._highlightFaceElementSelection=this._highlightNodeSelection=!0;this._selectionFilter=null;this._incrementalBlacklistedInstanceNodes=new Set;this._engine=b;this._view=g;
this._model=d;this._modelStructure=f;this._callbackManager=c;this._callbackManager.bind({_subtreeLoaded:function(a){for(var b=0;b<a.length;b++)e._onSubtreeLoaded(a[b]);return Promise.resolve()}})}d.deprecated=function(a,b,g){a;var d=g.value;g.value=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._callbackManager.trigger("deprecated","SelectionManager",b);return d.apply(this,a)};return g};d.prototype._init=function(){this._updateHighlightingMode();this._engine.setHighlightColorizeCompression(.7);
return Promise.resolve()};d.prototype.setSelectionFilter=function(a){this._selectionFilter=a};d.prototype.setPruneSelectionDescendants=function(a){this._pruneSelectionDescendants=a;this.clear()};d.prototype.getPruneSelectionDescendants=function(){return this._pruneSelectionDescendants};d.prototype.setSelectParentIfSelected=function(a){this._selectParentIfSelected=a};d.prototype.getSelectParentIfSelected=function(){return this._selectParentIfSelected};d.prototype.selectFromPoint=function(c,b,g){void 0===
g&&(g=a.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromPoint(c,b)];case 1:return a=d.sent(),this._onSelectionItem(a,g),[2]}})})};d.prototype.selectAllFromPoint=function(c,b,g){void 0===g&&(g=a.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickAllFromPoint(c,b)];case 1:return a=d.sent(),
this._onSelectionItems(a,g),[2]}})})};d.prototype.selectFromRay=function(c,b,g){void 0===g&&(g=a.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,this._view.pickFromRay(c,b)];case 1:return a=d.sent(),this._onSelectionItem(a,g),[2]}})})};d.prototype.selectAllFromRay=function(c,b,g){void 0===g&&(g=a.SelectionMode.Set);return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,
this._view.pickAllFromRay(c,b)];case 1:return a=d.sent(),this._onSelectionItems(a,g),[2]}})})};d.prototype._onSelectionItem=function(a,b){a.isNodeEntitySelection()?this._processSelection(a,b):this._triggerNullSelection()};d.prototype._onSelectionItems=function(c,b){b===a.SelectionMode.Set&&this.clear(!1);if(0===c.length)this._triggerNullSelection();else switch(b){case a.SelectionMode.Add:case a.SelectionMode.Set:this.add(c);break;case a.SelectionMode.Toggle:for(b=0;b<c.length;b++)this.toggle(c[b]);
break;default:a.Util.TypeAssertNever(b)}};d.prototype.beginScreenSelectByArea=function(a,b,g){return this._view.beginScreenSelectByArea(a,b,g)};d.prototype.beginRayDrillSelection=function(a,b,g){return this._view.beginRayDrillSelection(a,b,g)};d.prototype.beginConvexPolyhedronSelection=function(a,b,g){return this._view.beginConvexPolyhedronSelection(a,b,g)};d.prototype.beginSphereSelection=function(a,b,g){return this._view.beginSphereSelection(a,b,g)};d.prototype.endIncrementalSelection=function(a){this._callbackManager.trigger("incrementalSelectionEnd");
return this._view.endIncrementalSelection(a)};d.prototype.endVolumeSelection=function(a){return this.endIncrementalSelection(a)};d.prototype.advanceIncrementalSelection=function(a,b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var g,d;return __generator(this,function(f){switch(f.label){case 0:return[4,this._view.advanceIncrementalSelection(a)];case 1:return g=f.sent(),null===g?[2,!1]:null===b?[3,3]:[4,Promise.all(g.map(b))];case 2:d=f.sent(),g=g.filter(function(a,b){return d[b]}),
f.label=3;case 3:return this.add(g),[2,!0]}})})};d.prototype.advanceVolumeSelection=function(a,b){void 0===b&&(b=null);return this.advanceIncrementalSelection(a,b)};d.prototype.isSelected=function(a){return this.contains(a)?!0:a.isNodeSelection()?null!==this._findAncestor(a):!1};d.prototype.contains=function(a){return this._selectedItemsPruned.has(a._hash())};d.prototype.containsParent=function(a){return this._findAncestor(a)};d.prototype._findAncestor=function(c){if(0<this._selectedItemsPruned.size)for(;;){c=
this._model.getNodeParent(c.getNodeId());if(null===c)break;c=a.Selection.SelectionItem.create(c);var b=c._hash();if(this._selectedItemsPruned.has(b))return c}return null};d.prototype.selectLayer=function(c,b){b===a.SelectionMode.Set&&this.clear();var g=[],d=this._model.getLayerIdsFromName(c);if(null!==d)for(var f=0;f<d.length;f++){var e=this._model.getNodesFromLayer(d[f],!0);if(null!==e)for(var k=0;k<e.length;k++)g.push(a.Selection.SelectionItem.create(e[k]))}d=this._selectedLayers.has(c);b===a.SelectionMode.Toggle&&
d?this.remove(g):(this.add(g),this._selectedLayers.add(c))};d.prototype.getSelectedLayers=function(){var a=[];this._selectedLayers.forEach(function(b){a.push(b)});return a};d.prototype.selectType=function(c,b){b===a.SelectionMode.Set&&this.clear();var g=[],d=this._model.getNodesByGenericType(c);null!==d&&d.forEach(function(b){g.push(a.Selection.SelectionItem.create(b))});d=this._selectedTypes.has(c);if(b===a.SelectionMode.Toggle&&d)for(c=0;c<g.length;c++)this.remove(g[c]);else this.add(g),this._selectedTypes.add(c)};
d.prototype.getSelectedTypes=function(){var a=[];this._selectedTypes.forEach(function(b){a.push(b)});return a};d.prototype.selectNode=function(c,b){void 0===b&&(b=a.SelectionMode.Set);if(null!==c&&this._modelStructure.isIdValid(c))return c=a.Selection.SelectionItem.create(c),this._processSelection(c,b),c.getSelectionType();this._processSelection(null,b);return a.SelectionType.None};d.prototype._triggerNullSelection=function(){this._callbackManager.trigger("selectionArray",[],!1)};d.prototype._isInAxisOverlay=
function(a){var b=a.getFaceEntity();return b||(b=a.getLineEntity())?1===b.overlayIndex():(a=a.getPointEntity())?1===a.overlayIndex():!1};d.prototype._getNodeCounts=function(a){a=a.getNodeId();var b=this._selectedNodeCounts.get(a);b||(b=new e,this._selectedNodeCounts.set(a,b));return b};d.prototype._addToFull=function(c,b){for(;this._selectedItemsFull.set(b,c);){c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=a.Selection.SelectionItem.create(c);b=c._hash()}};d.prototype._addItems=function(c){var b=
c.length;if(0!==b){this._callbackManager.trigger("incrementalSelectionBatchBegin");for(var g=[],d=0;d<b;++d){var f=this._filterItem(c[d]);null!==f&&this._addImpl(f,f._hash())&&(f=new a.Event.NodeSelectionEvent(f),g.push(f))}0===g.length?this._triggerNullSelection():this._callbackManager.trigger("selectionArray",g,!1);this._callbackManager.trigger("incrementalSelectionBatchEnd")}};d.prototype._addItem=function(c){c=this._filterItem(c);null!==c&&this._addImpl(c,c._hash())?(c=new a.Event.NodeSelectionEvent(c),
this._callbackManager.trigger("selectionArray",[c],!1)):this._triggerNullSelection()};d.prototype.add=function(a){null===a?this._triggerNullSelection():Array.isArray(a)?this._addItems(a):this._addItem(a)};d.prototype._filterItem=function(c){return null!==this._selectionFilter?(c=this._selectionFilter(c.getNodeId(),this._model),null===c?null:a.Selection.SelectionItem.create(c)):c};d.prototype._addImpl=function(c,b){if(c.getSelectionType()===a.SelectionType.None)return!1;if(this._isInAxisOverlay(c))return!0;
if(this._selectedItemsPruned.has(b))return!1;if(this._pruneSelectionDescendants){if(null!==this._findAncestor(c))return!1;this._removeDescendants(c)}this._selectedItemsPruned.set(b,c);this._addToFull(c,b);this._getNodeCounts(c).update(c,1);var g=this._newestItemHash;this._newestItemHash=b;this._oldestItemHash||(this._oldestItemHash=b);if(null!==g){var d=this._temporalLinks.get(g);d&&(d.futureItemHash=b)}g=new h(g);this._temporalLinks.set(b,g);this._updateSelection(c,!0,!0);if(this._modelStructure.getType(c.getNodeId())===
a.NodeType.Pmi&&(c=this._modelStructure.getPmiTopologyReferences(c.getNodeId()),null!==c))for(b=0;b<c.length;b++){for(var d=c[b],g=d.body.getRuntimeId(),f=0,e=d.faceIds;f<e.length;f++)this._model.setNodeFaceHighlighted(g,e[f],!0);f=0;for(d=d.edgeIds;f<d.length;f++)this._model.setNodeLineHighlighted(g,d[f],!0)}return!0};d.prototype._removeUpdateLayers=function(a){0<this._selectedLayers.size&&(a=a.getNodeId(),null!==a&&(a=this._model.getNodeLayerId(a),null!==a&&(a=this._model.getLayerName(a),null!==
a&&this._selectedLayers.delete(a))))};d.prototype._removeUpdateTypes=function(a){0<this._selectedTypes.size&&(a=a.getNodeId(),null!==a&&(a=this._model.getNodeGenericType(a),null!==a&&this._selectedTypes.delete(a)))};d.prototype._removeFromFull=function(c,b){this._removeUpdateLayers(c);this._removeUpdateTypes(c);if(this._selectedItemsFull.delete(b))for(b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var g=a.Selection.SelectionItem.create(c[b]);this._removeFromFull(g,g._hash())}};d.prototype._removeItems=
function(c){var b=this,g=[];c.forEach(function(c){b._removeImpl(c,c._hash())&&g.push(new a.Event.NodeSelectionEvent(c))});this._callbackManager.trigger("selectionArray",g,!0)};d.prototype._removeItem=function(c){this._removeImpl(c,c._hash())&&(c=new a.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0))};d.prototype.remove=function(a){Array.isArray(a)?this._removeItems(a):this._removeItem(a)};d.prototype._removeImpl=function(a,b){if(!this._selectedItemsPruned.delete(b))return!1;
this._removeFromFull(a,b);var g=this._getNodeCounts(a);g.update(a,0);var d=this._temporalLinks.get(b);if(void 0!==d){this._temporalLinks.delete(b);if(null!==d.pastItemHash){var f=this._temporalLinks.get(d.pastItemHash);f&&(f.futureItemHash=d.futureItemHash)}null!==d.futureItemHash&&(f=this._temporalLinks.get(d.futureItemHash))&&(f.pastItemHash=d.pastItemHash);this._oldestItemHash===b&&(this._oldestItemHash=d.futureItemHash);this._newestItemHash===b&&(this._newestItemHash=d.pastItemHash)}b=!0;0===
g.sum()&&(b=!1,g=a.getNodeId(),this._selectedNodeCounts.delete(g));this._updateSelection(a,b,!1);return!0};d.prototype.toggle=function(c){var b=this._findAncestor(c);null!==b?null===c.getFaceEntity()&&null===c.getLineEntity()&&null===c.getPointEntity()&&this._removeImplicit(c,b):(b=c._hash(),this._selectedItemsPruned.has(b)?this._removeImpl(c,b)&&(c=new a.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!0)):(c=this._filterItem(c),null!==c&&this._addImpl(c,c._hash())&&
(c=new a.Event.NodeSelectionEvent(c),this._callbackManager.trigger("selectionArray",[c],!1))))};d.prototype.set=function(a){this.clear(!1);this.add(a)};d.prototype.getResults=function(){var a=[];this.each(function(b){a.push(b)});return a};d.prototype.getResult=function(a){var b=this.size();if(0>a||a>=b)return null;b=b-a-1;return a<=b?this._getItemFromOldest(a):this._getItemFromNewest(b)};d.prototype._getItemFromOldest=function(a){for(var b=this._oldestItemHash;b;){if(0===a--)return this._selectedItemsPruned.get(b)||
null;b=this._temporalLinks.get(b).futureItemHash}return null};d.prototype._getItemFromNewest=function(a){for(var b=this._newestItemHash;b;){if(0===a--)return this._selectedItemsPruned.get(b)||null;b=this._temporalLinks.get(b).pastItemHash}return null};d.prototype.getFirst=function(){return null!==this._oldestItemHash?this._selectedItemsPruned.get(this._oldestItemHash)||null:null};d.prototype.getLast=function(){return null!==this._newestItemHash?this._selectedItemsPruned.get(this._newestItemHash)||
null:null};d.prototype.size=function(){return this._selectedItemsPruned.size};d.prototype.each=function(a){for(var b=this._oldestItemHash;b;){var g=this._selectedItemsPruned.get(b);a(g);b=this._temporalLinks.get(b).futureItemHash}};d.prototype.clear=function(a){void 0===a&&(a=!0);this._selectedLayers.clear();this._selectedTypes.clear();this._resetSelectionMaterials();this._selectedItemsPruned.clear();this._selectedItemsFull.clear();this._selectedNodeCounts.clear();this._temporalLinks.clear();this._newestItemHash=
this._oldestItemHash=null;a&&this._triggerNullSelection()};d.prototype.setNodeSelectionColor=function(a){this._setNodeSelectionColor(a);return Promise.resolve()};d.prototype._setNodeSelectionColor=function(a){this._nodeSelectionColor.assign(a);this._updateHighlightingMode()};d.prototype.getNodeSelectionColor=function(){return this._nodeSelectionColor.copy()};d.prototype.setNodeSelectionOutlineColor=function(a){this._setNodeSelectionOutlineColor(a);return Promise.resolve()};d.prototype._setNodeSelectionOutlineColor=
function(a){this._nodeSelectionOutlineColor.assign(a);this._updateHighlightingMode()};d.prototype.getNodeSelectionOutlineColor=function(){return this._nodeSelectionOutlineColor.copy()};d.prototype.setNodeElementSelectionColor=function(a){this._setNodeElementSelectionColor(a);return Promise.resolve()};d.prototype._setNodeElementSelectionColor=function(a){this._elementSelectionColor.assign(a);this._updateHighlightingMode()};d.prototype.getNodeElementSelectionColor=function(){return this._elementSelectionColor.copy()};
d.prototype.setNodeElementSelectionOutlineColor=function(a){this._setNodeElementSelectionOutlineColor(a);return Promise.resolve()};d.prototype._setNodeElementSelectionOutlineColor=function(a){this._elementSelectionOutlineColor.assign(a);this._updateHighlightingMode()};d.prototype.getNodeElementSelectionOutlineColor=function(){return this._elementSelectionOutlineColor.copy()};d.prototype.getHighlightFaceElementSelection=function(){return this._highlightFaceElementSelection};d.prototype.setHighlightFaceElementSelection=
function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){this._highlightFaceElementSelection=a;return[2,this._updateSelectionMaterials()]})})};d.prototype.setNodeSelectionHighlightMode=function(a){this._setNodeSelectionHighlightMode(a);return Promise.resolve()};d.prototype._setNodeSelectionHighlightMode=function(a){this._nodeHighlightMode=a;this._updateHighlightingMode()};d.prototype.getNodeSelectionHighlightMode=function(){return this._nodeHighlightMode};d.prototype.setNodeElementSelectionHighlightMode=
function(a){this._setNodeElementSelectionHighlightMode(a);return Promise.resolve()};d.prototype._setNodeElementSelectionHighlightMode=function(a){this._nodeElementHighlightMode=a;this._updateHighlightingMode()};d.prototype.getNodeElementSelectionHighlightMode=function(){return this._nodeElementHighlightMode};d.prototype.setHighlightNodeSelection=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){this._highlightNodeSelection=a;return[2,this._updateSelectionMaterials()]})})};
d.prototype.getHighlightNodeSelection=function(){return this._highlightNodeSelection};d.prototype.getHighlightLineElementSelection=function(){return this._highlightLineElementSelection};d.prototype.getHighlightPointElementSelection=function(){return this._highlightPointElementSelection};d.prototype.setHighlightLineElementSelection=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){this._highlightLineElementSelection=a;return[2,this._updateSelectionMaterials()]})})};
d.prototype.setHighlightPointElementSelection=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){this._highlightPointElementSelection=a;return[2,this._updateSelectionMaterials()]})})};d.prototype.setPickTolerance=function(a){this._engine.setPickTolerance(a)};d.prototype.getPickTolerance=function(){return this._engine.getPickTolerance()};d.prototype.exportSelectionData=function(){for(var a=[],b=0,g=this.getResults();b<g.length;b++)a.push(g[b].toJson());return a};
d.prototype.loadSelectionData=function(c){this.clear(!1);if("string"===typeof c&&(c=JSON.parse(c),!Array.isArray(c)))throw new a.ParseError("Expected JSON depicting an Array.");for(var b=[],g=0;g<c.length;g++){var d=a.Selection.SelectionItem._fromJson(c[g]);d.isNodeSelection()&&b.push(d)}this.add(b)};d.prototype._pathToParent=function(c,b){for(var g=[];!c.equals(b);){g.push(c);c=this._model.getNodeParent(c.getNodeId());if(null===c)break;c=a.Selection.SelectionItem.create(c)}return g};d.prototype._removeImplicit=
function(c,b){for(var g=this._pathToParent(c,b),d=b;0<g.length;){this.remove(d);b=[];for(var f=0,d=this._model.getNodeChildren(d.getNodeId());f<d.length;f++){var e=a.Selection.SelectionItem.create(d[f]);b.push(e)}this.add(b);d=g.pop()}console.assert(c===d);this.remove(c)};d.prototype._removeDescendants=function(c){var b=0;for(c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var g=a.Selection.SelectionItem.create(c[b]);this._removeDescendantsRecursive(g)}};d.prototype._removeDescendantsRecursive=
function(c){var b=c._hash();if(this._selectedItemsFull.delete(b))for(this._removeImpl(c,b),b=0,c=this._model.getNodeChildren(c.getNodeId());b<c.length;b++){var g=a.Selection.SelectionItem.create(c[b]);this._removeDescendantsRecursive(g)}};d.prototype._processSelection=function(c,b){switch(b){case a.SelectionMode.Add:this.add(c);break;case a.SelectionMode.Set:this.set(c);break;case a.SelectionMode.Toggle:null!==c&&this.toggle(c)}};d.prototype._resetSelectionMaterials=function(){0<this._selectedItemsPruned.size&&
this._engine.clearHighlight()};d.prototype._updateSelectionMaterials=function(){var a=this;this._resetSelectionMaterials();this._selectedItemsPruned.forEach(function(b){b&&a._updateSelection(b,!0,!0)});this._highlightNodeSelection&&this._model.setNodesHighlighted([],!0)};d.prototype._updateSelection=function(c,b,g){var d=c.getNodeId();this._highlightNodeSelection&&this._model.setNodesHighlighted([d],b);this._model.getNodeType(d)!==a.NodeType.Pmi&&(b=c.getFaceEntity(),this._highlightFaceElementSelection&&
null!==b&&!b.isCappingGeometry()&&this._model.setNodeFaceHighlighted(d,b.getCadFaceIndex(),g),b=c.getLineEntity(),this._highlightLineElementSelection&&null!==b&&!b.isCappingGeometry()&&this._model.setNodeLineHighlighted(d,b.getLineId(),g),c=c.getPointEntity(),this._highlightPointElementSelection&&null!==c&&this._model.setNodePointHighlighted(d,c.getPointId(),g))};d.prototype._updateHighlightingMode=function(){switch(this._nodeHighlightMode){case a.SelectionHighlightMode.HighlightOnly:this._engine.setNodeHighlightColor(this._nodeSelectionColor,
null);break;case a.SelectionHighlightMode.OutlineOnly:this._engine.setNodeHighlightColor(null,this._nodeSelectionOutlineColor);break;case a.SelectionHighlightMode.HighlightAndOutline:this._engine.setNodeHighlightColor(this._nodeSelectionColor,this._nodeSelectionOutlineColor)}switch(this._nodeElementHighlightMode){case a.SelectionHighlightMode.HighlightOnly:this._engine.setElementHighlightColor(this._elementSelectionColor,null);break;case a.SelectionHighlightMode.OutlineOnly:this._nodeHighlightMode===
a.SelectionHighlightMode.OutlineOnly?this._engine.setElementHighlightColor(null,this._elementSelectionOutlineColor):this._engine.setElementHighlightColor(this._nodeSelectionColor,this._elementSelectionOutlineColor);break;case a.SelectionHighlightMode.HighlightAndOutline:this._engine.setElementHighlightColor(this._elementSelectionColor,this._elementSelectionOutlineColor)}};d.prototype._onSubtreeLoaded=function(c){c=a.Selection.SelectionItem.create(c);if(this.isSelected(c))return this._updateSelection(c,
!0,!0)};d.ifcSelectionFilter=function(c,b){if(b.getNodeType(c)!==a.NodeType.BodyInstance)return c;for(;null!==c;){if(null!==b.getNodeGenericId(c))return c;c=b.getNodeParent(c)}return null};__decorate([d.deprecated],d.prototype,"endVolumeSelection",null);__decorate([d.deprecated],d.prototype,"advanceVolumeSelection",null);return d}();a.SelectionManager=f})(Communicator||(Communicator={}));
(function(a){(function(h){var e;(function(a){a[a.Background=0]="Background";a[a.Shadow=1]="Shadow";a[a.Selection=2]="Selection"})(e||(e={}));var f=function(){function d(c,b,g,d){var f=this;this._backgroundSheetMeshId=this._activeSheetId=null;this._sheetIds=[null,null,null];this._backgroundSelectionEnabled=this._backgroundSheetEnabled=!1;this._backgroundColor=new a.Color(180,180,180);this._sheetColor=a.Color.white();this._sheetShadowColor=new a.Color(75,75,75);this._viewer=c;this._engine=b;this._callbackManager=
g;var e=function(){return __awaiter(f,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return this._viewer.model.isDrawing()?[4,this.deactivateSheets(!1)]:[2];case 1:return b.sent(),a=this.getSheets(),0===this.get3DNodes().length&&0<a.length?[4,this.setActiveSheetId(a[0],!0,!0)]:[3,3];case 2:b.sent(),b.label=3;case 3:return[2]}})})};this._viewer.setCallbacks({_modelStructureHeaderParsed:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,
function(a){return this._viewer.model.isDrawing()&&!d?[2,this.setBackgroundSheetEnabled(!0)]:[2]})})},_firstModelLoaded:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,e()];case 1:return a.sent(),[2]}})})},_resetAssemblyTreeBegin:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,e()];case 1:return a.sent(),[4,this.setBackgroundSheetEnabled(this._viewer.model.isDrawing()&&
!d)];case 2:return a.sent(),[4,this.setBackgroundSelectionEnabled(this._viewer.model.isDrawing()&&!d)];case 3:return a.sent(),this._backgroundSheetMeshId=this._activeSheetId=null,this._sheetIds=[null,null,null],[2]}})})}})}d.prototype.getSheets=function(){var c=this._viewer.model,b=c.getAbsoluteRootNode(),b=c.getNodeChildren(b),b=c.getNodeChildren(b[0]),b=c.getNodeChildren(b[0]),g=[],d;for(d in b)c.getNodeType(b[d])===a.NodeType.DrawingSheet&&g.push(b[d]);return g};d.prototype.get3DNodes=function(){var c=
this._viewer.model,b=c.getAbsoluteRootNode(),b=c.getNodeChildren(b),b=c.getNodeChildren(b[0]),b=c.getNodeChildren(b[0]),g=[],d;for(d in b)c.getNodeType(b[d])!==a.NodeType.DrawingSheet&&g.push(b[d]);return g};d.prototype.deactivateSheets=function(a){void 0===a&&(a=!0);return __awaiter(this,void 0,void 0,function(){var b,g,d,f;return __generator(this,function(e){switch(e.label){case 0:return this._activeSheetId=null,this._viewer.pauseRendering(),b=this.get3DNodes(),g=0<b.length,[4,this._viewer.view.isolateNodes(b,
0,g)];case 1:return e.sent(),[4,this._refreshBackgroundSheets()];case 2:return e.sent(),d=this._viewer.view,f=d.getBackgroundColor(),d.setBackgroundColor(f.top,f.bottom),this._viewer.resumeRendering(),a&&this._callbackManager.trigger("sheetDeactivated"),[2]}})})};d.prototype.setActiveSheetId=function(a,b,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:if(this._activeSheetId===a)return[2];this._activeSheetId=a;return[4,this._markupManager._setActiveMarkupView(null)];
case 1:d.sent();if(!b)return[3,4];this._viewer.pauseRendering();return[4,this._viewer.view.isolateNodes([this._activeSheetId],0,g)];case 2:return d.sent(),[4,this._refreshBackgroundSheets()];case 3:d.sent(),this._viewer.resumeRendering(),d.label=4;case 4:return this._callbackManager.trigger("sheetActivated",this._activeSheetId),[2]}})})};d.prototype.getActiveSheetId=function(){return this._activeSheetId};d.prototype.isDrawingSheetActive=function(){return null!==this._activeSheetId};d.prototype.setMarkupManager=
function(a){this._markupManager=a};d.prototype._createBackgroundSheetMesh=function(){return __awaiter(this,void 0,void 0,function(){var c,b,g;return __generator(this,function(d){c=[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0];b=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1];g=new a.MeshData;g.addFaces(c,b);g.setBackfacesEnabled(!0);return[2,this._viewer.model.createMesh(g)]})})};d.prototype._createBackgroundSheetMatrix=function(c,b){var g=c.min,d=c.max,f=this._viewer.view.getCamera();c=f.getPosition();var e=f.getTarget(),
k=a.Point3.subtract(e,c);c=d.x-g.x;var e=d.y-g.y,r=Math.max(.1*c,.1*(d.z-g.z)),h=g.x+.5*c,n=g.y+.5*e,q=Math.max(.05*c,.05*e);c+=q;e+=q;h-=.5*c;n-=.5*e;g=0<k.z?d.z+r:g.z-r;b&&(b=f.getUp(),f=.3*q,h+=f,0<b.y&&(f=-f),n+=f,g+=0<k.z?r:-r);b=new a.Matrix;b.setTranslationComponent(h,n,g);b.setScaleComponent(c,e,1);return b};d.prototype._createBackgroundSheetInstance=function(c,b,g,d,f,e){return __awaiter(this,void 0,void 0,function(){var k,r,h;return __generator(this,function(n){switch(n.label){case 0:return k=
a.MeshInstanceCreationFlags.DoNotExplode|a.MeshInstanceCreationFlags.DoNotCut|a.MeshInstanceCreationFlags.OverrideSceneVisibility|a.MeshInstanceCreationFlags.DoNotLight|a.MeshInstanceCreationFlags.DoNotOutlineHighlight|a.MeshInstanceCreationFlags.AlwaysDraw|a.MeshInstanceCreationFlags.ExcludeBounding,e||(k|=a.MeshInstanceCreationFlags.DoNotSelect),r=new a.MeshInstanceData(c,g,b,d,null,null,k),[4,this._viewer.model.createMeshInstance(r,null,!1,!0)];case 1:return h=n.sent(),this._viewer.model.setNodesOpacity([h],
f),[2,h]}})})};d.prototype._deleteBackgroundSheetInstances=function(a){void 0===a&&(a=[e.Background,e.Selection,e.Shadow]);return __awaiter(this,void 0,void 0,function(){var b,g,d,f,e;return __generator(this,function(k){b=[];g=0;for(d=a;g<d.length;g++)f=d[g],e=this._sheetIds[f],null!==e&&(this._sheetIds[f]=null,b.push(e));return 0<b.length?[2,this._viewer.model.deleteMeshInstances(b)]:[2]})})};d.prototype._createOrUpdateSheet=function(c,b,g,d,f,e){return __awaiter(this,void 0,void 0,function(){var k,
r,h,n;return __generator(this,function(q){switch(q.label){case 0:k=this._viewer.model;if(null!==this._sheetIds[c])return[3,2];r=this._sheetIds;h=c;return[4,this._createBackgroundSheetInstance(this._backgroundSheetMeshId,b,g,d,f,e)];case 1:return r[h]=q.sent(),[2,Promise.resolve()];case 2:return n=this._sheetIds[c],k.setNodesFaceColor([n],d),k.setNodesOpacity([n],f),null!==e&&k.setInstanceModifier(a.InstanceModifier.DoNotSelect,[n],!e),[2,k.setNodeMatrix(n,g,!0)]}})})};d.prototype._refreshBackgroundSheets=
function(){return __awaiter(this,void 0,void 0,function(){var c,b,g,d,f,p;return __generator(this,function(k){switch(k.label){case 0:c=this._viewer.model;if(!this.isDrawingSheetActive())return this._backgroundSelectionEnabled=!1,[2,this._deleteBackgroundSheetInstances()];if(null!==this._backgroundSheetMeshId)return[3,2];b=this;return[4,this._createBackgroundSheetMesh()];case 1:b._backgroundSheetMeshId=k.sent(),k.label=2;case 2:return[4,c.getModelBounding(!0,!1)];case 3:return g=k.sent(),d=this._createBackgroundSheetMatrix(g,
!1),f=[],this._backgroundSelectionEnabled?[4,this._createOrUpdateSheet(e.Selection,"2d_drawing_background_selection_sheet",d,a.Color.black(),0,!0)]:[3,5];case 4:return k.sent(),[3,6];case 5:f.push(e.Selection),k.label=6;case 6:this._engine.setBackgroundGradient(this._backgroundColor,this._backgroundColor);if(!this._backgroundSheetEnabled)return[3,9];p=this._createBackgroundSheetMatrix(g,!0);return[4,this._createOrUpdateSheet(e.Background,"2d_drawing_background_sheet",d,this._sheetColor,1,!1)];case 7:return k.sent(),
[4,this._createOrUpdateSheet(e.Shadow,"2d_drawing_background_shadow_sheet",p,this._sheetShadowColor,1,!1)];case 8:return k.sent(),[3,10];case 9:f.push(e.Background,e.Shadow),k.label=10;case 10:return 0<f.length?[2,this._deleteBackgroundSheetInstances(f)]:[2]}})})};d.prototype.setSheetColors=function(a,b,g){this._backgroundColor=a.copy();this._sheetColor=b.copy();this._sheetShadowColor=g.copy();return this._refreshBackgroundSheets()};d.prototype.getSheetBackgroundColor=function(){return this._backgroundColor};
d.prototype.getSheetColor=function(){return this._sheetColor};d.prototype.getSheetShadowColor=function(){return this._sheetShadowColor};d.prototype.setBackgroundSheetEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:if(a===this._backgroundSheetEnabled)return[2];this._backgroundSheetEnabled=a;this._viewer.pauseRendering();return[4,this._refreshBackgroundSheets()];case 1:return b.sent(),this._viewer.resumeRendering(),[2]}})})};
d.prototype.getBackgroundSheetEnabled=function(){return this._backgroundSheetEnabled};d.prototype.setBackgroundSelectionEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:this.isDrawingSheetActive()||(a=!1);if(a===this._backgroundSelectionEnabled)return[2];this._backgroundSelectionEnabled=a;this._viewer.pauseRendering();return[4,this._refreshBackgroundSheets()];case 1:return b.sent(),this._viewer.resumeRendering(),[2]}})})};
d.prototype.getBackgroundSelectionEnabled=function(){return this._backgroundSelectionEnabled};d.prototype.startComparison=function(a,b,g){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return d=this._viewer.view,d.startComparison([a],[b],g),[4,this.setActiveSheetId(a,!1,!1)];case 1:return f.sent(),[4,d.isolateNodes([a,b],0,!0)];case 2:return f.sent(),[4,this._refreshBackgroundSheets()];case 3:return f.sent(),[2]}})})};d.prototype.endComparison=
function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._activeSheetId?[2]:[4,this.setActiveSheetId(this._activeSheetId,!0,!1)];case 1:return a.sent(),this._viewer.view.endComparison(),[2]}})})};return d}();h.SheetManager=f})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){var h;(function(a){a[a.Model=1]="Model";a[a.Svg=2]="Svg";a[a.Html=4]="Html";a[a.All=7]="All"})(h=a.SnapshotLayer||(a.SnapshotLayer={}));var e=function(){return function(a,d,c){void 0===a&&(a=0);void 0===d&&(d=0);void 0===c&&(c=h.All);this.width=a;this.height=d;this.layers=c}}();a.SnapshotConfig=e})(Communicator||(Communicator={}));
(function(a){(function(h){function e(a){var c=document.createElement("canvas");c.width=a.width;c.height=a.height;c.getContext("2d").drawImage(a,0,0);return c}function f(a){if(a instanceof HTMLCanvasElement&&0<a.clientWidth&&0<a.clientHeight)return a;for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes.item(c);if(d=f(d))return d}return null}function d(b,c){var d=b.getContext("2d");if(null===d)throw new a.CommunicatorError("failed to create 2D canvas context");for(var f=0;f<c.length;f++)d.drawImage(c[f],
0,0);var e=h.OpenPromise.create(),k=new Image;k.src=b.toDataURL();k.onload=function(){e.resolve(k)};return e}var c=function(){function b(a,b){this._domElements=a;this._config=b}b.prototype._extractMarkupSvgAsCanvas=function(){for(var a=this._domElements.getMarkupSvgElement(),b=(new XMLSerializer).serializeToString(a),a=b,c=(new DOMParser).parseFromString(a,"text/xml"),b=c.getElementsByTagName("defs"),d=[],f=0;f<b.length;f++)for(var r=b.item(f).getElementsByTagName("marker"),h=0;h<r.length;h++){var n=
r.item(h);d.push(n)}b=[];r=c.getElementsByTagName("line");for(f=0;f<r.length;f++)if(c=r.item(f),null!==c.style.marker&&0<c.style.marker.length){for(var h=c.style.marker.indexOf("#")+1,n=c.style.marker.indexOf('"',h+1),n=c.style.marker.substring(h,n),q=null,t=null,h=0;h<d.length;h++)if(d[h].id===n){q=d[h];t=d[h+1];break}b.push({line:c,start:q,end:t})}for(d=a.indexOf("marker: url");0<=d;){f=a.indexOf(")",d)+1;c=a.substring(d,f);h=c.indexOf("#")+1;r=c.indexOf('"',h);n=c.indexOf("&quot",h+11+1);q=r;if(0>
r||n<r)q=n;h=c.substring(h,q);r=0;for(n=b;r<n.length;r++)if(c=n[r],q=c.start,c=c.end,null!==q&&null!==c&&q.id===h){h="marker-start: url('#"+q.id+"');";h+="marker-end: url('#"+c.id+"')";a=a.slice(0,d)+h+a.slice(f);break}d=a.indexOf("marker: url",f+1)}b=a;a=document.createElement("canvas");document.body.appendChild(a);canvg(a,b);b=e(a);document.body.removeChild(a);return b};b.prototype._extractRedlineSvgAsCanvas=function(a,b){var c=this._domElements.getRedlineSvgElement();c.setAttribute("width",""+
a);c.setAttribute("height",""+b);c=(new XMLSerializer).serializeToString(c);c=c.replace("width: 100%;","width: "+a+";");c=c.replace("height: 100%;","height: "+b+";");a=document.createElement("canvas");document.body.appendChild(a);canvg(a,c);b=e(a);document.body.removeChild(a);return b};b.prototype._extractRedlineAsCanvas=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){a=this._domElements.getRedlineElement();return[2,html2canvas(a,{background:void 0})]})})};
b.prototype.capture=function(b){return __awaiter(this,void 0,void 0,function(){var c,v,p,k,r;return __generator(this,function(h){switch(h.label){case 0:c=f(b);if(null===c)throw new a.CommunicatorError("failed to find canvas");v=document.createElement("canvas");v.width=this._config.width||b.clientWidth;v.height=this._config.height||b.clientHeight;v.style.width="100%";v.style.height="100%";p=[];this._config.layers&a.SnapshotLayer.Model&&p.push(e(c));this._config.layers&a.SnapshotLayer.Svg&&(p.push(this._extractMarkupSvgAsCanvas()),
p.push(this._extractRedlineSvgAsCanvas(v.width,v.height)));if(!(this._config.layers&a.SnapshotLayer.Html))return[3,2];r=(k=p).push;return[4,this._extractRedlineAsCanvas()];case 1:r.apply(k,[h.sent()]),h.label=2;case 2:return[2,d(v,p)]}})})};return b}();h.Snapshot=c})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function b(){this._strokeWidth=1;this._strokeColor=a.Color.black()}b.prototype._assign=function(a){this._strokeWidth=a._strokeWidth;this._strokeColor.assign(a._strokeColor)};b.prototype.setStrokeColor=function(a){this._strokeColor.assign(a)};b.prototype.getStrokeColor=function(){return this._strokeColor.copy()};b.prototype.setStrokeWidth=function(a){this._strokeWidth=a};b.prototype.getStrokeWidth=function(){return this._strokeWidth};return b}();
e.StrokedShape=f;var d=function(b){function c(){var g=null!==b&&b.apply(this,arguments)||this;g._fillColor=a.Color.black();g._fillOpacity=1;return g}__extends(c,b);c.prototype._assign=function(a){b.prototype._assign.call(this,a);this._fillColor.assign(a._fillColor);this._fillOpacity=a._fillOpacity};c.prototype.getFillOpacity=function(){return this._fillOpacity};c.prototype.setFillOpacity=function(a){this._fillOpacity=a};c.prototype.setFillColor=function(a){this._fillColor.assign(a)};c.prototype.getFillColor=
function(){return this._fillColor.copy()};return c}(f);e.FilledShape=d;var c;(function(a){a[a.None=0]="None";a[a.Arrowhead=1]="Arrowhead";a[a.Circle=2]="Circle"})(c=e.EndcapType||(e.EndcapType={}));f=function(b){function g(){var g=null!==b&&b.apply(this,arguments)||this;g._startEndcapType=c.None;g._startEndcapColor=a.Color.black();g._startEndcapSize=9;g._endEndcapType=c.None;g._endEndcapColor=a.Color.black();g._endEndcapSize=9;g._endcapsInverted=!1;return g}__extends(g,b);g.prototype._assign=function(a){b.prototype._assign.call(this,
a);this._startEndcapType=a._startEndcapType;this._startEndcapColor.assign(a._startEndcapColor);this._startEndcapSize=a._startEndcapSize;this._endEndcapType=a._endEndcapType;this._endEndcapColor.assign(a._endEndcapColor);this._endEndcapSize=a._endEndcapSize;this._endcapsInverted=a._endcapsInverted};g.prototype.getStartEndcapType=function(){return this._startEndcapType};g.prototype.setStartEndcapType=function(a){this._startEndcapType=a};g.prototype.getStartEndcapColor=function(){return this._startEndcapColor.copy()};
g.prototype.setStartEndcapColor=function(a){this._startEndcapColor.assign(a)};g.prototype.getStartEndcapSize=function(){return this._startEndcapSize};g.prototype.setStartEndcapSize=function(a){this._startEndcapSize=a};g.prototype.getEndEndcapType=function(){return this._endEndcapType};g.prototype.setEndEndcapType=function(a){this._endEndcapType=a};g.prototype.setEndcapType=function(a){this._endEndcapType=this._startEndcapType=a};g.prototype.getEndEndcapSize=function(){return this._endEndcapSize};
g.prototype.setEndEndcapSize=function(a){this._endEndcapSize=a};g.prototype.getEndEndcapColor=function(){return this._endEndcapColor.copy()};g.prototype.setEndEndcapColor=function(a){this._endEndcapColor.assign(a)};g.prototype.getEndcapsInverted=function(){return this._endcapsInverted};g.prototype.setEndcapsInverted=function(a){this._endcapsInverted=a};return g}(f);e.EndcapShape=f})(h.Shape||(h.Shape={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(a){function c(){var g=null!==a&&a.apply(this,arguments)||this;g._borderRadius=0;return g}__extends(c,a);c.prototype._assign=function(c){a.prototype._assign.call(this,c);this._borderRadius=c._borderRadius};c.prototype.getBorderRadius=function(){return this._borderRadius};c.prototype.setBorderRadius=function(a){this._borderRadius=a};return c}(e.FilledShape);e.RectangleBase=f;var d=function(b){function c(g,d){var f=b.call(this)||this;f._position=
a.Point2.zero();f._size=a.Point2.zero();g&&f._position.assign(g);d&&f._size.assign(d);return f}__extends(c,b);c.prototype._assign=function(a){b.prototype._assign.call(this,a);this._position.assign(a._position);this._size.assign(a._size)};c.prototype.setPosition=function(a){this._position.assign(a)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(a){this._size.assign(a)};c.prototype.getSize=function(){return this._size.copy()};return c}(f);e.Rectangle=
d;var c=function(){return function(a,c){this.position=a.copy();this.size=c.copy()}}();e._MarkupRectangleData=c;f=function(a){function g(){var c=null!==a&&a.apply(this,arguments)||this;c._rectangles=[];return c}__extends(g,a);g.prototype.clear=function(){this._rectangles=[]};g.prototype.addRectangle=function(a,b){this._rectangles.push(new c(a,b))};g.prototype.getRectangles=function(){return this._rectangles};return g}(f);e.RectangleCollection=f})(h.Shape||(h.Shape={}))})(a.Markup||(a.Markup={}))})(Communicator||
(Communicator={}));
(function(a){(function(h){(function(e){var f=function(a){function c(){var g=a.call(this)||this;g._fontFamily=null;g._fontSize=12;g.setStrokeWidth(0);return g}__extends(c,a);c.prototype._assign=function(c){a.prototype._assign.call(this,c);this._fontFamily=c._fontFamily;this._fontSize=c._fontSize};c.prototype.getFontFamily=function(){return this._fontFamily};c.prototype.setFontFamily=function(a){this._fontFamily=a};c.prototype.setFontSize=function(a){this._fontSize=a};c.prototype.getFontSize=function(){return this._fontSize};
return c}(e.FilledShape);e.TextMarkupBase=f;var d=function(b){function c(g,d){var f=b.call(this)||this;f._position=a.Point2.zero();f._text="";d&&(f._position=d.copy());g&&f.setText(g);return f}__extends(c,b);c.prototype._assign=function(a){b.prototype._assign.call(this,a);this._text=a._text;this._position.assign(a._position)};c.prototype.setPosition=function(a){this._position.assign(a)};c.prototype.getPosition=function(){return this._position};c.prototype.setText=function(a){this._text=a};c.prototype.getText=
function(){return this._text};return c}(f);e.Text=d;var c=function(){return function(a,c){a&&(this.text=a);c&&(this.position=c.copy())}}();e._MarkupTextData=c;f=function(a){function g(){var c=null!==a&&a.apply(this,arguments)||this;c._textStrings=[];return c}__extends(g,a);g.prototype.clear=function(){this._textStrings=[]};g.prototype.addString=function(a,b){this._textStrings.push(new c(a,b))};g.prototype.getStrings=function(){return this._textStrings};return g}(f);e.TextCollection=f})(h.Shape||(h.Shape=
{}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(){this._behindView=!1}a.prototype.remove=function(){};a.prototype.draw=function(){};a.prototype.hit=function(a){a;return!1};a.prototype.onSelect=function(){};a.prototype.onDeselect=function(){};a.prototype.toJson=function(){return{}};a.prototype.forJson=function(){return this.toJson()};a.prototype.getClassName=function(){return"Communicator.Markup.MarkupItem"};return a}();a.MarkupItem=e})(a.Markup||(a.Markup={}))})(Communicator||(Communicator=
{}));
(function(a){(function(h){var e=function(c){function b(b){var d=c.call(this)||this;d._position=new a.Point2(10,10);d._nextItemPosition=a.Point2.zero();d._statItemOffset=new a.Point2(5,5);d._maxStatWidth=0;d._viewer=b;d._backgroundPanel=new a.Markup.Shape.Rectangle(d._position,new a.Point2(300,100));d._backgroundPanel.setFillColor(a.Color.white());d._backgroundPanel.setStrokeWidth(0);d._statsText=new a.Markup.Shape.TextCollection;return d}__extends(b,c);b.prototype.draw=function(){this._updateBackgroundSize();var a=
this._viewer.markupManager.getRenderer();a.drawRectangle(this._backgroundPanel);a.drawTexts(this._statsText)};b.prototype.clearStatsText=function(){this._statsText.clear();this._nextItemPosition.assign(this._position)};b.prototype.setPosition=function(a){this._position.assign(a);this._backgroundPanel.setPosition(this._position)};b.prototype.addStatistic=function(b,c){var d=a.Point2.add(this._nextItemPosition,this._statItemOffset);this._statsText.addString(b+": "+c,d);this._nextItemPosition.y+=this._statsText.getFontSize()};
b.prototype._updateBackgroundSize=function(){for(var b=this._viewer.markupManager.getRenderer(),c=this._statsText.getStrings(),d=this._statsText.getFontSize(),f=0;f<c.length;f++){var e=b.measureText(c[f].text,this._statsText);this._maxStatWidth=Math.max(this._maxStatWidth,e.x)}this._backgroundPanel.setSize(new a.Point2(2*this._statItemOffset.x+this._maxStatWidth,c.length*(d+this._statItemOffset.y)))};return b}(a.Markup.MarkupItem),f=function(){return function(){}}();h.StatisticMap=f;var d=function(){function a(b,
c){this._statisticsDisplayHandle=null;this._statistics=new f;this._viewer=c;this._callbackManager=b;this._initEvents();this._statisticsDisplay=new e(this._viewer)}a.prototype._initEvents=function(){var a=this;this._updateFunc=function(){a.update()};this._callbackManager.bind({frameDrawn:this._updateFunc})};a.prototype.update=function(){var a=this,c=this._viewer.getStatistics().then(function(c){a._statistics=c;a._statisticsDisplay.clearStatsText();c=0;for(var g=Object.keys(a._statistics);c<g.length;c++){var d=
g[c];a._statisticsDisplay.addStatistic(d,a._statistics[d].toString())}});c};a.prototype.isShown=function(){return null!==this._statisticsDisplayHandle};a.prototype.getStatistics=function(){return this._statistics};a.prototype.showDisplay=function(){this.isShown()||(this.update(),this._statisticsDisplayHandle=this._viewer.markupManager.registerMarkup(this._statisticsDisplay))};a.prototype.hideDisplay=function(){this.isShown()&&(this._viewer.markupManager.unregisterMarkup(this._statisticsDisplayHandle),
this._statisticsDisplayHandle=null)};return a}();h.Statistics=d})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){var h=function(){return function(){this.svgXmlPrologEnabled=!0;this.svgBackgroundCssColor="";this.linesDrawModelLinesEnabled=this.silhouettesEnabled=!0;this.linesStrokeWidth=20;this.linesCssColor="#000000";this.linesClipZNudgeFactor=this.linesClipProximityToPlane=5.5;this.polygonsForceDrawCssColor="";this.logDiagnostics=this.logProgress=!1}}();a.SvgConfig=h})(Communicator||(Communicator={}));
(function(a){(function(a){a[a.Rgba32=0]="Rgba32";a[a.Rgb24=1]="Rgb24";a[a.Gray8=2]="Gray8";a[a.GrayAlpha16=3]="GrayAlpha16";a[a.Jpeg=4]="Jpeg";a[a.Png=5]="Png"})(a.ImageFormat||(a.ImageFormat={}));(function(a){a[a.Clamp=0]="Clamp";a[a.Repeat=1]="Repeat"})(a.TextureTiling||(a.TextureTiling={}));(function(a){a[a.UV=0]="UV"})(a.TextureParameterization||(a.TextureParameterization={}));(function(a){a[a.Decal=1]="Decal"})(a.TextureModifier||(a.TextureModifier={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function f(d){this._timeoutDurationMinutes=15;this._timeoutWarningMinutes=14;this._timer=new a.Timer;this._enabled=!0;this._callbackManager=d;this.resetTimeout()}f.prototype.setTimeoutDurations=function(a,c){this._timeoutDurationMinutes=a;this._timeoutWarningMinutes=c;this.resetTimeout();return!0};f.prototype.shutdown=function(){this._enabled=!1;this._timer.clear()};f.prototype.resetTimeout=function(){var a=this;this._enabled&&this._timer.set(Math.round(6E4*
this._timeoutWarningMinutes),function(){a._warn()})};f.prototype._warn=function(){var a=this;console.assert(this._timer.isIdle(0));var c=this._timeoutDurationMinutes-this._timeoutWarningMinutes,b=Math.round(6E4*c);this._callbackManager.trigger("timeoutWarning",c);this._timer.set(b,function(){a._timeout()})};f.prototype._timeout=function(){this._callbackManager.trigger("timeout");this._callbackManager.trigger("_timeout")};return f}();a.TimeoutMonitor=e})(a.Internal||(a.Internal={}))})(Communicator||
(Communicator={}));var __assign=this&&this.__assign||Object.assign||function(a){for(var h,e=1,f=arguments.length;e<f;e++){h=arguments[e];for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(a[d]=h[d])}return a};
(function(a){var h=function(){function e(f,d,c,b,g,l,e,p){this._backfacesVisible=!1;this._initialCamera=null;this._boundingCalculationIgnoresInvisible=this._faceVisibility=this._lineVisibility=!0;this._backgroundColorBottom=this._backgroundColorTop=null;this._drawMode=a.DrawMode.WireframeOnShaded;this._ambientOcclusionEnabled=!1;this._ambientOcclusionRadius=.03;this._antiAliasingMode=a.AntiAliasingMode.SMAA;this._lightingEnabled=!0;this._ambientLightColor=a.Color.black();this._bloomEnabled=!1;this._bloomIntensityScale=
this._bloomThresholdRampWidth=this._bloomThreshold=0;this._bloomLayers=[];this._silhouetteEnabled=this._simpleReflectionEnabled=this._simpleShadowEnabled=!1;this._hiddenLineSettings=new a.Settings.HiddenLineSettings;this._projectionMode=a.Projection.Orthographic;var k=f.getCreationParameters();this._viewer=f;this._engine=d;this._callbackManager=c;this._interpolationManager=g;this._eventDispatcher=b;this._model=f.model;this._statistics=l;this._navCube=e;this._axisTriad=p;this._determineInitialAxes=
a.Internal.getWithDefault(k.calculateDefaultViewAxes,!0);this._initEvents()}e.deprecated=function(a,d,c){a;var b=c.value;c.value=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._callbackManager.trigger("deprecated","View",d);return b.apply(this,a)};return c};e.prototype._initEvents=function(){var f=this;this._callbackManager.bind({_resetAssemblyTreeBegin:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(a){this._initialCamera=null;return[2]})})},
_firstAttachment:function(d){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(c){return d===a.Internal.AttachType.Direct?[2,this._massageInitialCamera(!1)]:[2]})})},_firstModelLoaded:function(){return f._massageInitialCamera(!1)},_modelSwitched:function(a){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return a?[3,2]:[4,this._massageInitialCamera(!1)];case 1:return c.sent(),[2,this._setInitialView(0)];case 2:return[2]}})})},
hwfParseComplete:function(){return f._massageInitialCamera(!0)},_modelStructureHeaderParsed:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(d){return this._viewer.isDrawingSheetActive()?(this._model.setViewAxes(new a.Point3(0,0,1),new a.Point3(0,1,0)),[2,this.setViewOrientation(a.ViewOrientation.Front,0)]):[2]})})},_sessionStarted:function(){return __awaiter(f,void 0,void 0,function(){return __generator(this,function(d){this.clearLights();this.setAmbientLightColor(a.Color.createFromFloatArray([.075,
.075,.075]));this.addLight(new a.Light(a.LightType.Directional,a.LightSpace.Camera,new a.Point3(.5,.5,1),a.Color.createFromFloatArray([.925,.925,.925])));this.addLight(new a.Light(a.LightType.Directional,a.LightSpace.Camera,new a.Point3(-.5,-.5,1),a.Color.createFromFloatArray([.1,.1,.2])));this.setBloomIntensityScale(1);this.setBloomThreshold(.65);this.setBloomThresholdRampWidth(.1);this.setBloomLayers([{intensity:.5,blurSamples:5,blurInterval:[.0025,a.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,
blurSamples:5,blurInterval:[.005,a.BlurIntervalUnit.ProportionOfHeight]},{intensity:.5,blurSamples:9,blurInterval:[.01,a.BlurIntervalUnit.ProportionOfHeight]},{intensity:1,blurSamples:9,blurInterval:[.02,a.BlurIntervalUnit.ProportionOfHeight]},{intensity:2,blurSamples:11,blurInterval:[.04,a.BlurIntervalUnit.ProportionOfHeight]}]);this.setGroundPlane({normal:new a.Point3(0,0,1),followViewAxes:!0});this.setSimpleShadowColor(a.Color.black());this.setSimpleShadowOpacity(.65);this.setSimpleShadowResolution(512);
this.setSimpleShadowBlurSamples(5);this.setSimpleShadowBlurInterval(1);this.setSimpleShadowInteractiveUpdateEnabled();this.setSimpleReflectionOpacity(.65);this.setSimpleReflectionFadeAngle(10);this.setSimpleReflectionBlurSamples(9);this.setSimpleReflectionBlurInterval(1,a.BlurIntervalUnit.Pixels);this.setSimpleReflectionAttenuation(0,1,a.SimpleReflectionAttenuationUnit.ProportionOfBoundingHeight);this.setSilhouetteColor(a.Color.black());this.setSilhouetteOpacity(1);this.setSilhouetteThreshold(.05);
this.setSilhouetteThresholdRampWidth(.025);return[2]})})},viewAxes:function(a,c){f._updateGroundPlane(a,c)}})};e.prototype._massageInitialCamera=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null!==this._initialCamera)return[2];d=this;return[4,this._engine.getCameraPromise()];case 1:return d._initialCamera=c.sent(),this._projectionMode=this._initialCamera.getProjection(),!this._determineInitialAxes||this._viewer.isDrawingSheetActive()||
this._model.viewAxesHaveBeenSet()||this._determineViewAxes(this._initialCamera),a?[4,this.fitWorld()]:[3,3];case 2:c.sent(),this._initialCamera=this.getCamera(),c.label=3;case 3:return[2]}})})};e.prototype.setLineVisibility=function(a){this._setLineVisibility(a);return Promise.resolve()};e.prototype._setLineVisibility=function(a){a!==this._lineVisibility&&(this._lineVisibility=a,this._engine.setLineVisibility(a))};e.prototype.getLineVisibility=function(){return this._lineVisibility};e.prototype.setFaceVisibility=
function(a){this._setFaceVisibility(a);return Promise.resolve()};e.prototype._setFaceVisibility=function(a){a!==this._faceVisibility&&(this._faceVisibility=a,this._engine.setFaceVisibility(a));return Promise.resolve()};e.prototype.getFaceVisibility=function(){return this._faceVisibility};e.prototype.setProjectionMode=function(a){this._projectionMode!==a&&(this._projectionMode=a,this._engine.isInit()&&this._engine.setProjection(a),this._eventDispatcher.injectViewOrientationChangeEvent())};e.prototype.getProjectionMode=
function(){return this._projectionMode};e.prototype.getViewMatrix=function(){return this._engine.getViewMatrix()};e.prototype.getProjectionMatrix=function(){return this._engine.getProjectionMatrix()};e.prototype.getFullCameraMatrix=function(){return this._engine.getFullCameraMatrix()};e.prototype.raycastFromPoint=function(f){var d=this.getCanvasSize(),c=this._engine.getViewMatrix(),b=this._engine.getProjectionMatrix(),g=new a.Point3(f.x,d.y-f.y,0);f=this._unproject(g,b,c,d);if(null===f)return null;
g.z=.5;d=this._unproject(g,b,c,d);if(null===d)return null;d=a.Point3.subtract(d,f).normalize();return new a.Ray(f,d)};e.prototype._unproject=function(f,d,c,b){d=a.Matrix.multiply(c,d);d=a.Matrix.inverse(d);if(null===d)return null;f=new a.Point4(f.x,f.y,f.z,1);f.x/=b.x;f.y/=b.y;f.x=2*f.x-1;f.y=2*f.y-1;f.z=2*f.z-1;b=d.transform4(f);if(0===b.w)return null;b.scale(1/b.w);return new a.Point3(b.x,b.y,b.z)};e.prototype._rectifySelectionItem=function(a){var d=a.getInclusionKey(),c=a.getNodeId(),d=this._model._getNodeFromInstanceInc(!1,
d,c,!0);a._setNodeId(d)};e.prototype.isOutsideCanvasArea=function(a){var d=this.getCanvasSize();return 0>a.x||0>a.y||a.x>=d.x||a.y>=d.y};e.prototype.pickFromPoint=function(f,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(f))throw new a.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.pickFromScreen(f,d,this._viewer.isDrawingSheetActive())];case 1:return(c=b.sent())?(this._rectifySelectionItem(c),
[2,c]):[2,a.Selection.SelectionItem.create()]}})})};e.prototype.pickAllFromPoint=function(f,d){return __awaiter(this,void 0,void 0,function(){var c,b,g,l;return __generator(this,function(e){switch(e.label){case 0:if(this.isOutsideCanvasArea(f))throw new a.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.pickAllFromScreen(f,d,this._viewer.isDrawingSheetActive())];case 1:c=e.sent();b=0;for(g=c;b<g.length;b++)l=g[b],this._rectifySelectionItem(l);return[2,c]}})})};
e.prototype.compositePickFromPoint=function(f,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:if(this.isOutsideCanvasArea(f))throw new a.CommunicatorError("Cannot pick from outside the canvas area.");return[4,this._engine.compositePickFromScreen(f,d,this._viewer.isDrawingSheetActive())];case 1:return c=b.sent(),null!==c.faceItem&&this._rectifySelectionItem(c.faceItem),null!==c.lineItem&&this._rectifySelectionItem(c.lineItem),null!==
c.pointItem&&this._rectifySelectionItem(c.pointItem),[2,c]}})})};e.prototype.pickFromRay=function(f,d){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return[4,this._engine.pickFromRay(f,d)];case 1:return(c=b.sent())?(this._rectifySelectionItem(c),[2,c]):[2,a.Selection.SelectionItem.create()]}})})};e.prototype.pickAllFromRay=function(a,d){return __awaiter(this,void 0,void 0,function(){var c,b,g,l;return __generator(this,function(e){switch(e.label){case 0:return[4,
this._engine.pickAllFromRay(a,d)];case 1:c=e.sent();b=0;for(g=c;b<g.length;b++)l=g[b],this._rectifySelectionItem(l);return[2,c]}})})};e.prototype.beginScreenSelectByArea=function(f,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(f)||this.isOutsideCanvasArea(d))throw new a.CommunicatorError("Cannot pick from outside the canvas area.");return[2,this._engine.beginScreenAreaSelection(f,d,c)]})})};e.prototype.beginRayDrillSelection=function(f,
d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){if(this.isOutsideCanvasArea(f))throw new a.CommunicatorError("Cannot pick from outside the canvas area.");return[2,this._engine.beginRayDrillSelection(f,d,c)]})})};e.prototype.beginConvexPolyhedronSelection=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2,this._engine.beginConvexPolyhedronSelection(a,d,c)]})})};e.prototype.beginSphereSelection=function(f,
d,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){b=a.Internal.toVec3(f);return[2,this._engine.beginSphereSelection(b,d,c)]})})};e.prototype.endIncrementalSelection=function(a){this._endIncrementalSelection(a);return Promise.resolve()};e.prototype._endIncrementalSelection=function(a){this._engine.endIncrementalSelection(a)};e.prototype.endVolumeSelection=function(a){return this.endIncrementalSelection(a)};e.prototype.advanceIncrementalSelection=function(f){return __awaiter(this,
void 0,void 0,function(){var d,c,b,g,l,e,p,k,r,h;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._engine.advanceIncrementalSelection(f)];case 1:d=n.sent();if(null===d)return[2,null];c=this._viewer.selectionManager;b=[];g=0;for(l=d;g<l.length;g++)e=l[g],this._rectifySelectionItem(e),p=e,k=p.getNodeId(),(r=c._incrementalBlacklistedInstanceNodes.has(k))||b.push(p);return[2,b];case 2:h=n.sent();if("advanceVolumeSelection"===h.scFunction)throw new a.SelectionInvalidatedError;
throw h;case 3:return[2]}})})};e.prototype.advanceVolumeSelection=function(a){return this.advanceIncrementalSelection(a)};e.prototype.projectPoint=function(a){var d=this._engine.getSynchedProjectionMatrix(),c=this._engine.getSynchedViewMatrix(),b=this.getCanvasSize();a=this._project(a,d,c,b);a.y=b.y-a.y;return a};e.prototype._project=function(f,d,c,b){f=new a.Point4(f.x,f.y,f.z,1);c.transform4(f,f);d.transform4(f,f);d=0>=f.w;c=f.w;0>=f.w&&(f.w=.001);f.scale(1/f.w);f.x=.5*f.x+.5;f.y=.5*f.y+.5;f.z=
.5*f.z+.5;f.x*=b.x;f.y*=b.y;d&&(f.z=c);return new a.Point3(f.x,f.y,f.z)};e.prototype.unprojectPoint=function(f,d){var c=this.getCanvasSize(),b=this.getProjectionMatrix(),g=this.getViewMatrix();f=new a.Point3(f.x,c.y-f.y,d);return this._unproject(f,b,g,c)};e.prototype.pointToWindowPosition=function(f){var d=this._engine.getCanvasSize();return new a.Point2(f.x/d.x*2-1,1-f.y/d.y*2)};e.prototype.setCamera=function(a,d){void 0===d&&(d=0);return null===a?!1:this._setCameraImpl(a,d).unsafeValue};e.prototype._setCameraPromise=
function(a,d){return this._setCameraImpl(a,d).readyPromise};e.prototype._setCameraImpl=function(f,d){return 0<d?this._interpolateCamera(f,d):this._engine.isInit()?(d=f.getProjection(),this._projectionMode!==d&&this.setProjectionMode(d),this._engine.setCamera(f),d=this._markupManager?this._markupManager._setActiveMarkupView(null):Promise.resolve(),this._callbackManager.trigger("camera",f),a.Internal.UnsafePromise.create(!0,d)):a.Internal.UnsafePromise.create(!1,Promise.resolve())};e.prototype._interpolateCamera=
function(f,d){var c=this;if(this._engine.isInit()){var b=this.getCamera();if(b.equals(f))return this._markupManager&&this._markupManager._update(),a.Internal.UnsafePromise.create(!1,Promise.resolve());this._callbackManager.trigger("transitionBegin",d);var g=a.Util.OpenPromise.create();this._interpolationManager.start(new a.Internal.CameraInterpolation(b,f,d,function(){c._eventDispatcher.injectViewOrientationChangeEvent();c._callbackManager.trigger("transitionEnd");g.resolve()},this));return a.Internal.UnsafePromise.create(!0,
g)}return a.Internal.UnsafePromise.create(!1,Promise.resolve())};e.prototype.updateCamera=function(a){a=this._engine.updateCamera(a);this._callbackManager.trigger("camera",a);return a};e.prototype.resetCamera=function(f){void 0===f&&(f=a.DefaultTransitionDuration);return this._setInitialView(f)};e.prototype.getCamera=function(){if(this._engine.isInit())return this._engine.getCamera();throw new a.CommunicatorError("getCamera() called before sceneReady");};e.prototype.getViewOrientationCamera=function(f,
d){return __awaiter(this,void 0,void 0,function(){var c,b,g,l,e,p,k,r,h,n,q,t,u,w,z,y,x,A,B;return __generator(this,function(C){switch(C.label){case 0:return c=this.getCamera(),b=this._model.getViewAxes(),g=b.upVector.copy(),l=b.frontVector.copy(),void 0!==d?[3,2]:[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return d=C.sent(),[3,3];case 2:this._fitCameraToBounding(c,d),C.label=3;case 3:e=d.center();p=e.copy();k=e.copy();r=a.Point3.subtract(c.getPosition(),
c.getTarget()).length();h=a.Point3.subtract(c.getPosition(),e).length();n=new a.Point3(0,0,1);q=new a.Point3(-1,0,0);null!==g&&(n=g.copy());null!==l&&(q=l.copy());t=q.copy().scale(-1);u=q.copy();w=n.copy();z=n.copy().scale(-1);y=a.Point3.cross(w,t);x=y.copy().scale(-1);switch(f){case a.ViewOrientation.Front:p=a.Point3.add(k,u);break;case a.ViewOrientation.Back:p=a.Point3.add(k,t);break;case a.ViewOrientation.Left:p=a.Point3.add(k,y);break;case a.ViewOrientation.Right:p=a.Point3.add(k,x);break;case a.ViewOrientation.Bottom:p=
a.Point3.add(k,z);n=t.copy();break;case a.ViewOrientation.Top:p=a.Point3.add(k,w);n=t.copy();break;case a.ViewOrientation.FrontTop:case a.ViewOrientation.TopFront:p=a.Point3.add(k,a.Point3.add(u,w));n=a.Point3.add(t,w).normalize();break;case a.ViewOrientation.FrontTopLeft:case a.ViewOrientation.LeftTopFront:case a.ViewOrientation.TopLeftFront:p=a.Point3.add(k,a.Point3.add(u,a.Point3.add(y,w)));n=a.Point3.add(t,a.Point3.add(x,w)).normalize();break;case a.ViewOrientation.Iso:case a.ViewOrientation.FrontTopRight:case a.ViewOrientation.RightTopFront:case a.ViewOrientation.TopRightFront:p=
a.Point3.add(k,a.Point3.add(u,a.Point3.add(x,w)));n=a.Point3.add(t,a.Point3.add(y,w)).normalize();break;case a.ViewOrientation.FrontLeft:case a.ViewOrientation.LeftFront:p=a.Point3.add(k,a.Point3.add(u,y));break;case a.ViewOrientation.FrontRight:case a.ViewOrientation.RightFront:p=a.Point3.add(k,a.Point3.add(u,x));break;case a.ViewOrientation.FrontBottom:case a.ViewOrientation.BottomFront:p=a.Point3.add(k,a.Point3.add(u,z));n=a.Point3.add(u,w).normalize();break;case a.ViewOrientation.FrontBottomLeft:case a.ViewOrientation.LeftBottomFront:case a.ViewOrientation.BottomLeftFront:p=
a.Point3.add(k,a.Point3.add(u,a.Point3.add(y,z)));n=a.Point3.add(u,a.Point3.add(y,w)).normalize();break;case a.ViewOrientation.FrontBottomRight:case a.ViewOrientation.RightBottomFront:case a.ViewOrientation.BottomRightFront:p=a.Point3.add(k,a.Point3.add(u,a.Point3.add(x,z)));n=a.Point3.add(u,a.Point3.add(x,w)).normalize();break;case a.ViewOrientation.BackTop:case a.ViewOrientation.TopBack:p=a.Point3.add(k,a.Point3.add(t,w));n=a.Point3.add(u,w).normalize();break;case a.ViewOrientation.BackTopLeft:case a.ViewOrientation.LeftTopBack:case a.ViewOrientation.TopLeftBack:p=
a.Point3.add(k,a.Point3.add(t,a.Point3.add(y,w)));n=a.Point3.add(u,a.Point3.add(x,w)).normalize();break;case a.ViewOrientation.BackTopRight:case a.ViewOrientation.RightTopBack:case a.ViewOrientation.TopRightBack:p=a.Point3.add(k,a.Point3.add(t,a.Point3.add(x,w)));n=a.Point3.add(u,a.Point3.add(y,w)).normalize();break;case a.ViewOrientation.BackLeft:case a.ViewOrientation.LeftBack:p=a.Point3.add(k,a.Point3.add(t,y));break;case a.ViewOrientation.BackRight:case a.ViewOrientation.RightBack:p=a.Point3.add(k,
a.Point3.add(t,x));break;case a.ViewOrientation.BackBottom:case a.ViewOrientation.BottomBack:p=a.Point3.add(k,a.Point3.add(t,z));n=a.Point3.add(t,w).normalize();break;case a.ViewOrientation.BackBottomLeft:case a.ViewOrientation.LeftBottomBack:case a.ViewOrientation.BottomLeftBack:p=a.Point3.add(k,a.Point3.add(t,a.Point3.add(y,z)));n=a.Point3.add(t,a.Point3.add(y,w)).normalize();break;case a.ViewOrientation.BackBottomRight:case a.ViewOrientation.RightBottomBack:case a.ViewOrientation.BottomRightBack:p=
a.Point3.add(k,a.Point3.add(t,a.Point3.add(x,z)));n=a.Point3.add(t,a.Point3.add(x,w)).normalize();break;case a.ViewOrientation.LeftBottom:case a.ViewOrientation.BottomLeft:p=a.Point3.add(k,a.Point3.add(y,z));n=a.Point3.add(y,w).normalize();break;case a.ViewOrientation.LeftTop:case a.ViewOrientation.TopLeft:p=a.Point3.add(k,a.Point3.add(y,w));n=a.Point3.add(x,w).normalize();break;case a.ViewOrientation.RightBottom:case a.ViewOrientation.BottomRight:p=a.Point3.add(k,a.Point3.add(x,z));n=a.Point3.add(x,
w).normalize();break;case a.ViewOrientation.RightTop:case a.ViewOrientation.TopRight:p=a.Point3.add(k,a.Point3.add(x,w));n=a.Point3.add(y,w).normalize();break;default:p=a.Point3.add(k,u)}A=a.Point3.add(a.Point3.subtract(p,e).normalize().scale(h),e);B=a.Point3.add(a.Point3.subtract(p,e).normalize().scale(h-r),e);c.setPosition(A);c.setTarget(B);c.setUp(n);return[2,c]}})})};e.prototype.setViewOrientation=function(f,d,c){void 0===d&&(d=a.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,
function(){var a;return __generator(this,function(g){switch(g.label){case 0:return[4,this.getViewOrientationCamera(f,c)];case 1:return a=g.sent(),void 0!==c?[3,3]:[4,this.fitWorld(d,a)];case 2:return g.sent(),[3,5];case 3:return[4,this.fitBounding(c,d,a)];case 4:g.sent(),g.label=5;case 5:return this._callbackManager.trigger("viewOrientation",f),[2]}})})};e.prototype.centerCameraOnNode=function(f,d,c){void 0===d&&(d=0);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){var b,
g,l,e,p;return __generator(this,function(k){switch(k.label){case 0:return[4,this._model.getNodesBounding([f])];case 1:b=k.sent();g=b.center();l=c.getPosition();e=c.getTarget();p=a.Point3.subtract(e,g);l.subtract(p);c.setPosition(l);c.setTarget(g);if(0<d)return[2,this._setCameraPromise(c,d)];this.setCamera(c);return[2]}})})};e.prototype._setInitialView=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){if(!this._initialCamera)return[2];if(0<a)return[2,this._setCameraPromise(this._initialCamera,
a)];this.setCamera(this._initialCamera);this._eventDispatcher.injectViewOrientationChangeEvent();return[2]})})};e.prototype.getCanvasSize=function(){return this._engine.getCanvasSize()};e.prototype._setMarkupManager=function(a){this._markupManager=a};e.prototype.setStatisticsDisplayVisibility=function(a){a?this._statistics.showDisplay():this._statistics.hideDisplay()};e.prototype.getBackgroundColor=function(){var f=null!==this._backgroundColorTop?this._backgroundColorTop.copy():null,d=null!==this._backgroundColorBottom?
this._backgroundColorBottom.copy():null;return new a.VerticalGradient(f,d)};e.prototype.setBackgroundColor=function(f,d){void 0===f&&(f=null);void 0===d&&(d=null);this._backgroundColorTop=null!==f?f.copy():null;this._backgroundColorBottom=null!==d?d.copy():null;this._drawMode===a.DrawMode.HiddenLine||this._viewer.isDrawingSheetActive()||this._engine.setBackgroundGradient(this._backgroundColorTop,this._backgroundColorBottom);return Promise.resolve()};e.prototype.isolateNodes=function(f,d,c,b){void 0===
d&&(d=a.DefaultTransitionDuration);void 0===c&&(c=!0);void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var a,l,e,p,k;return __generator(this,function(r){switch(r.label){case 0:a=this._model.getAbsoluteRootNode();l=new Map;l.set(a,!1);e=0;for(p=f;e<p.length;e++)k=p[e],l.set(k,!0);return[4,this._model.setNodesVisibilities(l,b)];case 1:return r.sent(),c?[2,this.fitNodes(f,d)]:[2]}})})};e.prototype.fitNodes=function(f,d){void 0===d&&(d=a.DefaultTransitionDuration);return __awaiter(this,
void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,this._model.getNodesBounding(f)];case 1:return a=b.sent(),[2,this.fitBounding(a,d)]}})})};e.prototype.fitWorld=function(a,d){void 0===a&&(a=0);return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(b){switch(b.label){case 0:return d||(d=this.getCamera()),[4,this._model.getModelBounding(this._boundingCalculationIgnoresInvisible,!1)];case 1:return c=b.sent(),[2,this.fitBounding(c,
a,d)]}})})};e.prototype._fitCameraToBounding=function(f,d){var c=d.extents().length(),b=f.getWidth(),g=a.Point3.subtract(f.getPosition(),f.getTarget()),l=g.length(),b=c*l/b;d=d.center();g=a.Point3.add(d,g.normalize().scale(b));f.setTarget(d);f.setPosition(g);f.setWidth(c);f.setHeight(c)};e.prototype.fitBounding=function(f,d,c){void 0===d&&(d=a.DefaultTransitionDuration);void 0===c&&(c=this.getCamera());return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(f){this._fitCameraToBounding(c,
f);if(0<d)return[2,this._setCameraPromise(c,d)];this.setCamera(c)}return[2]})})};e.prototype.setBackfacesVisible=function(a){this._backfacesVisible=a;this._engine.setBackFacesVisible(a);return Promise.resolve()};e.prototype.getBackfacesVisible=function(){return this._backfacesVisible};e.prototype.setDrawMode=function(a){this._setDrawMode(a);return Promise.resolve()};e.prototype._setDrawMode=function(f){this._drawMode=f;this._drawMode!==a.DrawMode.HiddenLine&&this.setBackgroundColor(this._backgroundColorTop,
this._backgroundColorBottom);switch(f){case a.DrawMode.Wireframe:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!1);break;case a.DrawMode.Shaded:this._engine.setDrawMode(1);this._setLineVisibility(!1);this._setFaceVisibility(!0);break;case a.DrawMode.WireframeOnShaded:this._engine.setDrawMode(1);this._setLineVisibility(!0);this._setFaceVisibility(!0);break;case a.DrawMode.HiddenLine:f=this._hiddenLineSettings.getBackgroundColor();this._setLineVisibility(!0);this._setFaceVisibility(!0);
this._engine.enableHiddenLineRendering(this._hiddenLineSettings);this._engine.setBackgroundGradient(f,f);break;case a.DrawMode.XRay:this._engine.setDrawMode(3),this._setLineVisibility(!0),this._setFaceVisibility(!0)}};e.prototype.getDrawMode=function(){return this._drawMode};e.prototype.setAntiAliasingMode=function(a){this._setAntiAliasingMode(a);return Promise.resolve()};e.prototype._setAntiAliasingMode=function(a){this._antiAliasingMode=a;this._engine.setAntiAliasingMode(a)};e.prototype.getAntiAliasingMode=
function(){return this._antiAliasingMode};e.prototype.getHiddenLineSettings=function(){return this._hiddenLineSettings};e.prototype.setAmbientOcclusionEnabled=function(a){void 0===a&&(a=!0);this._setAmbientOcclusionEnabled(a);return Promise.resolve()};e.prototype._setAmbientOcclusionEnabled=function(a){void 0===a&&(a=!0);this._ambientOcclusionEnabled=a;this._engine.setAmbientOcclusionEnabled(a)};e.prototype.getAmbientOcclusionEnabled=function(){return this._ambientOcclusionEnabled};e.prototype.setAmbientOcclusionRadius=
function(a){this._setAmbientOcclusionRadius(a);return Promise.resolve()};e.prototype._setAmbientOcclusionRadius=function(a){this._ambientOcclusionRadius=a;this._engine.setAmbientOcclusionRadius(a)};e.prototype.getAmbientOcclusionRadius=function(){return this._ambientOcclusionRadius};e.prototype.setLightingEnabled=function(a){void 0===a&&(a=!0);this._setLightingEnabled(a);return Promise.resolve()};e.prototype._setLightingEnabled=function(a){void 0===a&&(a=!0);this._lightingEnabled=a;this._engine.setLightingEnabled(a)};
e.prototype.getLightingEnabled=function(){return this._lightingEnabled};e.prototype.setXRayOpacity=function(a,d){this._setXRayOpacity(a,d);return Promise.resolve()};e.prototype._setXRayOpacity=function(a,d){this._engine.setXRayOpacity(a,d)};e.prototype.setXRayTransparencyMode=function(a){this._setXRayTransparencyMode(a);return Promise.resolve()};e.prototype._setXRayTransparencyMode=function(a){this._engine.setXRayTransparencyMode(a)};e.prototype.setXRayColor=function(f,d,c){void 0===c&&(c=a.XRayGroup.Selected);
return this._engine.setXRayColor(c,f,d)};e.prototype.unsetXRayColor=function(f,d){void 0===d&&(d=a.XRayGroup.Selected);return this._engine.unsetXRayColor(d,f)};e.prototype.setPointSize=function(a,d){this._setPointSize(a,d);return Promise.resolve()};e.prototype._setPointSize=function(a,d){this._engine.setPointSize(a,d)};e.prototype.getPointSize=function(){return this._engine.getPointSize()};e.prototype.setPointShape=function(a){this._setPointShape(a);return Promise.resolve()};e.prototype._setPointShape=
function(a){this._engine.setPointShape(a)};e.prototype.getPointShape=function(){return this._engine.getPointShape()};e.prototype.setEyeDomeLightingEnabled=function(a){void 0===a&&(a=!0);this._setEyeDomeLightingEnabled(a);return Promise.resolve()};e.prototype._setEyeDomeLightingEnabled=function(a){void 0===a&&(a=!0);this._engine.setEyeDomeLightingEnabled(a)};e.prototype.getEyeDomeLightingEnabled=function(){return this._engine.getEyeDomeLightingEnabled()};e.prototype.setEyeDomeLightingBlurSamples=function(a){this._setEyeDomeLightingBlurSamples(a);
return Promise.resolve()};e.prototype._setEyeDomeLightingBlurSamples=function(a){this._engine.setEyeDomeLightingBlurSamples(a)};e.prototype.getEyeDomeLightingBlurSamples=function(){return this._engine.getEyeDomeLightingBlurSamples()};e.prototype.setEyeDomeLightingBlurInterval=function(a){this._setEyeDomeLightingBlurInterval(a);return Promise.resolve()};e.prototype._setEyeDomeLightingBlurInterval=function(a){this._engine.setEyeDomeLightingBlurInterval(a)};e.prototype.getEyeDomeLightingBlurInterval=
function(){return this._engine.getEyeDomeLightingBlurInterval()};e.prototype.setEyeDomeLightingBlurEdgeDistance=function(a){this._setEyeDomeLightingBlurEdgeDistance(a);return Promise.resolve()};e.prototype._setEyeDomeLightingBlurEdgeDistance=function(a){this._engine.setEyeDomeLightingBlurEdgeDistance(a)};e.prototype.getEyeDomeLightingBlurEdgeDistance=function(){return this._engine.getEyeDomeLightingBlurEdgeDistance()};e.prototype.setEyeDomeLightingShadingEdgeDistance=function(a){this._setEyeDomeLightingShadingEdgeDistance(a);
return Promise.resolve()};e.prototype._setEyeDomeLightingShadingEdgeDistance=function(a){this._engine.setEyeDomeLightingShadingEdgeDistance(a)};e.prototype.getEyeDomeLightingShadingEdgeDistance=function(){return this._engine.getEyeDomeLightingShadingEdgeDistance()};e.prototype.setEyeDomeLightingOpacity=function(a){this._setEyeDomeLightingOpacity(a);return Promise.resolve()};e.prototype._setEyeDomeLightingOpacity=function(a){this._engine.setEyeDomeLightingOpacity(a)};e.prototype.getEyeDomeLightingOpacity=
function(){return this._engine.getEyeDomeLightingOpacity()};e.prototype.setBoundingCalculationIgnoresInvisible=function(a){this._boundingCalculationIgnoresInvisible=a};e.prototype.getBoundingCalculationIgnoresInvisible=function(){return this._boundingCalculationIgnoresInvisible};e.prototype.setDisplayIncompleteFrames=function(a){this._setDisplayIncompleteFrames(a);return Promise.resolve()};e.prototype._setDisplayIncompleteFrames=function(a){this._engine.setDisplayIncompleteFrames(a)};e.prototype.setInteractiveDrawDelay=
function(a){this._setInteractiveDrawDelay(a);return Promise.resolve()};e.prototype._setInteractiveDrawDelay=function(a){this._engine.setInteractiveDrawDelay(a)};e.prototype.getNavCube=function(){return this._navCube};e.prototype.getAxisTriad=function(){return this._axisTriad};e.prototype._determineViewAxes=function(e){var d=e.getUp().normalize();e=a.Point3.subtract(e.getTarget(),e.getPosition()).normalize();d=a.Internal.majorAxis(d);e=a.Internal.majorAxis(e);null===d&&null===e?(d=new a.Point3(0,1,
0),e=new a.Point3(0,0,1)):null===d?d=0===e.y?new a.Point3(0,1,0):new a.Point3(0,0,1):null===e&&(e=0===d.z?new a.Point3(0,0,1):new a.Point3(0,1,0));this._model.setViewAxes(e,d)};e.prototype.setAmbientLightColor=function(a){this._ambientLightColor=a;this._engine.setAmbientLightColor(a)};e.prototype.getAmbientLightColor=function(){return this._ambientLightColor};e.prototype.clearLights=function(){this._engine.clearLights()};e.prototype.addLight=function(a){this._engine.addLight(a)};e.prototype.setBloomEnabled=
function(a){void 0===a&&(a=!0);this._engine.setBloomEnabled(a);this._bloomEnabled=a};e.prototype.getBloomEnabled=function(){return this._bloomEnabled};e.prototype.setBloomThreshold=function(a){this._engine.setBloomThreshold(a);this._bloomThreshold=a};e.prototype.getBloomThreshold=function(){return this._bloomThreshold};e.prototype.setBloomThresholdRampWidth=function(a){this._engine.setBloomThresholdRampWidth(a);this._bloomThresholdRampWidth=a};e.prototype.getBloomThresholdRampWidth=function(){return this._bloomThresholdRampWidth};
e.prototype.setBloomIntensityScale=function(a){this._engine.setBloomIntensityScale(a);this._bloomIntensityScale=a};e.prototype.getBloomIntensityScale=function(){return this._bloomIntensityScale};e.prototype.setBloomLayers=function(e){e=a.Internal.deepClone(e);for(var d=0;d<e.length;d++){var c=e[d];void 0===c.intensity&&(c.intensity=1);void 0===c.blurSamples&&(c.blurSamples=9);void 0===c.blurInterval&&(c.blurInterval=[1,a.BlurIntervalUnit.Pixels])}this._engine.setBloomLayers(e);this._bloomLayers=e};
e.prototype.getBloomLayers=function(){return a.Internal.deepClone(this._bloomLayers)};e.prototype.startComparison=function(e,d,c){var b=this._model._getModelStructure();e=b.gatherInstanceIncsFromNodeIds(e,7,a.Internal.Tree.WalkRestriction.None);d=b.gatherInstanceIncsFromNodeIds(d,7,a.Internal.Tree.WalkRestriction.None);this._engine.startComparison(e,d,c)};e.prototype.endComparison=function(){this._engine.endComparison()};e.prototype.setSimpleShadowEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowEnabled=
a;this._engine.setSimpleShadowEnabled(a)};e.prototype.getSimpleShadowEnabled=function(){return this._simpleShadowEnabled};e.prototype.setSimpleShadowColor=function(a){this._simpleShadowColor=a.copy();this._engine.setSimpleShadowColor(a)};e.prototype.getSimpleShadowColor=function(){return this._simpleShadowColor.copy()};e.prototype.setSimpleShadowOpacity=function(a){this._simpleShadowOpacity=a;this._engine.setSimpleShadowOpacity(a)};e.prototype.getSimpleShadowOpacity=function(){return this._simpleShadowOpacity};
e.prototype.setGroundPlane=function(a){this._groundPlane=__assign({},a);this._updateGroundPlane()};e.prototype._updateGroundPlane=function(e,d){if(this._groundPlane.followViewAxes&&(void 0!==e&&void 0!==d||this._model.viewAxesHaveBeenSet())){if(void 0===e||void 0===d)d=this._model.getViewAxes(),e=d.frontVector,d=d.upVector;e=e.copy().negate();var c=a.Point3.cross(d,e);e=a.Matrix.createFromBasis(e,c,d);d=new a.Point3(0,0,0);e.transform(this._groundPlane.normal,d);this._engine.setGroundPlane(d,this._groundPlane.position)}else this._engine.setGroundPlane(this._groundPlane.normal,
this._groundPlane.position)};e.prototype.getGroundPlane=function(){return __assign({},this._groundPlane)};e.prototype.setSimpleShadowResolution=function(a){this._simpleShadowResolution=a;this._engine.setSimpleShadowResolution(a)};e.prototype.getSimpleShadowResolution=function(){return this._simpleShadowResolution};e.prototype.setSimpleShadowBlurSamples=function(a){this._simpleShadowBlurSamples=a;this._engine.setSimpleShadowBlurSamples(a)};e.prototype.getSimpleShadowBlurSamples=function(){return this._simpleShadowBlurSamples};
e.prototype.setSimpleShadowBlurInterval=function(a){this._simpleShadowBlurInterval=a;this._engine.setSimpleShadowBlurInterval(a)};e.prototype.getSimpleShadowBlurInterval=function(){return this._simpleShadowBlurInterval};e.prototype.setSimpleShadowInteractiveUpdateEnabled=function(a){void 0===a&&(a=!0);this._simpleShadowInteractiveUpdateEnabled=a;this._engine.setSimpleShadowInteractiveUpdateEnabled(a)};e.prototype.getSimpleShadowInteractiveUpdateEnabled=function(){return this._simpleShadowInteractiveUpdateEnabled};
e.prototype.setSilhouetteEnabled=function(a){void 0===a&&(a=!0);this._silhouetteEnabled=a;this._engine.setSilhouetteEnabled(a)};e.prototype.getSilhouetteEnabled=function(){return this._silhouetteEnabled};e.prototype.setSilhouetteColor=function(a){this._silhouetteColor=a.copy();this._engine.setSilhouetteColor(a)};e.prototype.getSilhouetteColor=function(){return this._silhouetteColor.copy()};e.prototype.setSilhouetteOpacity=function(a){this._silhouetteOpacity=a;this._engine.setSilhouetteOpacity(a)};
e.prototype.getSilhouetteOpacity=function(){return this._silhouetteOpacity};e.prototype.setSilhouetteThreshold=function(a){this._silhouetteThreshold=a;this._engine.setSilhouetteThreshold(a)};e.prototype.getSilhouetteThreshold=function(){return this._silhouetteThreshold};e.prototype.setSilhouetteThresholdRampWidth=function(a){this._silhouetteThresholdRampWidth=a;this._engine.setSilhouetteThresholdRampWidth(a)};e.prototype.getSilhouetteThresholdRampWidth=function(){return this._silhouetteThresholdRampWidth};
e.prototype.setSimpleReflectionEnabled=function(a){void 0===a&&(a=!0);this._simpleReflectionEnabled=a;this._engine.setSimpleReflectionEnabled(a)};e.prototype.getSimpleReflectionEnabled=function(){return this._simpleReflectionEnabled};e.prototype.setSimpleReflectionBlurInterval=function(e,d){void 0===d&&(d=a.BlurIntervalUnit.Pixels);this._simpleReflectionBlurInterval=[e,d];this._engine.setSimpleReflectionBlurInterval(e,d)};e.prototype.getSimpleReflectionBlurInterval=function(){return[this._simpleReflectionBlurInterval[0],
this._simpleReflectionBlurInterval[1]]};e.prototype.setSimpleReflectionBlurSamples=function(a){this._simpleReflectionBlurSamples=a;this._engine.setSimpleReflectionBlurSamples(a)};e.prototype.getSimpleReflectionBlurSamples=function(){return this._simpleReflectionBlurSamples};e.prototype.setSimpleReflectionFadeAngle=function(a){this._simpleReflectionFadeAngle=a;this._engine.setSimpleReflectionFadeAngle(a)};e.prototype.getSimpleReflectionFadeAngle=function(){return this._simpleReflectionFadeAngle};e.prototype.setSimpleReflectionOpacity=
function(a){this._simpleReflectionOpacity=a;this._engine.setSimpleReflectionOpacity(a)};e.prototype.getSimpleReflectionOpacity=function(){return this._simpleReflectionOpacity};e.prototype.setSimpleReflectionAttenuation=function(e,d,c){void 0===c&&(c=a.SimpleReflectionAttenuationUnit.World);this._simpleReflectionAttenuation={nearDistance:e,farDistance:d,unit:c};this._engine.setSimpleReflectionAttenuation(e,d,c)};e.prototype.getSimpleReflectionAttenuation=function(){return __assign({},this._simpleReflectionAttenuation)};
__decorate([e.deprecated],e.prototype,"endVolumeSelection",null);__decorate([e.deprecated],e.prototype,"advanceVolumeSelection",null);return e}();a.View=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(e){var d=this;this._callbackManager=new a.Internal.CallbackManager;this._interpolationManager=new a.Internal.InterpolationManager;this._streamingMode=a.StreamingMode.Interactive;this._rendererType=a.RendererType.Client;this._alreadyShutDown=!1;this._sceneReadyPromise=a.Util.OpenPromise.create();this._seenPriorityMetaDataSent=!1;this._params=__assign({},e);this._contextMenuActiveFlag=!1;if(void 0!==this._params.containerId){e=a.Internal.DomElements.createFromId(this._params.containerId);
if(null===e)throw new a.ParseError("'containerId' is invalid");this._domElements=e}else if(void 0!==this._params.container)this._domElements=a.Internal.DomElements.createFromElement(this._params.container);else throw new a.ParseError("must supply 'container' or 'containerId'");this.operatorManager=new a.OperatorManager(this);this._eventDispatcher=new a.Internal.EventDispatcher(this._callbackManager,this.operatorManager);this._timeoutMonitor=new a.Internal.TimeoutMonitor(this._callbackManager);this._inputMonitor=
new a.Internal.InputMonitor(this._eventDispatcher,this._timeoutMonitor);this._setInitialOptions(this._params);this._engine=new a.Internal.ScEngine(this._callbackManager,this._params);this._statistics=new a.Internal.Statistics(this._callbackManager,this);e=new a.NavCube(this);var c=new a.AxisTriad(this);this.model=new a.Model(this._engine,this._callbackManager);this.view=new a.View(this,this._engine,this._callbackManager,this._eventDispatcher,this._interpolationManager,this._statistics,e,c);this.cuttingManager=
new a.CuttingManager(this,this.model,this._callbackManager,this._engine);e={disableAutomaticFitWorld:a.Internal.getWithDefault(this._params.disableAutomaticFitWorld,!1),markImplicitNodesOutOfHierarchy:a.Internal.getWithDefault(this._params._markImplicitNodesOutOfHierarchy,!0),streamingMode:a.Internal.getWithDefault(this._params.streamingMode,a.StreamingMode.Default)};this._modelStructure=a.Internal.Tree.ModelStructure.unsafeCreate(e,this._engine,this._callbackManager,this.cuttingManager,this.view,
this.model,this._params._maxConcurrentAttachments||null);this.model._setModelStructure(this._modelStructure);this.measureManager=new a.MeasureManager(this,this._callbackManager);this.lineManager=new a.LineManager(this,this._callbackManager);this.explodeManager=new a.ExplodeManager(this.model,this._engine,this._callbackManager);this.overlayManager=new a.OverlayManager(this,this._engine);this.BCFManager=new a.BCFManager(this);this.selectionManager=new a.SelectionManager(this._callbackManager,this._engine,
this.view,this.model,this._modelStructure);e=a.Internal.getWithDefault(this._params.disableAutomaticBackgroundSheets,!1);this._sheetManager=new a.Internal.SheetManager(this,this._engine,this._callbackManager,e);this._noteTextManager=new a.Internal.NoteTextManager(this);this.markupManager=new a.MarkupManager(this._domElements,this.measureManager,this.lineManager,this._callbackManager,this._sheetManager,this._noteTextManager,this);this.view._setMarkupManager(this.markupManager);this._initEventDispatcher();
var b=function(b){if(!d.isDrawingSheetActive()){var c=[];d.model._setInstanceModifier(a.InstanceModifier.OverrideSceneVisibility,b,!0,6);for(var g=0;g<b.length;g++)c.push(d.model.setPmiColorOverride(!0,b[g]));return a.Util.waitForAll(c)}return Promise.resolve()},g=function(b){return __awaiter(d,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return b?[4,Promise.all([this.view.setPointSize(.003,a.PointSizeUnit.ProportionOfBoundingDiagonal),this.view.setEyeDomeLightingEnabled(!0),
this.view.setPointShape(a.PointShape.Disk)])]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,Promise.all([this.view.setPointSize(1,a.PointSizeUnit.ScreenPixels),this.view.setEyeDomeLightingEnabled(!1),this.view.setPointShape(a.PointShape.Square)])];case 3:c.sent(),c.label=4;case 4:return[2]}})})},l=function(b){return __awaiter(d,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return c=this.model.getModelFileTypeFromNode(b[0]),null===c||c===a.FileType.Unknown?
[3,2]:[4,g(!1)];case 1:d.sent(),d.label=2;case 2:return[2]}})})},v=function(b){var c=[];if(d.model.getModelFileTypeFromNode(b[0])===a.FileType.Ifc)for(var g=0;g<b.length;g++){var l=d.model.registerIfcNodes(b[g]);c.push(l)}return a.Util.waitForAll(c)},p=function(b){d.model.getModelFileTypeFromNode(b[0])===a.FileType.Ifc?d.selectionManager.setSelectionFilter(a.SelectionManager.ifcSelectionFilter):d.selectionManager.setSelectionFilter(null)};this.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(d,
void 0,void 0,function(){return __generator(this,function(b){d.model.setPmiColor(a.Color.black());return[2]})})},_sessionStarted:function(){return g(!0)},_firstModelLoaded:function(c){return __awaiter(d,void 0,void 0,function(){return __generator(this,function(g){d.model.setPmiColor(a.Color.black());p(c);return[2,a.Util.waitForAll([v(c),b([this.model.getAbsoluteRootNode()]),l(c)])]})})},_modelSwitched:function(c,g){p(g);return a.Util.waitForAll([v(g),b(g),l(g)])},_subtreeLoaded:function(c){return __awaiter(d,
void 0,void 0,function(){return __generator(this,function(g){return[2,a.Util.waitForAll([v(c),b(c)])]})})},subtreeLoaded:function(a,b){d._callbackManager.trigger("modelLoaded",a,b)}})}e.deprecated=function(a,d,c){a;var b=c.value;c.value=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._callbackManager.trigger("deprecated","WebViewer",d);return b.apply(this,a)};return c};e.prototype.setContextMenuStatus=function(a){this._contextMenuActiveFlag=a};e.prototype.getContextMenuStatus=
function(){return this._contextMenuActiveFlag};e.prototype.deactivateSheets=function(){return this._sheetManager.deactivateSheets()};e.prototype.setActiveSheetId=function(a){return this._sheetManager.setActiveSheetId(a,!0,!0)};e.prototype.getActiveSheetId=function(){return this._sheetManager.getActiveSheetId()};e.prototype.getSheetIds=function(){return this._sheetManager.getSheets()};e.prototype.isDrawingSheetActive=function(){return this.model.isDrawing()?this._sheetManager.isDrawingSheetActive():
!1};e.prototype.enableBackgroundSheet=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._sheetManager.setBackgroundSheetEnabled(a)]})})};e.prototype.setBackgroundSheetEnabled=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._sheetManager.setBackgroundSheetEnabled(a)]})})};e.prototype.getBackgroundSheetEnabled=function(){return this._sheetManager.getBackgroundSheetEnabled()};e.prototype.setBackgroundSelectionEnabled=
function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){return[2,this._sheetManager.setBackgroundSelectionEnabled(a)]})})};e.prototype.getBackgroundSelectionEnabled=function(){return this._sheetManager.getBackgroundSelectionEnabled()};e.prototype.setSheetColors=function(a,d,c){return this._sheetManager.setSheetColors(a,d,c)};e.prototype.getSheetBackgroundColor=function(){return this._sheetManager.getSheetBackgroundColor()};e.prototype.getSheetColor=function(){return this._sheetManager.getSheetColor()};
e.prototype.getSheetShadowColor=function(){return this._sheetManager.getSheetShadowColor()};e.prototype.getCreationParameters=function(){return __assign({},this._params)};e.prototype._setInitialOptions=function(a){this._inputMonitor.setOptions(a);void 0!==a.streamingMode?this._streamingMode=a.streamingMode:a.streamingMode=this._streamingMode;void 0!==a.rendererType?this._rendererType=a.rendererType:a.rendererType=this._rendererType};e.prototype._initEventDispatcher=function(){var e=new a.Operator.CameraOrbitOperator(this),
d=new a.Operator.CameraPanOperator(this),c=new a.Operator.CameraZoomOperator(this),b=new a.Operator.CameraNavigationOperator(this,e,d,c),g=new a.Operator.CameraWalkOperator(this),l=new a.Operator.CameraKeyboardWalkOperator(this),v=new a.Operator.CameraWalkModeOperator(this,g,l),p=new a.Operator.CameraTurntableOperator(this),k=new a.Operator.SelectionOperator(this,this._noteTextManager),h=new a.Operator.AreaSelectionOperator(this),m=new a.Operator.RayDrillSelectionOperator(this),n=new a.Operator.RedlineCircleOperator(this),
q=new a.Operator.RedlineTextOperator(this),t=new a.Operator.RedlineRectangleOperator(this),u=new a.Operator.RedlinePolylineOperator(this),w=new a.Operator.MeasureEdgeLengthOperator(this,this.measureManager),z=new a.Operator.MeasureFaceFaceDistanceOperator(this,this.measureManager),y=new a.Operator.MeasurePointPointDistanceOperator(this,this.measureManager),x=new a.Operator.MeasureFaceFaceAngleOperator(this,this.measureManager),A=new a.Operator.NoteOperator(this,this._noteTextManager),B=new a.Operator.CuttingPlaneOperator(this,
this.cuttingManager),C=new a.Operator.HandleOperator(this),D=new a.Operator.NavCubeOperator(this),G=new a.Operator.AxisTriadOperator(this);this.operatorManager._registerOperator(a.OperatorId.Navigate,b);this.operatorManager._registerOperator(a.OperatorId.Orbit,e);this.operatorManager._registerOperator(a.OperatorId.Pan,d);this.operatorManager._registerOperator(a.OperatorId.Zoom,c);this.operatorManager._registerOperator(a.OperatorId.Walk,g);this.operatorManager._registerOperator(a.OperatorId.KeyboardWalk,
l);this.operatorManager._registerOperator(a.OperatorId.WalkMode,v);this.operatorManager._registerOperator(a.OperatorId.Turntable,p);this.operatorManager._registerOperator(a.OperatorId.Select,k);this.operatorManager._registerOperator(a.OperatorId.AreaSelect,h);this.operatorManager._registerOperator(a.OperatorId.RayDrillSelect,m);this.operatorManager._registerOperator(a.OperatorId.RedlineCircle,n);this.operatorManager._registerOperator(a.OperatorId.RedlineText,q);this.operatorManager._registerOperator(a.OperatorId.RedlineRectangle,
t);this.operatorManager._registerOperator(a.OperatorId.RedlinePolyline,u);this.operatorManager._registerOperator(a.OperatorId.MeasureEdgeLength,w);this.operatorManager._registerOperator(a.OperatorId.MeasureFaceFaceDistance,z);this.operatorManager._registerOperator(a.OperatorId.MeasurePointPointDistance,y);this.operatorManager._registerOperator(a.OperatorId.MeasureFaceFaceAngle,x);this.operatorManager._registerOperator(a.OperatorId.Note,A);this.operatorManager._registerOperator(a.OperatorId.Cutting,
B);this.operatorManager._registerOperator(a.OperatorId.Handle,C);this.operatorManager._registerOperator(a.OperatorId.NavCube,D);this.operatorManager._registerOperator(a.OperatorId.AxisTriad,G);e.addMapping(a.Button.Left);e.addMapping(a.Button.Middle);c.addMapping(a.Button.Left,a.KeyModifiers.Shift);d.addMapping(a.Button.Right);d.addMapping(a.Button.Left,a.KeyModifiers.Control);w.addMapping(a.Button.Left);z.addMapping(a.Button.Left);y.addMapping(a.Button.Left);y.addMapping(a.Button.Left,a.KeyModifiers.Alt);
x.addMapping(a.Button.Left);B.addMapping(a.Button.Left);h.addMapping(a.Button.Left);h.addMapping(a.Button.Left,a.KeyModifiers.Control);this.operatorManager.set(a.OperatorId.Navigate,0);this.operatorManager.set(a.OperatorId.Select,1);this.operatorManager.push(a.OperatorId.Cutting);this.operatorManager.push(a.OperatorId.Handle);this.operatorManager.push(a.OperatorId.NavCube);this.operatorManager.push(a.OperatorId.AxisTriad)};e.prototype.getViewerVersionString=function(){return e.VIEWER_VERSION_STRING};
e.prototype.getFormatVersionString=function(){return this._engine.getVersionString()};e.prototype.getView=function(){return this.view};e.prototype.getModel=function(){return this.model};e.prototype.getOverlayManager=function(){return this.overlayManager};e.prototype.getMeasureManager=function(){return this.measureManager};e.prototype.getLineManager=function(){return this.lineManager};e.prototype.getCuttingManager=function(){return this.cuttingManager};e.prototype.getMarkupManager=function(){return this.markupManager};
e.prototype.getSelectionManager=function(){return this.selectionManager};e.prototype.getExplodeManager=function(){return this.explodeManager};e.prototype.getOperatorManager=function(){return this.operatorManager};e.prototype._getNoteTextManager=function(){return this._noteTextManager};e.prototype._getSheetManager=function(){return this._sheetManager};e.prototype.start=function(){var a=this,d=this._domElements.getCanvasContainerElement();return this._engine.start(d,{enginePath:this._params.enginePath,
engineReady:function(c){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,c];case 1:return a.sent(),[4,this._modelStructure.waitForReady()];case 2:return a.sent(),this._scEngineReady(),[2]}})})},sceneReady:function(){a._sceneReady()},renderComplete:function(){a._renderComplete()},streamingActivated:function(){a._streamingActivated()},streamingDeactivated:function(){a._streamingDeactivated()},priorityMetaDataSent:function(c,b){a._priorityMetaDataSent(c,
b)}})};e.prototype.registerCustomOperator=function(a){return this.operatorManager.registerCustomOperator(a)};e.prototype.unregisterCustomOperator=function(a){this.operatorManager.unregisterCustomOperator(a)};e.prototype.focusInput=function(a){this._inputMonitor.focusInput(a)};e.prototype.setCallbacks=function(a){this._callbackManager.bind(a)};e.prototype.unsetCallbacks=function(a){this._callbackManager.unbind(a)};e.prototype.resizeCanvas=function(){this._alreadyShutDown||(this._engine.resize(),this._inputMonitor.elementResize())};
e.prototype.moveToWindow=function(a){this._inputMonitor.setDocument(a.document)};e.prototype.redraw=function(a){var d=this;if(a){var c=function(){d._callbackManager.unbind({_drawComplete:c});a()};this._callbackManager.bind({_drawComplete:c})}this._engine.redraw()};e.prototype.selectPart=function(e,d){void 0===d&&(d=a.SelectionMode.Set);return this.selectionManager.selectNode(e,d)};e.prototype.trigger=function(a){for(var d=[],c=1;c<arguments.length;c++)d[c-1]=arguments[c];this._callbackManager.unsafeTrigger(a,
d)};e.prototype.triggerEvent=function(a,d){this._callbackManager.unsafeTrigger(a,d)};e.prototype._getCallbackManager=function(){return this._callbackManager};e.prototype._setStreamIdleMarker=function(){return this._engine.setStreamIdleMarker()};e.prototype.getStatistics=function(a){void 0===a&&(a=!1);return this._engine.getStatistics(a)};e.prototype.setMinimumFramerate=function(a){this._setMinimumFramerate(a);return Promise.resolve()};e.prototype._setMinimumFramerate=function(a){this._engine.setMinimumFramerate(a)};
e.prototype.getMinimumFramerate=function(){return this._engine.getMinimumFramerate()};e.prototype.setServerRenderQuality=function(a,d,c,b){return this._engine.setServerRenderQuality(a,d,c,b)};e.prototype.getStreamingMode=function(){return this._streamingMode};e.prototype.getRendererType=function(){return this._engine.getRendererType()};e.prototype.getViewElement=function(){return this._domElements.getCanvasContainerElement()};e.prototype.shutdown=function(){this._alreadyShutDown||(console.assert(this._modelStructure.isReady()),
this._callbackManager.trigger("_shutdownBegin"),this.operatorManager._shutdown(),this._inputMonitor.shutdown(),this.markupManager._shutdown(),this._timeoutMonitor.shutdown(),this._modelStructure.shutdown(),this._domElements.shutdown(),this._engine.shutdown(),this._alreadyShutDown=!0)};e.prototype.setClientTimeout=function(a,d){return this._timeoutMonitor.setTimeoutDurations(a,d)};e.prototype.resetClientTimeout=function(){this._timeoutMonitor.resetTimeout()};e.prototype.pauseRendering=function(){this._pauseRendering();
return Promise.resolve()};e.prototype._pauseRendering=function(){this._engine.pauseRendering()};e.prototype.resumeRendering=function(){this._resumeRendering();return Promise.resolve()};e.prototype._resumeRendering=function(){this._engine.resumeRendering()};e.prototype.delayCapping=function(){this.cuttingManager.delayCapping()};e.prototype.reset=function(e){void 0===e&&(e=a.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===
this.model.getDefaultCadConfiguration()?[3,2]:[4,this.model.activateDefaultCadConfiguration()];case 1:return a.sent(),[3,5];case 2:return[4,this.model.reset()];case 3:return a.sent(),[4,this.view.resetCamera(e)];case 4:a.sent(),a.label=5;case 5:return[2]}})})};e.prototype.closeConnection=function(){this.view.setCamera(this.view.getCamera());this._engine.disconnectNetwork()&&this._timeoutMonitor.shutdown()};e.prototype.setAllowHighDpi=function(a){this._engine.setAllowHighDpi(a)};e.prototype.setAllowHighDPI=
function(a){this.setAllowHighDpi(a)};e.prototype.getAllowHighDpi=function(){return this._engine.getAllowHighDpi()};e.prototype.getAllowHighDPI=function(){return this.getAllowHighDpi()};e.prototype.takeSnapshot=function(e){var d=this;void 0===e&&(e=new a.SnapshotConfig);var c=a.Util.OpenPromise.create(),b=new a.Internal.Snapshot(this._domElements,e),g=this._domElements.getCanvasContainerElement(),l=this._domElements.getRedlineElement(),v=0<e.width&&0<e.height;if(v){var p=e.width/g.clientWidth*100+
"%";e=e.height/g.clientHeight*100+"%";g.style.width=p;g.style.height=e;l.style.width=p;l.style.height=e}var k=this.getAllowHighDpi();this._engine.setAllowHighDpi(!1);this._engine.resize();this.redraw(function(){return __awaiter(d,void 0,void 0,function(){var a;return __generator(this,function(d){switch(d.label){case 0:return[4,b.capture(g)];case 1:return a=d.sent(),v&&(g.style.width="100%",g.style.height="100%",l.style.width="100%",l.style.height="100%"),this._engine.setAllowHighDpi(k),this._engine.resize(),
c.resolve(a),[2]}})})});return c};e.prototype.fitWorld=function(e){void 0===e&&(e=a.DefaultTransitionDuration);return this.view.fitWorld(e)};e.prototype.setViewOrientation=function(e,d){void 0===d&&(d=a.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.view.setViewOrientation(e,d)];case 1:return a.sent(),this._eventDispatcher.injectViewOrientationChangeEvent(),[2]}})})};e.prototype._scEngineReady=function(){return __awaiter(this,
void 0,void 0,function(){var e=this,d,c,b,g,l,v;return __generator(this,function(p){switch(p.label){case 0:console.assert(this._modelStructure.isReady()),d=this.model.getAbsoluteRootNode(),c=this._engine.getSessionType(),p.label=1;case 1:return p.trys.push([1,,18,19]),[4,Promise.all([this.cuttingManager._init(),this._sceneReadyPromise])];case 2:return p.sent(),[4,this._callbackManager.promiseTrigger("_assemblyTreeReady","assemblyTreeReady")];case 3:p.sent(),b=function(){e._modelStructure.notifyFirstLoadIsEmptyModel()},
g="",p.label=4;case 4:p.trys.push([4,16,,17]);if(1!==c)return[3,8];g=this._engine.getNetworkModelName();if(g!==a.EmptyModelName)return[3,5];b();return[3,7];case 5:return[4,this.model.loadSubtreeFromModel(d,g)];case 6:p.sent(),p.label=7;case 7:return[3,15];case 8:if(2!==c)return[3,14];this._timeoutMonitor.shutdown();l=this._engine.getScsInfo();return"string"!==typeof l?[3,10]:[4,this.model.loadSubtreeFromScsFile(d,l)];case 9:return p.sent(),[3,13];case 10:return null===l?[3,12]:[4,this.model.loadSubtreeFromScsBuffer(d,
l)];case 11:return p.sent(),[3,13];case 12:b(),p.label=13;case 13:return[3,15];case 14:throw new a.InternalLogicError;case 15:return[3,17];case 16:throw v=p.sent(),this._callbackManager.trigger("modelLoadFailure",g,""+v,v),v;case 17:return[3,19];case 18:return console.assert(this._modelStructure.isReady()),[2,this._callbackManager.promiseTrigger("_modelStructureReady","modelStructureReady")];case 19:return[2]}})})};e.prototype._sceneReady=function(){var a=this;this._inputMonitor.bindEvents(this._domElements.getCanvasContainerElement());
this.selectionManager._init();this._callbackManager.bind({_timeout:function(){a.shutdown()}});this._callbackManager.trigger("sceneReady");this._sceneReadyPromise&&this._sceneReadyPromise.resolve()};e.prototype._priorityMetaDataSent=function(e,d){this._callbackManager.trigger("_priorityMetaDataSent",e,d);if(!this._seenPriorityMetaDataSent){if(0!==e||0!==d)throw new a.InternalLogicError;this._seenPriorityMetaDataSent=!0;this._callbackManager.trigger("_attached",0)}};e.prototype._renderComplete=function(){this.markupManager._update();
this._callbackManager.trigger("frameDrawn")};e.prototype._streamingActivated=function(){this._callbackManager.trigger("streamingActivated")};e.prototype._streamingDeactivated=function(){this._callbackManager.trigger("streamingDeactivated")};e.prototype.setStreamCutoffScale=function(a){this._setStreamCutoffScale(a);return Promise.resolve()};e.prototype._setStreamCutoffScale=function(a){this._engine.setStreamCutoffScale(a)};e.prototype.getStreamCutoffScale=function(){return this._engine.getStreamCutoffScale()};
e.prototype._loseWebGlContext=function(){return this._engine.loseWebGlContext()};e.prototype._getScEngine=function(){return this._engine};e.prototype._debug_log=function(a){return this._engine.debug_log(a)};e.prototype._debug_stateFailure=function(a){return this._engine.debug_stateFailure(a)};e.prototype._debug_sync=function(){return this._engine.debug_sync()};e.prototype.exportToSvg=function(e){void 0===e&&(e=new a.SvgConfig);return this._engine.exportToSvg(e)};e.prototype.waitForIdle=function(){return __awaiter(this,
void 0,void 0,function(){var e,d,c;return __generator(this,function(b){switch(b.label){case 0:return this._alreadyShutDown?[2]:[4,this._setStreamIdleMarker()];case 1:return b.sent(),e=[],this.cuttingManager.hasActiveCuttingSection()?[4,this.cuttingManager.enableCappingIdleCallback(!0)]:[3,3];case 2:(d=b.sent())||e.push(this.cuttingManager.waitForCappingIdle()),b.label=3;case 3:return e.push(this._engine.waitForImageDecoding()),[4,Promise.all(e)];case 4:return b.sent(),c=a.Util.OpenPromise.create(),
this.redraw(function(){c.resolve()}),[4,c];case 5:return b.sent(),[2]}})})};e.prototype.startSheetComparison=function(a,d,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return[4,this._sheetManager.startComparison(a,d,c)];case 1:return b.sent(),[2]}})})};e.prototype.endSheetComparison=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._sheetManager.endComparison()];
case 1:return a.sent(),[2]}})})};e.BUILD_ID="767b34c";e.VIEWER_VERSION_STRING="7.2 Build "+e.BUILD_ID;__decorate([e.deprecated],e.prototype,"enableBackgroundSheet",null);__decorate([e.deprecated],e.prototype,"getView",null);__decorate([e.deprecated],e.prototype,"getModel",null);__decorate([e.deprecated],e.prototype,"getOverlayManager",null);__decorate([e.deprecated],e.prototype,"getMeasureManager",null);__decorate([e.deprecated],e.prototype,"getLineManager",null);__decorate([e.deprecated],e.prototype,
"getCuttingManager",null);__decorate([e.deprecated],e.prototype,"getMarkupManager",null);__decorate([e.deprecated],e.prototype,"getSelectionManager",null);__decorate([e.deprecated],e.prototype,"getExplodeManager",null);__decorate([e.deprecated],e.prototype,"getOperatorManager",null);__decorate([e.deprecated],e.prototype,"setAllowHighDPI",null);__decorate([e.deprecated],e.prototype,"getAllowHighDPI",null);return e}();a.WebViewer=h})(Communicator||(Communicator={}));
(function(a){(function(h){function e(a){for(var b=2*Math.PI/a,g=[],d=0;d<a;d++){var e=d*b,f=Math.sin(e);g.push(Math.cos(e));g.push(f)}return g}function f(c,b,g,d){void 0===d&&(d=1);var e=a.Point3.cross(g,new a.Point3(0,1,0));.001>e.length()&&(e=a.Point3.cross(g,new a.Point3(0,0,1)));g=a.Point3.cross(e,g);for(var f=2*Math.PI/c,k=[],h=0;h<c;h++){var m=h*f,n=Math.sin(m),m=Math.cos(m),n=e.copy().scale(n).add(g.copy().scale(m)).scale(d).add(b);k.push(n)}return k}function d(c,b,g,d,e){for(var f=[],k=[],
h=0;h<g.length;h++){var m=(h+1)%g.length;f.push(g[h]);f.push(g[m]);f.push(d[h]);f.push(g[m]);f.push(d[m]);f.push(d[h]);k.push(a.Point3.subtract(g[h],c));k.push(a.Point3.subtract(g[m],c));k.push(a.Point3.subtract(d[h],b));k.push(a.Point3.subtract(g[m],c));k.push(a.Point3.subtract(d[m],b));k.push(a.Point3.subtract(d[h],b))}if(e)for(c=a.Point3.subtract(c,b),b=0;b<k.length;b++)k[b].add(c).normalize();return[f,k]}h.generateSphereMeshData=function(){var c=(1+Math.sqrt(5))/2,b=Math.sqrt(10+2*Math.sqrt(5))/
(4*c),g=b/2,c=b/(2*c),d=[];d[0]=new a.Point3(-c,g,0);d[1]=new a.Point3(c,g,0);d[2]=new a.Point3(-c,-g,0);d[3]=new a.Point3(c,-g,0);d[4]=new a.Point3(0,-c,g);d[5]=new a.Point3(0,c,g);d[6]=new a.Point3(0,-c,-g);d[7]=new a.Point3(0,c,-g);d[8]=new a.Point3(g,0,-c);d[9]=new a.Point3(g,0,c);d[10]=new a.Point3(-g,0,-c);d[11]=new a.Point3(-g,0,c);for(g=0;g<d.length;g++)d[g].normalize();for(var e=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,
6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],f=12,g=function(b){var c=[];e.map(function(b){var g=d[b[0]],e=d[b[1]],v=d[b[2]];d[f++]=(new a.Point3(g.x+e.x,g.y+e.y,g.z+e.z)).scale(.5).normalize();d[f++]=(new a.Point3(e.x+v.x,e.y+v.y,e.z+v.z)).scale(.5).normalize();d[f++]=(new a.Point3(v.x+g.x,v.y+g.y,v.z+g.z)).scale(.5).normalize();c.push([b[0],f-3,f-1]);c.push([f-3,f-2,f-1]);c.push([f-3,b[1],f-2]);c.push([f-2,b[2],f-1])});e=c},c=0;2>c;c++)g(c);for(var g=[],c=[],b=0,k=e;b<k.length;b++)for(var h=
k[b],m=0;3>m;m++){var n=h[m];g.push(d[n].x);g.push(d[n].y);g.push(d[n].z);n=d[n].normalize();c.push(n.x);c.push(n.y);c.push(n.z)}b=new a.MeshData;b.addFaces(g,c);b.setFaceWinding(a.FaceWinding.CounterClockwise);return b};h.generateConeCylinderMeshData=function(c,b,g,l,v,p){var k=new a.Matrix,h,m=g+p,n=e(b);for(h=0;h<n.length;h++)n[h]*=l;v=new a.Point3(0,m+v,0);h=new a.Point3(0,m,0);var q=k.transform(v),t=k.transform(h);v=[];var u=[];for(h=0;h<n.length;h+=2){var w=n[h],z=n[h+1],y=(h+2)%n.length,x=
n[y],A=n[y+1],B=n[h],C=n[h+1],D=n[y],y=n[y+1],G=new a.Point3(w,m,z),E=new a.Point3(x,m,A),G=k.transform(G),E=k.transform(E);v.push(q);v.push(G);v.push(E);E=new a.Point3(0,1,0);B=new a.Point3(B,0,C);D=new a.Point3(D,0,y);C=k.transform(E);B=k.transform(B);D=k.transform(D);u.push(C);u.push(B);u.push(D);w=new a.Point3(w,m,z);x=new a.Point3(x,m,A);A=k.transform(w);x=k.transform(x);v.push(t);v.push(x);v.push(A);x=new a.Point3(0,-1,0);x=k.transform(x);u.push(x);u.push(x);u.push(x)}m=[];n=[];for(h=0;h<v.length;h++)q=
v[h],m.push(q.x),m.push(q.y),m.push(q.z),q=u[h],n.push(q.x),n.push(q.y),n.push(q.z);h=[m,n];v=[];u=[];n=e(b);for(m=0;m<n.length;m++)n[m]*=c;q=[];t=[];for(m=0;m<n.length;m+=2){x=n[m];A=n[m+1];y=(m+2)%n.length;w=n[y];z=n[y+1];D=n[m];B=n[m+1];C=n[y];y=n[y+1];q[0]=new a.Point3(x,g,A);q[1]=new a.Point3(x,0,A);q[2]=new a.Point3(w,0,z);q[3]=new a.Point3(w,0,z);q[4]=new a.Point3(w,g,z);q[5]=new a.Point3(x,g,A);t[0]=new a.Point3(D,0,B);t[1]=new a.Point3(D,0,B);t[2]=new a.Point3(C,0,y);t[3]=new a.Point3(C,
0,y);t[4]=new a.Point3(C,0,y);t[5]=new a.Point3(D,0,B);for(D=0;D<q.length;D++)B=k.transform(q[D]),v.push(B),B=k.transform(t[D]),u.push(B);q[0]=new a.Point3(w,0,z);q[1]=new a.Point3(x,0,A);q[2]=a.Point3.zero();t[0]=new a.Point3(0,-1,0);t[1]=new a.Point3(0,-1,0);t[2]=new a.Point3(0,-1,0);for(D=0;3>D;D++)B=k.transform(q[D]),v.push(B),B=k.transform(t[D]),u.push(B)}k=[];n=[];for(m=0;m<v.length;m++)q=v[m],k.push(q.x),k.push(q.y),k.push(q.z),q=u[m],n.push(q.x),n.push(q.y),n.push(q.z);k=[k,n];v=new a.Point3(0,
0,g);g=new a.Point3(0,0,g+p);p=new a.Point3(0,0,1);c=f(b,v,p,c);b=f(b,g,p,l);b=d(v,g,c,b,!0);l=[];c=[];for(g=0;g<b[0].length;g++)l.push(b[0][g].x),l.push(b[0][g].z),l.push(b[0][g].y),c.push(b[1][g].x),c.push(b[1][g].z),c.push(b[1][g].y);l=[l,c];b=h[0].concat(k[0]).concat(l[0]);l=h[1].concat(k[1]).concat(l[1]);c=new a.MeshData;c.setFaceWinding(a.FaceWinding.Clockwise);c.addFaces(b,l);return c};h.createCylinderMeshDataFromArc=function(c,b,g,l){for(var e=[],p=[],k,h=0;h<c.length-3;h+=3){var m=new a.Point3(c[h],
c[h+1],c[h+2]),n=new a.Point3(c[h+3],c[h+4],c[h+5]),q=f(g,m,b,l),t=f(g,n,b,l);k=d(m,n,q,t,!1);Array.prototype.push.apply(e,k[0]);Array.prototype.push.apply(p,k[1])}m=c.length;h=new a.Point3(c[m-3],c[m-2],c[m-1]);t=h.copy().subtract(new a.Point3(c[m-6],c[m-5],c[m-4])).normalize();m=f(2*g,h,b,l);n=h.copy().add(t.copy().scale(2/3));q=f(2*g,n,b,2*l);t=n.copy().add(t.copy().scale(2));k=d(h,n,m,q,!1);Array.prototype.push.apply(e,k[0]);Array.prototype.push.apply(p,k[1]);for(h=0;h<m.length;h++)k=(h+1)%m.length,
e.push(t),e.push(q[h]),e.push(q[k]),k=q[h].copy().subtract(n).normalize().add(t.copy().normalize()).normalize(),p.push(k),p.push(k),p.push(k);h=new a.Point3(c[0],c[1],c[2]);t=h.copy().subtract(new a.Point3(c[3],c[4],c[5])).normalize();m=f(2*g,h,b,l);n=h.copy().add(t.copy().scale(2/3));q=f(2*g,n,b,2*l);t=n.copy().add(t.copy().scale(2));k=d(n,h,q,m,!1);Array.prototype.push.apply(e,k[0]);Array.prototype.push.apply(p,k[1]);for(h=0;h<m.length;h++)k=(h+1)%m.length,e.push(t),e.push(q[k]),e.push(q[h]),k=
q[h].copy().subtract(n).normalize().add(t.copy().normalize()).normalize(),p.push(k),p.push(k),p.push(k);c=[];b=[];for(h=0;h<e.length;h++)g=e[h],c.push(g.x),c.push(g.y),c.push(g.z),k=p[h],b.push(k.x),b.push(k.y),b.push(k.z);e=new a.MeshData;e.setFaceWinding(a.FaceWinding.CounterClockwise);e.addFaces(c,b);return e}})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(d,c){this._mode=d;this._impl=new a.Internal.IncrementalSelectionImpl(c)}e.create=function(a,c){return new e(a,c)};e.prototype.performSelection=function(a,c,b){var g=this._impl.viewer;"View"===this._mode?(g=g.view,void 0===b&&(b=[])):(h.TypeAssert(this._mode),g=g.selectionManager);void 0===c&&(c=null);return this._impl.performSelection(g,a,c,b)};e.prototype.isIdle=function(){return this._impl.isIdle()};e.prototype.waitForIdle=function(){return this._impl.waitForIdle()};
e.prototype.stopSelection=function(){return this._impl.stopSelection()};e.prototype.clearSelection=function(){return this._impl.clearSelection()};return e}();h.IncrementalSelection=e;(function(a){a.isScreenByAreaConfig=function(a){return"areaCssMin"in a};a.isRayDrillConfig=function(a){return"rayCssBoxRadius"in a};a.isConvexPolyhedronConfig=function(a){return"volumePlanes"in a};a.isSphereConfig=function(a){return"sphereRadius"in a}})(e=h.IncrementalSelection||(h.IncrementalSelection={}))})(a.Util||
(a.Util={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(a){this._killHandles=[];this._activeSelectionCount=0;this._inactivityPromise=null;this.viewer=a}e.prototype.isIdle=function(){return 0===this._activeSelectionCount};e.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){if(0===this._activeSelectionCount)return console.assert(null===this._inactivityPromise),[2,Promise.resolve()];null===this._inactivityPromise&&(this._inactivityPromise=
h.OpenPromise.create());return[2,this._inactivityPromise]})})};e.prototype.stopSelection=function(){return __awaiter(this,void 0,void 0,function(){var d,c,b,g;return __generator(this,function(l){console.assert(this._killHandles.length===this._activeSelectionCount);d=[];c=0;for(b=this._killHandles;c<b.length;c++)g=b[c],d.push(g());return[2,a.Util.waitForAll(d)]})})};e.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=
this.viewer.selectionManager,a.clear(),[4,this.stopSelection()];case 1:return c.sent(),a.clear(),[2]}})})};e.prototype._advanceBySelectionManager=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){b=this.viewer.selectionManager;return[2,b.advanceIncrementalSelection(a,c)]})})};e.prototype._advanceByView=function(a,c,b){return __awaiter(this,void 0,void 0,function(){var g,l,e,f,k,h;return __generator(this,function(m){switch(m.label){case 0:return g=
this.viewer.view,[4,g.advanceIncrementalSelection(a)];case 1:return l=m.sent(),null===l?[2,!1]:c?[4,Promise.all(l.map(c))]:[3,3];case 2:e=m.sent(),l=l.filter(function(a,b){return e[b]}),m.label=3;case 3:f=0;for(k=l;f<k.length;f++)h=k[f],b.push(h);return[2,!0]}})})};e.prototype._wrapBeginSelection=function(d,c){return a.Util.IncrementalSelection.isScreenByAreaConfig(c)?d.beginScreenSelectByArea(c.areaCssMin,c.areaCssMax,c.pickConfig):a.Util.IncrementalSelection.isRayDrillConfig(c)?d.beginRayDrillSelection(c.rayCssOrigin,
c.rayCssBoxRadius,c.pickConfig):a.Util.IncrementalSelection.isConvexPolyhedronConfig(c)?d.beginConvexPolyhedronSelection(c.volumePlanes,c.heuristicOrigin,c.pickConfig):a.Util.IncrementalSelection.isSphereConfig(c)?d.beginSphereSelection(c.sphereCenter,c.sphereRadius,c.pickConfig):a.Util.TypeAssertNever(c)};e.prototype.performSelection=function(a,c,b,g){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(l){switch(l.label){case 0:return void 0!==g?[3,1]:[2,this._performSelection(a,
c,b,null)];case 1:return[4,this._performSelection(a,c,b,g)];case 2:return l.sent(),[2,g]}})})};e.prototype._performSelection=function(a,c,b,g){return __awaiter(this,void 0,void 0,function(){var l=this,e,f,k,r,m,n,q,t;return __generator(this,function(u){switch(u.label){case 0:e=this._wrapBeginSelection(a,c);if(null===e)return[2];++this._activeSelectionCount;f=this.viewer.selectionManager;k=null===g;r=!1;m=h.Lazy.create(function(){return __awaiter(l,void 0,void 0,function(){var a,b;return __generator(this,
function(c){switch(c.label){case 0:r=!0,c.label=1;case 1:return c.trys.push([1,,7,8]),[4,e];case 2:return a=c.sent(),k?[4,f.endIncrementalSelection(a)]:[3,4];case 3:return c.sent(),[3,6];case 4:return[4,this.viewer.view.endIncrementalSelection(a)];case 5:c.sent(),c.label=6;case 6:return[3,8];case 7:return b=this._killHandles.indexOf(n),console.assert(0<=b),this._killHandles.splice(b,1),--this._activeSelectionCount,0===this._activeSelectionCount&&null!==this._inactivityPromise&&(this._inactivityPromise.resolve(),
this._inactivityPromise=null),[7];case 8:return[2]}})})});n=function(){return m.get()};this._killHandles.push(n);u.label=1;case 1:return u.trys.push([1,,11,13]),[4,e];case 2:q=u.sent(),t=!0,u.label=3;case 3:return!t||r?[3,10]:k?[4,this._advanceBySelectionManager(q,b)]:[3,5];case 4:return t=u.sent(),[3,7];case 5:return[4,this._advanceByView(q,b,g)];case 6:t=u.sent(),u.label=7;case 7:return!t||r?[3,9]:[4,h.sleep(1)];case 8:u.sent(),u.label=9;case 9:return[3,3];case 10:return[3,13];case 11:return[4,
n()];case 12:return u.sent(),[7];case 13:return[2]}})})};return e}();h.IncrementalSelectionImpl=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(){this.diffuseColor=[1,1,1,1]}a.prototype.setDiffuseTransparency=function(a){this.diffuseColor[3]=a};a.prototype.setDiffuseColor=function(a){a.toFloatArray(this.diffuseColor)};a.prototype.setDiffuseColorFromArray=function(a){this.diffuseColor[0]=a[0];this.diffuseColor[1]=a[1];this.diffuseColor[2]=a[2]};a.prototype.hash=function(){return this.diffuseColor.join(",")};return a}();a.MaterialInfo=e;e=function(){function a(d){this._materials=new Map;
this._engine=d}a.prototype.getOrCreateMaterial=function(a){var c=this,b=a.hash(),g=this._materials.get(b);if(void 0!==g)return g;g=this._engine.createMaterial().then(function(b){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.setDiffuseColor(b,a.diffuseColor)];case 1:return c.sent(),[2,b]}})})});this._materials.set(b,g);return g};return a}();a.ScMaterialCache=e;e=function(){function a(d){this._engine=d}a.prototype.getIdentityInc=
function(){return this._identityInc};a.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return[4,this._engine.createIdentityMatrix()];case 1:return this._identityInc=a=c.sent(),[2]}})})};return a}();a.ScMatrixCache=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(b,c,g){if(b.selectionMask===a.SelectionMask.None)throw new a.CommunicatorError("selectionMask is None");return __assign({},b,{cullSuboptimalEntities:c,enableOcclusionChecks:c,restrictLinesAndPointsToSelectedFaceInstances:g?!1:b.restrictLinesAndPointsToSelectedFaceInstances})}function f(b,c){var g=a.Point3.createFromArray(b.rayPoint),d=a.Point3.createFromArray(b.normal),l=new a.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),e=new a.Point3(b.bounding.max[0],
b.bounding.max[1],b.bounding.max[2]),l=new a.Box(l,e);c=new a.Selection.FaceEntity(g,d,b.elementIndex,b.overlayIndex,b.elementBits,l,c);b=b.instanceInc;return a.Selection.SelectionItem.create(b[1],b[0],c,null,null)}function d(b){var c=new a.Point3(b.bounding.min[0],b.bounding.min[1],b.bounding.min[2]),g=new a.Point3(b.bounding.max[0],b.bounding.max[1],b.bounding.max[2]),c=new a.Box(c,g),c=new a.Selection.LineEntity(b.elementIndex,a.Point3.createFromArray(b.point),b.lineSegmentVertices,b.bestLineSegmentVertexIndex,
c,b.overlayIndex,b.elementBits);b=b.instanceInc;return a.Selection.SelectionItem.create(b[1],b[0],null,c,null)}function c(b){var c=new a.Selection.PointEntity(a.Point3.createFromArray(b.point),b.elementIndex,b.overlayIndex,b.elementBits);b=b.instanceInc;return a.Selection.SelectionItem.create(b[1],b[0],null,null,c)}function b(a){return null!==a.point?(a=a.point.entities[0],c(a)):null!==a.line?(a=a.line.entities[0],d(a)):null!==a.face?(a=a.face.entities[0],f(a,!1)):null!==a.proximityFace?(a=a.proximityFace.entities[0],
f(a,!0)):null}function g(b){var g=null;if(null!==b.face)var l=b.face.entities[0],g=f(l,!1);else null!==b.proximityFace&&(l=b.proximityFace.entities[0],g=f(l,!0));var e=null;null!==b.line&&(l=b.line.entities[0],e=d(l));l=null;null!==b.point&&(l=b.point.entities[0],l=c(l));return new a.Selection.CompositeSelectionItem(g,e,l)}function l(a){var b=[];if(null!==a.face)for(var g=0,l=a.face.entities;g<l.length;g++){var e=f(l[g],!1);b.push(e)}a:for(e=a.line,g=a.point,l=a.proximityFace,a=null!==e?e.entities:
[],g=null!==g?g.entities:[],l=null!==l?l.entities:[],e=[a,g,l];;){for(var v,p=v=Number.POSITIVE_INFINITY,h=null,z=0;z<e.length;z++){var y=e[z];if(0<y.length){var x=y[0];x.radialMetric<v?(v=x.radialMetric,p=x.zMetric,h=y):x.radialMetric===v&&x.zMetric<p&&(p=x.zMetric,h=y)}}v=h;if(null===v){console.assert(0===a.length);console.assert(0===g.length);console.assert(0===l.length);break a}console.assert(0<v.length);v===a?(v=a.pop(),v=d(v)):v===g?(v=g.pop(),v=c(v)):(console.assert(v===l),v=l.pop(),v=f(v,
!0));b.push(v)}return b}var v;(function(a){a[a.Batch=1E3]="Batch";a[a.Chunk=100]="Chunk"})(v=h.AdvanceSelectionCapacity||(h.AdvanceSelectionCapacity={}));var p=function(){function c(a){this._pickTolerance=20;this._incrementalChunkedItems=new Map;this._sc=a}c.prototype.setPickTolerance=function(a){this._pickTolerance=a};c.prototype.getPickTolerance=function(){return this._pickTolerance};c.prototype.beginScreenAreaSelection=function(b,c,g){return __awaiter(this,void 0,void 0,function(){var d,l,e;return __generator(this,
function(f){switch(f.label){case 0:d=g,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._sc.beginScreenAreaSelection(b.x,b.y,c.x,c.y,d)];case 2:return l=f.sent(),[3,4];case 3:e=f.sent();if(SC.isError(e)&&"beginScreenAreaSelection"===e.scFunction)throw new a.SelectionInvalidatedError;throw e;case 4:return[2,new a.Selection.IncrementalSelectionId(l)]}})})};c.prototype.beginRayDrillSelection=function(b,c,g){return __awaiter(this,void 0,void 0,function(){var d,l,e;return __generator(this,function(f){switch(f.label){case 0:d=
g,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._sc.beginRayDrillSelection(b.x,b.y,c,d)];case 2:return l=f.sent(),[3,4];case 3:e=f.sent();if(SC.isError(e)&&"beginRayDrillSelection"===e.scFunction)throw new a.SelectionInvalidatedError;throw e;case 4:return[2,new a.Selection.IncrementalSelectionId(l)]}})})};c.prototype.beginConvexPolyhedronSelection=function(b,c,g){return __awaiter(this,void 0,void 0,function(){var d,l,e,f,v,p,k,h;return __generator(this,function(B){switch(B.label){case 0:d=
g;l=[];e=0;for(f=b;e<f.length;e++)v=f[e],l.push(v.getCoefficients());p=[c.x,c.y,c.z];B.label=1;case 1:return B.trys.push([1,3,,4]),[4,this._sc.beginConvexPolyhedronSelection(l,p,d)];case 2:return k=B.sent(),[3,4];case 3:h=B.sent();if(SC.isError(h)&&"beginConvexPolyhedronSelection"===h.scFunction)throw new a.SelectionInvalidatedError;throw h;case 4:return[2,new a.Selection.IncrementalSelectionId(k)]}})})};c.prototype.beginSphereSelection=function(b,c,g){return __awaiter(this,void 0,void 0,function(){var d,
l,e;return __generator(this,function(f){switch(f.label){case 0:d=g,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this._sc.beginSphereSelection(b,c,d)];case 2:return l=f.sent(),[3,4];case 3:e=f.sent();if(SC.isError(e)&&"beginSphereSelection"===e.scFunction)throw new a.SelectionInvalidatedError;throw e;case 4:return[2,new a.Selection.IncrementalSelectionId(l)]}})})};c.prototype.endIncrementalSelection=function(a){this._incrementalChunkedItems.delete(a._handle);this._sc.endVolumeSelection(a._handle)};
c.prototype.advanceIncrementalSelection=function(b,c){return __awaiter(this,void 0,void 0,function(){var g,d,l,e,f,p,k,x;return __generator(this,function(A){switch(A.label){case 0:if((g=this._incrementalChunkedItems.get(b._handle))&&g.length)return[2,g.pop()];A.label=1;case 1:return A.trys.push([1,3,,4]),[4,this._sc.advanceVolumeSelection(b._handle,v.Batch)];case 2:return d=A.sent(),[3,4];case 3:l=A.sent();if(SC.isError(l)&&"advanceVolumeSelection"===l.scFunction)throw new a.SelectionInvalidatedError;
throw l;case 4:return 2!==d.length||4294967295!==d[1]?[3,7]:c?[4,this._sc.setStreamIdleMarker()]:[3,6];case 5:return A.sent(),[2,this.advanceIncrementalSelection(b,!1)];case 6:return[2,null];case 7:e=[];for(f=0;f<d.length;f+=2)p=d[f],k=d[f+1],e.push(a.Selection.SelectionItem.create(k,p));if(e.length<=v.Chunk)return[2,e];x=h.chunkify(e,v.Chunk).reverse();this._incrementalChunkedItems.set(b._handle,x);return[2,x.pop()]}})})};c.prototype._screenSelectByRay=function(b,c,g,d){return __awaiter(this,void 0,
void 0,function(){var l,f,v,p;return __generator(this,function(k){l=e(c,g,d);f=c.selectionMask;p=(v=c.selectionMask!==a.SelectionMask.Face||c.enableProximityFaces)?this._pickTolerance:-1;return[2,this._sc.screenSelectByRay(f,b.x,b.y,p,l)]})})};c.prototype._worldSelectByRay=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var g,d;return __generator(this,function(l){g=e(b,c,!1);d=h.toScRay(a);return[2,this._sc.worldSelectByRay(d,g)]})})};c.prototype.pickFromScreen=function(a,c,g){return __awaiter(this,
void 0,void 0,function(){var d;return __generator(this,function(l){switch(l.label){case 0:return[4,this._screenSelectByRay(a,c,!0,g)];case 1:return d=l.sent(),[2,b(d)]}})})};c.prototype.pickAllFromScreen=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._screenSelectByRay(a,b,!1,c)];case 1:return g=d.sent(),[2,l(g)]}})})};c.prototype.compositePickFromScreen=function(a,b,c){return __awaiter(this,void 0,void 0,
function(){var d;return __generator(this,function(l){switch(l.label){case 0:return[4,this._screenSelectByRay(a,b,!0,c)];case 1:return d=l.sent(),[2,g(d)]}})})};c.prototype.pickFromRay=function(a,c){return __awaiter(this,void 0,void 0,function(){var g;return __generator(this,function(d){switch(d.label){case 0:return[4,this._worldSelectByRay(a,c,!0)];case 1:return g=d.sent(),[2,b(g)]}})})};c.prototype.pickAllFromRay=function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,
function(g){switch(g.label){case 0:return[4,this._worldSelectByRay(a,b,!1)];case 1:return c=g.sent(),[2,l(c)]}})})};c.prototype.pickCompositeFromRay=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,l;return __generator(this,function(f){switch(f.label){case 0:return c=e(b,!0,!1),d=h.toScRay(a),[4,this._sc.worldSelectByRay(d,c)];case 1:return l=f.sent(),[2,g(l)]}})})};return c}();h.ScSelectionManager=p})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){a=a.Internal||(a.Internal={});(a.Test||(a.Test={})).AdvanceSelectionCapacity=a.AdvanceSelectionCapacity})(Communicator||(Communicator={}));
(function(a){(function(h){h.toScRay=function(a){var f={origin:[],direction:[]};a.origin.toArray(f.origin);a.direction.toArray(f.direction);return f};h.makeFaceFaceDistanceItem=function(e){var f=new a.FaceFaceDistanceItem;f.pos1.fromArray(e.point1);f.pos2.fromArray(e.point2);f.distance=e.distance;return f}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(e){this.attributes=e}a.prototype.copy=function(){return new a(this.attributes.map(function(a){return a.copy()}))};return a}();a.SubentityAttributes=h})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){(function(e){e.isFace=function(d){return d instanceof a.SubentityProperties.CylinderElement||d instanceof a.SubentityProperties.PlaneElement||d instanceof a.SubentityProperties.ConeElement||d instanceof a.SubentityProperties.SphereElement||d instanceof a.SubentityProperties.TorusElement||d instanceof a.SubentityProperties.Blend01Element||d instanceof a.SubentityProperties.Blend02Element||d instanceof a.SubentityProperties.Blend03Element||d instanceof a.SubentityProperties.NurbsElement||
d instanceof a.SubentityProperties.CylindricalElement||d instanceof a.SubentityProperties.OffsetElement||d instanceof a.SubentityProperties.PipeElement||d instanceof a.SubentityProperties.RuledElement||d instanceof a.SubentityProperties.RevolutionElement||d instanceof a.SubentityProperties.ExtrusionElement||d instanceof a.SubentityProperties.FromCurvesElement||d instanceof a.SubentityProperties.TransformElement||d instanceof a.SubentityProperties.OtherFaceElement};e.isEdge=function(d){return d instanceof
a.SubentityProperties.LineElement||d instanceof a.SubentityProperties.CircleElement||d instanceof a.SubentityProperties.OtherEdgeElement}})(e.MeasurementProperty||(e.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){(function(e){(function(d){d.parseBinary=function(d){var C=a.SubentityProperties.FaceType,D=d.parseFaceType();switch(D){case C.Cylinder:return c.parseBinary(d);case C.Plane:return b.parseBinary(d);case C.Cone:return g.parseBinary(d);case C.Other:return f.parseBinary(d);case C.Sphere:return l.parseBinary(d);case C.Torus:return e.parseBinary(d);case C.Blend01:return k.parseBinary(d);case C.Blend02:return h.parseBinary(d);case C.Blend03:return m.parseBinary(d);case C.Nurbs:return n.parseBinary(d);
case C.Cylindrical:return q.parseBinary(d);case C.Offset:return t.parseBinary(d);case C.Pipe:return u.parseBinary(d);case C.Ruled:return w.parseBinary(d);case C.Revolution:return z.parseBinary(d);case C.Extrusion:return y.parseBinary(d);case C.FromCurves:return x.parseBinary(d);case C.Transform:return A.parseBinary(d);default:throw a.Util.TypeAssert(D),new a.AssemblyDataParseError("Unexpected measurement face type.");}};var c=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),
g=b.parsePoint3_32();b=b.parsePoint3_32();return new a.SubentityProperties.CylinderElement(c,g,b)};return b}();d.Cylinder=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parsePoint3_32();b=b.parsePoint3_32();return new a.SubentityProperties.PlaneElement(c,b)};return b}();d.Plane=b;var g=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),g=b.parsePoint3_32(),d=b.parsePoint3_32();b=b.parseFloat_32();return new a.SubentityProperties.ConeElement(c,g,d,b)};return b}();
d.Cone=g;var l=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),g=b.parsePoint3_32();b=b.parsePoint3_32();return new a.SubentityProperties.SphereElement(c,g,b)};return b}();d.Sphere=l;var e=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),g=b.parseFloat_32(),d=b.parsePoint3_32();b=b.parsePoint3_32();return new a.SubentityProperties.TorusElement(c,g,d,b)};return b}();d.Torus=e;var f=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.OtherFaceElement};
return b}();d.Other=f;var k=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.Blend01Element};return b}();d.Blend01=k;var h=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.Blend02Element};return b}();d.Blend02=h;var m=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.Blend03Element};return b}();d.Blend03=m;var n=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.NurbsElement};
return b}();d.Nurbs=n;var q=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.CylindricalElement};return b}();d.Cylindrical=q;var t=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.OffsetElement};return b}();d.Offset=t;var u=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.PipeElement};return b}();d.Pipe=u;var w=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.RuledElement};
return b}();d.Ruled=w;var z=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.RevolutionElement};return b}();d.Revolution=z;var y=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.ExtrusionElement};return b}();d.Extrusion=y;var x=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.FromCurvesElement};return b}();d.FromCurves=x;var A=function(){function b(){}b.parseBinary=function(b){b;return new a.SubentityProperties.TransformElement};
return b}();d.Transform=A})(e.Face||(e.Face={}))})(e.MeasurementProperty||(e.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){(function(e){(function(d){d.parseBinary=function(d){var e=a.SubentityProperties.EdgeType,f=d.parseEdgeType();switch(f){case e.Line:return c.parseBinary(d);case e.Circle:return b.parseBinary(d);case e.Other:return g.parseBinary(d);default:throw a.Util.TypeAssert(f),new a.AssemblyDataParseError("Unexpected measurement edge type.");}};var c=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new a.SubentityProperties.LineElement(b)};return b}();
d.Line=c;var b=function(){function b(){}b.parseBinary=function(b){var c=b.parseFloat_32(),g=b.parsePoint3_32();b=b.parsePoint3_32();return new a.SubentityProperties.CircleElement(c,g,b)};return b}();d.Circle=b;var g=function(){function b(){}b.parseBinary=function(b){b=b.parseFloat_32();return new a.SubentityProperties.OtherEdgeElement(b)};return b}();d.Other=g})(e.Edge||(e.Edge={}))})(e.MeasurementProperty||(e.MeasurementProperty={}))})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||
(Communicator={}));
(function(a){(function(a){var e;(function(a){a[a.Undefined=0]="Undefined";a[a.Line=1]="Line";a[a.Circle=2]="Circle";a[a.Other=6]="Other"})(e=a.EdgeType||(a.EdgeType={}));var f;(function(a){a[a.Undefined=0]="Undefined";a[a.Cylinder=3]="Cylinder";a[a.Plane=4]="Plane";a[a.Cone=5]="Cone";a[a.Other=6]="Other";a[a.Sphere=7]="Sphere";a[a.Torus=8]="Torus";a[a.Blend01=9]="Blend01";a[a.Blend02=10]="Blend02";a[a.Blend03=11]="Blend03";a[a.Nurbs=12]="Nurbs";a[a.Cylindrical=13]="Cylindrical";a[a.Offset=14]="Offset";
a[a.Pipe=15]="Pipe";a[a.Ruled=16]="Ruled";a[a.Revolution=17]="Revolution";a[a.Extrusion=18]="Extrusion";a[a.FromCurves=19]="FromCurves";a[a.Transform=20]="Transform"})(f=a.FaceType||(a.FaceType={}));var d=function(){function a(b){this.length=b}a.prototype.copy=function(){return new a(this.length)};a.prototype.type=function(){return e.Line};return a}();a.LineElement=d;d=function(){function a(b,c,d){this.radius=b;this.origin=c.copy();this.normal=d.copy()}a.prototype.copy=function(){return new a(this.radius,
this.origin,this.normal)};a.prototype.type=function(){return e.Circle};return a}();a.CircleElement=d;d=function(){function a(b){this.length=b}a.prototype.copy=function(){return new a(this.length)};a.prototype.type=function(){return e.Other};return a}();a.OtherEdgeElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Other};return a}();a.OtherFaceElement=d;d=function(){function a(b,c,d){this.radius=b;this.origin=c.copy();this.normal=d.copy()}
a.prototype.copy=function(){return new a(this.radius,this.origin,this.normal)};a.prototype.type=function(){return f.Cylinder};return a}();a.CylinderElement=d;d=function(){function a(b,c){this.origin=b.copy();this.normal=c.copy()}a.prototype.copy=function(){return new a(this.origin,this.normal)};a.prototype.type=function(){return f.Plane};return a}();a.PlaneElement=d;d=function(){function a(b,c,d,e){this.radius=b;this.origin=c.copy();this.normal=d.copy();this.halfAngle=e}a.prototype.copy=function(){return new a(this.radius,
this.origin,this.normal,this.halfAngle)};a.prototype.type=function(){return f.Cone};return a}();a.ConeElement=d;d=function(){function a(b,c,d){this.radius=b;this.origin=c.copy();this.normal=d.copy()}a.prototype.copy=function(){return new a(this.radius,this.origin,this.normal)};a.prototype.type=function(){return f.Sphere};return a}();a.SphereElement=d;d=function(){function a(b,c,d,e){this.majorRadius=b;this.minorRadius=c;this.origin=d.copy();this.normal=e.copy()}a.prototype.copy=function(){return new a(this.majorRadius,
this.minorRadius,this.origin,this.normal)};a.prototype.type=function(){return f.Torus};return a}();a.TorusElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Blend01};return a}();a.Blend01Element=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Blend02};return a}();a.Blend02Element=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Blend03};
return a}();a.Blend03Element=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Nurbs};return a}();a.NurbsElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Cylindrical};return a}();a.CylindricalElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Offset};return a}();a.OffsetElement=d;d=function(){function a(){}a.prototype.copy=
function(){return new a};a.prototype.type=function(){return f.Pipe};return a}();a.PipeElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Ruled};return a}();a.RuledElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Revolution};return a}();a.RevolutionElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Extrusion};
return a}();a.ExtrusionElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.FromCurves};return a}();a.FromCurvesElement=d;d=function(){function a(){}a.prototype.copy=function(){return new a};a.prototype.type=function(){return f.Transform};return a}();a.TransformElement=d})(a.SubentityProperties||(a.SubentityProperties={}))})(Communicator||(Communicator={}));
(function(a){a=a.StaticGenericType||(a.StaticGenericType={});a.IfcColumn="IFCCOLUMN";a.IfcCovering="IFCCOVERING";a.IfcCurtainWall="IFCCURTAINWALL";a.IfcDoor="IFCDOOR";a.IfcRamp="IFCRAMP";a.IfcRoof="IFCROOF";a.IfcSlab="IFCSLAB";a.IfcSpace="IFCSPACE";a.IfcStair="IFCSTAIR";a.IfcStairFlight="IFCSTAIRFLIGHT";a.IfcTransportElement="IFCTRANSPORTELEMENT";a.IfcWall="IFCWALL";a.IfcWallStandardCase="IFCWALLSTANDARDCASE";a.IfcWindow="IFCWINDOW"})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(b,c,g,d){return __awaiter(this,void 0,void 0,function(){var f,h,n,q,t,u,w,z;return __generator(this,function(y){switch(y.label){case 0:return[4,c.getNodeOrRepItem(g)];case 1:f=y.sent();if(null===f||f instanceof e.RepresentationItem||f instanceof e.PartDefinition)return[2,a.BimMask.None];h=e.getNodeGenericType(f);return null!==h?[3,3]:null===d?[2,a.BimMask.None]:[4,f.getAttributes()];case 2:n=y.sent();q=0;for(t=n;q<t.length;q++)if(u=t[q],w=u.getTitle(),
w===d){h=u.getValue();break}if(null===h)return[2,a.BimMask.None];y.label=3;case 3:return z=b(h),z!==a.BimMask.None?[2,z]:[2,a.BimMask.None]}})})}function d(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(g){switch(g.label){case 0:return b=[],c={enterAnyBody:function(a){a instanceof e.BodyInstance&&b.push(a)}},[4,e.WalkerAsync.walk(c,a,e.WalkRestriction.None)];case 1:return g.sent(),[2,b]}})})}function c(b){return __awaiter(this,void 0,void 0,function(){var c,
g,e,f,h,n;return __generator(this,function(q){switch(q.label){case 0:return[4,d(b)];case 1:c=q.sent();g=new Set;e=0;for(f=c;e<f.length;e++)h=f[e],n=h.getParent(),g.add(n);return[2,a.Util.setToArray(g)]}})})}function b(b,c,g,d){return __awaiter(this,void 0,void 0,function(){var e,h,n,q,t,u,w,z,y,x,A;return __generator(this,function(B){switch(B.label){case 0:e=[];h=0;for(n=g;h<n.length;h++)q=n[h],t=f(b,c,q,d),e.push(t);return[4,Promise.all(e)];case 1:u=B.sent();w=[];z=[];y=[];for(x=0;x<g.length;++x)q=
g[x],A=u[x],A!==a.BimMask.None&&(0!==(A&a.BimMask.Floor)&&w.push(q),0!==(A&a.BimMask.Wall)&&z.push(q),0!==(A&a.BimMask.Door)&&y.push(q));return[2,{floors:w,walls:z,doors:y}]}})})}function g(a){for(var b=[],c=0;c<a.length;c++)for(var g=0,d=a[c].getBodyInstances();g<d.length;g++){var e=d[g].getInstanceInc();b.push(e[0],e[1])}return b}e.hasEffectiveGenericType=function(a,b){for(;null!==a;){if(a.getName()===b||e.getNodeGenericType(a)===b)return!0;a=e.towardProductOccurrence(a.getParent())}return!1};e.ifcAttributeToBimMask=
function(b){switch(b){case a.StaticGenericType.IfcColumn:case a.StaticGenericType.IfcCurtainWall:case a.StaticGenericType.IfcStair:case a.StaticGenericType.IfcStairFlight:case a.StaticGenericType.IfcWall:case a.StaticGenericType.IfcWallStandardCase:case a.StaticGenericType.IfcWindow:return a.BimMask.Wall|a.BimMask.Floor;case a.StaticGenericType.IfcCovering:case a.StaticGenericType.IfcRamp:case a.StaticGenericType.IfcRoof:case a.StaticGenericType.IfcSlab:return a.BimMask.Floor;case a.StaticGenericType.IfcDoor:case a.StaticGenericType.IfcTransportElement:return a.BimMask.Door|
a.BimMask.Floor}return a.BimMask.None};e.registerBimNodes=function(a,d,e,f,h){return __awaiter(this,void 0,void 0,function(){var m,n,q,t,u;return __generator(this,function(w){switch(w.label){case 0:return[4,c(f)];case 1:return m=w.sent(),[4,b(a,e,m,h)];case 2:return n=w.sent(),q=g(n.floors),d.registerBimInstances(q,0),t=g(n.walls),d.registerBimInstances(t,1),u=g(n.doors),d.registerBimInstances(u,2),[2]}})})}})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function c(a,c,d,e,f,k){this._rootAssemblyDataKey=c;this.headerVersion=a;this.isDrawing=d;this.isMeasurable=e;this.originalFileName=f;this.originalFileType=k}c.prototype.rootAssemblyDataKey=function(){console.assert(4294967295!==this._rootAssemblyDataKey);return this._rootAssemblyDataKey};c.parseBinary=function(b){if(0===b.length)return null;b=new e.AssemblyDataParser(new d(null,b));var g=new e.NodeParseBits;g.parseBits1(b);if(!g.hasBits1(8388608))return null;
var l=b.parseAssemblyDataHeaderVersion();if(l>c._maxHeaderVersion)throw new a.AssemblyDataParseError("Unknown header version: "+l);g.parseBits2(b);var f=b.parseDataKey(),p=b.parseBoolean(),k,h="",m=a.FileType.Unknown;k=1<=l?b.parseBoolean():!0;3<=l&&(g.hasBits2(4)&&(h=b.parseCString()),m=b.parseIndex_32());return new c(l,f,p,k,h,m)};c._maxHeaderVersion=3;c.dynamic=new c(c._maxHeaderVersion,4294967295,!1,!1,"",a.FileType.Unknown);return c}();e.AssemblyDataHeader=f;var d=function(){return function(a,
b){this.header=a;this.bytes=b}}();e.AssemblyData=d})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){return function(){this.prototypes=new Map;this.partDefinitions=new Map}}(),d=function(){return function(){this.bodies=new Map;this.contexts=[]}}(),c=function(){function b(b,c,d,f,k,r){this._centralQueueClock=new h.Clock;this._productOccurrences=new Map;this._pmis=new Map;this._cadViews=new Map;this._bodyInstances=new Map;this._pmiBodies=new Map;this._viewFrames=new Map;this._partDefinitions=new Map;this._representationItems=new Map;this._partToInstance=
new Map;this._filters=[];this._layers=new Map;this._layersIds=new Map;this._genericTypeToNodes=new Map;this._genericIdToNode=new Map;this._cadConfigurations=new Set;this._modelContents=new Map;this._inclusionContents=new Map;this._nodeDeletionBlackList=new Set;this._meshDeletionBlackList=new Set;this._dynamicNodeIdSeed=e.invalidNodeId;this._currentNodeIdOffset=0;this._initialEmptyNodeIdOffsetObtained=!1;this._firstProductOccurrenceWithView=this._defaultCadConfiguration=this._activeCadConfiguration=
this._activeCadView=null;this._isMeasurable=this._containsDrawings=!1;this._initiallyHiddenStayHidden=this._automaticMeasurementUnitScaling=!0;this._completedLoadTimestamp=this._activeLoadTimestamp=0;this._requestedNodes=new Map;this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0;this._seenExternalModel=this._isInitialized=!1;this._config=__assign({},b);this._engine=c;this._callbackManager=d;this._cuttingManager=f;this._view=k;this._model=
r;this._isScs=2===this._engine.getSessionType();console.assert(!this._isScs||this._engine.getRendererType()===a.RendererType.Client)}b.prototype.initialize=function(b){var c=this;b;console.assert(void 0===this._rootLoadContext);console.assert(void 0===this._rootNode);console.assert(!this._isInitialized);this._isInitialized=!0;console.assert(void 0===this._centralQueue);this._centralQueue=new h.PromiseQueue(b.maxConcurrentAttachments(),!1);this._callbackManager.bind({_inputInteraction:function(a,b){c._onUserInteraction(a,
b)}});this._rootLoadContext=new e.LoadContext(null,a.EmptyModelName,null);b=new e.AttachContext(new e.ScKeyRemapper,0,!1,0,this._rootLoadContext);this._rootLoadContext.addAttachContext(b);var d=new e.InclusionContext(this,b,0,0);b.addInclusionContext(d);this._rootNode=e.ProductOccurrence.createDynamic(this,d,"Models",null,null,!0);d.addProductOccurrence(this._rootNode);console.assert(this._rootNode.isAbsoluteRoot());this.preventNodeDeletion(this._rootLoadContext);this.preventNodeDeletion(b);this.preventNodeDeletion(d);
this.preventNodeDeletion(this._rootNode);this._rootNode.markLoaded()};b.prototype.isInitialized=function(){return this._isInitialized};b.prototype.getRootNode=function(){return this._rootNode};b.prototype.getAbstractScEngine=function(){return this._engine};b.prototype.generateDynamicNodeId=function(){return--this._dynamicNodeIdSeed};b.prototype.newNodeIdOffset=function(){if(!this._initialEmptyNodeIdOffsetObtained)return this._initialEmptyNodeIdOffsetObtained=!0,console.assert(0===this._currentNodeIdOffset),
0;var a=this._currentNodeIdOffset;this._currentNodeIdOffset+=4294967296;return a};b.prototype.getLowestAvailableNodeId=function(){return this._currentNodeIdOffset};b.prototype.tryParseHeader=function(a){var b=this,c=e.AssemblyDataHeader.parseBinary(a);if(null===c)return null;this._containsDrawings=this._containsDrawings||c.isDrawing;this._isMeasurable=this._isMeasurable||c.isMeasurable;return this._callbackManager.promiseTrigger("_modelStructureHeaderParsed",null,c).then(function(){b._callbackManager.trigger("modelStructureHeaderParsed",
c.originalFileName,c.originalFileType);return c})};b.prototype._isRegistered=function(a){return this._productOccurrences.has(a)||this._pmis.has(a)||this._cadViews.has(a)||this._bodyInstances.has(a)||this._pmiBodies.has(a)||this._viewFrames.has(a)||this._partDefinitions.has(a)||this._representationItems.has(a)};b.prototype.registerProductOccurrence=function(a){if(!a.isMissing()){var b=a.getRuntimeId();console.assert(!this._isRegistered(b));this._productOccurrences.set(b,a);b=e.getNodeGenericType(a);
null!==b&&this.registerGenericType(a,b);b=a.getGenericId();null!==b&&this.registerGenericGlobalId(a,b);a.isAConfigurationNode()&&this._registerCadConfiguration(a);if(a.isADrawingSheetNode()||a.isADrawingViewNode())this._containsDrawings=!0}};b.prototype.lookupProductOccurrence=function(a){a=this._productOccurrences.get(a);return void 0!==a?a:null};b.prototype.registerPmi=function(a){var b=a.getRuntimeId();console.assert(!this._isRegistered(b));this._pmis.set(b,a)};b.prototype.lookupPmi=function(a){a=
this._pmis.get(a);return void 0!==a?a:null};b.prototype.registerCadView=function(a){null===this._firstProductOccurrenceWithView&&(this._firstProductOccurrenceWithView=a.getParent());var b=a.getRuntimeId();console.assert(!this._isRegistered(b));this._cadViews.set(b,a)};b.prototype.getFirstProductOccurrenceWithView=function(){return this._firstProductOccurrenceWithView};b.prototype.lookupCadView=function(a){a=this._cadViews.get(a);return void 0!==a?a:null};b.prototype.registerBodyInstance=function(a){var b=
a.getRuntimeId();console.assert(!this._isRegistered(b));this._bodyInstances.set(b,a);this._registerAnyBodyByInstanceInc(a)};b.prototype.lookupBodyInstance=function(a){a=this._bodyInstances.get(a);return void 0!==a?a:null};b.prototype.registerPmiBody=function(a){var b=a.getRuntimeId();console.assert(!this._isRegistered(b));this._pmiBodies.set(b,a);this._registerAnyBodyByInstanceInc(a)};b.prototype.lookupPmiBody=function(a){a=this._pmiBodies.get(a);return void 0!==a?a:null};b.prototype.registerViewFrame=
function(a){var b=a.getRuntimeId();console.assert(!this._isRegistered(b));this._viewFrames.set(b,a);this._registerAnyBodyByInstanceInc(a)};b.prototype.lookupViewFrame=function(a){a=this._viewFrames.get(a);return void 0!==a?a:null};b.prototype.registerPartDefinition=function(a){if(!a.isMissing()){var b=a.getRuntimeId();console.assert(!this._isRegistered(b));this._partDefinitions.set(b,a)}};b.prototype.lookupPartDefinition=function(a){a=this._partDefinitions.get(a);return void 0!==a?a:null};b.prototype.registerRepresentationItem=
function(a){var b=a.getRuntimeId();console.assert(!this._isRegistered(b));this._representationItems.set(b,a)};b.prototype.lookupRepresentationItem=function(a){a=this._representationItems.get(a);return void 0!==a?a:null};b.prototype.lookupAnyBody=function(a){return this.lookupBodyInstance(a)||this.lookupPmiBody(a)||this.lookupViewFrame(a)};b.prototype.lookupAnyTreeNode=function(a){return this.lookupProductOccurrence(a)||this.lookupPmi(a)||this.lookupCadView(a)||this.lookupAnyBody(a)};b.prototype.lookupAnyNonTreeNode=
function(a){return this.lookupRepresentationItem(a)||this.lookupPartDefinition(a)};b.prototype.lookupAnyNode=function(a){return this.lookupAnyTreeNode(a)||this.lookupAnyNonTreeNode(a)};b.prototype._registerCadConfiguration=function(a){console.assert(a.isAConfigurationNode());console.assert(!this._cadConfigurations.has(a));this._cadConfigurations.add(a);a.isADefaultNode()&&null===this._defaultCadConfiguration&&(this._defaultCadConfiguration=a)};b.prototype.getInstanceCountByInclusion=function(a){return this._getInclusionContent(a).bodies.size};
b.prototype.lookupAnyBodyByInstanceInc=function(a,b){a=this._getInclusionContent(a).bodies.get(b);return void 0!==a?a:null};b.prototype._registerAnyBodyByInstanceInc=function(b){var c=b.getInstanceInc(),d=this._getInclusionContent(c[0]),f=d.bodies.get(c[1]);if(void 0!==f){console.assert(b.hasAuthoredId());if(f.hasAuthoredId()){console.assert(f.constructor===b.constructor);h.CompileTime.disable&&console.assert(!1);return}console.assert(f.constructor===e.BodyInstance);f=f.getRuntimeId();b instanceof
e.BodyInstance?this._bodyInstances.set(f,b):b instanceof e.PmiBody?this._pmiBodies.set(f,b):(a.Util.TypeAssert(b),this._viewFrames.set(f,b))}d.bodies.set(c[1],b)};b.prototype._getInclusionContent=function(a){console.assert(4294967295!==a);var b=this._inclusionContents.get(a);void 0===b&&(b=new d,this._inclusionContents.set(a,b));return b};b.prototype._getModelContent=function(a,b){console.assert(4294967295!==b);var c=this._modelContents.get(a);void 0===c&&(c=new Map,this._modelContents.set(a,c));
a=c.get(b);void 0===a&&(a=new f,c.set(b,a));return a};b.prototype.registerPrototypeByDataId=function(a,b,c,d){a=this._getModelContent(a,b);console.assert(!a.prototypes.has(c));a.prototypes.set(c,d)};b.prototype.registerPartDefinitionByDataId=function(a,b,c,d){a=this._getModelContent(a,b);console.assert(!a.partDefinitions.has(c));a.partDefinitions.set(c,d)};b.prototype.lookupPrototypeByDataId=function(a,b,c){a=this._getModelContent(a,b).prototypes.get(c);return void 0!==a?a:null};b.prototype.lookupPartDefinitionByDataId=
function(a,b,c){a=this._getModelContent(a,b).partDefinitions.get(c);return void 0!==a?a:null};b.prototype.registerInclusionContext=function(a){var b=a.getInclusionKey();this._getInclusionContent(b).contexts.push(a)};b.prototype.getInclusionContexts=function(a){return this._getInclusionContent(a).contexts};b.prototype._createLayer=function(a,b,c,d){c=new e.Layer(a,b,c,d);console.assert(!this._layers.has(a));this._layers.set(a,c);null!==b&&(d=this._layersIds.get(b),void 0!==d?d.push(a):this._layersIds.set(b,
[a]));return c};b.prototype.createOrUpdateLayerName=function(a,b){var c=this._layers.get(a);void 0===c&&(c=this._createLayer(a,b,[],[]));c.name=b;c.id=a;return c};b.prototype.registerNodeInLayer=function(a,b){var c=this._layers.get(b);void 0!==c?c.nodes.push(a):this._createLayer(b,null,[a],[])};b.prototype.registerTreeNodeInLayer=function(a,b){var c=this._layers.get(b);void 0!==c?c.treeNodes.push(a):this._createLayer(b,null,[],[a])};b.prototype.addFilter=function(a){this._filters.push(a)};b.prototype.getFilters=
function(){for(var a=new Map,b=0;b<this._filters.length;b++){var c=this.getFilterName(b)||"";a.set(b,c)}return a};b.prototype.getFilterName=function(a){return a<this._filters.length?this._filters[a].name||"":null};b.prototype.getFiltersWithNode=function(a){for(var b=this,c=a.getAuthoredId(),d=this._filters,e=[],f=function(f){var h=d[f];null!==h.filterLayersItem&&h.filterLayersItem.layers.forEach(function(c){c=b.getNodesFromLayer(c);null!==c&&c.forEach(function(b){a===b&&e.push(f)})});null!==h.filterEntityItem&&
h.filterEntityItem.nodeIds.forEach(function(a){c===a&&e.push(f)})},h=0;h<d.length;h++)f(h);return e};b.prototype.getNodesFromFiltersId=function(b){var c=new Set,d=new Set,e=null,f=this._filters,h=this._layers;b.forEach(function(a){var b=f[a].filterLayersItem;if(null!==b){var g=b.isInclusive;null===e&&(e=g);b.layers.forEach(function(a){(a=h.get(a))&&null!==a.nodes&&a.nodes.forEach(function(a){a=a.getAuthoredId();g?(c.add(a),d.delete(a)):(c.delete(a),d.add(a))})})}a=f[a].filterEntityItem;if(null!==
a){var t=a.isInclusive;null===e&&(e=t);a.nodeIds.forEach(function(a){t?(c.add(a),d.delete(a)):(c.delete(a),d.add(a))})}});return null===e?null:e?new a.FilteredNodes(!0,c):new a.FilteredNodes(!1,d)};b.prototype.getLayers=function(){var a=new Map;this._layers.forEach(function(b,c){a.set(c,b.name||"")});return a};b.prototype.getUniqueLayerNames=function(){var a=new Set,b=[];this._layers.forEach(function(c){c=c.name;null===c||a.has(c)||(a.add(c),b.push(c))});return b};b.prototype.getLayerName=function(a){a=
this._layers.get(a);return void 0!==a?a.name||"":null};b.prototype.getLayersIdFromName=function(a){a=this._layersIds.get(a);return void 0!==a?a:null};b.prototype.getNodesFromLayer=function(a,b){a=this._layers.get(a);return void 0!==a?b?a.treeNodes:a.nodes:null};b.prototype.getNodesFromLayers=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.getNodesFromLayer(a[d],b);if(null!==e)for(var f=0;f<e.length;f++)c.push(e[f])}return c};b.prototype.getNodesFromLayerName=function(a,b){a=this._layersIds.get(a);
return void 0!==a?this.getNodesFromLayers(a,b):null};b.prototype.generateProductName=function(){return"Product "+this._unnamedProductCount++};b.prototype.generateGroupName=function(){return"Product "+this._unnamedGroupCount++};b.prototype.generateDrawingSheetName=function(){return"Product "+this._unnamedDrawingSheetCount++};b.prototype.generateDrawingViewName=function(){return"Product "+this._unnamedDrawingViewCount++};b.prototype.forEachCadView=function(a){this._cadViews.forEach(a)};b.prototype.forEachPmi=
function(a){this._pmis.forEach(a)};b.prototype.forEachCadConfiguration=function(a){this._cadConfigurations.forEach(a)};b.prototype.hasActiveCadView=function(){return null!==this._activeCadView};b.prototype.activateCadView=function(a,b){console.assert(null===this._activeCadView);this._activeCadView=a;return a.activate(this,this._engine,this._callbackManager,this._cuttingManager,this._view,b,this._activeCadConfiguration)};b.prototype.deactivateActiveCadView=function(){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(a){switch(a.label){case 0:return null===this._activeCadView?[2]:[4,this._activeCadView.deactivate(this._cuttingManager)];case 1:return a.sent(),console.assert(null!==this._activeCadView),this._activeCadView=null,[2]}})})};b.prototype.getCadViewPmis=function(a){var b=[];this._pmis.forEach(function(c){a.hasPmi(c)&&b.push(c)});return b};b.prototype.isMeasureable=function(){return this._isMeasurable};b.prototype.containsDrawings=function(){return this._containsDrawings};
b.prototype.getDefaultCadConfiguration=function(){return this._defaultCadConfiguration};b.prototype.getActiveCadConfiguration=function(){return this._activeCadConfiguration};b.prototype.activateCadConfiguration=function(b){console.assert(b.isAConfigurationNode());this._activeCadConfiguration=b;b=b.getRuntimeId();return this._view.isolateNodes([b],a.DefaultTransitionDuration,!0)};b.prototype.massageAuthoredUserId=function(a,b){if(null===b)return this.generateDynamicNodeId();a=a.toRuntimeId(b);return null!==
this.lookupAnyNode(a)?this.generateDynamicNodeId():b};b.prototype.createNode=function(a,b,c,d,f){b=e.ProductOccurrence.createDynamic(this,a,b,c,d,f);a.addProductOccurrence(b);b.markLoaded();return b};b.prototype.createPart=function(a){a=e.PartDefinition.createDynamic(this,a,null);a.markLoaded();return a};b.prototype.setPart=function(a,b){b.addReferrer(a);var c=this._partToInstance.get(b);if(void 0===c){var c=e.towardInclusionContext(this._rootNode),d,f=h.LazyObject.create(function(){console.assert(void 0!==
d);return new e.SharedPrototypeContext(h.LazyPromise.create(d))}),c=new e.PrototypeContext(f,c);d=e.ProductOccurrence.createDynamic(this,c,null,null,null,!0);d.setPartDefinition(b);d.markLoaded()}a.setPrototype(c)};b.prototype._createCadView=function(a,b,c,d,f,h,m,n){b=e.CadView.createDynamic(this,a,b,c,d,f,h,m,n);a.addCadView(b);b.markLoaded();return b};b.prototype._createCadViewInstance=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d,f,h,m,n,q,t,u,w;return __generator(this,
function(z){switch(z.label){case 0:return null===c?[3,2]:[4,a.createMeshInstance(c)];case 1:d=z.sent(),f=d[0],h=d[1],m=this.generateDynamicNodeId(),n={nodeId:m,bits:786432,name:null,localTransform:null,attributes:[],header:e.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},q={nodeInfo:n,inclusionKey:f,instanceKey:h,bits:0},t=e.towardAttachContext(b),u=t.getMasterModelKey(),console.assert(b.isLoaded()),w=e.ViewFrame.reify(this,u,b,q),b.setViewFrame(w),
w.markLoaded(),z.label=2;case 2:return[2]}})})};b.prototype.createCadView=function(a,b,c,d,e,f,h,n,q,t){b=this._createCadView(b,c,d,e,f,h,n,q);null!==t&&(a=this._createCadViewInstance(a,b,t),a);return b};b.prototype.createMeshInstance=function(a,b,c,d,f,h,m,n){var q=0;m&&(q|=16384);n&&(q|=268435456);b=e.BodyInstance.createDynamic(this,b,c,d,f,h,q);h.addBodyInstance(b);a&&b.markLoaded();return b};b.prototype.createPmiInstance=function(a,b,c,d,f,h,m,n){var q=e.towardInclusionContext(f);a={nodeInfo:{nodeId:this.massageAuthoredUserId(q,
c),bits:1073741824,name:d,localTransform:null,attributes:[],header:e.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:a,instanceKey:b,bits:0};h=e.Pmi.createDynamic(this,q,f,h,m,[a],n);f.addPmi(h);h.markLoaded();return h};b.prototype.getAutomaticMeasurementUnitScaling=function(){return this._automaticMeasurementUnitScaling};b.prototype.setAutomaticMeasurementUnitScaling=function(a){this._automaticMeasurementUnitScaling=a};b.prototype.getInitiallyHiddenStayHidden=
function(){return this._initiallyHiddenStayHidden};b.prototype.setInitiallyHiddenStayHidden=function(a){this._initiallyHiddenStayHidden=a};b.prototype._removeIdMappingsRecursive=function(b){var c=this;return e.WalkerAsync.walk({enterProductOccurrence:function(a){c._productOccurrences.delete(a.getRuntimeId())},enterAnyBody:function(b){var g=b.getRuntimeId();b instanceof e.BodyInstance?c._bodyInstances.delete(g):b instanceof e.PmiBody?c._pmiBodies.delete(g):(a.Util.TypeAssert(b),c._viewFrames.delete(g))},
enterCadView:function(a){c._cadViews.delete(a.getRuntimeId())},enterPmi:function(a){c._pmis.delete(a.getRuntimeId())}},b,e.WalkRestriction.None)};b.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,f,k,h,m,n;return __generator(this,function(q){switch(q.label){case 0:if(!this._canDeleteNode(b))throw c=b.getRuntimeId(),new a.CommunicatorError("Cannot delete node ("+c+")");d=e.gatherInstanceIncsSync(b,7,!0,new Set,e.WalkRestriction.None);this._engine.setPartVisibility(d,
!1,!1);this._engine.setInstanceModifier(a.InstanceModifier.DoNotSelect,d,!0);if(!(b instanceof e.ProductOccurrence))return[3,2];this._cadConfigurations.delete(b)&&(b===this._activeCadConfiguration&&(this._activeCadConfiguration=null),b===this._defaultCadConfiguration&&(this._defaultCadConfiguration=null));f=b.getParent();console.assert(null!==f);null!==f&&(k=void 0,k=f instanceof e.PrototypeContext?f.removeReferrer(b):f.removeProductOccurrence(b),console.assert(k));this._productOccurrences.delete(b.getRuntimeId());
return[4,this._removeIdMappingsRecursive(b)];case 1:return q.sent(),[2,b.purgeContents()];case 2:a.Util.TypeAssert(b),h=b.getParent(),h.removeBodyInstance(b),m=b.getInstanceInc(),n=this._getInclusionContent(m[0]),n.bodies.delete(m[1]),this._bodyInstances.delete(b.getRuntimeId()),q.label=3;case 3:return[2]}})})};b.prototype._canDeleteNode=function(a){return!this._nodeDeletionBlackList.has(a)};b.prototype.preventNodeDeletion=function(b){var c=b.getParent();if(c instanceof e.PrototypeContext)throw new a.InternalLogicError;
null!==c&&(console.assert(null===c||this._nodeDeletionBlackList.has(c)),b instanceof e.ProductOccurrence?(console.assert(!b.hasAuthoredId()),console.assert(!b.isOutOfHierarchy())):b instanceof e.BodyInstance&&(c=b.getInstanceInc(),console.assert(!b.hasAuthoredId()),console.assert(0===c[0]),console.assert(b.isOutOfHierarchy())));this._nodeDeletionBlackList.add(b)};b.prototype.preventMeshDeletion=function(a){this._meshDeletionBlackList.add(a)};b.prototype._resetContents=function(){return __awaiter(this,
void 0,void 0,function(){var b=this;return __generator(this,function(c){switch(c.label){case 0:return this.hasActiveCadView()?[4,this.deactivateActiveCadView()]:[3,2];case 1:return c.sent(),[2,this._resetContents()];case 2:return[4,this._rootLoadContext.purgeContents()];case 3:return c.sent(),this._productOccurrences.clear(),this._pmis.clear(),this._cadViews.clear(),this._bodyInstances.clear(),this._pmiBodies.clear(),this._viewFrames.clear(),this._partDefinitions.clear(),this._representationItems.clear(),
this._partToInstance.clear(),this._filters.length=0,this._layers.clear(),this._layersIds.clear(),this._genericTypeToNodes.clear(),this._genericIdToNode.clear(),this._cadConfigurations.clear(),this._modelContents.clear(),this._inclusionContents.clear(),this._currentNodeIdOffset=0,this._firstProductOccurrenceWithView=this._defaultCadConfiguration=this._activeCadConfiguration=this._activeCadView=null,this._isMeasurable=this._containsDrawings=!1,this._completedLoadTimestamp=this._activeLoadTimestamp=
0,this._requestedNodes.clear(),this._unnamedDrawingViewCount=this._unnamedDrawingSheetCount=this._unnamedGroupCount=this._unnamedProductCount=0,this._seenExternalModel=!1,this._rootNode.unsetMeasurementUnit(),this._nodeDeletionBlackList.forEach(function(c){if(c instanceof e.ProductOccurrence){var d=c.getRuntimeId();b._productOccurrences.set(d,c);d=c.getParent();d instanceof e.PrototypeContext?console.assert(!1):d.addProductOccurrence(c);c.setVisibility(!0);c.unsetMeasurementUnit();c.hasLocalTransformOverride()&&
c.removeLocalTransformOverride()}else if(c instanceof e.BodyInstance){d=c.getRuntimeId();b._bodyInstances.set(d,c);var d=c.getInstanceInc(),l=d[0];console.assert(0===l);l=b._getInclusionContent(l);l.bodies.set(d[1],c);c.getParent().addBodyInstance(c)}else c instanceof e.LoadContext?(d=c.getParent(),null!==d&&d.addLoadContext(c)):c instanceof e.AttachContext?c.getParent().addAttachContext(c):(a.Util.TypeAssert(c),l=c.getInclusionKey(),console.assert(0===l),l=b._getInclusionContent(l),l.contexts.push(c),
c.getParent().addInclusionContext(c))}),[2]}})})};b.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,function(c){switch(c.label){case 0:return[4,this._callbackManager.promiseTrigger("_resetAssemblyTreeBegin",null)];case 1:return c.sent(),[4,this._resetContents()];case 2:return c.sent(),a=[],this._nodeDeletionBlackList.forEach(function(b){b instanceof e.BodyInstance&&(b=b.getInstanceInc(),console.assert(0===b[0]),a.push(b[1]))}),b=[],this._meshDeletionBlackList.forEach(function(a){b.push(a)}),
[4,this._engine.resetToEmpty(a,b)];case 3:return c.sent(),[4,this._resetContents()];case 4:return c.sent(),[2]}})})};b.prototype.setViewAxes=function(a,b){this._model.setViewAxes(a,b)};b.prototype._requestIncsOfNodes=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,f,k,h,m,n,q,t;return __generator(this,function(u){switch(u.label){case 0:if(this._config.streamingMode!==a.StreamingMode.OnDemand)return[2];c=new Set;d=[];f=[];k=0;for(h=b;k<h.length;k++)m=h[k],n=e.gatherInstanceIncs(m,
7,!1,c).then(function(a){for(var b=0;b<a.length;b++)d.push(a[b])}),f.push(n);return[4,a.Util.waitForAll(f)];case 1:return u.sent(),q=[],t=[],c.forEach(function(a){if(!a.isRequested()){a.setRequested();var b=a.isInitiallyShown();b!==a.isVisible()&&(b?(a.setVisibility(!0),q.push(a.getRuntimeId())):(a.setVisibility(!1),t.push(a.getRuntimeId())))}}),0<q.length+t.length&&this._callbackManager.trigger("visibilityChanged",q,t),this._engine.requestMeshInstances(d),[2]}})})};b.prototype._requestExternalModelsLocal=
function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(f){switch(f.label){case 0:return[4,b.loadPendingExternalModels(a)];case 1:return d=f.sent(),0===d.length?[3,4]:[4,e.markContextsLoaded(d)];case 2:return f.sent(),[4,this._requestNodes(a,[b],c)];case 3:f.sent(),f.label=4;case 4:return[2,d]}})})};b.prototype._requestExternalModelsNonLocal=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d,f,r,m,n,q,t,u;return __generator(this,function(w){switch(w.label){case 0:return[4,
e.gatherParentsOfPendingExternalModels(b)];case 1:d=w.sent();if(0===d.length)return[2,[]];f=[];r=0;for(m=d;r<m.length;r++)n=m[r],q=this._requestExternalModelsLocal(a,n,c),f.push(q);u=h.concatAll;return[4,Promise.all(f)];case 2:return t=u.apply(void 0,[w.sent()]),[2,t]}})})};b.prototype._requestExternalModelsOfNodes=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d,e,f,m,n,q,t;return __generator(this,function(u){switch(u.label){case 0:d=[];e=0;for(f=b;e<f.length;e++)m=f[e],n=this._requestExternalModelsNonLocal(a,
m,c),d.push(n);t=h.concatAll;return[4,Promise.all(d)];case 1:return q=t.apply(void 0,[u.sent()]),[2,q]}})})};b.prototype._requestNodes=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d,f,h,m,n,q,t;return __generator(this,function(u){switch(u.label){case 0:if(!c)for(d=0,f=b;d<f.length;d++)h=f[d],this._activeLoadTimestamp!==this._completedLoadTimestamp&&this._requestedNodes.set(h,this._activeLoadTimestamp),h instanceof e.ProductOccurrence&&a.notifyDirectRequest(h);m=this._requestIncsOfNodes(b);
n=this._requestExternalModelsOfNodes(a,b,c);q=[m,n];return[4,Promise.all(q)];case 1:return t=u.sent()[1],[2,t]}})})};b.prototype.requestNodes=function(b,c,d){return __awaiter(this,void 0,void 0,function(){var e,f,r,m,n,q,t;return __generator(this,function(u){switch(u.label){case 0:return[4,this._requestNodes(b,c,d)];case 1:e=u.sent();f=[];r=0;for(m=e;r<m.length;r++)n=m[r],q=n.getChildren(),h.concatInPlace(f,q);if(!(0<f.length))return[3,3];t=f.map(function(a){return a.getRuntimeId()});return[4,this._callbackManager.promiseTrigger("_subtreeLoaded",
"subtreeLoaded",t,a.NodeSource.LoadModel)];case 2:u.sent(),u.label=3;case 3:return[2]}})})};b.prototype.isBeingRequested=function(b){for(;;)if(b instanceof e.NodeMixin){if(this._requestedNodes.has(b))return!0;b=b.getParent()}else if(b instanceof e.AttachContext)b=b.getParent();else if(b instanceof e.InclusionContext)b=b.getParent();else if(b instanceof e.LoadContext){if(b=b.getParent(),null===b)return!1}else return a.Util.TypeAssert(b),console.assert(!1),!1};b.prototype.onDemandRequestsActive=function(){return 0!==
this._requestedNodes.size};b.prototype.onLoadBegin=function(){++this._activeLoadTimestamp};b.prototype.onLoadEnd=function(){var a=this;console.assert(this._completedLoadTimestamp<this._activeLoadTimestamp);++this._completedLoadTimestamp;console.assert(this._completedLoadTimestamp===this._activeLoadTimestamp);var b=[];this._requestedNodes.forEach(function(c,d){c<=a._completedLoadTimestamp&&(console.assert(c===a._completedLoadTimestamp),b.push(d))});for(var c=0;c<b.length;c++)this._requestedNodes.delete(b[c])};
b.prototype.markSeenExternalModel=function(){this._seenExternalModel=!0};b.prototype.seenExternalModel=function(){return this._seenExternalModel};b.prototype.getNodeByGenericId=function(a){return this._genericIdToNode.get(a)||null};b.prototype.getNodesByGenericType=function(a){return this._genericTypeToNodes.get(a)||null};b.prototype.genericTypeToNodes=function(){return this._genericTypeToNodes};b.prototype.registerGenericGlobalId=function(a,b){this._genericIdToNode.set(b,a)};b.prototype.registerGenericType=
function(a,b){var c=this._genericTypeToNodes.get(b);void 0===c&&(c=new Set);c.add(a);this._genericTypeToNodes.set(b,c)};b.prototype.disableAutomaticFitWorld=function(){return this._config.disableAutomaticFitWorld};b.prototype.markImplicitNodesOutOfHierarchy=function(){return this._config.markImplicitNodesOutOfHierarchy};b.prototype._throttleLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._engine.throttleLoad(200,
200),[4,this._engine.sleep(20)];case 1:return a.sent(),[2]}})})};b.prototype.enqueue=function(a){var b=this,c="function"===typeof a?h.Lazy.create(a):a;return this._centralQueue.push(function(){return __awaiter(b,void 0,void 0,function(){var a,b;return __generator(this,function(d){switch(d.label){case 0:return(a=this._isScs&&this._centralQueueClock.isTicking())&&this._throttleLoad(),[4,c.get()];case 1:return b=d.sent(),a&&this._throttleLoad(),[2,b]}})})})};b.prototype._onUserInteraction=function(b,
c){if(this._isScs){var d=!1;switch(c){case a.EventType.MouseDown:case a.EventType.MouseUp:case a.EventType.Mousewheel:case a.EventType.TouchStart:case a.EventType.TouchMove:case a.EventType.TouchEnd:case a.EventType.KeyDown:case a.EventType.KeyUp:case a.EventType.ViewOrientationChange:d=!0;break;case a.EventType.MouseMove:d=b.getButtons()!==a.Buttons.None;break;default:a.Util.TypeAssertNever(c)}d&&this._centralQueueClock.tickFor(1E3)}};return b}();e.AssemblyTree=c})(h.Tree||(h.Tree={}))})(a.Internal||
(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a){var b=this;return function(d){return __awaiter(b,void 0,void 0,function(){var b;return __generator(this,function(e){switch(e.label){case 0:return[4,a(d)];case 1:return b=e.sent(),"string"===typeof b?[2,h.httpRequestBuffer(b)]:[2,b]}})})}}var d=function(){function c(a,c,d,f,p,k){this._clearQueue=new h.PromiseQueue(1,!1);this._clearInProgress=!1;this._cadConfigurationsEnabled=!0;this._engine=c;this._callbackManager=d;this._cuttingManager=f;this._view=
p;this._model=k;this._assemblyTree=new e.AssemblyTree(a,this._engine,this._callbackManager,this._cuttingManager,this._view,this._model);this._readyPromise=h.TrackedOpenPromise.create()}c.unsafeCreate=function(a,c,d,e,f,k,h){return this._create(a,c,d,e,f,k,h).unsafeValue};c.create=function(a,c,d,e,f,k,h){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(m){return[2,this._create(a,c,d,e,f,k,h)]})})};c._create=function(a,d,e,f,p,k,r){a=new c(a,d,e,f,p,k);r=a._init(r);return h.UnsafePromise.create(a,
r)};c.prototype._init=function(a){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(f){switch(f.label){case 0:return[4,e.ScAttacher.createWithEmptyModel(this._engine,this._view,this._callbackManager,a)];case 1:return c=f.sent(),this._assemblyTree.initialize(c),d=new e.TreeLoader(this._assemblyTree,c,this._engine,this._view,this._callbackManager),this._callbackManager.trigger("modelStructureLoadBegin"),this._callbackManager.trigger("modelStructureLoadEnd"),this._callbackManager.trigger("modelStructureParseBegin"),
console.assert(void 0===this._treeLoader),this._treeLoader=d,this._readyPromise.resolve(),[2]}})})};c.prototype._loadSubtreePrologue=function(b,c,d){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(f){switch(f.label){case 0:if(this._engine.getSessionType()!==b)throw new a.LoadError("Incompatible load types.");return d?[4,this._clearQueue.waitOnLatest()]:[3,2];case 1:f.sent(),f.label=2;case 2:if(this._clearInProgress)throw new a.LoadCancelledError;e=this._assemblyTree.lookupProductOccurrence(c);
if(null===e)throw new a.InvalidNodeTypeError(c,0);return[2,e]}})})};c.prototype._loadSubtreeEpilogue=function(b,c){return __awaiter(this,void 0,void 0,function(){var d,e;return __generator(this,function(f){switch(f.label){case 0:return b.isFirstLoad()&&2===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",null)]:[3,2];case 1:f.sent(),f.label=2;case 2:return d=b.getChildren(),e=d.map(function(a){return a.getRuntimeId()}),!c||b.isFirstLoad()?[3,4]:[4,this._callbackManager.promiseTrigger("_subtreeLoaded",
"subtreeLoaded",e,a.NodeSource.LoadModel)];case 3:f.sent(),f.label=4;case 4:return[2,e]}})})};c.prototype.loadSubtreeFromXmlFile=function(a,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(h){switch(h.label){case 0:return[4,this._disableCadConfigurations()];case 1:return h.sent(),[4,this._loadSubtreePrologue(1,a,!0)];case 2:return f=h.sent(),[4,this._treeLoader.loadByXmlFile(e,f,c,d)];case 3:return k=h.sent(),[2,this._loadSubtreeEpilogue(k,!1)]}})})};
c.prototype.loadSubtreeFromXmlDoc=function(a,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(h){switch(h.label){case 0:return[4,this._disableCadConfigurations()];case 1:return h.sent(),[4,this._loadSubtreePrologue(1,a,!0)];case 2:return f=h.sent(),[4,this._treeLoader.loadByXmlDoc(e,f,c,d)];case 3:return k=h.sent(),[2,this._loadSubtreeEpilogue(k,!1)]}})})};c.prototype.loadSubtreeFromScsXmlFile=function(a,c,d,e){return __awaiter(this,void 0,void 0,function(){var p,
k,h;return __generator(this,function(m){switch(m.label){case 0:return[4,this._disableCadConfigurations()];case 1:return m.sent(),[4,this._loadSubtreePrologue(2,a,!0)];case 2:return p=m.sent(),k=f(d),[4,this._treeLoader.loadByXmlFile(e,p,c,k)];case 3:return h=m.sent(),[2,this._loadSubtreeEpilogue(h,!1)]}})})};c.prototype.loadSubtreeFromScsXmlDoc=function(a,c,d,e){return __awaiter(this,void 0,void 0,function(){var p,k,h;return __generator(this,function(m){switch(m.label){case 0:return[4,this._disableCadConfigurations()];
case 1:return m.sent(),[4,this._loadSubtreePrologue(2,a,!0)];case 2:return p=m.sent(),k=f(d),[4,this._treeLoader.loadByXmlDoc(e,p,c,k)];case 3:return h=m.sent(),[2,this._loadSubtreeEpilogue(h,!1)]}})})};c.prototype._loadSubtreeFromStream=function(a,c,d,e){return __awaiter(this,void 0,void 0,function(){var f,k;return __generator(this,function(h){switch(h.label){case 0:return[4,this._loadSubtreePrologue(1,a,d)];case 1:return f=h.sent(),[4,this._treeLoader.loadByStream(e,f,c)];case 2:return k=h.sent(),
[2,this._loadSubtreeEpilogue(k,!0)]}})})};c.prototype.loadSubtreeFromStream=function(a,c,d){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,this._loadSubtreeFromStream(a,c,!0,d)]})})};c.prototype.loadSubtreeFromScsFile=function(a,c,d){return __awaiter(this,void 0,void 0,function(){var e,f;return __generator(this,function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(2,a,!0)];case 1:return e=k.sent(),[4,this._treeLoader.loadByScsFile(d,e,c)];
case 2:return f=k.sent(),[2,this._loadSubtreeEpilogue(f,!0)]}})})};c.prototype.loadSubtreeFromScsBuffer=function(a,c,d){return __awaiter(this,void 0,void 0,function(){var e,f;return __generator(this,function(k){switch(k.label){case 0:return[4,this._loadSubtreePrologue(2,a,!0)];case 1:return e=k.sent(),[4,this._treeLoader.loadByScsBuffer(d,e,c)];case 2:return f=k.sent(),[2,this._loadSubtreeEpilogue(f,!0)]}})})};c.prototype.loadSubtreeFromAssemblyData=function(a,c,d,e){return __awaiter(this,void 0,
void 0,function(){var f,k;return __generator(this,function(h){switch(h.label){case 0:return[4,this._loadSubtreePrologue(1,a,!0)];case 1:return f=h.sent(),[4,this._treeLoader.loadByAssemblyData(e,f,c,d)];case 2:return k=h.sent(),[2,this._loadSubtreeEpilogue(k,!0)]}})})};c.prototype.notifyFirstLoadIsEmptyModel=function(){this._treeLoader.notifyFirstLoadIsEmptyModel()};c.prototype._clearImpl=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:console.assert(!this._clearInProgress),
this._clearInProgress=!0,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,this._treeLoader.cancelPendingLoads()];case 2:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),[4,this._treeLoader.reset()];case 3:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),[4,this._assemblyTree.reset()];case 4:return c.sent(),console.assert(this._treeLoader.isIdle()),console.assert(this._clearInProgress),this._clearInProgress=
!1,[3,6];case 5:throw a=c.sent(),console.assert(this._clearInProgress),this._clearInProgress=!1,a;case 6:return[2]}})})};c.prototype.clear=function(){var a=this;return this._clearQueue.push(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._callbackManager.trigger("modelSwitchStart",!0),[4,this._clearImpl()];case 1:return a.sent(),[2,this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",!0,[],h.AttachType.Direct)]}})})})};
c.prototype.switchToModel=function(b){var c=this,d=b===a.EmptyModelName;return this._clearQueue.push(function(){return __awaiter(c,void 0,void 0,function(){var c;return __generator(this,function(g){switch(g.label){case 0:return this._callbackManager.trigger("modelSwitchStart",!1),[4,this._clearImpl()];case 1:g.sent();if(!d)return[3,2];c=[];return[3,4];case 2:return[4,this._loadSubtreeFromStream(this.getAbsoluteRootNodeId(),b,!1,new a.LoadSubtreeConfig)];case 3:c=g.sent(),g.label=4;case 4:return[4,
this._callbackManager.promiseTrigger("_modelSwitched","modelSwitched",d,c,h.AttachType.Direct)];case 5:return g.sent(),[2,c]}})})})};c.prototype.getAbsoluteRootNodeId=function(){return this._assemblyTree.getRootNode().getRuntimeId()};c.prototype.isIdValid=function(a){return null!==this._assemblyTree.lookupAnyNode(a)};c.prototype._getNodeChildren=function(a,c){var d=a.getChildrenSync();c||(d=d.filter(function(a){return!a.isOutOfHierarchy()}));for(var e=0,f=a.getBodyInstances();e<f.length;e++){var k=
f[e];k.isOutOfHierarchy()&&!c||d.push(k)}c=0;for(a=a.getPmis();c<a.length;c++)d.push(a[c]);return d};c.prototype.getChildIds=function(a,c){var d=this._assemblyTree.lookupProductOccurrence(a);if(null===d)return[];a=[];var e=0;for(c=this._getNodeChildren(d,c);e<c.length;e++)a.push(c[e].getRuntimeId());return a};c.prototype.isOutOfHierarchy=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a&&e.isOutOfHierarchy(a)};c.prototype.getParentId=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);
if(null===a)return null;a=e.towardContainerNode(a.getParent());return null===a?null:a.getRuntimeId()};c.prototype.getPartReferrers=function(a){return __awaiter(this,void 0,void 0,function(){var c,d,f,p,k,h,m,n;return __generator(this,function(q){switch(q.label){case 0:c=this._assemblyTree.lookupProductOccurrence(a);if(null===c)return[2,null];d=this._assemblyTree.getRootNode();return[4,e.forcePrototypes(d)];case 1:return q.sent(),[4,e.forcePartDefinitions(d)];case 2:q.sent();f=c.getPartDefinitionSync();
if(null===f)return[2,null];p=f.getReferrers();k=[];h=0;for(m=p;h<m.length;h++)n=m[h],k.push(n.getRuntimeId());return[2,k]}})})};c.prototype.getAttributes=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return c=d.sent(),null===c?[2,[]]:[2,c.getAttributes()]}})})};c.prototype.getProperties=function(b){return __awaiter(this,void 0,void 0,function(){var c=this,d,f,p,k,r,m;return __generator(this,
function(n){switch(n.label){case 0:return[4,this._getNodeOrRepItemFromId(b)];case 1:d=n.sent();if(null===d)return[2,null];f=null;p=[];k=d.getAttributes().then(function(a){null===f&&(f={});for(var b=0;b<a.length;b++){var c=a[b],d=c.getTitle(),c=c.getValue();f[d]=c}});p.push(k);r=function(d){null===f&&(f={});var e=c.getNetMatrix(b),l=(new a.Point3(e.m[0],e.m[1],e.m[2])).length(),e=e.transform(d.centerOfGravity),k=c.getUnit(b),p=a.Util.formatWithUnit(d.surfaceArea*l,k);f["Surface Area"]=""+p+h.Unicode.Subscript2;
d=a.Util.formatWithUnit(d.volume*l,k);f.Volume=""+d+h.Unicode.Subscript3;d=e.x.toLocaleString();l=e.y.toLocaleString();e=e.z.toLocaleString();f.COG="x:"+d+" y:"+l+" z:"+e};d instanceof e.RepresentationItem?(m=d.getPhysicalProperties(),null!==m&&r(m)):d instanceof e.ProductOccurrence&&(k=Promise.resolve(e.forcePartDefinition(d)).then(function(){return __awaiter(c,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,d.getPhysicalProperties()];case 1:return a=
b.sent(),null!==a&&r(a),[2]}})})}),p.push(k));return[4,a.Util.waitForAll(p)];case 2:return n.sent(),[2,f]}})})};c.prototype.addProperty=function(b,c,d){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return!1;c=new e.Attribute(a.AttributeType.String,c,d);b.addAttribute(c);return!0};c.prototype.setPhysicalProperties=function(a,c,d,f){a=this._assemblyTree.lookupRepresentationItem(a);if(null===a)return!1;c=new e.PhysicalProperties(d,f,c);a.setPhysicalProperties(c);return!0};c.prototype.getUserDataIndices=
function(b){var c=this._assemblyTree.lookupAnyTreeNode(b);if(null===c)throw new a.InvalidNodeIdError(b);return c.getUserDataIndices()};c.prototype.getUserData=function(b,c){var d=this._assemblyTree.lookupAnyTreeNode(b);if(null===d)throw new a.InvalidNodeIdError(b);return d.getUserData(c)};c.prototype.getInstanceIncs=function(a,c){a=this._assemblyTree.lookupAnyTreeNode(a);if(null===a)return console.assert(!1),[];var d=e.isOutOfHierarchy(a),f=new Set;return e.gatherInstanceIncsSync(a,c,d,f,e.WalkRestriction.None)};
c.prototype.getNodeFromInstanceInc=function(a,c,d,f){var p=this._assemblyTree.lookupAnyBodyByInstanceInc(c,d);null===p?(p=a?this._rectifyParent(c,null):this._assemblyTree.getRootNode(),p=this._assemblyTree.createMeshInstance(a,c,d,null,null,p,!1,f)):p instanceof e.PmiBody?p=p.getParent():p instanceof e.ViewFrame&&(a=p.getParent(),a);return p.getRuntimeId()};c.prototype._getAssociatedModelKey=function(b){if(b instanceof e.PartDefinition)return b.getModelKey();a.Util.TypeAssert(b);return this._getAssociatedModelKey(b.getParent())};
c.prototype.getAssociatedModelKey=function(a){var c=this._assemblyTree.lookupAnyTreeNode(a);return null===c?(c=this._assemblyTree.lookupAnyNonTreeNode(a),null===c?null:this._getAssociatedModelKey(c)):e.towardAttachContext(c).getMasterModelKey()};c.prototype.getMatrix=function(b){b=this._assemblyTree.lookupAnyNode(b);if(null===b)return new a.Matrix;b=b.getLocalTransform();return null===b?new a.Matrix:b.copy()};c.prototype.setMatrix=function(a,c,d){return __awaiter(this,void 0,void 0,function(){var f,
p;return __generator(this,function(k){f=this._assemblyTree.lookupAnyTreeNode(a);if(null===f)return[2];d?f.setLocalTransformAsInitial(c):f.overrideLocalTransform(c);p=e.isOutOfHierarchy(f);return[2,e.updateScMatrices(this._engine,this._callbackManager,[f],p)]})})};c.prototype.resetToInitialMatrix=function(a){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(f){c=this._assemblyTree.lookupAnyTreeNode(a);return null===c?[2]:c.hasLocalTransformOverride()?(c.removeLocalTransformOverride(),
d=e.isOutOfHierarchy(c),[2,e.updateScMatrices(this._engine,this._callbackManager,[c],d)]):[2]})})};c.prototype.getNetMatrix=function(b){b=this._assemblyTree.lookupAnyNode(b);return null===b?new a.Matrix:e.getNetMatrix(b)};c.prototype.getNodeOrRepItem=function(a){return __awaiter(this,void 0,void 0,function(){var c,d,f,p,k,h;return __generator(this,function(m){switch(m.label){case 0:if(!(a instanceof e.BodyInstance))return[3,7];c=a.getParent();d=c.getBodyInstances();f=0;m.label=1;case 1:return f<d.length?
d[f]!==a?[3,5]:[4,e.forcePartDefinition(c)]:[3,6];case 2:return m.sent(),[4,c.getPartDefinition()];case 3:return p=m.sent(),null===p?[2,null]:[4,p.value];case 4:return k=m.sent(),h=k.getRepresentationItems(),f<h.length?[2,h[f]]:[2,null];case 5:return++f,[3,1];case 6:return[3,8];case 7:if(a instanceof e.ProductOccurrence||a instanceof e.Pmi||a instanceof e.CadView||a instanceof e.PartDefinition||a instanceof e.RepresentationItem)return[2,a];m.label=8;case 8:return[2,null]}})})};c.prototype._getNodeOrRepItemFromId=
function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){c=this._assemblyTree.lookupAnyNode(a);return null===c?[2,null]:[2,this.getNodeOrRepItem(c)]})})};c.prototype.getEdgeCount=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return c=d.sent(),c instanceof e.RepresentationItem?[2,c.getEdgeCount()]:[2,0]}})})};c.prototype.getEdgeAttributes=
function(a,c){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(p){switch(p.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return d=p.sent(),d instanceof e.RepresentationItem&&(f=d.getEdgeAttributes(c),null!==f)?[2,f.copy()]:[2,null]}})})};c.prototype.getEdgeProperty=function(a,c){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(p){switch(p.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return d=
p.sent(),d instanceof e.RepresentationItem&&(f=d.getEdgeMeasurementProperty(c),null!==f)?[2,f.copy()]:[2,null]}})})};c.prototype.getFaceCount=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return c=d.sent(),c instanceof e.RepresentationItem?[2,c.getFaceCount()]:[2,0]}})})};c.prototype.getFaceAttributes=function(a,c){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,
function(p){switch(p.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return d=p.sent(),d instanceof e.RepresentationItem&&(f=d.getFaceAttributes(c),null!=f)?[2,f.copy()]:[2,null]}})})};c.prototype.getFaceProperty=function(a,c){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(p){switch(p.label){case 0:return[4,this._getNodeOrRepItemFromId(a)];case 1:return d=p.sent(),d instanceof e.RepresentationItem&&(f=d.getFaceMeasurementProperty(c),null!==f)?
[2,f.copy()]:[2,null]}})})};c.prototype.setEdgeProperty=function(a,c,d){a=this._assemblyTree.lookupRepresentationItem(a);null!==a&&e.MeasurementProperty.isEdge(d)&&a.setEdgeMeasurementProperty(c,d)};c.prototype.setFaceProperty=function(a,c,d){a=this._assemblyTree.lookupRepresentationItem(a);null!==a&&e.MeasurementProperty.isFace(d)&&a.setFaceMeasurementProperty(c,d)};c.prototype.getName=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?a.getName():null};c.prototype.getNodeExchangeId=
function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?a.getExchangeId():null};c.prototype.getFilters=function(){return this._assemblyTree.getFilters()};c.prototype.getFilterName=function(a){return this._assemblyTree.getFilterName(a)};c.prototype.getFiltersWithNode=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null===a?[]:this._assemblyTree.getFiltersWithNode(a)};c.prototype.getNodesFromFiltersId=function(a){return this._assemblyTree.getNodesFromFiltersId(a)};c.prototype.getLayers=
function(){return this._assemblyTree.getLayers()};c.prototype.getUniqueLayerNames=function(){return this._assemblyTree.getUniqueLayerNames()};c.prototype.getLayerName=function(a){return this._assemblyTree.getLayerName(a)};c.prototype.getLayerIdsFromName=function(a){return this._assemblyTree.getLayersIdFromName(a)};c.prototype.getNodeLayerId=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?a.getLayerId():null};c.prototype.getNodesFromLayer=function(a,c){a=this._assemblyTree.getNodesFromLayer(a,
c);return null===a?null:a.map(function(a){return a.getAuthoredId()})};c.prototype.getNodesFromLayers=function(a,c){a=this._assemblyTree.getNodesFromLayers(a,c);return null===a?null:a.map(function(a){return a.getAuthoredId()})};c.prototype.getNodesFromLayerName=function(a,c){a=this._assemblyTree.getNodesFromLayerName(a,c);return null===a?null:a.map(function(a){return a.getAuthoredId()})};c.prototype.createCadView=function(a,c,d,e,f,k,h,m,n){if(null===this._assemblyTree.lookupProductOccurrence(a))return null;
a=this._assemblyTree.lookupProductOccurrence(a);if(null===a)return null;for(var q=[],t=0;t<e.length;t++){var u=this._assemblyTree.lookupPmi(e[t]);null!==u&&q.push(u)}e=new Map;for(t=0;t<h.length;t++)u=h[t],e.set(u[0],u[1]);return this._assemblyTree.createCadView(this._engine,a,c,d,q,f,k,e,m,n).getRuntimeId()};c.prototype.getCadViews=function(){var a=this._assemblyTree.getFirstProductOccurrenceWithView(),c={};this._assemblyTree.forEachCadView(function(d){var e=d.getRuntimeId(),f=d.getParent();d=f===
a?d.getName()||"(null)":f.getName()+" - "+d.getName();c[e]=d});return c};c.prototype.activateCadView=function(a,c){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return this._assemblyTree.hasActiveCadView()?[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:return e.sent(),[2,this.activateCadView(a,c)];case 2:return d=this._assemblyTree.lookupCadView(a),null===d?[2]:[2,this._assemblyTree.activateCadView(d,c)]}})})};c.prototype.getCadViewPmis=
function(a){var c=this._assemblyTree.lookupCadView(a);if(null===c)return[];a=[];for(var d=0,c=this._assemblyTree.getCadViewPmis(c);d<c.length;d++)a.push(c[d].getRuntimeId());return a};c.prototype._disableCadConfigurations=function(){this._cadConfigurationsEnabled=!1;return this._assemblyTree.deactivateActiveCadView()};c.prototype.cadConfigurationsEnabled=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._cadConfigurationsEnabled&&
this._assemblyTree.seenExternalModel()?[4,this._disableCadConfigurations()]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2,this._cadConfigurationsEnabled]}})})};c.prototype.getCadConfigurations=function(){var a={};this._assemblyTree.forEachCadConfiguration(function(c){var d=c.getRuntimeId();c=c.getName()||"(null)";a[d]=c});return a};c.prototype.getDefaultCadConfiguration=function(){var a=this._assemblyTree.getDefaultCadConfiguration();return null!==a?a.getRuntimeId():null};c.prototype.getActiveCadConfiguration=
function(){var a=this._assemblyTree.getActiveCadConfiguration();return null!==a?a.getRuntimeId():null};c.prototype._activateCadConfiguration=function(a){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return[4,this._assemblyTree.activateCadConfiguration(a)];case 1:return d.sent(),c=a.getRuntimeId(),this._callbackManager.trigger("configurationActivated",c),[2]}})})};c.prototype.activateCadConfiguration=function(a){return __awaiter(this,
void 0,void 0,function(){var c;return __generator(this,function(d){c=this._assemblyTree.lookupProductOccurrence(a);return null===c?[2]:[2,this._activateCadConfiguration(c)]})})};c.prototype.activateDefaultCadConfiguration=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){a=this._assemblyTree.getDefaultCadConfiguration();return null===a?[2]:[2,this._activateCadConfiguration(a)]})})};c.prototype.getPmis=function(){var a={};this._assemblyTree.forEachPmi(function(c){var d=
c.getRuntimeId();c=c.getName()||"(null)";a[d]=c});return a};c.prototype.getPmiType=function(a){a=this._assemblyTree.lookupPmi(a);return null===a?e.PmiType.Unknown:a.getPmiType()};c.prototype.getPmiSubType=function(b){b=this._assemblyTree.lookupPmi(b);return null===b?a.PmiSubType.Unknown:b.getPmiSubType()};c.prototype.getUnit=function(a){a=this._assemblyTree.lookupAnyNode(a);return a instanceof e.ProductOccurrence?a.getMeasurementUnit():a instanceof e.BodyInstance?a.getParent().getMeasurementUnit():
1};c.prototype._rectifyParent=function(a,c){if(null!==c){c=this._assemblyTree.lookupProductOccurrence(c);if(null!==c)return c;console.assert(!1)}a=this._assemblyTree.getInclusionContexts(a);return 0<a.length?(a=a[0].getChildren(),console.assert(0<a.length),a[0]):this._assemblyTree.getRootNode()};c.prototype.createMeshInstance=function(a,c,d,e,f,k){e=this._rectifyParent(a,e);return this._assemblyTree.createMeshInstance(!0,a,c,null,d,e,f,k).getRuntimeId()};c.prototype.createPmiInstance=function(a,c,
d,e,f,k,h){h=this._rectifyParent(a,h);return this._assemblyTree.createPmiInstance(a,c,null,k,h,d,e,f).getRuntimeId()};c.prototype.setVisibilitiesByMap=function(a,c){var d=this,f=new Map;a.forEach(function(a,b){b=d._assemblyTree.lookupAnyTreeNode(b);null!==b&&f.set(b,a)});a=this._assemblyTree.getRootNode();return e.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,a,f,!1,c,null)};c.prototype.setVisibilitiesByValue=function(a,c,d){for(var f=new Map,p=0;p<a.length;p++){var k=this._assemblyTree.lookupAnyTreeNode(a[p]);
null!==k&&f.set(k,c)}a=this._assemblyTree.getRootNode();return e.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,a,f,!1,d,null)};c.prototype.resetAllVisibilities=function(){var a=new Map,c=this._assemblyTree.getRootNode(),d=this._assemblyTree.getActiveCadConfiguration();return e.updateVisibilities(this._assemblyTree,this._engine,this._callbackManager,c,a,!0,null,d)};c.prototype.resetAllTransforms=function(){return __awaiter(this,void 0,void 0,function(){var a,c;return __generator(this,
function(d){switch(d.label){case 0:return a=this._assemblyTree.getRootNode(),[4,e.resetTransforms(a)];case 1:return(c=d.sent())?[2,e.updateScMatrices(this._engine,this._callbackManager,[a],!1)]:[2]}})})};c.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return this._cadConfigurationsEnabled=!0,this.isACadDrawing()?[2,this._callbackManager.promiseTrigger("_resetDrawing",null)]:this._assemblyTree.hasActiveCadView()?
[4,this._assemblyTree.deactivateActiveCadView()]:[3,2];case 1:c.sent(),c.label=2;case 2:return b=[this.resetAllVisibilities(),this.resetAllTransforms()],[4,a.Util.waitForAll(b)];case 3:return c.sent(),[2]}})})};c.prototype.setPmiColor=function(b,c){void 0===c&&(c=this.getAbsoluteRootNodeId());c=this.getInstanceIncs(c,6);0<c.length&&(this._engine.setPartColor(c,a.ElementType.Faces,b),this._engine.setPartColor(c,a.ElementType.Lines,b))};c.prototype.resetPmiColor=function(b){void 0===b&&(b=this.getAbsoluteRootNodeId());
b=this.getInstanceIncs(b,6);0<b.length&&(this._engine.unsetPartColor(b,a.ElementType.Faces),this._engine.unsetPartColor(b,a.ElementType.Lines))};c.prototype.getPmiTopologyReferences=function(a){a=this._assemblyTree.lookupPmi(a);return null===a?null:a.getPmiTopologyReferences(this._assemblyTree)};c.prototype.createNode=function(a,c,d,f,p){void 0===f&&(f=null);void 0===p&&(p=!0);var k=null;null!==a&&(k=this._assemblyTree.lookupProductOccurrence(a));null===k&&(k=this._assemblyTree.getRootNode());null===
d||e.isAuthoredId(d)||(d=null);return this._assemblyTree.createNode(k,c,d,f,p).getRuntimeId()};c.prototype.deleteNode=function(b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){c=this._assemblyTree.lookupAnyTreeNode(b);if(null!==c){if(c instanceof e.ProductOccurrence||c instanceof e.BodyInstance)return[2,this._assemblyTree.deleteNode(c)];throw new a.InvalidNodeTypeError(b,0,2);}return[2]})})};c.prototype.createPart=function(a){return this._assemblyTree.createPart(a).getRuntimeId()};
c.prototype.setPart=function(a,c){a=this._assemblyTree.lookupProductOccurrence(a);if(null===a)return!1;c=this._assemblyTree.lookupPartDefinition(c);if(null===c)return!1;this._assemblyTree.setPart(a,c);return!0};c.prototype.createAndAddRepItem=function(a,c){a=this._assemblyTree.lookupPartDefinition(a);return null===a?null:a.createRepItem(this._assemblyTree,c).getRuntimeId()};c.prototype.getLowestAvailableNodeId=function(){return this._assemblyTree.getLowestAvailableNodeId()};c.prototype.getType=function(b){b=
this._assemblyTree.lookupAnyNode(b);return null===b?a.NodeType.Unknown:e.getNodeType(b)};c.prototype.isVisible=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?a.isVisible():!1};c.prototype.getBranchVisibility=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?e.getBranchVisibility(a):1};c.prototype.setMeshLevel=function(a,c){for(var d=[],f=0;f<a.length;f++){var p=this._assemblyTree.lookupAnyTreeNode(a[f]);null!==p&&d.push(p)}return e.setMeshLevels(this._engine,
d,c)};c.prototype.setEnableAutomaticUnitScaling=function(a){this._assemblyTree.setAutomaticMeasurementUnitScaling(a)};c.prototype.setBehaviorInitiallyHidden=function(a){this._assemblyTree.setInitiallyHiddenStayHidden(a)};c.prototype.isACadDrawing=function(){return this._assemblyTree.containsDrawings()};c.prototype.isMeasurable=function(){return this._assemblyTree.isMeasureable()};c.prototype.getModelFileNameFromNode=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?e.towardAttachContext(a).getOriginalFileName():
null};c.prototype.getModelFileTypeFromNode=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?e.towardAttachContext(a).getOriginalFileType():null};c.prototype.isAnnotationView=function(b){var c=this._assemblyTree.lookupCadView(b);if(null!==c)return c.isAnnotationView();throw new a.InvalidNodeTypeError(b,3);};c.prototype.preventNodeDeletion=function(b){b=this._assemblyTree.lookupBodyInstance(b);if(null===b)throw new a.InternalLogicError;this._assemblyTree.preventNodeDeletion(b)};
c.prototype.preventMeshDeletion=function(a){this._assemblyTree.preventMeshDeletion(a)};c.prototype.getBounding=function(a,c,d,f){return e.getBoundingByNodeId(this._assemblyTree,this._engine,a,c,d,f)};c.prototype.getIdOffset=function(a){a=this._assemblyTree.lookupAnyNode(a);return null!==a?(a instanceof e.PartDefinition?a.getInclusionContextForNodeId():a instanceof e.RepresentationItem?a.getParent().getInclusionContextForNodeId():e.towardInclusionContext(a)).getIdOffset():0};c.prototype.isNodeLoaded=
function(b){var c=this._assemblyTree.lookupAnyNode(b);if(null===c)throw new a.InvalidNodeIdError(b);return c.isLoaded()};c.prototype.shutdown=function(){var a=this._treeLoader.cancelPendingLoads();a};c.prototype.isReady=function(){console.assert(2!==this._readyPromise.state);return 0!==this._readyPromise.state};c.prototype.waitForReady=function(){return this._readyPromise};c.prototype.lookupAnyTreeNode=function(a){return this._assemblyTree.lookupAnyTreeNode(a)};c.prototype.lookupAnyBody=function(a){return this._assemblyTree.lookupAnyBody(a)};
c.prototype.lookupBodyInstance=function(a){return this._assemblyTree.lookupBodyInstance(a)};c.prototype.gatherInstanceIncsFromNodeIds=function(a,c,d){return e.gatherInstanceIncsByNodeIdsSync(this._assemblyTree,a,c,d)};c.prototype.requestNodes=function(a){return __awaiter(this,void 0,void 0,function(){var c,d,e,f,k;return __generator(this,function(h){c=[];d=0;for(e=a;d<e.length;d++)f=e[d],k=this._assemblyTree.lookupAnyTreeNode(f),null!==k&&c.push(k);return[2,this._assemblyTree.requestNodes(this._treeLoader,
c,!1)]})})};c.prototype.isWithinExternalModel=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);if(null===a)return!1;for(a=e.towardProductOccurrence(a);null!==a;){if(a.isExternalModelRoot())return!0;a=e.towardProductOccurrence(a.getParent())}return!1};c.prototype.getNodeGenericType=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?e.getNodeGenericType(a):null};c.prototype.getNodeGenericId=function(a){a=this._assemblyTree.lookupAnyTreeNode(a);return null!==a?a.getGenericId():
null};c.prototype.getNodeByGenericId=function(a){a=this._assemblyTree.getNodeByGenericId(a);return null!==a?a.getRuntimeId():null};c.prototype.getNodesByGenericType=function(a){a=this._assemblyTree.getNodesByGenericType(a);if(null!==a){var c=new Set;a.forEach(function(a){c.add(a.getRuntimeId())});return c}return null};c.prototype.getGenericTypes=function(){var a=[];this._assemblyTree.genericTypeToNodes().forEach(function(c,d){a.push(d)});return a};c.prototype.getGenericTypeIdMap=function(){var a=
new Map;this._assemblyTree.genericTypeToNodes().forEach(function(c,d){var e=new Set;c.forEach(function(a){e.add(a.getRuntimeId())});a.set(d,e)});return a};c.prototype.hasEffectiveGenericType=function(b,c){var d=this.lookupAnyTreeNode(b);if(null===d)throw new a.InvalidNodeIdError(b);return e.hasEffectiveGenericType(d,c)};c.prototype.registerGenericId=function(a,c){return this._assemblyTree.registerGenericGlobalId(a,c)};c.prototype.registerGenericType=function(a,c){return this._assemblyTree.registerGenericType(a,
c)};c.prototype.firstAssemblyDataHeader=function(){return this._treeLoader.firstAssemblyDataHeader()};return c}();e.ModelStructure=d})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(d){for(;;)if(d instanceof e.InclusionContext)d=d.getParent();else{if(d instanceof e.AttachContext)return d;if(d instanceof e.NodeMixin)d=d.getParent();else if(d instanceof e.LoadContext){if(d=d.getParent(),null===d)throw new a.InternalLogicError;}else a.Util.TypeAssert(d),d=d.getInclusionContext()}}e.getNetMatrix=function(d){for(var c=new a.Matrix;null!==d;)if(d instanceof e.NodeMixin){var b=d.getLocalTransform();b&&(c=a.Matrix.multiply(c,b));d=d instanceof
e.PartDefinition?null:d.getParent()}else if(d instanceof e.InclusionContext)d=d.getParent();else if(d instanceof e.AttachContext)d=d.getParent();else if(d instanceof e.LoadContext)d=d.getParent();else{a.Util.TypeAssert(d);break}return c};e.towardContainerNode=function(d){for(;;)if(d instanceof e.NodeMixin)if(d instanceof e.BodyMixin)d=d.getParent();else return d;else if(d instanceof e.LoadContext)d=d.getParent();else if(d instanceof e.InclusionContext)d=d.getParent();else if(d instanceof e.AttachContext)d=
d.getParent();else{if(null===d)return null;a.Util.TypeAssert(d);console.assert(!1);d=d.getInclusionContext()}};e.isOutOfHierarchy=function(a){return a instanceof e.BodyMixin||a instanceof e.ProductOccurrence?a.isOutOfHierarchy():!1};e.getBranchVisibility=function(a){return a instanceof e.ProductOccurrence||a instanceof e.Pmi||a instanceof e.CadView?a.getBranchVisibility():a.isVisible()?2:1};e.getNodeType=function(d){if(d instanceof e.ProductOccurrence)return d.hasBodyInstances()?d.isADrawingSheetNode()?
a.NodeType.DrawingSheet:a.NodeType.PartInstance:a.NodeType.AssemblyNode;if(d instanceof e.PartDefinition)return a.NodeType.Part;if(d instanceof e.PmiBody)return a.NodeType.PmiBody;if(d instanceof e.ViewFrame)return a.NodeType.ViewFrame;if(d instanceof e.BodyInstance)return a.NodeType.BodyInstance;if(d instanceof e.RepresentationItem)switch(d.getBodyType()){case e.BodyType.BRep:return a.NodeType.BrepBody;case e.BodyType.Tessellation:return a.NodeType.TessBody;case e.BodyType.Wireframe:return a.NodeType.WireBody;
case e.BodyType.PointCloud:return a.NodeType.PointsBody;default:return a.NodeType.Body}else{if(d instanceof e.Pmi)return a.NodeType.Pmi;a.Util.TypeAssert(d);return a.NodeType.CadView}};e.getNodeGenericType=function(a){var c=a.getGenericTypeId();return null!==c&&(a=f(a).getGenericTypeMaps(),null!==a)?a.getRight(c)||null:null};e.towardInclusionContext=function(d){for(;;)if(d instanceof e.NodeMixin)d=d.getParent();else{if(d instanceof e.InclusionContext)return d;if(d instanceof e.PmiBody)d=d.getParent();
else if(d instanceof e.ViewFrame)d=d.getParent();else return a.Util.TypeAssert(d),d.getInclusionContext()}};e.towardLoadContext=function(d){for(;;)if(d instanceof e.AttachContext)d=d.getParent();else{if(d instanceof e.LoadContext)return d;d instanceof e.NodeMixin?d=d.getParent():d instanceof e.InclusionContext?d=d.getParent():(a.Util.TypeAssert(d),d=d.getInclusionContext())}};e.towardAttachContext=f;e.towardAttachRoot=function(d){for(var c=null;;)if(d instanceof e.ProductOccurrence)c=d,d=d.getParent();
else if(d instanceof e.NodeMixin)d=d.getParent();else{if(d instanceof e.InclusionContext){if(null===c)throw new a.InternalLogicError;return c}a.Util.TypeAssert(d);d=d.getInclusionContext()}};e.towardProductOccurrence=function(d){for(;;){if(d instanceof e.ProductOccurrence)return d;if(d instanceof e.AttachContext)d=d.getParent();else if(d instanceof e.InclusionContext)d=d.getParent();else if(d instanceof e.LoadContext){if(d=d.getParent(),null===d)return null}else if(d instanceof e.BodyMixin)d=d.getParent();
else if(d instanceof e.Pmi)d=d.getParent();else if(d instanceof e.CadView)d=d.getParent();else return a.Util.TypeAssert(d),console.assert(!1),null}}})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){(function(a){})(e.GenericTypeId||(e.GenericTypeId={}));var f=function(){function d(c,b,d,e,f){this._inclusionContexts=this._reservedNodeIdOffset=null;this._originalFileName="";this._originalFileType=a.FileType.Unknown;this._genericTypeMaps=null;console.assert(4294967295!==e);this._remapper=c;this._attachScope=b;this._attachedInvisibly=d;this._masterModelKey=e;this._parent=f}d.prototype.getRootNodeMetaData=function(a){return __awaiter(this,void 0,void 0,function(){var b,
d,f,v,p,k;return __generator(this,function(h){switch(h.label){case 0:if(4294967295===this._masterModelKey)return[2,null];b=a.getAbstractScEngine();d=this._masterModelKey;return[4,b.safeGetMetaData(d,1)];case 1:f=h.sent();if(null===f)return[3,4];v=a.tryParseHeader(f);return null===v?[2,new e.AssemblyData(null,f)]:[4,v];case 2:return p=h.sent(),this._originalFileName=p.originalFileName,this._originalFileType=p.originalFileType,[4,b.safeGetMetaData(d,p.rootAssemblyDataKey())];case 3:return k=h.sent(),
null!==k?[2,new e.AssemblyData(p,k)]:[2,null];case 4:return[2,null]}})})};d.prototype.getAttachScope=function(){return this._attachScope};d.prototype.attachedInvisibly=function(){return this._attachedInvisibly};d.prototype.getMasterModelKey=function(){return this._masterModelKey};d.prototype.addInclusionContext=function(a){console.assert(a.getParent()===this);this._inclusionContexts=h.TerseArray.push(this._inclusionContexts,a)};d.prototype.getRemapper=function(){return this._remapper};d.prototype.getParent=
function(){return this._parent};d.prototype.getChildren=function(){var a=this._inclusionContexts;if(null===a)return[];if(Array.isArray(a)){console.assert(0<a.length);for(var b=a[0].getChildren(),d=1;d<a.length;++d)h.append(b,a[d].getChildren());return b}return a.getChildren()};d.prototype.split=function(a,b,g){return new d(this._remapper,a,b,this._masterModelKey,g)};d.prototype.hasChildren=function(){return null!==this._inclusionContexts};d.prototype.removeProductOccurrence=function(a){for(var b=
null,d=h.TerseArray.toArray(this._inclusionContexts),e=0,f=d;e<f.length;e++){var p=f[e];if(p.removeProductOccurrence(a)){b=p;break}}if(null===b)return!1;d=d.filter(function(a){return a.hasChildren()});this._inclusionContexts=0===d.length?null:h.TerseArray.fromArray(d);return!0};d.prototype.purgeContents=function(){for(var c=[],b=0,d=h.TerseArray.toArray(this._inclusionContexts);b<d.length;b++){var e=d[b].purgeContents();c.push(e)}this._inclusionContexts=null;return a.Util.waitForAll(c)};d.prototype.isLoaded=
function(){if(this._inclusionContexts instanceof e.InclusionContext)return this._inclusionContexts.isLoaded();if(null!==this._inclusionContexts)for(var a=0,b=this._inclusionContexts;a<b.length;a++)if(!b[a].isLoaded())return!1;return!0};d.prototype.setReservedNodeIdOffset=function(a){console.assert(null===this._reservedNodeIdOffset);this._reservedNodeIdOffset=a};d.prototype.getReservedNodeIdOffset=function(){return this._reservedNodeIdOffset};d.prototype.forgetReservedNodeIdOffset=function(){console.assert(null!==
this._reservedNodeIdOffset);this._reservedNodeIdOffset=null};d.prototype.getOriginalFileName=function(){return this._originalFileName};d.prototype.getOriginalFileType=function(){return this._originalFileType};d.prototype.setGenericTypeMaps=function(a){this._genericTypeMaps=a};d.prototype.getGenericTypeMaps=function(){return this._genericTypeMaps};return d}();e.AttachContext=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(a,b,d,f){this._productOccurrences=null;console.assert(void 0!==d);console.assert(0===d===(0===f));this._parent=b;this._inclusionKey=d;this._modelKey=f;b=e.towardAttachContext(b);d=b.getReservedNodeIdOffset();null!==d?b.forgetReservedNodeIdOffset():d=a.newNodeIdOffset();this._nodeIdOffset=d;a.registerInclusionContext(this)}d.prototype.split=function(a,b){return new d(a,b,this._inclusionKey,this._modelKey)};d.prototype.getIdOffset=function(){return this._nodeIdOffset};
d.prototype.toRuntimeId=function(a){console.assert(e.isAuthoredId(a));return a+this._nodeIdOffset};d.prototype.getInclusionKey=function(){return this._inclusionKey};d.prototype.getModelKey=function(){return this._modelKey};d.prototype.getParent=function(){return this._parent};d.prototype.addProductOccurrence=function(a){console.assert(a.getParent()===this);this._productOccurrences=h.TerseArray.push(this._productOccurrences,a)};d.prototype.getChildren=function(){console.assert(null!==this._productOccurrences);
return h.TerseArray.toArray(this._productOccurrences)};d.prototype.removeProductOccurrence=function(a){var b=h.TerseArray.toArray(this._productOccurrences),d=b.length,b=b.filter(function(b){return b!==a});0===b.length?delete this._productOccurrences:this._productOccurrences=h.TerseArray.fromArray(b);return b.length<d};d.prototype.purgeContents=function(){for(var c=[],b=0,d=h.TerseArray.toArray(this._productOccurrences);b<d.length;b++){var e=d[b].purgeContents();c.push(e)}this._productOccurrences=
null;return a.Util.waitForAll(c)};d.prototype.hasChildren=function(){return null!==this._productOccurrences};d.prototype.isLoaded=function(){if(this._productOccurrences instanceof e.ProductOccurrence)return this._productOccurrences.isLoaded();if(null!==this._productOccurrences)for(var a=0,b=this._productOccurrences;a<b.length;a++)if(!b[a].isLoaded())return!1;return!0};return d}();e.InclusionContext=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(a,b,d){this._attachContexts=this._handledExternalModels=null;this._registeredScsModelKeys=new Map;this._parent=a;this._debugLoadString=b;this._debugLoadString;this._scsBufferCache=d}d.prototype.handleExternalModel=function(a,b,d){b=b.getInclusionKey();a=h.compressUint(d)+" "+h.compressUint(b)+" "+h.compressUint(a);null===this._handledExternalModels&&(this._handledExternalModels=new Set);if(this._handledExternalModels.has(a))return!1;
this._handledExternalModels.add(a);return!0};d.prototype.getParent=function(){return this._parent};d.prototype.addAttachContext=function(a){this._attachContexts=h.TerseArray.push(this._attachContexts,a)};d.prototype.getChildren=function(){var a=this._attachContexts;if(null===a)return[];if(Array.isArray(a)){console.assert(0<a.length);for(var b=a[0].getChildren(),d=1;d<a.length;++d)h.append(b,a[d].getChildren());return b}return a.getChildren()};d.prototype.hasChildren=function(){return null!==this._attachContexts};
d.prototype.removeProductOccurrence=function(a){for(var b=null,d=h.TerseArray.toArray(this._attachContexts),e=0,f=d;e<f.length;e++){var p=f[e];if(p.removeProductOccurrence(a)){b=p;break}}if(null===b)return!1;d=d.filter(function(a){return a.hasChildren()});this._attachContexts=0===d.length?null:h.TerseArray.fromArray(d);return!0};d.prototype.purgeContents=function(){for(var c=[],b=0,d=h.TerseArray.toArray(this._attachContexts);b<d.length;b++){var e=d[b].purgeContents();c.push(e)}this._attachContexts=
null;return a.Util.waitForAll(c)};d.prototype.isLoaded=function(){if(this._attachContexts instanceof e.AttachContext)return this._attachContexts.isLoaded();if(null!==this._attachContexts)for(var a=0,b=this._attachContexts;a<b.length;a++)if(!b[a].isLoaded())return!1;return!0};d.prototype.initializeScsModelKeysOf=function(a){console.assert(void 0===this._registeredScsModelKeys.get(a));this._registeredScsModelKeys.set(a,h.TrackedOpenPromise.create())};d.prototype.getScsModelKeysOf=function(a){a=this._registeredScsModelKeys.get(a);
return void 0===a?null:a};d.prototype.markAsFirstLoad=function(){console.assert(void 0===this._isFirstLoad);this._isFirstLoad=!0};d.prototype.isFirstLoad=function(){return!0===this._isFirstLoad};d.prototype.toScsBuffer=function(c,b){return __awaiter(this,void 0,void 0,function(){var d=this,e;return __generator(this,function(f){e=h.LazyPromise.create(function(){return __awaiter(d,void 0,void 0,function(){var d;return __generator(this,function(g){switch(g.label){case 0:return[4,b(c)];case 1:g=d=g.sent();
if("string"===typeof g)throw new a.InternalLogicError;return[2,g]}})})});return null===this._scsBufferCache?[2,e]:[2,this._scsBufferCache.load(c,e)]})})};d.prototype.onLoadComplete=function(){this._scsBufferCache=null};return d}();e.LoadContext=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(e){var f=function(){function c(a){this._referrers=null;this._prototype=a}c.prototype._addReferrer=function(b){this._referrers=a.TerseArray.push(this._referrers,b)};c.prototype._getReferrers=function(){return a.TerseArray.toArray(this._referrers)};c.prototype._getPrototype=function(){return this._prototype};c.prototype._removeReferrer=function(b){var c=!1,d=a.TerseArray.toArray(this._referrers),d=d.filter(function(a){return a===b?(c=!0,!1):!0});if(!c)return!1;0===
d.length?delete this._referrers:this._referrers=a.TerseArray.fromArray(d);return!0};c.prototype._purgeContents=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return this._prototype.isUnforced()?[3,3]:[4,this._prototype];case 1:return a=c.sent(),[4,a.purgeContents()];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._isLoaded=function(){return this._prototype.isResolved()&&this._prototype.getResolved().isLoaded()};
return c}();e.SharedPrototypeContext=f;var d=function(){function c(b,c){b instanceof f&&(b=a.LazyObject.create(b));this._shared=b;this._inclusionContext=c}c.prototype.getInclusionContext=function(){return this._inclusionContext};c.prototype.addReferrer=function(a){this._shared.get()._addReferrer(a)};c.prototype.getReferrers=function(){return this._shared.get()._getReferrers()};c.prototype.getProductOccurrence=function(){return this._shared.get()._getPrototype()};c.prototype.removeReferrer=function(a){return this._shared.get()._removeReferrer(a)?
(a=a.removePrototype(),console.assert(this===a),!0):!1};c.prototype.removeAllReferrers=function(){for(var a=0,c=this.getReferrers();a<c.length;a++)this.removeReferrer(c[a])||console.assert(!1)};c.prototype.purgeContents=function(){return this._shared.get()._purgeContents()};c.prototype.isLoaded=function(){return this._shared.get()._isLoaded()};return c}();e.PrototypeContext=d})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function a(){this._bits2=this._bits1=0}a.prototype.hasBits1=function(a){return h.hasBits(this._bits1,a)};a.prototype.hasBits2=function(a){return h.hasBits(this._bits2,a)};a.prototype.parseBits1=function(a){this._bits1=a.parseIndex_32()};a.prototype.parseBits2=function(a){this.hasBits1(1073741824)&&(this._bits2=a.parseIndex_32())};return a}();e.NodeParseBits=f;var d=function(){return function(a,c){this.shown=a;this.removed=c}}();e.AssemblyVisibility=
d;var c=function(){function b(a){this._bytes=a.bytes;this._header=a.header;this._dataView=new DataView(this._bytes.buffer,this._bytes.byteOffset,this._bytes.byteLength);this._currentPos=0}b.prototype.hasNext=function(){return this._currentPos<this._bytes.length};b.prototype.parseCount_32=function(){return this._parseUint_32()};b.prototype.parseIndex_32=function(){return this._parseUint_32()};b.prototype.parseAssemblyDataVersion=function(){return{major:this._parseUint_32(),minor:this._parseUint_32()}};
b.prototype.parseAssemblyDataHeaderVersion=function(){return this._parseUint_32()};b.prototype.parseVisibility=function(){var a=this._parseInt_8(),b=h.hasBits(a,2),a=h.hasBits(a,1);return new d(b,a)};b.prototype.parseProductBits=function(){var a=this._parseUint_8();return null!==this._header&&2<=this._header.headerVersion||!h.hasBits(a,6)?a:a&-7|32};b.prototype.parseCString=function(){for(var a=this._currentPos,b=this._bytes[this._currentPos++];0!==b;)b=this._bytes[this._currentPos++];return h.utf8ArrayToStr(this._bytes.subarray(a,
this._currentPos-1))};b.prototype.parseBytes=function(a){var b=this._currentPos;this._currentPos+=a;a=this._bytes.subarray(b,this._currentPos);return new Uint8Array(a)};b.prototype.parseNodeId=function(){var a=this._parseUint_32();console.assert(a!==e.invalidNodeId);return a};b.prototype.parseLayerId=function(){var a=this._parseUint_32();console.assert(a!==e.invalidNodeId);return a};b.prototype.parseGenericTypes=function(){for(var a=this._parseUint_32(),b=new h.Bimap,c=0;c<a;c++){var d=this.parseCString(),
e=this._parseUint_32();b.set(e,d)}return b};b.prototype.parseGenericTypeId=function(){return this._parseUint_32()};b.prototype.parseGenericId=function(){return this.parseCString()};b.prototype._parseScKey=function(){var a=this._parseUint_32();console.assert(4294967295!==a);return a};b.prototype.parseDataKey=function(){return this._parseScKey()};b.prototype.parseInstanceKey=function(){return this._parseScKey()};b.prototype.parseMeshKey=function(){return this._parseScKey()};b.prototype.parseModelKey=
function(a){var b=this._parseScKey();return null!==a?a.getEffectiveModelKey(b):b};b.prototype.parseInclusionKey=function(a,b){var c=this._parseScKey();return null!==a?a.getEffectiveInclusionKey(c,b):c};b.prototype._parseInt_8=function(){return this._dataView.getInt8(this._currentPos++)};b.prototype._parseUint_8=function(){return this._dataView.getUint8(this._currentPos++)};b.prototype._parseUint_32=function(){var a=this._dataView.getUint32(this._currentPos,!0);this._currentPos+=4;return a};b.prototype._parseFloat_32=
function(){var a=this._dataView.getFloat32(this._currentPos,!0);this._currentPos+=4;return a};b.prototype._parseFloat_64=function(){var a=this._dataView.getFloat64(this._currentPos,!0);this._currentPos+=8;return a};b.prototype.parseFloat_32=function(){return this._parseFloat_32()};b.prototype.parseFloat_64=function(){return this._parseFloat_64()};b.prototype.parseAttributeType=function(){return this._parseInt_8()};b.prototype.parseNodeParseBits=function(){var a=new f;a.parseBits1(this);a.parseBits2(this);
return a};b.prototype.parseViewParseBits=function(){return this._parseUint_32()};b.prototype.parsePmiParseBits=function(){return this._parseUint_32()};b.prototype.parseLayerParseBits=function(){return this._parseUint_32()};b.prototype.parseBoolean=function(){return 0!==this._parseUint_8()};b.prototype.parsePoint3_32=function(){return new a.Point3(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePoint3_64=function(){return new a.Point3(this._parseFloat_64(),this._parseFloat_64(),
this._parseFloat_64())};b.prototype.parsePlane3_32=function(){return a.Plane.createFromCoefficients(this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32(),this._parseFloat_32())};b.prototype.parsePmiType=function(){return this._parseUint_32()};b.prototype.parsePmiSubType=function(){return this._parseUint_32()};b.prototype.parsePmiTopoRef=function(){return this._parseInt_8()};b.prototype.parseBodyType=function(){return this._parseUint_8()};b.prototype.parseFaceType=function(){return this._parseInt_8()};
b.prototype.parseEdgeType=function(){return this._parseInt_8()};b.prototype.parseUserDataIndex=function(){var a=this._parseUint_32(),b=this._parseUint_32();return 2097151>=b?4294967296*b+a:(""+b.toString(16)+h.zeroPadHex32(a)).toUpperCase()};b.prototype.getHeader=function(){return this._header};return b}();e.AssemblyDataParser=c})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(){function a(c,b){this._inclusionsOf=new Map;this._masterModelKey=4294967295;this._prototypeInstanceCount=-1;this._attachScope=c;this._attachedInvisibly=b}a.prototype.getAttachScope=function(){return this._attachScope};a.prototype.getMasterModelKey=function(){console.assert(4294967295!==this._masterModelKey);return this._masterModelKey};a.prototype.getModelKeys=function(){var a=[];this._inclusionsOf.forEach(function(b,d){b;a.push(d)});return a};
a.prototype.hasInclusions=function(){return 0<this._inclusionsOf.size};a.prototype.getAllInclusions=function(){var a=[];this._inclusionsOf.forEach(function(b,d){for(var e=0;e<b.length;e++)a.push(b[e],d)});return a};a.prototype.getInclusionsOf=function(a){var b=this._inclusionsOf.get(a);if(void 0===b)return[];for(var d=[],e=0;e<b.length;e++)d.push(b[e],a);return d};a.prototype.hasModelIncluded=function(a){return this._inclusionsOf.has(a)};a.prototype.attachedInvisibly=function(){return this._attachedInvisibly};
a.prototype.prototypeInstanceCount=function(){console.assert(0<=this._prototypeInstanceCount);return this._prototypeInstanceCount};a.prototype.registerInclusion=function(a,b){var d=this._inclusionsOf.get(b);void 0===d?this._inclusionsOf.set(b,[a]):d.push(a)};a.prototype.registerMasterModelKey=function(a){console.assert(4294967295===this._masterModelKey);this._masterModelKey=a};a.prototype.registerPrototypeInstanceCount=function(a){console.assert(-1===this._prototypeInstanceCount);this._prototypeInstanceCount=
a};return a}();a.AttachInfoBuilder=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(e){var f=function(){function d(){this._prevPriorityValue=1;this._priorityProxies=new Map}d.prototype._getPriorityCompareValue=function(a){if("number"===typeof a)return a;a=this._priorityProxies.get(a);null!==a.worldBounding&&console.assert(1>=a.priorityHeuristic);return a.priorityHeuristic};d.prototype.comparePriority=function(a,b){a=this._getPriorityCompareValue(a);b=this._getPriorityCompareValue(b);return a<b};d.prototype._updateHeuristicInfo=function(c,b){if(null!==
b.worldBounding){var d=a.toVec3(b.worldBounding.center()),e=a.toVec3(b.worldBounding.extents());c=c.calculateAttachHeuristic(e,d);b.priorityHeuristic=c}null!==b.xmlAttachInfo&&b.xmlAttachInfo.directlyRequested&&(null===b.worldBounding&&(b.priorityHeuristic=0),b.priorityHeuristic+=-1E6)};d.prototype.createPriority=function(a,b,d){if(null===d)return++this._prevPriorityValue;var e=Object.create(null),f;null!==d.bounding?(b=b.transformBox(d.bounding),f=0):(b=null,f=++this._prevPriorityValue);d={xmlAttachInfo:d,
worldBounding:b,priorityHeuristic:f};this._updateHeuristicInfo(a,d);this._priorityProxies.set(e,d);return e};d.prototype.destroyPriority=function(a){"object"===typeof a&&this._priorityProxies.delete(a)};d.prototype.onViewChange=function(a){var b=this;this._priorityProxies.forEach(function(d){b._updateHeuristicInfo(a,d)})};d.prototype.reset=function(){this._priorityProxies.clear()};return d}();e.AttachPriorityManager=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator=
{}));(function(a){(function(a){(function(a){(function(a){function d(a){return"modelName"in a}a.isNameInfo=d;a.isIncInfo=function(a){return!d(a)};a.canImplicitlyLoad=function(a){return a.config.implicitlyLoadXmlExternalModels||!d(a)}})(a.ExternalModel||(a.ExternalModel={}))})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a){return a instanceof d?a.referencedInfo:a}var d=function(){return function(a){this.referencedInfo=a}}();e.ReferencedNodeInfo=d;e.modelFileNodeInfoAsProdOccInfo=f;var c=function(){function b(){}b.parseXml=function(b,c,f,p,k){console.assert("ModelFile"===p.localName);var h=new Map,m=new Map,n=new Map;for(p=p.firstElementChild;null!==p;){if("ProductOccurence"!==p.localName)throw new a.XmlParseError('Unexpected element "'+p.localName+'".');if(null===
e.XmlParser.parseNodeId(p,"Id"))throw new a.XmlParseError('Expected "Id" attribute.');var q=p,t=e.ProductOccurrence.parseXml(b,c,f,q,k),u=t.nodeInfo.nodeId;if(n.has(t.nodeInfo.nodeId)){var w=new d(t);h.set(u,w)}else{if(!m.has(t.nodeInfo.nodeId)&&(m.set(t.nodeInfo.nodeId,null),null!==b.additionalMatrix))var w=b.additionalMatrix,z=t.nodeInfo.localTransform,z=null===z?w:a.Matrix.multiply(z,w),t=__assign({},t,{nodeInfo:__assign({},t.nodeInfo,{localTransform:z})});h.set(u,t)}u=0;for(w=e.XmlParser.parseNodeIds(q,
"Children")||[];u<w.length;u++)m.set(w[u],t);q=e.XmlParser.parseNodeId(q,"InstanceRef");null!==q&&(u=n.get(q),void 0===u?n.set(q,[t]):u.push(t));p=p.nextElementSibling}b=this._parentMapToChildMap(h,m,n);return{treeInfos:this._childMapRoseTrees(b)}};b._parentMapToChildMap=function(b,c,e){var f=new Map,k=function(a,b){var c=f.get(a);void 0===c?f.set(a,[b]):c.push(b)};c.forEach(function(c,e){e=b.get(e);if(e instanceof d)throw new a.XmlParseError('Expected a referenced node for "InstanceRef".');k(c,e)});
e.forEach(function(c,e){console.assert(0<c.length);e=b.get(e);if(!(e instanceof d))throw new a.XmlParseError('Node is both an "InstanceRef" and contained in another node\'s "Children" list.');for(var f=0;f<c.length;f++)k(c[f],e)});return f};b._childMapRoseTrees=function(a){var b=function(c){var d=[],e=f(c),e=a.get(e);if(void 0!==e){console.assert(0<e.length);for(var v=0;v<e.length;v++){var k=b(e[v]);d.push(k)}}return new h.RoseTree(c,d)},c=a.get(null);if(void 0===c)return console.assert(0===a.size),
[];for(var e=[],k=0;k<c.length;k++){var r=c[k];r instanceof d?console.assert(!1):(r=b(r),e.push(r))}return e};b.reify=function(b,c,e,f,k,h){return __awaiter(this,void 0,void 0,function(){var m,n,q,t,u,w,z,y;return __generator(this,function(x){switch(x.label){case 0:m=[];n=[];q=[];t=0;for(u=h.treeInfos;t<u.length;t++)w=u[t],w.value instanceof d?console.assert(!1):(z=this._reifyProductOccurrence(b,c,e,f,k,k,w,m),n.push(z),q.push(z.getRuntimeId()));y=c.promiseTrigger("_subtreeLoaded","subtreeLoaded",
q,a.NodeSource.LoadModel).then(function(){for(var a=0,b=q;a<b.length;a++)c.trigger("shatteredXmlStructureReady",b[a])});m.push(y);return[4,a.Util.waitForAll(m)];case 1:return x.sent(),[2,n]}})})};b._rectifyExternalModelInfo=function(b,c){c=c.referencedInfo.externalModelInfo;if(null===c)throw new a.XmlParseError('"InstanceRef" node does not contain "ExternalModel".');if(!e.ExternalModel.isNameInfo(c))throw new a.InternalLogicError;console.assert(0===c.reservedNodeIdOffset);b=b.newNodeIdOffset();return c=
__assign({},c,{reservedNodeIdOffset:b})};b._reifyProductOccurrence=function(b,c,v,p,k,h,m,n){var q=this,t=f(m.value);if(0!==t.childDataKeys.length)throw new a.InternalLogicError;if(null!==t.externalModelInfo)throw new a.LoadError('Unexpected "ExternalModel". Should be a child of an "InstanceRef".');var u=e.ProductOccurrence.reifySync(b,v,p,k,t,h);h.addProductOccurrence(u);u.markLoaded();h=0;for(m=m.kids;h<m.length;h++)t=m[h],t.value instanceof d?(console.assert(0===t.kids.length),t=this._rectifyExternalModelInfo(p,
t.value),e.ExternalModel.canImplicitlyLoad(t)?(t=v.attachByExternalModelInfo(t,u).then(function(b){return __awaiter(q,void 0,void 0,function(){var d;return __generator(this,function(g){switch(g.label){case 0:return null===b?[2]:[4,e.markContextsLoaded([b])];case 1:return g.sent(),u.addAttachContext(b),d=b.getChildren().map(function(a){return a.getRuntimeId()}),c.promiseTrigger("_subtreeLoaded","subtreeLoaded",d,a.NodeSource.LoadModel),[2]}})})}),n.push(t)):u.addPendingExternalModel(t)):(console.assert(null===
t.value.externalModelInfo),this._reifyProductOccurrence(b,c,v,p,k,u,t,n));return u};b._parseBounding=function(b,c){var d=f(b.value),p=SC.UnspecifiedMeasurementUnit;null!==d.measurementUnit&&(p=d.measurementUnit);var k=1;p===SC.UnspecifiedMeasurementUnit?p=c:c!==SC.UnspecifiedMeasurementUnit&&(k=p/c);var k=(new a.Matrix).setScaleComponent(k,k,k),h=d.nodeInfo.localTransform;null!==h&&(k=a.Matrix.multiply(h,k));var h=a.Box.invalid(),m=0;for(b=b.kids;m<b.length;m++){var n=this._parseBounding(b[m],p),
n=k.transformBox(n);h.addBox(n)}b=d.externalModelInfo;if(null!==b){if(!e.ExternalModel.isNameInfo(b))throw new a.InternalLogicError;d=b.bounding;null===d||d.isDegenerate()||(b=b.measurementUnit||SC.UnspecifiedMeasurementUnit,c!==SC.UnspecifiedMeasurementUnit&&b!==SC.UnspecifiedMeasurementUnit&&(c=b/p,c=(new a.Matrix).setScaleComponent(c,c,c),k=a.Matrix.multiply(c,k)),d=k.transformBox(d),h.addBox(d))}return h};b.parseBounding=function(b,c){var d=a.Box.invalid(),e=0;for(b=b.treeInfos;e<b.length;e++)for(var f=
0,h=b[e].kids;f<h.length;f++){var m=this._parseBounding(h[f],c);d.addBox(m)}return d};return b}();e.ModelFile=c})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(a,b,d,f){var v=this;this._cameraTimeoutId=null;this._isFirstAttachment=!0;this._attachScope=0;null===f&&(f=13);console.assert(0<f);this._engine=a;this._view=b;this._callbackManager=d;this._parentToXmlAttachInfos=new Map;this._viewInfo=new e.ViewInfo(this._view);this._attachPriorityManager=new e.AttachPriorityManager;this._comparePriority=function(a,b){return v._attachPriorityManager.comparePriority(a,b)};this._attachQueue=this._createAttachQueue(f);
this._prefetchScsQueue=this._createPrefetchScsQueue(f);this._registerCameraListener()}d.createWithEmptyModel=function(a,b,g,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){switch(f.label){case 0:return[4,a.loadEmpty()];case 1:return f.sent(),[2,new d(a,b,g,e)]}})})};d.prototype._createAttachQueue=function(a){return new h.PriorityPromiseQueue(a,this._comparePriority,!1)};d.prototype._createPrefetchScsQueue=function(a){return new h.PriorityPromiseQueue(a+15,this._comparePriority,
!1)};d.prototype._reprioritizeAttachments=function(){this._viewInfo=new e.ViewInfo(this._view);this._attachQueue.markDirty();this._prefetchScsQueue.markDirty();this._attachPriorityManager.onViewChange(this._viewInfo)};d.prototype._registerCameraListener=function(){var a=this,b=function(){a._onCameraChange()};this._callbackManager.bind({camera:b,_shutdownBegin:function(){null!==a._cameraTimeoutId&&(clearTimeout(a._cameraTimeoutId),a._cameraTimeoutId=null);a._callbackManager.unbind({camera:b})}})};
d.prototype._onCameraChange=function(){var a=this;null!==this._cameraTimeoutId&&clearTimeout(this._cameraTimeoutId);this._cameraTimeoutId=this._engine.setTimeout(function(){a._cameraTimeoutId=null;a._reprioritizeAttachments()},500)};d.prototype._awaitAttachInfo=function(c,b,d,f,v){var p=this,k=null===f,r=new e.AttachInfoBuilder(b,d),m=!1,n=[],q=h.OpenPromise.create(),t=h.OpenPromise.create(),u=!1,w=function(){console.assert(!u);u=!0;p._cleanupAttachLowLevel();p._callbackManager.unbind(y)},z=null,
y={_priorityMetaDataSent:function(a,c){a===b&&(r.registerPrototypeInstanceCount(c),q.resolve())},_announceModel:function(a,c){a===b&&(m=!0,r.registerMasterModelKey(c))},_inclusion:function(a,c,d){a===b&&(r.registerInclusion(c,d),n.push(d))},_remapModel:function(a,d,g){a===b&&c.remapModel(d,g)},_remapInclusion:function(a,d,g,e){a===b&&c.remapInclusion(d,g,e)},_missingModel:function(a,c){a===b&&(z=c)},_attached:function(c){if(c===b){if(!m){if(null!==z&&(k||v)){console.assert(0===n.length);t.reject(new a.MissingModelError(z));
return}if(1!==n.length){t.reject(new a.LoadError("Bad model: Could not find master model key."));return}r.registerMasterModelKey(n[0])}c=[q];var d=p._isFirstAttachment;if(d){p._isFirstAttachment=!1;var g=p._callbackManager.promiseTrigger("_firstAttachment",null,k?h.AttachType.Direct:h.AttachType.Indirect);c.push(g)}a.Util.waitForAll(c).catch(function(a){console.assert(!1);throw a;}).then(function(){return __awaiter(p,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return d&&
1===this._engine.getSessionType()?[4,this._callbackManager.promiseTrigger("_firstBoundingReady",null)]:[3,2];case 1:a.sent(),a.label=2;case 2:return w(),t.resolve(r),[2]}})})})}}};this._callbackManager.bind(y);return t.catch(function(a){w();throw a;})};d.prototype._createPriority=function(a,b){return this._attachPriorityManager.createPriority(this._viewInfo,a,b)};d.prototype._cleanupAttachLowLevel=function(){};d.prototype._cleanupAttachHighLevel=function(a,b,d){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,,2,3]),[4,a];case 1:return[2,e.sent()];case 2:return null!==d&&this._forgetXmlAttachment(d),this._attachPriorityManager.destroyPriority(b),[7];case 3:return[2]}})})};d.prototype.newAttachScope=function(){return++this._attachScope};d.prototype._attachByStream=function(c,b,d,e,f,p,k,h){var m=this,n=a.Matrix.toMatrix12(e.m);e=this._createPriority(e,k);var q=this._attachQueue.push(function(){return __awaiter(m,
void 0,void 0,function(){var a=this,e,l,m;return __generator(this,function(q){switch(q.label){case 0:e=this.newAttachScope(),l=this._awaitAttachInfo(b,e,p.get(),k,h),q.label=1;case 1:return q.trys.push([1,4,,5]),[4,c.enqueue(function(){return a._engine.attachModel(e,d,n,f,p.get())})];case 2:return q.sent(),[4,l];case 3:return[2,q.sent()];case 4:throw m=q.sent(),this._cleanupAttachLowLevel(),m;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(q,e,k)};d._getAllModelKeys=function(a){var b=
a.getMasterModelKey();a=a.getAllInclusions();if(a[1]!==b)for(var d=2;d<a.length;d+=2)if(a[d+1]===b){var e=a[d];a[d]=a[0];a[d+1]=a[1];a[0]=e;a[1]=b;break}b=[];d=0;for(e=1;e<a.length;++d,e+=2)b[d]=a[e];return b};d.prototype.attachByNamedScsBuffer=function(c,b,g,f,v,p,k,h){return __awaiter(this,void 0,void 0,function(){var m=this,n,q,t,u,w;return __generator(this,function(z){c.getAutomaticMeasurementUnitScaling()||(p=SC.UnspecifiedMeasurementUnit);n=e.towardLoadContext(h.parent);q=a.Matrix.toMatrix12(v.m);
t=this._createPriority(v,h);u=function(f){return __awaiter(m,void 0,void 0,function(){var l=this,v,m,t,u,w,z,I,F,K,L,H,M;return __generator(this,function(J){switch(J.label){case 0:return[4,function(){return __awaiter(l,void 0,void 0,function(){var a;return __generator(this,function(c){a=n.getScsModelKeysOf(b);return null===a?(n.initializeScsModelKeysOf(b),[2,f]):[2,a]})})}()];case 1:v=J.sent();m=n.getScsModelKeysOf(b);if(null===m)throw new a.InternalLogicError;t=this.newAttachScope();if(!(v instanceof
Uint8Array))return[3,7];w=!0;z=this._awaitAttachInfo(g,t,k.get(),h,!1);J.label=2;case 2:return J.trys.push([2,5,,6]),[4,c.enqueue(function(){return l._engine.attachScsBuffer(t,v,q,p,k.get(),w)})];case 3:return J.sent(),[4,z];case 4:return u=J.sent(),[3,6];case 5:throw I=J.sent(),this._cleanupAttachLowLevel(),I;case 6:return 0===m.state&&(F=d._getAllModelKeys(u),m.resolve(F)),[3,8];case 7:if(null===v)u=null,0===m.state&&m.resolve(null);else{console.assert(0!==m.state);K=new e.AttachInfoBuilder(t,k.get());
K.registerPrototypeInstanceCount(0);for(L=0;L<v.length;++L)H=v[L],M=this._engine.attachScsModelByKey(t,H,q,p,k.get()),K.registerInclusion(M,H),0===L&&K.registerMasterModelKey(H);u=K}J.label=8;case 8:return[2,u]}})})};w=function(){return __awaiter(m,void 0,void 0,function(){var a=this,c;return __generator(this,function(d){switch(d.label){case 0:return[4,this._prefetchScsQueue.push(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){return[2,n.toScsBuffer(b,f)]})})},
t)];case 1:return c=d.sent(),h.directlyRequested=!0,[2,this._attachQueue.push(function(){return u(c)},t)]}})})}();return[2,this._cleanupAttachHighLevel(w,t,h)]})})};d.prototype._attachByScsBuffer=function(c,b,d,e,f,p){var k=this,h=a.Matrix.toMatrix12(e.m);e=this._createPriority(e,null);var m=this._attachQueue.push(function(){return __awaiter(k,void 0,void 0,function(){var a=this,e,l,k;return __generator(this,function(m){switch(m.label){case 0:e=this.newAttachScope(),l=this._awaitAttachInfo(b,e,p.get(),
null,!1),m.label=1;case 1:return m.trys.push([1,4,,5]),[4,c.enqueue(function(){return a._engine.attachScsBuffer(e,d,h,f,p.get(),!1)})];case 2:return m.sent(),[4,l];case 3:return[2,m.sent()];case 4:throw k=m.sent(),this._cleanupAttachLowLevel(),k;case 5:return[2]}})})},e);return this._cleanupAttachHighLevel(m,e,null)};d.prototype.simpleAttach=function(c,b,d,e,f,p,k,h){c.getAutomaticMeasurementUnitScaling()||(f=SC.UnspecifiedMeasurementUnit);if("string"===typeof d)return this._attachByStream(c,b,d,
e,f,p,k,h);if(null===k)return this._attachByScsBuffer(c,b,d,e,f,p);a.Util.TypeAssert(d);a.Util.TypeAssert(k);throw new a.InternalLogicError;};d.prototype.reset=function(){this._isFirstAttachment=!0;this._attachScope=0;this._parentToXmlAttachInfos.clear();this._attachPriorityManager.reset();this._attachQueue.killDeferred();return this._attachQueue.waitForIdle()};d.prototype.isIdle=function(){return this._attachQueue.isIdle()};d.prototype.notifyDirectRequest=function(a){a=this._parentToXmlAttachInfos.get(a);
if(void 0!==a){for(var b=!1,d=0;d<a.length;d++){var e=a[d];e.directlyRequested||(b=e.directlyRequested=!0)}b&&this._reprioritizeAttachments()}};d.prototype.registerXmlAttachInfo=function(a){var b=a.parent,d=this._parentToXmlAttachInfos.get(b);void 0===d&&(d=[],this._parentToXmlAttachInfos.set(b,d));d.push(a)};d.prototype._forgetXmlAttachment=function(a){var b=a.parent,d=this._parentToXmlAttachInfos.get(b);1===d.length?(console.assert(d[0]===a),this._parentToXmlAttachInfos.delete(b)):(console.assert(1<
d.length),a=d.indexOf(a),console.assert(0<=a),d.splice(a,1))};d.prototype.maxConcurrentAttachments=function(){return this._attachQueue.maxActivePromises()};return d}();e.ScAttacher=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(){function a(){this._remappedModelKeys=new Map;this._remappedInclusionKeys=new Map}a.prototype.remapModel=function(a,b){this._remappedModelKeys.set(b,a);this._remappedInclusionKeys.has(a)||this._remappedInclusionKeys.set(a,new Map)};a.prototype.remapInclusion=function(a,b,d){a=this._remappedInclusionKeys.get(a);console.assert(void 0!==a);a.set(d,b)};a.prototype.getEffectiveModelKey=function(a){var b=this._remappedModelKeys.get(a);return void 0!==
b?b:a};a.prototype.getEffectiveInclusionKey=function(a,b){b=this._remappedInclusionKeys.get(b);return void 0!==b&&(b=b.get(a),void 0!==b)?b:a};return a}();a.ScKeyRemapper=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a){return(new DOMParser).parseFromString(a,"application/xml")}function d(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return[4,h.httpRequest(a)];case 1:return b=d.sent(),c=b.responseXML,null===c&&(c=f(b.responseText)),[2,c]}})})}function c(a){if(!a.hasChildNodes)return!1;a=a.firstChild;if(!(a instanceof Comment))return!1;a=a.data.split(" ");if(2!==a.length||"HC"!==a[0])return!1;
a=a[1].split(".");if(2!==a.length)return!1;for(var b=0;b<a.length;b++)if(!h.isBase10Number(a[b]))return!1;b=parseInt(a[0],10);return 7>b?!0:7<b?!1:2>=parseInt(a[1],10)}function b(a,b,c,d){return{getAttachScope:function(){return a},getMasterModelKey:function(){return d},getModelKeys:function(){return[d]},hasInclusions:function(){return!0},getAllInclusions:function(){return[c,d]},getInclusionsOf:function(a){return a===d?[c,d]:[]},hasModelIncluded:function(a){return a===d},attachedInvisibly:function(){return b},
prototypeInstanceCount:function(){return 0}}}var g=function(){function g(a,b,c,d,e){this._loadQueue=new h.PromiseQueue(1,!1);this._activeLoadGeneration=this._activeLoadCount=0;this._isFirstLoad=!0;this._firstAssemblyDataHeader=null;console.assert(a.isInitialized());this._assemblyTree=a;this._scAttacher=b;this._engine=c;this._view=d;this._callbackManager=e;this._isScsSession=2===this._engine.getSessionType();this._nodesUntilNextSleep=2E3}g.prototype._resolveMeasurementUnits=function(b){if(this._assemblyTree.getAutomaticMeasurementUnitScaling()){var c=
e.towardProductOccurrence(b.getParent());if(null===c)throw new a.InternalLogicError;var d=c.getMeasurementUnit(),g=b.getMeasurementUnit();d!==g&&(c=b.getLocalTransform(),null===c&&(c=new a.Matrix),d=g/d,c.m[0]*=d,c.m[5]*=d,c.m[10]*=d,b.setLocalTransformAsInitial(c))}};g.prototype._patchImplicitNodesByModelInc=function(a,b,c,d,g){var f=this,l=0;if(0!==d.length)for(var t,u=h.Lazy.create(function(){var d=a.get(),l=e.towardAttachContext(d),h=l.getAttachScope();t=l.attachedInvisibly();l=l.split(h,t,d);
d.addAttachContext(l);d=new e.InclusionContext(f._assemblyTree,l,b,c);l.addInclusionContext(d);l=e.ProductOccurrence.createDynamic(f._assemblyTree,d,"Of Inclusion ("+b+")",null,null,!t,g);d.addProductOccurrence(l);return l}),w=0;w<d.length;w++){var z=d[w],y=this._assemblyTree.lookupAnyBodyByInstanceInc(b,z);if(null===y){var y=u.get(),x="Implicit Body "+ ++l,y=this._assemblyTree.createMeshInstance(!0,b,z,null,x,y,!1,!1);t&&y.setVisibility(!1)}}};g.prototype._getPrototypeInstanceCountByAttachment=function(a){var b=
new Set,c=0;a=a.getAllInclusions();for(var d=0;d<a.length;d+=2){var g=a[d],e=a[d+1];b.has(e)||(b.add(e),c+=this._assemblyTree.getInstanceCountByInclusion(g))}return c};g.prototype._patchImplicitNodesByAttachment=function(b,c,d){return __awaiter(this,void 0,void 0,function(){var g=this,f,l,q,t,u,w,z,y,x,A;return __generator(this,function(B){switch(B.label){case 0:return console.assert(b.isLoaded()),f=null,l=h.Lazy.create(function(){var a=new e.ScKeyRemapper,l=c.getMasterModelKey();f=new e.AttachContext(a,
c.getAttachScope(),c.attachedInvisibly(),l,b);a=new e.InclusionContext(g._assemblyTree,f,0,0);f.addInclusionContext(a);l=e.ProductOccurrence.createDynamic(g._assemblyTree,a,"Implicit Bodies",null,null,!c.attachedInvisibly(),d);a.addProductOccurrence(l);return l}),q=c.prototypeInstanceCount(),0!==q?[3,2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),0,1)];case 1:q=B.sent()[0],B.label=2;case 2:return t=this._getPrototypeInstanceCountByAttachment(c),t===q?[2]:[4,this._engine.instanceKeyInfo(c.getAttachScope(),
0,0)];case 3:u=B.sent();w=c.getAllInclusions();for(z=0;z<w.length;z+=2)y=w[z],x=w[z+1],A=u.get(x),void 0!==A&&this._patchImplicitNodesByModelInc(l,y,x,A,d);t=this._getPrototypeInstanceCountByAttachment(c);if(t<q)throw new a.InternalLogicError;return null===f?[2]:[4,e.markContextsLoaded([f])];case 4:return B.sent(),b.addAttachContext(f),[2]}})})};g.prototype._updateOnDemandRequests=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,g,e;return __generator(this,function(f){if(!this._assemblyTree.onDemandRequestsActive())return[2];
b=a.getChildren();c=[];d=0;for(g=b;d<g.length;d++)e=g[d],this._assemblyTree.isBeingRequested(e)&&c.push(e);return[2,this._assemblyTree.requestNodes(this,c,!0)]})})};g.prototype._populateAttachment=function(a,b,c,d,g,e){return __awaiter(this,void 0,void 0,function(){var f;return __generator(this,function(l){switch(l.label){case 0:return console.assert(g===h.AttachType.Indirect===(null!==e)),[4,this._parseRootNodes(a,b,c,d,e)];case 1:return f=l.sent(),[4,this._postProcessAttachContext(b,d,g,f)];case 2:return l.sent(),
[2,f]}})})};g.prototype._postProcessAttachContext=function(a,b,c,d){return __awaiter(this,void 0,void 0,function(){var g=this,f,l,t;return __generator(this,function(u){switch(u.label){case 0:return[4,e.WalkerAsync.forceLazyPromises(d)];case 1:return u.sent(),[4,this._assemblyTree.enqueue(function(){return e.synchronizePmiVisibilities(g._engine,d)})];case 2:return u.sent(),(f=this._assemblyTree.markImplicitNodesOutOfHierarchy())&&(f=0<d.getChildren().length||c===h.AttachType.Indirect),[4,this._patchImplicitNodesByAttachment(a,
b,f)];case 3:return u.sent(),[4,this._updateOnDemandRequests(d)];case 4:return u.sent(),l=d.getChildren(),t=l.map(function(a){return a.getRuntimeId()}),this._callbackManager.trigger("_attachmentPopulated",t),[2]}})})};g.prototype._parseRootNodes=function(a,b,c,d,g){return __awaiter(this,void 0,void 0,function(){var f=this,l,t,u,w,z,y,x;return __generator(this,function(A){switch(A.label){case 0:return l=d.getMasterModelKey(),t=d.getInclusionsOf(l),4294967295===l&&(console.assert(0===t.length),t.push(4294967295,
4294967295)),u=new e.AttachContext(c,d.getAttachScope(),d.attachedInvisibly(),l,b),null!==g&&u.setReservedNodeIdOffset(g),w=new h.PromiseQueue(1,!0),[4,this._assemblyTree.enqueue(function(){return u.getRootNodeMetaData(f._assemblyTree)})];case 1:z=A.sent();y=function(b){w.push(function(){return f._parseRootNode(a,u,z,t[b],t[b+1])})};for(x=0;x<t.length;x+=2)y(x);return[4,w.waitForIdle()];case 2:return A.sent(),[2,u]}})})};g.prototype._parseRootNode=function(a,b,c,d,g){return __awaiter(this,void 0,
void 0,function(){var f,l;return __generator(this,function(h){switch(h.label){case 0:return console.assert(0!==d),[4,this._populateInclusion(a,b,c,d,g)];case 1:return f=h.sent(),f.hasAuthoredId()?(console.assert(!f.isLoaded()),l=e.towardInclusionContext(f),h=l.getParent(),h=h instanceof e.AttachContext&&h.getParent()instanceof e.LoadContext?!0:!1,h&&this._setupRootNode(f,!1)):null===f.getName()&&(b.removeProductOccurrence(f)||console.assert(!1)),[2]}})})};g.prototype._setupRootNode=function(a,b){console.assert(!a.isAbsoluteRoot());
b&&a.markIsExternalModelRoot(this._assemblyTree);this._resolveMeasurementUnits(a)};g.prototype._populateInclusion=function(a,b,c,d,g){return __awaiter(this,void 0,void 0,function(){var f=this,l,h;return __generator(this,function(u){switch(u.label){case 0:return console.assert(0!==d),l=new e.InclusionContext(this._assemblyTree,b,d,g),b.addInclusionContext(l),[4,function(){return __awaiter(f,void 0,void 0,function(){var d,g,f;return __generator(this,function(h){if(null===c||0===c.bytes.length)return d=
null,null===c&&(d="Missing"),[2,e.ProductOccurrence.createDynamic(this._assemblyTree,l,d,null,null,!b.attachedInvisibly())];g=new e.AssemblyDataParser(c);f=e.ProductOccurrence.parseBinary(a,this._assemblyTree,l,g);return[2,e.ProductOccurrence.reify(a,this,this._assemblyTree,l,f,l)]})})}()];case 1:return h=u.sent(),l.addProductOccurrence(h),[2,h]}})})};g.prototype._rectifyLateVisibilityChange=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,g,f;return __generator(this,function(l){c=
e.towardAttachContext(b.getParent());d=e.towardProductOccurrence(b.getParent());console.assert(d===e.towardProductOccurrence(c));if(a.attachInvisibly||null===d||!d.isLoaded())return[2];g=d.isVisible();if(c.attachedInvisibly()===!g)return[2];f=g?2:0;return[2,e.updateVisibilitiesByAttachment(this._assemblyTree,this._engine,c,f)]})})};g.prototype._loadCleanup=function(a,b){console.assert(0<this._activeLoadCount);a.onLoadComplete();null!==b&&this._callbackManager.unbind(b);--this._activeLoadCount;this._assemblyTree.onLoadEnd();
this._callbackManager.trigger("visibilityChanged",[],[])};g.prototype._wrap=function(b,c,d,g){var e=this,f=this._activeLoadGeneration;return this._loadQueue.push(function(){return __awaiter(e,void 0,void 0,function(){var e=this,l,m,w,z,y,x,A,B,C,D,G,E,I;return __generator(this,function(F){switch(F.label){case 0:this._assemblyTree.onLoadBegin();l=null;if(f!==this._activeLoadGeneration)throw this._loadCleanup(c,l),new a.LoadCancelledError;null===this._firstAssemblyDataHeader&&(l={_modelStructureHeaderParsed:function(a){return __awaiter(e,
void 0,void 0,function(){return __generator(this,function(b){null!==l&&(null===this._firstAssemblyDataHeader&&(this._firstAssemblyDataHeader=a),this._callbackManager.unbind(l),l=null);return[2]})})}},this._callbackManager.bind(l,!0));F.label=1;case 1:return F.trys.push([1,3,,4]),[4,d];case 2:return F.sent(),[3,4];case 3:throw m=F.sent(),c.purgeContents(),this._loadCleanup(c,l),m;case 4:w=c.getParent();if(null===w)throw this._loadCleanup(c,l),new a.InternalLogicError;(z=g===h.AttachType.Direct)&&(c.hasChildren()?
w.addLoadContext(c):c.purgeContents());this._loadCleanup(c,l);y=c.getChildren();x=[];A=0;for(B=y;A<B.length;A++)C=B[A],D=this._rectifyLateVisibilityChange(b,C),x.push(D);return[4,a.Util.waitForAll(x)];case 5:F.sent();if(!this._isFirstLoad)return[3,9];this._isFirstLoad=!1;c.markAsFirstLoad();G=y.map(function(a){return a.getRuntimeId()});E=!1;F.label=6;case 6:return F.trys.push([6,8,,9]),[4,this._callbackManager.promiseTrigger("_firstModelLoaded","firstModelLoaded",G,g,E)];case 7:return F.sent(),[3,
9];case 8:throw I=F.sent(),console.assert(!1),I;case 9:return[2,c]}})})})};g.prototype._initLoad=function(a,b,c){++this._activeLoadCount;c=this._isScsSession&&c?new h.PromiseCache:null;return new e.LoadContext(a,b,c)};g._getNetMatrix=function(b,c){b=e.getNetMatrix(b);null!==c&&(b=a.Matrix.multiply(c,b));return b};g.prototype._lazyAttachInvisibly=function(a,b){return h.Lazy.create(function(){return b.attachInvisibly||!a.isVisible()})};g.prototype._loadBySingleAttach=function(a,b,c,d){var f=this,n=
this._initLoad(b,d,!1);d=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var d,f,r,m,z,y,x;return __generator(this,function(A){switch(A.label){case 0:return[4,c];case 1:return d=A.sent(),f=new e.ScKeyRemapper,r=g._getNetMatrix(b,a.additionalMatrix),m=b.getMeasurementUnit(),z=this._lazyAttachInvisibly(b,a),[4,this._scAttacher.simpleAttach(this._assemblyTree,f,d,r,m,z,null,!1)];case 2:return y=A.sent(),[4,this._populateAttachment(a,n,f,y,h.AttachType.Direct,null)];case 3:return x=
A.sent(),[4,e.markContextsLoaded([n,x])];case 4:return A.sent(),x.hasChildren()&&n.addAttachContext(x),[2,h.Void]}})})});return this._wrap(a,n,d,h.AttachType.Direct)};g.prototype._populateFromXml=function(b,c,d,g){return __awaiter(this,void 0,void 0,function(){var f,l,h,t,u,w,z,y,x,A,B;return __generator(this,function(C){switch(C.label){case 0:f=d.documentElement;l=f.firstElementChild;for(h=null;null!==l;)"ModelFile"===l.localName&&(console.assert(null===h),h=e.ModelFile.parseXml(b,this._assemblyTree,
c,l,g)),l=l.nextElementSibling;if(null===h)throw new a.XmlParseError('Expected "ModelFile" element.');t=!1;if(!this._isFirstLoad)return[3,2];u=SC.UnspecifiedMeasurementUnit;this._assemblyTree.getAutomaticMeasurementUnitScaling()&&(w=e.towardProductOccurrence(c),u=w.getMeasurementUnit());z=e.ModelFile.parseBounding(h,u);if(z.isDegenerate())return[3,2];t=!0;return[4,this._view.setViewOrientation(a.ViewOrientation.Iso,0,z)];case 1:C.sent(),C.label=2;case 2:return[4,e.ModelFile.reify(b,this._callbackManager,
this,this._assemblyTree,c,h)];case 3:y=C.sent();x=0;for(A=y;x<A.length;x++)B=A[x],this._setupRootNode(B,!1);return!this._isFirstLoad||t?[3,5]:[4,this._view.setViewOrientation(a.ViewOrientation.Iso,0)];case 4:C.sent(),C.label=5;case 5:return[2]}})})};g.prototype._loadByXml=function(b,d,g,f,l){var n=this,q=this._initLoad(d,l,!0);l=h.LazyPromise.create(function(){return __awaiter(n,void 0,void 0,function(){var l,m,n,z,y,x,A;return __generator(this,function(B){switch(B.label){case 0:return[4,g];case 1:l=
B.sent();if(!c(l))throw new a.XmlParseError("Bad version.");d.addLoadContext(q);m=e.towardInclusionContext(d);n=e.towardAttachContext(m);z=this._scAttacher.newAttachScope();y=this._lazyAttachInvisibly(d,b);x=n.split(z,y.get(),q);q.addAttachContext(x);A=m.split(this._assemblyTree,x);x.addInclusionContext(A);return[4,this._populateFromXml(b,A,l,f)];case 2:return B.sent(),[4,e.markContextsLoaded([q,x])];case 3:return B.sent(),[2,h.Void]}})})});return this._wrap(b,q,l,h.AttachType.Indirect)};g.prototype._attachExternalModelByInc=
function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,g,f,l,h;return __generator(this,function(u){switch(u.label){case 0:return console.assert(0!==a.inclusionKey),c=e.towardAttachContext(b).getAttachScope(),d=a.modelKey,g=this._lazyAttachInvisibly(b,a.config),f=new e.ScKeyRemapper,l=new e.AttachContext(f,c,g.get(),d,b),[4,l.getRootNodeMetaData(this._assemblyTree)];case 1:return h=u.sent(),[4,this._populateInclusion(a.config,l,h,a.inclusionKey,a.modelKey)];case 2:return u.sent(),[2,
l]}})})};g.prototype._attachExternalModelInfoByName=function(b,c){return __awaiter(this,void 0,void 0,function(){var d,g,f,l,q,t,u,w,z,y;return __generator(this,function(x){switch(x.label){case 0:d=new e.ScKeyRemapper;g=e.getNetMatrix(c);f=c.getMeasurementUnit();l=this._lazyAttachInvisibly(c,b.config);q={bounding:b.bounding,parent:c,directlyRequested:!1};if(!this._isScsSession)return[3,2];this._scAttacher.registerXmlAttachInfo(q);return[4,this._scAttacher.attachByNamedScsBuffer(this._assemblyTree,
b.modelName,d,b.toAttachData,g,f,l,q)];case 1:return t=x.sent()||0,[3,8];case 2:return x.trys.push([2,7,,8]),[4,b.toAttachData(b.modelName)];case 3:u=x.sent();if(null!==u&&u!==a.EmptyModelName)return[3,4];t=0;return[3,6];case 4:if("string"!==typeof u)throw a.Util.TypeAssert(u),new a.InternalLogicError;a.Util.TypeAssert(u);this._scAttacher.registerXmlAttachInfo(q);return[4,this._scAttacher.simpleAttach(this._assemblyTree,d,u,g,f,l,q,b.config.allowMissingExternalModels)];case 5:t=x.sent(),x.label=6;
case 6:return[3,8];case 7:w=x.sent();if(b.config.allowMissingExternalModels&&w instanceof a.MissingModelError)t=1;else throw w;return[3,8];case 8:if("number"===typeof t){a.Util.TypeAssert(t);z=this._scAttacher.newAttachScope();y=!l.get();a:{var A=this._assemblyTree,B=t,C=y;x=new e.AttachContext(d,z,C,0,c);switch(B){case 0:break a;case 1:B=new e.InclusionContext(A,x,0,0);x.addInclusionContext(B);A=e.ProductOccurrence.createDynamic(A,B,"Missing",null,null,!C);B.addProductOccurrence(A);break a;default:x=
a.Util.TypeAssertNever(B)}}return[2,x]}return[2,this._populateAttachment(b.config,c,d,t,h.AttachType.Indirect,b.reservedNodeIdOffset)]}})})};g.prototype.isIdle=function(){return 0===this._activeLoadCount?(console.assert(this._scAttacher.isIdle()),!0):!1};g.prototype.waitOnCurrentLoads=function(){return this._loadQueue.waitOnLatest()};g.prototype.cancelPendingLoads=function(){++this._activeLoadGeneration;return this.waitOnCurrentLoads()};g.prototype.loadByStream=function(b,c,d){return d===a.EmptyModelName?
(b=new e.LoadContext(c,a.EmptyModelName,null),Promise.resolve(b)):this._loadBySingleAttach(b,c,Promise.resolve(d),d)};g.prototype.loadByScsBuffer=function(a,b,c){return this._loadBySingleAttach(a,b,Promise.resolve(c),"*SCS Buffer*")};g.prototype.loadByScsFile=function(a,b,c){var d=h.httpRequestBuffer(c);return this._loadBySingleAttach(a,b,d,c)};g.prototype.loadByXmlDoc=function(a,b,c,d){c="string"===typeof c?f(c):c;return this._loadByXml(a,b,Promise.resolve(c),d,"*XML Document*")};g.prototype.loadByXmlFile=
function(a,b,c,g){var e=d(c);return this._loadByXml(a,b,e,g,c)};g.prototype.attachByExternalModelInfo=function(b,c){return __awaiter(this,void 0,void 0,function(){var d,g,f,l,h,t,u;return __generator(this,function(w){switch(w.label){case 0:return e.ExternalModel.isNameInfo(b)?[4,this._attachExternalModelInfoByName(b,c)]:[3,2];case 1:return d=w.sent(),[3,4];case 2:return[4,this._attachExternalModelByInc(b,c)];case 3:d=w.sent(),w.label=4;case 4:g=[];f=d.getChildren();l=0;for(h=f;l<h.length;l++)t=h[l],
this._setupRootNode(t,!0),u=this._rectifyLateVisibilityChange(b.config,t),g.push(u);return[4,a.Util.waitForAll(g)];case 5:return w.sent(),[2,d]}})})};g.prototype.loadByAssemblyData=function(a,c,d,g){return __awaiter(this,void 0,void 0,function(){var f=this,l,q,t,u,w,z,y,x;return __generator(this,function(A){l=h.AttachType.Direct;q=d[0];t=d[1];u=this._scAttacher.newAttachScope();w=!c.isVisible();z=b(u,w,q,t);y=this._initLoad(c,"*Assembly Data*",!1);x=h.LazyPromise.create(function(){return __awaiter(f,
void 0,void 0,function(){var b,c,d;return __generator(this,function(f){switch(f.label){case 0:return b=new e.ScKeyRemapper,c=z.getMasterModelKey(),d=new e.AttachContext(b,u,z.attachedInvisibly(),c,y),[4,this._parseRootNode(a,d,g,q,t)];case 1:return f.sent(),[4,this._postProcessAttachContext(y,z,l,d)];case 2:return f.sent(),[4,e.markContextsLoaded([y,d])];case 3:return f.sent(),d.hasChildren()&&y.addAttachContext(d),[2,h.Void]}})})});return[2,this._wrap(a,y,x,l)]})})};g.prototype.reset=function(){this._isFirstLoad=
!0;this._firstAssemblyDataHeader=null;return this._scAttacher.reset()};g.prototype.notifyFirstLoadIsEmptyModel=function(){console.assert(this._isFirstLoad);this._isFirstLoad=!1};g.prototype.notifyDirectRequest=function(a){this._scAttacher.notifyDirectRequest(a)};g.prototype.onLoadChildProductOccurrence=function(){if(0===this._nodesUntilNextSleep)return this._nodesUntilNextSleep=2E3,this._engine.sleep(10);--this._nodesUntilNextSleep};g.prototype.firstAssemblyDataHeader=function(){return this._firstAssemblyDataHeader};
return g}();e.TreeLoader=g})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(c){var b=c.getCamera(),d=b.getPosition(),e=b.getTarget(),e=a.Point3.subtract(e,d),f=e.length();1E-7>f&&(f=1E-7);this._eyeDistanceInverse=1/f;e.scale(this._eyeDistanceInverse);c=c.getFullCameraMatrix();this._frustum=h.ConvexVolume.createFrustumFromMatrix(c);this._viewProjectionW=h.col4(c,3);this._cameraIsOrtho=b.getProjection()===a.Projection.Orthographic;this._position=h.toVec3(d);this._eye=h.toVec3(e)}d.prototype.calculateAttachHeuristic=
function(a,b){var d=0;if(this._frustum.axisAlignedBoxNotOutside(b,a))return a=h.squaredNorm3(a),a=h.projectSquaredSize(b,a,this._viewProjectionW),0<a&&(d=h.sub3(b,this._position),b=1/(h.dot3(this._eye,d)*this._eyeDistanceInverse+1E-5),d=h.scale3(1/h.norm3(d),d),d=h.dot3(this._eye,d),b=Math.pow(b,6),this._cameraIsOrtho||(b*=5*Math.pow(d,10)),1E-5>b&&(b=1E-5),d=a*b),console.assert(0<=d),-d-1;d=1/(1+Math.exp(h.norm3(a)));console.assert(0<=d&&1>d);return d};return d}();e.ViewInfo=f})(h.Tree||(h.Tree=
{}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(){}d._parseUint_32=function(a){if(!h.isBase10Number(a))return null;a=parseInt(a,10);return 4294967295>=a?a:null};d.parseFloat=function(a,b){a=a.getAttribute(b);if(null===a)return null;a=parseFloat(a);return isNaN(a)?null:a};d._parseScKey=function(a,b){a=a.getAttribute(b);return null===a?null:this._parseUint_32(a)};d.parseDataKey=function(a,b){return this._parseScKey(a,b)};d.parseMeshKey=function(a,b){return this._parseScKey(a,b)};
d.parseInstanceKeyFromInc=function(a,b){a=a.getAttribute(b);if(null===a)return null;a=a.split(" ");return 2!==a.length||null===this._parseUint_32(a[0])?null:this._parseUint_32(a[1])};d.parseNodeId=function(a,b){a=a.getAttribute(b);return null===a?null:this._parseUint_32(a)};d.parseLayerId=function(a,b){a=a.getAttribute(b);return null===a?null:this._parseUint_32(a)};d.parseUint=function(a,b){a=a.getAttribute(b);return null===a?null:this._parseUint_32(a)};d.parseNodeIds=function(a,b){var d=a.getAttribute(b);
if(null===d)return null;a=[];b=0;for(d=d.split(/\s+/);b<d.length;b++){var e=this._parseUint_32(d[b]);if(null===e)return null;a.push(e)}return a};d._parsePoint3=function(c,b){c=c.getAttribute(b);if(null===c)return null;c=c.split(" ");if(3!==c.length)return null;b=[];for(var d=0;d<c.length;d++){var e=Number(c[d]);if(isNaN(e))return null;b.push(e)}return new a.Point3(b[0],b[1],b[2])};d.parseBounding=function(c,b){c=c.getElementsByTagName(b);if(1!==c.length)return null;b=c[0];c=this._parsePoint3(b,"Min");
if(null===c)return null;b=this._parsePoint3(b,"Max");return null===b?null:new a.Box(c,b)};return d}();e.XmlParser=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a,b){var d="number"===typeof a;return d===("number"===typeof b)?a<b?-1:a>b?1:0:d?-1:1}var d=function(){function a(){console.assert(!1)}a.parseXml=function(a,c){var d=e.XmlParser.parseNodeId(c,"Id");null===d&&(console.assert(!1),d=a.generateDynamicNodeId());a=c.getAttribute("Name");for(var f=null,h=[],k=c.firstElementChild;null!==k;){if("Transformation"===k.localName)console.assert(null===f),f=e.Transform.parseXml(k),f.isIdentity()&&(f=null);else if("Attributes"===
k.localName)for(var r=k.firstElementChild;null!==r;){console.assert("Attr"===r.localName);var m=e.Attribute.parseXml(r);h.push(m);r=r.nextElementSibling}k=k.nextElementSibling}k=c.getAttribute("ExchangeId");c=e.XmlParser.parseLayerId(c,"LayerId");return{nodeId:d,bits:1073741824,name:a,localTransform:f,attributes:h,header:e.AssemblyDataHeader.dynamic,exchangeId:k,layerId:c,genericTypeId:null,genericId:null,userDatas:null}};a.parseBinary=function(a,c,d){d.hasBits1(1)?a=c.parseNodeId():(console.assert(!1),
a=a.generateDynamicNodeId());var f=d.hasBits1(2)?c.parseCString():null,h=1073741824;if(d.hasBits1(4)){var k=c.parseVisibility();k.shown||(h&=-1073741825);k.removed&&(h|=536870912)}k=null;d.hasBits1(8)&&(k=e.Transform.parseBinary(c),k.isIdentity()&&(k=null));var r=null;d.hasBits1(256)&&(r=c.parseDataKey());var m=d.hasBits1(33554432)?c.parseCString():null,n=d.hasBits1(67108864)?c.parseLayerId():null,q=null;d.hasBits2(16)&&(q=c.parseGenericTypeId());var t=null;d.hasBits2(32)&&(t=c.parseGenericId());
var u=null;if(d.hasBits1(536870912)){u=new Map;d=c.parseCount_32();for(var w=0;w<d;++w){var z=c.parseUserDataIndex(),y=c.parseCount_32(),y=c.parseBytes(y);u.set(z,y)}}return{nodeId:a,bits:h,name:f,localTransform:k,attributes:null!==r?r:[],header:c.getHeader(),exchangeId:m,layerId:n,genericTypeId:q,genericId:t,userDatas:u}};return a}();e.Node=d;d=function(){function c(a,d,e){this._bits=0;this._nodeId=e.nodeId;this._bits=e.bits;null!==e.name&&(this._name=e.name);null!==e.localTransform&&(this._localTransform=
e.localTransform.copy());"number"===typeof e.attributes?this._lazyAttributes=c._lazyLoadAttributes(a,d,e.attributes,e.header):0<e.attributes.length&&(this._lazyAttributes=h.LazyPromise.create(e.attributes));null!==e.exchangeId&&(this._exchangeId=e.exchangeId);null!==e.layerId&&(this._layerId=e.layerId,a.registerNodeInLayer(this,this._layerId));null!==e.genericTypeId&&(this._genericTypeId=e.genericTypeId);null!==e.genericId&&(this._genericId=e.genericId);null!==e.userDatas&&(this._userDatas=h.copyMap(e.userDatas))}
c._lazyLoadAttributes=function(a,c,d,f){var p=this;return h.LazyPromise.create(function(){return __awaiter(p,void 0,void 0,function(){var h,p,m,n,q,t;return __generator(this,function(u){switch(u.label){case 0:return h=a.getAbstractScEngine(),[4,a.enqueue(function(){return h.safeGetMetaData(c,d)})];case 1:p=u.sent();m=[];if(null!==p)for(n=new e.AssemblyData(f,p),q=new e.AssemblyDataParser(n);q.hasNext();)t=e.Attribute.parseBinary(q),m.push(t);return[2,m]}})})})};c.prototype.hasAuthoredId=function(){return e.isAuthoredId(this._nodeId)};
c.prototype.getAuthoredId=function(){return e.getAuthoredId(this._nodeId)};c.prototype.getName=function(){return void 0!==this._name?this._name:null};c.prototype.getExchangeId=function(){return void 0!==this._exchangeId?this._exchangeId:null};c.prototype.getLayerId=function(){return void 0!==this._layerId?this._layerId:null};c.prototype.getGenericTypeId=function(){return void 0!==this._genericTypeId?this._genericTypeId:null};c.prototype.getGenericId=function(){return void 0!==this._genericId?this._genericId:
null};c.prototype._hasBits=function(a){return h.hasBits(this._bits,a)};c.prototype.isLoaded=function(){return this._hasBits(-2147483648)};c.prototype.markLoaded=function(){this._bits|=-2147483648};c.prototype._setVisibility=function(a){this._bits|=524288;this._bits=a?this._bits|262144:this._bits&-262145};c.prototype.isVisible=function(){return this._hasBits(524288)?this._hasBits(262144):this.isInitiallyShown()};c.prototype.isInitiallyShown=function(){return this._hasBits(536870912)?!1:this._hasBits(1073741824)};
c.prototype.setLocalTransformAsInitial=function(a){this._localTransform=a.copy()};c.prototype.overrideLocalTransform=function(a){this._localTransformOverride=a.copy()};c.prototype.hasLocalTransformOverride=function(){return void 0!==this._localTransformOverride};c.prototype.removeLocalTransformOverride=function(){console.assert(void 0!==this._localTransformOverride);delete this._localTransformOverride};c.prototype.getLocalTransform=function(){return void 0!==this._localTransformOverride?this._localTransformOverride:
void 0!==this._localTransform?this._localTransform:null};c.prototype.getAttributes=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(c){return void 0!==this._lazyAttributes?[2,this._lazyAttributes.then(function(c){if(void 0!==a._lazyAttributes){for(var d=0;d<c.length;d++)a.addAttribute(c[d]);delete a._lazyAttributes}return a.getAttributes()})]:[2,h.TerseArray.toArray(this._attributes)]})})};c.prototype.addAttribute=function(a){this._attributes=h.TerseArray.push(this._attributes,
a)};c.prototype.getUserDataIndices=function(){var a=[];void 0!==this._userDatas&&this._userDatas.forEach(function(c,d){a.push(d)});return a.sort(f)};c.prototype.getUserData=function(b){if(void 0!==this._userDatas){var c=this._userDatas.get(b);if(void 0!==c)return c}throw new a.InvalidIndexError(b);};return c}();e.NodeMixin=d})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(a){function c(d,g,e,f){g=a.call(this,d,g,f.nodeInfo)||this;g._bits|=f.bits;g._parent=e;g._instanceInc=[f.inclusionKey,f.instanceKey];e=g.getLayerId();null===e||g.isOutOfHierarchy()||d.registerTreeNodeInLayer(g,e);return g}__extends(c,a);c.prototype.setRequested=function(){this._bits|=1024};c.prototype.isRequested=function(){return this._hasBits(1024)};c.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};c.prototype.preventFromResetting=
function(){return this._hasBits(16384)};c.prototype.getInstanceInc=function(){return this._instanceInc};c.prototype.getParent=function(){return this._parent};return c}(e.NodeMixin);e.BodyMixin=f;var d=function(b){function c(a,d,g,e){d=b.call(this,a,d,g,e)||this;a.registerBodyInstance(d);return d}__extends(c,b);c.parseXml=function(b,c,d){b=e.Node.parseXml(b,c);c=e.XmlParser.parseInstanceKeyFromInc(c,"MeshInstanceKey");if(null===c)throw new a.XmlParseError('Expected "MeshInstanceKey" attribute.');return{nodeInfo:b,
inclusionKey:d,instanceKey:c,bits:0}};c.parseBinary=function(b,c,d){var g=e.towardAttachContext(c),f=g.getRemapper(),h=g.getMasterModelKey(),g=d.parseNodeParseBits();b=e.Node.parseBinary(b,d,g);c=g.hasBits1(131072)?d.parseInclusionKey(f,h):c.getInclusionKey();if(!g.hasBits1(262144))throw new a.AssemblyDataParseError('Expected "ScInstanceKey" in binary data.');d=d.parseInstanceKey();return{nodeInfo:b,inclusionKey:c,instanceKey:d,bits:0}};c.reify=function(a,b,d,f){var h=e.towardAttachContext(d);a=new c(a,
b,d,f);h.attachedInvisibly()&&a.setVisibility(!1);return a};c.createDynamic=function(a,b,d,f,h,m,n){var q=e.towardInclusionContext(m),t=e.towardAttachContext(q).getMasterModelKey();b={nodeInfo:{nodeId:a.massageAuthoredUserId(q,f),bits:1073741824,name:h,localTransform:null,attributes:[],header:e.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},inclusionKey:b,instanceKey:d,bits:n};return new c(a,t,m,b)};c.prototype.getName=function(){var a=b.prototype.getName.call(this);
if(null!==a)return a;a=this.getParent().getBodyInstances();if(1<a.length){for(var c=0;c<a.length;++c)if(this===a[c])return"body "+(c+1);console.assert(!1)}return"body"};c.prototype.setVisibility=function(a){a!==this.isVisible()&&this.getParent().markBranchVisibilityDirty();this._setVisibility(a)};c.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this)};return c}(f);e.BodyInstance=d;var c=function(a){function c(d,g,e,f){g=a.call(this,d,g,e,f)||this;d.registerPmiBody(g);return g}
__extends(c,a);c.parseBinary=function(a,b,c,g){a=d.parseBinary(a,b,c);g&&(g=a.nodeInfo,g=__assign({},g,{bits:g.bits&-1073741825}),a=__assign({},a,{nodeInfo:g}));return a};c.reify=function(a,b,d,f){var h=e.towardAttachContext(d);a=new c(a,b,d,f);h.attachedInvisibly()&&a.setVisibility(!1);return a};c.prototype.getName=function(){var a=this.getName();return null!==a?a:"PMI body"};c.prototype.setVisibility=function(a){a!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();this._setVisibility(a)};
c.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this)};return c}(f);e.PmiBody=c;f=function(a){function c(d,g,e,f){g=a.call(this,d,g,e,f)||this;g._bits&=-1073741825;d.registerViewFrame(g);return g}__extends(c,a);c.parseBinary=function(a,b,c){return d.parseBinary(a,b,c)};c.reify=function(a,b,d,f){var h=e.towardAttachContext(d);a=new c(a,b,d,f);h.attachedInvisibly()&&a.setVisibility(!1);return a};c.prototype.getName=function(){var a=this.getName();return null!==a?a:"CAD View frame"};
c.prototype.setVisibility=function(a){a!==this.isVisible()&&this.getParent().getParent().markBranchVisibilityDirty();this._setVisibility(a)};c.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this)};return c}(f);e.ViewFrame=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a,c){var d=new h.PromiseQueue(1,!0);d.push(function(){return a.clear()});for(var e=function(c){d.push(function(){return a.addPlane(c,null)})},f=0;f<c.length;f++)e(c[f]);return d.waitForIdle()}function d(a,c){c.hasLocalTransformOverride()&&(c.removeLocalTransformOverride(),a.push(c))}var c=function(b){function c(a,d,f,k,r){var m=this,n=e.towardAttachContext(d).getMasterModelKey(),m=b.call(this,a,n,{nodeId:f.nodeId,bits:0,name:f.name,localTransform:null,
attributes:[],header:e.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;m._parent=r;m._bits|=f.bits;m._activatedCuttingSectionIndex=null;null!==f.camera&&(m._camera={initial:f.camera.copy(),derived:f.camera.copy()});m._instanceMarkupKeysToShow=h.toSet(f.instanceMarkupKeysToShow);c.isAuthoredViewInfo(f,k)?(m._nodesToShow=c._toRuntimeIds(d,f.nodesToShow),m._nodesToHide=c._toRuntimeIds(d,f.nodesToHide),0<f.transformMap.size&&(m._transformMap=
new Map,f.transformMap.forEach(function(a,b){b=d.toRuntimeId(b);m._transformMap.set(b,a.copy())}))):(m._nodesToShow=h.toSet(f.nodesToShow),m._nodesToHide=h.toSet(f.nodesToHide),0<f.transformMap.size&&(m._transformMap=h.copyMap(f.transformMap)));null!==f.viewFrameInfo&&(m._viewFrame=m._loadViewFrame(a,n,f.viewFrameInfo));0<f.cuttingPlanes.length&&(m._cuttingPlanes=h.TerseArray.fromArray(f.cuttingPlanes));a.registerCadView(m);return m}__extends(c,b);c.parseBinary=function(b,c,d){var g=d.parseViewParseBits(),
f=d.parseNodeId(),m=null;h.hasBits(g,1)&&(m=d.parseCString());var n=0,q=!1;h.hasBits(g,256)?(q=!0,m+=" # Annotation View"):null!==m&&0<=m.indexOf("# Annotation View")&&(q=!0);q&&(n|=134217728);h.hasBits(g,1024)||(n|=33554432);h.hasBits(g,2048)||(n|=16777216);h.hasBits(g,4096)||(n|=8388608);h.hasBits(g,8192)||(n|=4194304);h.hasBits(g,16384)&&(n|=2097152);var t=h.hasBits(g,32768);t&&(n|=1048576);q=null;if(h.hasBits(g,2)){var t=t?a.Projection.Perspective:a.Projection.Orthographic,u=d.parsePoint3_32(),
w=d.parsePoint3_32(),z=d.parsePoint3_32(),y=d.parseFloat_32(),x=d.parseFloat_32();!h.hasBits(g,512)&&(n|=67108864,q=a.Camera.create(u,w,z,t,y,x),0>y||0>x)&&(n|=8192)}t=[];if(h.hasBits(g,4))for(w=d.parseCount_32(),u=0;u<w;++u)z=d.parseInstanceKey(),t.push(z);w=null;h.hasBits(g,8)&&(w=e.ViewFrame.parseBinary(b,c,d));b=[];if(h.hasBits(g,16))for(c=d.parseCount_32(),u=0;u<c;++u)z=d.parseNodeId(),b.push(z);c=[];if(h.hasBits(g,32))for(z=d.parseCount_32(),u=0;u<z;++u)y=d.parseNodeId(),c.push(y);z=new Map;
if(h.hasBits(g,64))for(y=d.parseCount_32(),u=0;u<y;++u){var x=d.parseNodeId(),A=e.Transform.parseBinary(d);z.set(x,A)}y=[];if(h.hasBits(g,128))for(g=d.parseCount_32(),u=0;u<g;++u)x=d.parsePlane3_32(),y.push(x);return{nodeId:f,name:m,camera:q,instanceMarkupKeysToShow:t,viewFrameInfo:w,nodesToShow:b,nodesToHide:c,transformMap:z,cuttingPlanes:y,bits:n}};c.reify=function(a,b,d,f){var h=e.towardAttachContext(b);a=new c(a,b,d,0,f);h.attachedInvisibly()&&a.setVisibility(!1);return a};c.createDynamic=function(a,
b,d,f,h,m,n,q,t){for(var u=e.towardInclusionContext(b),w=a.generateDynamicNodeId(),z=[],y=0;y<h.length;y++)for(var x=0,A=h[y].getPmiBodies();x<A.length;x++){var B=A[x],C=e.towardInclusionContext(B);console.assert(u===C);B=B.getInstanceInc()[1];z.push(B)}return new c(a,u,{nodeId:w,name:d,camera:f,instanceMarkupKeysToShow:z,viewFrameInfo:null,nodesToShow:m,nodesToHide:n,transformMap:q,cuttingPlanes:null!==t?[t]:[],bits:67108864},1,b)};c.isAuthoredViewInfo=function(a,b){a;return 0===b};c._toRuntimeIds=
function(a,b){for(var c=new Set,d=0;d<b.length;d++){var g=a.toRuntimeId(b[d]);c.add(g)}return c};c.prototype._loadViewFrame=function(a,b,c){return e.ViewFrame.reify(a,b,this,c)};c.prototype.getViewFrame=function(){return void 0!==this._viewFrame?this._viewFrame:null};c.prototype.getParent=function(){return this._parent};c.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this)};c.prototype.getBranchVisibility=function(){var a=this.isVisible()?2:1;void 0===this._viewFrame||this._viewFrame.isOutOfHierarchy()||
(a|=this._viewFrame.isVisible()?2:1);return a};c.prototype.setVisibility=function(a){this._setVisibility(a)};c.prototype.isPmiFilteringSet=function(){return this._hasBits(33554432)};c.prototype.deactivate=function(a){var b=Promise.resolve();null!==this._activatedCuttingSectionIndex&&(a=a.getCuttingSection(this._activatedCuttingSectionIndex),null!==a&&(b=a.clear()),this._activatedCuttingSectionIndex=null);return b};c.prototype.activate=function(a,b,c,d,g,e,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(h){switch(h.label){case 0:return console.assert(null===this._activatedCuttingSectionIndex),[4,this._activateView(a,b,c,d,f)];case 1:return h.sent(),[2,this._activateCamera(a,b,g,e)]}})})};c.prototype._activateView=function(b,c,g,k,r){return __awaiter(this,void 0,void 0,function(){var m=this,n,q,t,u,w,z,y,x,A,B,C;return __generator(this,function(D){switch(D.label){case 0:return n=b.getRootNode(),null!==r&&console.assert(r.isAConfigurationNode()),q=0,t=new Map,u=[],w=[],z=d,void 0!==this._transformMap&&
(z=function(a,b){var c=m._transformMap,d=b.getRuntimeId(),c=c.get(d);void 0!==c?(b.overrideLocalTransform(c),a.push(b)):b.hasLocalTransformOverride()&&(b.removeLocalTransformOverride(),a.push(b))}),y={enterProductOccurrence:function(a){(r===a||0<q)&&++q;var b=a.forEachPmi(function(a){var b=a.getPmiBodies();if(0!==b.length){var c=!0;if(m.isPmiFilteringSet())for(var c=!1,d=0;d<b.length;d++){var g=b[d],g=g.getInstanceInc()[1];if(m._instanceMarkupKeysToShow.has(g)){c=!0;break}}null!==r&&(c=c&&0<q);t.set(a,
c);for(a=0;a<b.length;a++)g=b[a],t.set(g,c)}}).then(function(){var b=a.getRuntimeId();m._nodesToHide.has(b)||a.isADrawingSheetNode()?t.set(a,!1):m._nodesToShow.has(b)&&(null!==r?t.set(a,0<q):t.set(a,!0));z(u,a);return a.forEachCadView(function(a){if(void 0!==a._viewFrame){var b=a===m;null!==r&&(b=b&&0<q);t.set(a,b);t.set(a._viewFrame,b)}})});w.push(b)},leaveProductOccurrence:function(){0<q&&--q},enterAnyBody:function(a){z(u,a);for(var b=null,c=a.getParent();null!==c&&null===b&&!(c instanceof e.Pmi);){var d=
c.getRuntimeId();m._nodesToHide.has(d)?(b=!1,t.set(c,!1)):m._nodesToShow.has(d)&&(b=!0,t.set(c,!0));c=e.towardContainerNode(c.getParent())}null===b&&(d=a.getRuntimeId(),m._nodesToShow.has(d)?t.set(a,!0):m._nodesToHide.has(d)&&t.set(a,!1));null!==r&&0===q&&t.set(a,!1)}},[4,e.WalkerAsync.walk(y,n,e.WalkRestriction.None)];case 1:return D.sent(),[4,Promise.all(w)];case 2:return D.sent(),x=[],A=e.updateVisibilities(b,c,g,n,t,!0,!1,null),x.push(A),A=e.updateScMatrices(c,g,u,!1),x.push(A),[4,a.Util.waitForAll(x)];
case 3:D.sent();B=h.TerseArray.toArray(this._cuttingPlanes);if(!(0<B.length))return[3,5];C=k.getCuttingSection(4);if(null===C)return[3,5];this._activatedCuttingSectionIndex=4;return[4,f(C,B)];case 4:return D.sent(),[2,C.activate()];case 5:return[2]}})})};c.prototype._activateCamera=function(b,c,d,g){return __awaiter(this,void 0,void 0,function(){var f,h,n,q,t,u,w,z,y,x,A,B,C,D,G,E,I,F,K,L,H,M,J,Q,P,O,R,T,S,U,V,W,X,Y;return __generator(this,function(N){switch(N.label){case 0:return f=this._camera,
void 0!==f?[3,3]:b.disableAutomaticFitWorld()?[3,2]:[4,d.fitWorld(g)];case 1:N.sent(),N.label=2;case 2:return[2];case 3:h=e.towardAttachRoot(this);n=e.towardAttachContext(h);q=e.towardProductOccurrence(n);t=e.getNetMatrix(n);null!==q&&(u=h.getMeasurementUnit(),w=q.getMeasurementUnit(),u!==w&&(z=u/w,y=new a.Matrix,y.setScaleComponent(z,z,z),t=a.Matrix.multiply(y,t)));f.derived=f.initial.transform(t);if(!this._hasBits(8192))return[3,8];x=!1;return void 0===this._viewFrame?[3,5]:[4,e.getBoundingByNodeId(b,
c,[this._viewFrame.getRuntimeId()],7,!1,x)];case 4:return B=N.sent(),[3,7];case 5:return[4,c.getModelBounding(!0,!1,x)];case 6:B=N.sent(),N.label=7;case 7:return A=B,C=a.Point3.subtract(f.derived.getTarget(),f.derived.getPosition()),D=A.extents().length(),G=C.copy().normalize().scale(D),E=A.center(),I=a.Point3.subtract(E,G),f.derived.setPosition(I),f.derived.setTarget(E),f.derived.setWidth(D),f.derived.setHeight(D),[2,d._setCameraPromise(f.derived,g)];case 8:if(f.derived.getProjection()!==a.Projection.Orthographic)return[3,
10];F=a.Point3.subtract(f.derived.getTarget(),f.derived.getPosition());return[4,c.getModelBounding(!0,!1,!1)];case 9:return A=N.sent(),K=a.Point3.subtract(A.center(),f.derived.getPosition()),L=1/F.length(),H=L*a.Point3.dot(F,K),0<H&&(F.scale(L),M=Math.max(f.derived.getWidth(),f.derived.getHeight()),J=a.Point3.add(f.derived.getPosition(),a.Point3.scale(F,H)),Q=a.Point3.subtract(J,a.Point3.scale(F,2.5*M)),f.derived.setPosition(Q),f.derived.setTarget(J)),[2,d._setCameraPromise(f.derived,g)];case 10:if(f.derived.getProjection()!==
a.Projection.Perspective)return[3,12];P=.01;return[4,c.getModelBounding(!0,!1,!1)];case 11:A=N.sent();O=a.Point3.subtract(A.max,A.min).length();F=a.Point3.subtract(f.derived.getTarget(),f.derived.getPosition());R=F.length();T=R/O;if(0===O||T>P)return[2,d._setCameraPromise(f.derived,g)];S=O*P*1.001;U=f.derived.getWidth()/R;V=f.derived.getHeight()/R;W=U*S;X=V*S;Y=F.copy().normalize().scale(S);E=a.Point3.add(f.derived.getPosition(),Y);f.derived.setTarget(E);f.derived.setWidth(W);f.derived.setHeight(X);
return[2,d._setCameraPromise(f.derived,g)];case 12:return[2,d._setCameraPromise(f.derived,g)]}})})};c.prototype.hasPmi=function(a){var b=e.towardInclusionContext(this).getInclusionKey(),c=e.towardInclusionContext(a).getInclusionKey();if(b!==c)return!1;b=0;for(a=a.getPmiBodies();b<a.length;b++)if(c=a[b].getInstanceInc()[1],this._instanceMarkupKeysToShow.has(c))return!0;return!1};c.prototype.isAnnotationView=function(){return this._hasBits(134217728)};c.prototype.setViewFrame=function(a){console.assert(void 0===
this._viewFrame);this._viewFrame=a};return c}(e.NodeMixin);e.CadView=c})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(e){var f=function(d){function c(b,c,e,f){var p;p=d.call(this,b,e,f.nodeInfo)||this;p._inclusionContextForNodeId=c;p._modelKey=e;0<f.repItemInfos.length&&(c=p._loadRepresentationItems(b,e,f.repItemInfos),p._repItems=a.TerseArray.fromArray(c));b.registerPartDefinition(p);return p}__extends(c,d);c.parseXml=function(a,c){var d=e.Node.parseXml(a,c);if(null===d.name){var f=c.getAttribute("FilePath");null!==f&&(d=__assign({},d,{name:f}))}f=[];for(c=c.firstElementChild;null!==
c;){if("Body"===c.localName){var h=e.RepresentationItem.parseXml(a,c);f.push(h)}c=c.nextElementSibling}return{nodeInfo:d,repItemInfos:f}};c.parseBinary=function(a,c){var d=c.parseNodeParseBits(),f=e.Node.parseBinary(a,c,d),h=[];if(d.hasBits1(1024))for(var d=c.parseCount_32(),k=0;k<d;++k){var r=e.RepresentationItem.parseBinary(a,c);h.push(r)}return{nodeInfo:f,repItemInfos:h}};c.reify=function(a,d,e,f){return new c(a,d,e,f)};c.createDynamic=function(a,d,f){var h=a.getRootNode(),h=e.towardInclusionContext(h);
d={nodeInfo:{nodeId:a.massageAuthoredUserId(h,d),bits:1073741824,name:f,localTransform:null,attributes:[],header:e.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},repItemInfos:[]};return new c(a,h,0,d)};c.createMissing=function(a){a=this.createDynamic(a,null,null);a._bits|=4096;return a};c.prototype.isMissing=function(){return this._hasBits(4096)};c.prototype._loadRepresentationItems=function(a,c,d){for(var f=[],h=0;h<d.length;h++){var k=e.RepresentationItem.reify(a,
c,d[h],this);this._addRepresentationItem(k);f.push(k)}return f};c.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this._inclusionContextForNodeId)};c.prototype.getInclusionContextForNodeId=function(){return this._inclusionContextForNodeId};c.prototype.addReferrer=function(b){var c=e.towardLoadContext(b),d=e.towardLoadContext(this._inclusionContextForNodeId);console.assert(c===d);this._referrers=a.TerseArray.push(this._referrers,b)};c.prototype.createRepItem=function(a,c){a=e.RepresentationItem.createDynamic(a,
c,null,this._modelKey,this);this._addRepresentationItem(a);return a};c.prototype._addRepresentationItem=function(b){this._repItems=a.TerseArray.push(this._repItems,b)};c.prototype.getRepresentationItems=function(){return a.TerseArray.toArray(this._repItems)};c.prototype.getReferrers=function(){return a.TerseArray.toArray(this._referrers)};c.prototype.removeAllReferrers=function(){for(var a=0,c=this.getReferrers();a<c.length;a++){var d=c[a].removePartDefinition();console.assert(this===d)}delete this._referrers};
c.prototype.getModelKey=function(){return this._modelKey};return c}(e.NodeMixin);e.PartDefinition=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){(function(a){a[a.Unknown=0]="Unknown";a[a.Text=1]="Text";a[a.Dimension=2]="Dimension";a[a.Arrow=3]="Arrow";a[a.Balloon=4]="Balloon";a[a.CircleCenter=5]="CircleCenter";a[a.Coordinate=6]="Coordinate";a[a.Datum=7]="Datum";a[a.Fastener=8]="Fastener";a[a.Gdt=9]="Gdt";a[a.Locator=10]="Locator";a[a.MeasurementPoint=11]="MeasurementPoint";a[a.Roughness=12]="Roughness";a[a.Welding=13]="Welding";a[a.Table=14]="Table";a[a.Other=15]="Other";a[a.GeometricalTolerance=16]=
"GeometricalTolerance"})(e.PmiType||(e.PmiType={}));(function(a){a[a.Ident=1]="Ident";a[a.Target=2]="Target"})(e.PmiSubTypeDatum||(e.PmiSubTypeDatum={}));(function(a){a[a.Distance=1]="Distance";a[a.DistanceOffset=2]="DistanceOffset";a[a.DistanceCumulate=3]="DistanceCumulate";a[a.Chamfer=4]="Chamfer";a[a.Slope=5]="Slope";a[a.Ordinate=6]="Ordinate";a[a.Radius=7]="Radius";a[a.RadiusTangent=8]="RadiusTangent";a[a.RadiusCylinder=9]="RadiusCylinder";a[a.RadiusEdge=10]="RadiusEdge";a[a.Diameter=11]="Diameter";
a[a.DiameterTangent=12]="DiameterTangent";a[a.DiameterCylinder=13]="DiameterCylinder";a[a.DiameterEdge=14]="DiameterEdge";a[a.DiameterCone=15]="DiameterCone";a[a.Length=16]="Length";a[a.LengthCurvilinear=17]="LengthCurvilinear";a[a.LengthCircular=18]="LengthCircular";a[a.Angle=19]="Angle"})(e.PmiSubTypeDimension||(e.PmiSubTypeDimension={}));(function(a){a[a.Fcf=1]="Fcf"})(e.PmiSubTypeGdt||(e.PmiSubTypeGdt={}));(function(a){a[a.Line=1]="Line";a[a.Spot=2]="Spot"})(e.PmiSubTypeWelding||(e.PmiSubTypeWelding=
{}));(function(a){a[a.SymbolUser=1]="SymbolUser";a[a.SymbolUtility=2]="SymbolUtility";a[a.SymbolCustom=3]="SymbolCustom";a[a.GeometricReference=4]="GeometricReference";a[a.Region=5]="Region"})(e.PmiSubTypeOther||(e.PmiSubTypeOther={}));var f=function(){return function(a){this.faceIds=[];this.edgeIds=[];this.body=a}}();e.PmiTopologyReference=f;var d=function(c){function b(a,d,f,p){var k,r=e.towardAttachContext(d).getMasterModelKey();k=0;f.initiallyShown&&(k|=1073741824);k=c.call(this,a,r,{nodeId:f.nodeId,
bits:k,name:f.name,localTransform:null,attributes:f.attributesDataKey?f.attributesDataKey:[],header:e.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null})||this;k._bits|=16384;k._parent=p;k._packed=b._pack(f.pmiType,f.pmiSubType);p=0;for(var m=f.pmiBodyInfos;p<m.length;p++)k._pmiBodies=h.TerseArray.push(k._pmiBodies,k._loadPmiBody(a,r,m[p]));0<f.topoRefInfos.length&&(k._topoRefs=b._loadTopoRefs(d,f.topoRefInfos));if(0<f.topoRefs.length)if(void 0===
k._topoRefs)k._topoRefs=f.topoRefs.slice();else for(d=0,f=f.topoRefs;d<f.length;d++)k._topoRefs.push(f[d]);a.registerPmi(k);return k}__extends(b,c);b.parseBinary=function(a,b,c){var d=c.parsePmiParseBits(),f=c.parseNodeId(),r=null;h.hasBits(d,1)&&(r=c.parseCString());var m=null;h.hasBits(d,4)&&(m=c.parseDataKey());var n=1;h.hasBits(d,16)&&(n=c.parseCount_32());for(var q=[],t=h.hasBits(d,8),u=0;u<n;++u){var w=e.PmiBody.parseBinary(a,b,c,t);q.push(w)}a=0<q.length?h.hasBits(q[0].nodeInfo.bits,1073741824):
!1;b=c.parsePmiType();n=c.parsePmiSubType();t=[];if(h.hasBits(d,2))for(d=c.parseCount_32(),u=0;u<d;++u)w=e.ReferenceOnTopology.parseBinary(c),t.push(w);return{nodeId:f,name:r,attributesDataKey:m,pmiBodyInfos:q,initiallyShown:a,pmiType:b,pmiSubType:n,topoRefInfos:t,topoRefs:[]}};b.reify=function(a,c,d,f){var h=e.towardAttachContext(c);a=new b(a,c,d,f);h.attachedInvisibly()&&a.setVisibility(!1);return a};b.createDynamic=function(a,c,d,e,f,h,m){e={nodeId:a.generateDynamicNodeId(),name:null,attributesDataKey:null,
pmiBodyInfos:h,initiallyShown:!0,pmiType:e,pmiSubType:f,topoRefInfos:[],topoRefs:m};return new b(a,c,e,d)};b._loadTopoRefs=function(a,b){for(var c=[],d=0;d<b.length;d++){var f=e.ReferenceOnTopology.reify(a,b[d]);c.push(f)}return c};b.prototype._loadPmiBody=function(a,b,c){return e.PmiBody.reify(a,b,this,c)};b.prototype.getPmiBodies=function(){return h.TerseArray.toArray(this._pmiBodies)};b._pack=function(a,b){return a+100*b};b.prototype.getPmiType=function(){return this._packed%100};b.prototype.getPmiSubType=
function(){return Math.floor(this._packed/100)%100};b.prototype.getParent=function(){return this._parent};b.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this)};b.prototype.getBranchVisibility=function(){for(var a=this.isVisible()?2:1,b=0,c=h.TerseArray.toArray(this._pmiBodies);b<c.length;b++){var d=c[b];d.isOutOfHierarchy()||(a|=d.isVisible()?2:1)}return a};b.prototype.setVisibility=function(a){this._setVisibility(a)};b.prototype.getPmiTopologyReferences=function(b){if(void 0===
this._topoRefs)return[];for(var c=new Map,d=0,e=this._topoRefs;d<e.length;d++){var h=e[d],r=h.getBodyInstanceInc(),r=b.lookupAnyBodyByInstanceInc(r[0],r[1]);if(null!==r){var m=c.get(r);void 0===m&&(m=new f(r),c.set(r,m));switch(h.getTopoItemType()){case a.PmiTopoRef.Face:m.faceIds.push(h.getItemIndex());break;case a.PmiTopoRef.Edge:m.edgeIds.push(h.getItemIndex())}}}var n=[];c.forEach(function(a){n.push(a)});return n};return b}(e.NodeMixin);e.Pmi=d})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal=
{}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(c,b){for(var d=[],e=0;e<c.length;e++){var f=b(c[e]);f&&d.push(f)}return a.Util.waitForAll(d)}var d=function(c){function b(d,f,v,p,k,r,m){var n=this;m=b._amendInfo(p,m);var q=e.towardAttachContext(k).getMasterModelKey(),n=c.call(this,p,q,m.nodeInfo)||this;n._parent=r;n._bits=n._bits|m.productBits|32768;var t=m.nodeInfo.header;r=[];null!==m.prototypeDataKey&&(console.assert(null!==v),n._prototypeContext=n._loadPrototypeContext(f,v,p,k,m.prototypeDataKey,
t));console.assert(null===m.quickAccessPartDefinitionDataId||null===m.partDefinition);null!==m.partDefinition?Array.isArray(m.partDefinition)?n._partDefinition=n._lazyLoadPartDefinitionById(p,k,m.partDefinition,t):n._partDefinition=n._lazyLoadPartDefinitionByInfo(p,k,m.partDefinition,q):null!==m.quickAccessPartDefinitionDataId&&(n._partDefinition=n._lazyLoadPartDefinitionById(p,k,m.quickAccessPartDefinitionDataId,t));if(0<m.childDataKeys.length){console.assert(null!==v);var u=function(){return __awaiter(n,
void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,this._loadProductOccurrences(f,v,p,k,m.childDataKeys,t)];case 1:return a=b.sent(),this._children=h.TerseArray.fromArray(a),[2]}})})}();r.push(u)}0<m.bodyInstanceInfos.length&&(q=n._loadBodyInstances(p,q,m.bodyInstanceInfos),n._bodyInstances=h.TerseArray.fromArray(q));0<m.cadViewInfos.length&&(q=n._loadCadViews(p,k,m.cadViewInfos),n._cadViews=h.TerseArray.fromArray(q));0<m.pmiInfos.length&&(q=n._loadPmis(p,
k,m.pmiInfos),n._pmis=h.TerseArray.fromArray(q));null!==m.measurementUnit&&(n._measurementUnit=m.measurementUnit);null!==m.externalModelInfo&&(console.assert(null!==d),console.assert(null!==v),e.ExternalModel.canImplicitlyLoad(m.externalModelInfo)?(u=n._loadAndAttachExternalModel(v,k,m.externalModelInfo),r.push(u)):n._pendingExternalModels=h.TerseArray.push(n._pendingExternalModels,m.externalModelInfo));q=0;for(u=m.layersInfos;q<u.length;q++){var w=u[q];p.createOrUpdateLayerName(w.id,w.name)}q=0;
for(u=m.filters;q<u.length;q++)p.addFilter(u[q]);q=n.getLayerId();null===q||n.isOutOfHierarchy()||p.registerTreeNodeInLayer(n,q);p.registerProductOccurrence(n);if(null===d){if(0<r.length)throw new a.InternalLogicError;}else d.resolve(a.Util.waitForAll(r));return n}__extends(b,c);b.parseXml=function(a,b,c,d,f){c=c.getInclusionKey();var h=e.Node.parseXml(b,d),m=e.XmlParser.parseFloat(d,"Unit"),n=[],q=null,t=null,u=null;for(d=d.firstElementChild;null!==d;){if("PartDefinition"===d.localName){q=e.PartDefinition.parseXml(b,
d);break}else if("BodyInstance"===d.localName){var w=e.BodyInstance.parseXml(b,d,c);n.push(w)}else if("Material"===d.localName)console.assert(null===t),t=e.SimpleMaterial.parseXml(d);else if("ExternalModel"===d.localName&&(console.assert(null===u),w=d.getAttribute("Name"),null!==w))var u=e.XmlParser.parseFloat(d,"Unit"),z=e.XmlParser.parseBounding(d,"BoundingBox"),u={config:a,modelName:w,bounding:z,measurementUnit:u,toAttachData:f,reservedNodeIdOffset:0};d=d.nextElementSibling}return{nodeInfo:h,productBits:0,
childDataKeys:[],prototypeDataKey:null,partDefinition:q,quickAccessPartDefinitionDataId:null,externalModelInfo:u,bodyInstanceInfos:n,cadViewInfos:[],pmiInfos:[],measurementUnit:m,simpleMaterial:t,layersInfos:[],filters:[]}};b.parseBinary=function(a,b,c,d){var f=e.towardAttachContext(c),h=f.getRemapper(),m=d.parseNodeParseBits();if(m.hasBits1(2097152)){var n=d.parseAssemblyDataVersion();n}m.hasBits2(8)&&f.setGenericTypeMaps(d.parseGenericTypes());var n=e.Node.parseBinary(b,d,m),q=0;m.hasBits1(4194304)&&
(q=d.parseProductBits());var t=[];if(m.hasBits1(16))for(var u=d.parseCount_32(),w=0;w<u;++w){var z=d.parseDataKey();t.push(z)}z=u=null;if(m.hasBits1(32)&&(u=d.parseDataKey(),m.hasBits1(64))){z=d.parseModelKey(h);console.assert(0!==z);var y=d.parseDataKey(),z=[z,y]}y=[];if(m.hasBits1(128))for(var x=d.parseCount_32(),w=0;w<x;++w){var A=e.BodyInstance.parseBinary(b,c,d);y.push(A)}x=null;m.hasBits1(524288)&&(w=d.parseModelKey(h),console.assert(0!==w),x=d.parseInclusionKey(h,w),x={config:a,inclusionKey:x,
modelKey:w});a=null;m.hasBits1(512)&&(w=d.parseModelKey(h),0===w&&(w=f.getMasterModelKey()),a=d.parseDataKey(),a=[w,a]);f=[];if(m.hasBits1(32768))for(h=d.parseCount_32(),w=0;w<h;++w)A=e.CadView.parseBinary(b,c,d),f.push(A);h=[];if(m.hasBits1(65536))for(A=d.parseCount_32(),w=0;w<A;++w){var B=e.Pmi.parseBinary(b,c,d);h.push(B)}c=null;m.hasBits1(16384)&&(c=d.parseFloat_64());m.hasBits1(16777216)&&(w=d.parsePoint3_64(),A=d.parsePoint3_64(),b.setViewAxes(w,A));b=[];if(m.hasBits1(134217728))for(A=d.parseCount_32(),
w=0;w<A;++w)B=e.Layer.parseBinary(d),b.push(B);A=[];if(m.hasBits1(268435456))for(m=d.parseCount_32(),w=0;w<m;++w)B=e.Filter.parseBinary(d),A.push(B);return{nodeInfo:n,productBits:q,childDataKeys:t,prototypeDataKey:u,partDefinition:a,quickAccessPartDefinitionDataId:z,externalModelInfo:x,bodyInstanceInfos:y,cadViewInfos:f,pmiInfos:h,measurementUnit:c,simpleMaterial:null,layersInfos:b,filters:A}};b.reifySync=function(a,c,d,f,h,r){console.assert(0===h.childDataKeys.length);console.assert(null===h.externalModelInfo);
var m=e.towardAttachContext(f);a=new b(null,a,c,d,f,r,h);m.attachedInvisibly()&&a.setVisibility(!1);return a};b.reify=function(a,c,d,e,f,r){return __awaiter(this,void 0,void 0,function(){var m,n;return __generator(this,function(q){switch(q.label){case 0:return m=h.OpenPromise.create(),n=new b(m,a,c,d,e,r,f),[4,m];case 1:return q.sent(),[2,n]}})})};b.createDynamic=function(c,d,f,h,k,r,m){void 0===m&&(m=!1);var n=e.towardInclusionContext(d);f={nodeInfo:{nodeId:c.massageAuthoredUserId(n,h),bits:r?1073741824:
0,name:f,localTransform:k,attributes:[],header:e.AssemblyDataHeader.dynamic,exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},productBits:m?268435456:0,childDataKeys:[],prototypeDataKey:null,partDefinition:null,quickAccessPartDefinitionDataId:null,bodyInstanceInfos:[],externalModelInfo:null,cadViewInfos:[],pmiInfos:[],measurementUnit:null,simpleMaterial:null,layersInfos:[],filters:[]};h=new a.LoadSubtreeConfig;h.attachInvisibly=!r;return new b(null,h,null,c,n,d,f)};b.createMissing=
function(a,b){a=this.createDynamic(a,b,"Missing",null,null,!1);a._bits|=4096;return a};b.prototype.isMissing=function(){return this._hasBits(4096)};b._amendInfo=function(a,b){if(null!==b.nodeInfo.name)return b;var c=null;h.hasBits(b.productBits,2)?c=a.generateProductName():h.hasBits(b.productBits,4)?c=a.generateGroupName():h.hasBits(b.productBits,32)?c=a.generateDrawingSheetName():h.hasBits(b.productBits,8)&&(c=a.generateDrawingViewName());if(null===c)return b;a=__assign({},b.nodeInfo,{name:c});return __assign({},
b,{nodeInfo:a})};b.prototype._loadExternalModel=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(h){if(e.ExternalModel.isNameInfo(c))return[2,a.attachByExternalModelInfo(c,this)];d=this.getAuthoredId();f=e.towardLoadContext(b);return f.handleExternalModel(d,b,c.inclusionKey)?[2,a.attachByExternalModelInfo(c,this)]:[2,null]})})};b.prototype._loadAndAttachExternalModel=function(a,b,c){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,
function(e){switch(e.label){case 0:return[4,this._loadExternalModel(a,b,c)];case 1:return d=e.sent(),null!==d&&this.addAttachContext(d),[2,d]}})})};b.prototype.loadPendingExternalModels=function(a){return __awaiter(this,void 0,void 0,function(){var b,c,d,f,r,m,n,q,t,u;return __generator(this,function(w){switch(w.label){case 0:if(!this.hasPendingExternalModels())return[2,[]];b=e.towardInclusionContext(this);c=[];d=0;for(f=h.TerseArray.toArray(this._pendingExternalModels);d<f.length;d++)r=f[d],m=this._loadAndAttachExternalModel(a,
b,r),c.push(m);delete this._pendingExternalModels;n=[];q=0;return[4,Promise.all(c)];case 1:t=w.sent(),w.label=2;case 2:if(!(q<t.length))return[3,4];u=t[q];null!==u&&n.push(u);w.label=3;case 3:return q++,[3,2];case 4:return[2,n]}})})};b.prototype._lazyLoadPartDefinitionByInfo=function(a,b,c,d){a=e.PartDefinition.reify(a,b,d,c);return h.LazyPromise.create(a)};b.prototype._lazyLoadPartDefinitionById=function(a,b,c,d){var f=this,r=a.getAbstractScEngine(),m=e.towardLoadContext(b),n=a.lookupPartDefinitionByDataId(m,
c[0],c[1]);if(null!==n)return h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,n];case 1:return a=b.sent(),a.addReferrer(this),[2,a]}})})});n=h.LazyPromise.create(function(){return __awaiter(f,void 0,void 0,function(){var f,h,k,m,n,y,x;return __generator(this,function(A){switch(A.label){case 0:return f=c[0],h=c[1],[4,a.enqueue(function(){return r.safeGetMetaData(f,h)})];case 1:return k=A.sent(),null!==
k?(m=new e.AssemblyData(d,k),n=new e.AssemblyDataParser(m),y=e.PartDefinition.parseBinary(a,n),x=e.PartDefinition.reify(a,b,f,y),x.addReferrer(this),[2,x]):[2,e.PartDefinition.createMissing(a)]}})})});a.registerPartDefinitionByDataId(m,c[0],c[1],n);return n};b._loadProductOccurrence=function(a,c,d,f,h,r){return __awaiter(this,void 0,void 0,function(){var m,n;return __generator(this,function(q){m=new e.AssemblyDataParser(h);n=b.parseBinary(a,d,f,m);return[2,b.reify(a,c,d,f,n,r)]})})};b.prototype._loadPrototypeContext=
function(a,c,d,f,k,r){var m=this,n=e.towardAttachContext(f),q=e.towardLoadContext(n),t=n.getMasterModelKey(),u,n=d.lookupPrototypeByDataId(q,t,k);null===n&&(n=h.LazyPromise.create(function(){return __awaiter(m,void 0,void 0,function(){var h,m,n;return __generator(this,function(q){switch(q.label){case 0:return h=d.getAbstractScEngine(),[4,d.enqueue(function(){return h.safeGetMetaData(t,k)})];case 1:return m=q.sent(),null!==m?(n=new e.AssemblyData(r,m),[2,b._loadProductOccurrence(a,c,d,f,n,u)]):[2,
b.createMissing(d,u)]}})})}),n=new e.SharedPrototypeContext(n),d.registerPrototypeByDataId(q,t,k,n));u=new e.PrototypeContext(n,f);u.addReferrer(this);return u};b.prototype._loadProductOccurrences=function(a,c,d,f,k,r){return __awaiter(this,void 0,void 0,function(){var m,n,q,t,u,w,z,y,x,A,B;return __generator(this,function(C){switch(C.label){case 0:return m=e.towardAttachContext(f),q=n=m.getMasterModelKey(),t=d.getAbstractScEngine(),[4,d.enqueue(function(){return t.safeGetMetaDatas(q,k)})];case 1:u=
C.sent(),w=[],z=0,C.label=2;case 2:if(!(z<k.length))return[3,9];y=void 0;if(null===u)return[3,6];x=u[z];u[z]=h.emptyBytes;A=new e.AssemblyData(r,x);return[4,b._loadProductOccurrence(a,c,d,f,A,this)];case 3:return y=C.sent(),(B=c.onLoadChildProductOccurrence())?[4,B]:[3,5];case 4:C.sent(),C.label=5;case 5:return[3,7];case 6:y=b.createMissing(d,this),C.label=7;case 7:w.push(y),C.label=8;case 8:return++z,[3,2];case 9:return[2,w]}})})};b.prototype._loadBodyInstances=function(a,b,c){for(var d=[],f=0;f<
c.length;f++){var h=e.BodyInstance.reify(a,b,this,c[f]);d.push(h)}return d};b.prototype._loadCadViews=function(a,b,c){for(var d=[],f=0;f<c.length;f++){var h=e.CadView.reify(a,b,c[f],this);d.push(h)}return d};b.prototype._loadPmis=function(a,b,c){for(var d=[],f=0;f<c.length;f++){var h=e.Pmi.reify(a,b,c[f],this);d.push(h)}return d};b.prototype.getParent=function(){return this._parent};b.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this)};b.prototype.isAbsoluteRoot=function(){return-2===
this._nodeId};b.prototype.getPrototype=function(){return void 0!==this._prototypeContext?this._prototypeContext:null};b.prototype.isAConfigurationNode=function(){return this._hasBits(1)};b.prototype.isADefaultNode=function(){return this._hasBits(16)};b.prototype.isAProductNode=function(){return h.hasBits(this._bits,2)};b.prototype.isAGroupNode=function(){return h.hasBits(this._bits,4)};b.prototype.isADrawingSheetNode=function(){return h.hasBits(this._bits,32)};b.prototype.isADrawingViewNode=function(){return h.hasBits(this._bits,
8)};b.prototype.addProductOccurrence=function(a){console.assert(a.getParent()===this);this._children=h.TerseArray.push(this._children,a);this._itemWasAdded()};b.prototype.addBodyInstance=function(a){console.assert(a.getParent()===this);this._bodyInstances=h.TerseArray.push(this._bodyInstances,a);this._itemWasAdded()};b.prototype.addCadView=function(a){console.assert(a.getParent()===this);this._cadViews=h.TerseArray.push(this._cadViews,a);this._itemWasAdded()};b.prototype.addPmi=function(a){console.assert(a.getParent()===
this);this._pmis=h.TerseArray.push(this._pmis,a);this._itemWasAdded()};b.prototype.addLoadContext=function(a){console.assert(a.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,a);this._itemWasAdded()};b.prototype.addAttachContext=function(a){console.assert(a.getParent()===this);this._childContexts=h.TerseArray.push(this._childContexts,a);this._itemWasAdded()};b.prototype._followPrototypesWhileEmpty=function(){if(void 0===this._prototypeContext||void 0!==this._children||
void 0!==this._childContexts)return this;var a=this._prototypeContext.getProductOccurrence();return a.isResolved()?a.getResolved()._followPrototypesWhileEmpty():this};b.prototype.getRawPartDefinition=function(){if(void 0!==this._partDefinition)return this._partDefinition;if(void 0!==this._prototypeContext){var a=this._prototypeContext.getProductOccurrence();if(a.isResolved())return a.getResolved().getRawPartDefinition()}return null};b.prototype.getPartDefinition=function(){return __awaiter(this,void 0,
void 0,function(){var b;return __generator(this,function(c){b=this.getRawPartDefinition();if(b instanceof h.LazyPromise)return[2,h.Boxed.create(b)];if(b instanceof Promise)return[2,b];a.Util.TypeAssert(b);return[2,null]})})};b.prototype.getPartDefinitionSync=function(){console.assert(this.isLoaded());if(void 0!==this._partDefinition&&this._partDefinition.isResolved())return this._partDefinition.getResolved();if(void 0!==this._prototypeContext){var a=this._prototypeContext.getProductOccurrence();if(a.isResolved())return a.getResolved().getPartDefinitionSync()}return null};
b.prototype._getChildren=function(){for(var a=h.TerseArray.toArray(this._children),b=0,c=h.TerseArray.toArray(this._childContexts);b<c.length;b++){var d=c[b].getChildren();h.append(a,d)}return a};b.prototype.getChildren=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return[4,this._followPrototypesWhileEmpty()];case 1:return a=b.sent(),[2,a._getChildren()]}})})};b.prototype.getChildrenSync=function(){console.assert(this.isLoaded());
var b=this.tryGetChildrenSync();if(null===b)throw new a.InternalLogicError;return b};b.prototype.tryGetChildrenSync=function(){var a=this._followPrototypesWhileEmpty();return a instanceof Promise?null:a._getChildren()};b.prototype.forEachChild=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return[4,this.getChildren()];case 1:return b=c.sent(),[2,f(b,a)]}})})};b.prototype.forEachBodyInstance=function(a){var b=this.getBodyInstances();
return f(b,a)};b.prototype.forEachPmi=function(a){var b=this.getPmis();return f(b,a)};b.prototype.forEachCadView=function(a){var b=this.getCadViews();return f(b,a)};b.prototype.hasBodyInstances=function(){return void 0!==this._bodyInstances};b.prototype.getBodyInstances=function(){return h.TerseArray.toArray(this._bodyInstances)};b.prototype.getCadViews=function(){return h.TerseArray.toArray(this._cadViews)};b.prototype.getPmis=function(){return h.TerseArray.toArray(this._pmis)};b.prototype.setMeasurementUnit=
function(a){this._measurementUnit=a};b.prototype.unsetMeasurementUnit=function(){this._measurementUnit=void 0};b.prototype.hasMeasurementUnit=function(){return void 0!==this._measurementUnit};b.prototype.getMeasurementUnit=function(){for(var a=this;null!==a;){if(void 0!==a._measurementUnit)return a._measurementUnit;a=e.towardProductOccurrence(a._parent)}return 1};b.prototype.getPhysicalProperties=function(){return __awaiter(this,void 0,void 0,function(){var a,b,c,d,e;return __generator(this,function(f){switch(f.label){case 0:return[4,
this.getPartDefinition()];case 1:return a=f.sent(),null===a?[2,null]:[4,a.value];case 2:b=f.sent();c=b.getRepresentationItems();if(1!==c.length)return[2,null];d=c[0];e=d.getPhysicalProperties();return[2,e]}})})};b.prototype.setPartDefinition=function(a){console.assert(void 0===this._partDefinition);this._partDefinition=h.LazyPromise.create(a)};b.prototype.setPrototype=function(a){console.assert(void 0===this._prototypeContext);this._prototypeContext=a;this._markBranchVisibilityDirty(!1)};b.prototype.removePrototype=
function(){if(void 0===this._prototypeContext)throw new a.InternalLogicError;var b=this._prototypeContext;delete this._prototypeContext;this._markBranchVisibilityDirty(!1);return b};b.prototype.getBranchVisibility=function(){this._updateBranchVisibility();return this._getBranchVisibility()};b.prototype._getBranchVisibility=function(){var a=this.isVisible()?2:1;this._hasBits(65536)&&(a|=2);this._hasBits(131072)&&(a|=1);return a};b.prototype._setBranchVisibility=function(a){this.isVisible()?console.assert(h.hasBits(a,
2)):console.assert(h.hasBits(a,1));this._bits&=-196609;h.hasBits(a,1)&&(this._bits|=131072);h.hasBits(a,2)&&(this._bits|=65536)};b.prototype._updateBranchVisibility=function(){if(this._hasBits(32768)){var a=this.isVisible()?2:1,b=this._getSubBranchVisibilities();null!==b&&(a|=b);this._setBranchVisibility(a);this._bits&=-32769}};b.prototype._getSubBranchVisibilities=function(){for(var a=0,b=0,c=this.getChildrenSync();b<c.length;b++){var d=c[b].getBranchVisibility(),a=a|d;if(3===a)return 3}d=0;for(b=
this.getBodyInstances();d<b.length;d++)if(c=b[d],!c.isOutOfHierarchy()&&(a|=c.isVisible()?2:1,3===a))return 3;b=0;for(c=this.getPmis();b<c.length;b++)if(d=c[b].getBranchVisibility(),a|=d,3===a)return 3;b=0;for(c=this.getCadViews();b<c.length;b++)if(d=c[b].getBranchVisibility(),a|=d,3===a)return 3;return 0===a?null:a};b.prototype._itemWasAdded=function(){3!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!0)};b.prototype._onItemRemoved=function(){1!==this._getBranchVisibility()&&this._markBranchVisibilityDirty(!1)};
b.prototype.markBranchVisibilityDirty=function(){this._markBranchVisibilityDirty(!1)};b.prototype._markBranchVisibilityDirty=function(a){if(!(this._hasBits(32768)||a&&3===this._getBranchVisibility()))if(this._bits|=32768,this._parent instanceof e.PrototypeContext)for(var b=0,c=this._parent.getReferrers();b<c.length;b++)c[b]._markBranchVisibilityDirty(a);else if(b=e.towardProductOccurrence(this._parent),null!==b)return b._markBranchVisibilityDirty(a)};b.prototype.setVisibility=function(a){this.isVisible()!==
a&&(this._setVisibility(a),this._markBranchVisibilityDirty(!1))};b.prototype._removeDirectChild=function(a){var b=h.TerseArray.toArray(this._children),c=b.length,b=b.filter(function(b){return b!==a});if(b.length===c)return!1;0===b.length?delete this._children:this._children=h.TerseArray.fromArray(b);this._onItemRemoved();return!0};b.prototype._removeIndirectChild=function(a){for(var b=!1,c=h.TerseArray.toArray(this._childContexts),d=0,e=c;d<e.length;d++)if(e[d].removeProductOccurrence(a)){b=!0;break}if(!b)return!1;
c=c.filter(function(a){return a.hasChildren()});0===c.length?delete this._childContexts:this._childContexts=h.TerseArray.fromArray(c);this._onItemRemoved();return!0};b.prototype.removeProductOccurrence=function(a){return this._removeDirectChild(a)?!0:this._removeIndirectChild(a)};b.prototype.removeBodyInstance=function(a){var b=h.TerseArray.toArray(this._bodyInstances),c=b.length,b=b.filter(function(b){return b!==a});if(b.length===c)return!1;0===b.length?delete this._bodyInstances:this._bodyInstances=
h.TerseArray.fromArray(b);this._onItemRemoved();return!0};b.prototype.purgeContents=function(){this._markBranchVisibilityDirty(!1);var b=[],c;void 0!==this._partDefinition&&(this._partDefinition.isUnforced()||(c=this._partDefinition.then(function(a){a.removeAllReferrers()}),b.push(c)),delete this._partDefinition);void 0!==this._prototypeContext&&(c=this._prototypeContext.purgeContents(),b.push(c),delete this._prototypeContext);c=h.TerseArray.toArray(this._children);c=f(c,function(a){return a.purgeContents()});
b.push(c);delete this._children;c=h.TerseArray.toArray(this._childContexts);c=f(c,function(a){return a.purgeContents()});b.push(c);delete this._childContexts;delete this._bodyInstances;delete this._cadViews;delete this._pmis;delete this._measurementUnit;return a.Util.waitForAll(b)};b.prototype.removePartDefinition=function(){if(void 0===this._partDefinition||!this._partDefinition.isResolved())throw new a.InternalLogicError;var b=this._partDefinition;delete this._partDefinition;return b.getResolved()};
b.prototype.isOutOfHierarchy=function(){return this._hasBits(268435456)};b.prototype.markIsExternalModelRoot=function(a){console.assert(!this._hasBits(2048));this._bits|=2048;a.markSeenExternalModel()};b.prototype.isExternalModelRoot=function(){return this._hasBits(2048)};b.prototype.addPendingExternalModel=function(a){this._pendingExternalModels=h.TerseArray.push(this._pendingExternalModels,a)};b.prototype.hasPendingExternalModels=function(){return!h.TerseArray.isEmpty(this._pendingExternalModels)};
return b}(e.NodeMixin);e.ProductOccurrence=d})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a,b){return void 0!==a&&b<a.length?a[b]:null}function d(a,b,c){void 0===a&&(a=[]);a.length=Math.max(a.length,b+1);a[b]=c;return a}var c;(function(a){a[a.Unknown=0]="Unknown";a[a.BRep=1]="BRep";a[a.Tessellation=2]="Tessellation";a[a.Wireframe=3]="Wireframe";a[a.PointCloud=4]="PointCloud"})(c=e.BodyType||(e.BodyType={}));var b=function(b){function l(a,c,d,e){c=b.call(this,a,c,d.nodeInfo)||this;c._parent=e;c._bodyType=d.bodyType;null!==d.meshKey&&(c._meshKey=
d.meshKey);0<d.faceMeasurementProps.length&&(c._faceMeasurementProps=d.faceMeasurementProps.slice());0<d.edgeMeasurementProps.length&&(c._edgeMeasurementProps=d.edgeMeasurementProps.slice());null!==d.physicalProps&&(c._physicalProps=d.physicalProps);if(0<d.faceAttributes.length){c._faceAttributes=[];for(var f=0,l=d.faceAttributes;f<l.length;f++)e=l[f],c._faceAttributes.push(e.copy())}if(0<d.edgeAttributes.length)for(c._edgeAttributes=[],f=0,d=d.edgeAttributes;f<d.length;f++)e=d[f],c._edgeAttributes.push(e.copy());
a.registerRepresentationItem(c);return c}__extends(l,b);l.parseXml=function(a,b){a=e.Node.parseXml(a,b);b=e.XmlParser.parseMeshKey(b,"TCKey_Mesh");return{nodeInfo:a,meshKey:b,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[]}};l.parseBinary=function(b,c){var d=c.parseNodeParseBits();b=e.Node.parseBinary(b,c,d);var g=c.parseBodyType(),f=null;d.hasBits1(8192)&&(f=c.parseMeshKey());var l=[];if(d.hasBits1(2048))for(var h=c.parseCount_32(),
t=0;t<h;++t){var u=e.MeasurementProperty.Face.parseBinary(c);l.push(u)}u=[];if(d.hasBits1(4096))for(h=c.parseCount_32(),t=0;t<h;++t){var w=e.MeasurementProperty.Edge.parseBinary(c);u.push(w)}h=null;d.hasBits1(1048576)&&(h=e.PhysicalProperties.parseBinary(c));w=[];if(d.hasBits2(1))for(var z=c.parseCount_32(),t=0;t<z;t++){for(var y=[],x=c.parseCount_32(),A=0;A<x;A++){var B=e.Attribute.parseBinary(c);y.push(B)}w.push(new a.SubentityAttributes(y))}z=[];if(d.hasBits2(2))for(d=c.parseCount_32(),t=0;t<d;t++){y=
[];x=c.parseCount_32();for(A=0;A<x;A++)B=e.Attribute.parseBinary(c),y.push(B);z.push(new a.SubentityAttributes(y))}return{nodeInfo:b,meshKey:f,bodyType:g,faceMeasurementProps:l,edgeMeasurementProps:u,physicalProps:h,faceAttributes:w,edgeAttributes:z}};l.reify=function(a,b,c,d){return new l(a,b,c,d)};l.createDynamic=function(a,b,d,g,f){var h=f.getInclusionContextForNodeId();b={nodeInfo:{nodeId:a.massageAuthoredUserId(h,b),bits:1073741824,name:d,localTransform:null,attributes:[],header:e.AssemblyDataHeader.dynamic,
exchangeId:null,layerId:null,genericTypeId:null,genericId:null,userDatas:null},meshKey:null,bodyType:c.Unknown,faceMeasurementProps:[],edgeMeasurementProps:[],physicalProps:null,faceAttributes:[],edgeAttributes:[]};return new l(a,g,b,f)};l.prototype.setPhysicalProperties=function(a){this._physicalProps=a};l.prototype.getPhysicalProperties=function(){return void 0!==this._physicalProps?this._physicalProps:null};l.prototype.getParent=function(){return this._parent};l.prototype.getFaceCount=function(){return void 0!==
this._faceMeasurementProps?this._faceMeasurementProps.length:0};l.prototype.getEdgeCount=function(){return void 0!==this._edgeMeasurementProps?this._edgeMeasurementProps.length:0};l.prototype.getFaceAttributes=function(a){return f(this._faceAttributes,a)};l.prototype.getEdgeAttributes=function(a){return f(this._edgeAttributes,a)};l.prototype.getFaceMeasurementProperty=function(a){return f(this._faceMeasurementProps,a)};l.prototype.getEdgeMeasurementProperty=function(a){return f(this._edgeMeasurementProps,
a)};l.prototype.setFaceMeasurementProperty=function(a,b){this._faceMeasurementProps=d(this._faceMeasurementProps,a,b.copy())};l.prototype.setEdgeMeasurementProperty=function(a,b){this._edgeMeasurementProps=d(this._edgeMeasurementProps,a,b.copy())};l.prototype.getBodyType=function(){return this._bodyType};l.prototype.getRuntimeId=function(){return e.getRuntimeId(this._nodeId,this._parent.getInclusionContextForNodeId())};return l}(e.NodeMixin);e.RepresentationItem=b})(h.Tree||(h.Tree={}))})(a.Internal||
(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(a,b,d){this._type=a;this._title=b;this._value=d}d.parseBinary=function(a){var b=a.parseCString(),g=a.parseAttributeType();a=a.parseCString();return new d(g,b,a)};d.parseXml=function(c){console.assert("Attr"===c.localName);var b=a.AttributeType.Undefined,g="",e="",f=c.getAttribute("Name");if(null!==f&&(g=f,"__PRC_RESERVED_ATTRIBUTE_A3DF_ProductInformation"===g))return new d(b,g,e);f=c.getAttribute("Type");if(null!==f)switch(f){case "i":b=
a.AttributeType.Int;break;case "f":b=a.AttributeType.Float;break;case "t":b=a.AttributeType.Time;break;case "s":b=a.AttributeType.String}c=c.getAttribute("Value");null!==c&&(e=c);return new d(b,g,e)};d.prototype.getType=function(){return this._type};d.prototype.getTitle=function(){return this._title};d.prototype.getValue=function(){return this._value};d.prototype.copy=function(){return new d(this._type,this._title.slice(),this._value.slice())};return d}();e.Attribute=f})(h.Tree||(h.Tree={}))})(a.Internal||
(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(a){this._colorTable=[];this._colorTable=a.slice()}d.parseXml=function(c){console.assert("ColorTable"===c.localName);var b=[];c=c.getAttribute("data");if(null!==c){c=c.split(" ");console.assert(0===c.length%3);for(var g=0;g<c.length;g+=3){var e=parseFloat(c[g]),f=parseFloat(c[g+1]),h=parseFloat(c[g+2]),e=new a.Color(e,f,h);b.push(e)}}return new d(b)};d.prototype.getColor=function(a){if(0<=a&&0===a%3&&(a/=3,a<this._colorTable.length))return this._colorTable[a];
console.assert(!1);return null};return d}();e.ColorTable=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(e){var f=function(){function a(){this.isInclusive=!1;this.nodeIds=[]}a.parseBinary=function(c){var d=new a;d.isInclusive=c.parseBoolean();for(var e=c.parseCount_32(),f=0;f<e;f++)d.nodeIds.push(c.parseNodeId());return d};return a}();e.FilterEntityItem=f;var d=function(){function a(){this.isInclusive=!1;this.layers=[]}a.parseBinary=function(c){var d=new a;d.isInclusive=c.parseBoolean();for(var e=c.parseCount_32(),f=0;f<e;f++)d.layers.push(c.parseLayerId());return d};
return a}();e.FilterLayerItem=d;var c=function(){function b(){this.isDisplayfilter=!1;this.name=null;this.isActive=!1;this.filterEntityItem=this.filterLayersItem=null}b.parseBinary=function(c){var e=new b,v=null,p=null,k=c.parseLayerParseBits();e.isDisplayfilter=c.parseBoolean();a.hasBits(k,1)&&(e.name=c.parseCString());e.isActive=c.parseBoolean();a.hasBits(k,2)&&(v=d.parseBinary(c));a.hasBits(k,4)&&(p=f.parseBinary(c));e.filterLayersItem=v;e.filterEntityItem=p;return e};return b}();e.Filter=c})(a.Tree||
(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(a){(function(e){var f=function(){function d(a,b,d,e){this.id=a;this.name=b;this.nodes=d;this.treeNodes=e}d.parseBinary=function(c){var b=c.parseLayerParseBits(),d=c.parseLayerId(),e=null;a.hasBits(b,1)&&(e=c.parseCString());return{id:d,name:e}};return d}();e.Layer=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function a(c,b,d,e,f,h,k,r,m){this._ambientAlpha=c;this._diffuseAlpha=b;this._emissiveAlpha=d;this._specularAlpha=e;this._shininess=f;null!==h&&(this._ambientIndex=h);null!==k&&(this._diffuseIndex=k);null!==r&&(this._emissiveIndex=r);null!==m&&(this._specularIndex=m)}a.parseXml=function(c){console.assert("MaterialTable"===c.localName);var b=e.XmlParser.parseFloat(c,"AmbientAlpha")||0,g=e.XmlParser.parseFloat(c,"DiffuseAlpha")||0,f=e.XmlParser.parseFloat(c,
"EmissiveAlpha")||0,h=e.XmlParser.parseFloat(c,"SpecularAlpha")||0,p=e.XmlParser.parseFloat(c,"Shininess")||0,k=e.XmlParser.parseUint(c,"AmbientIndice"),r=e.XmlParser.parseUint(c,"DiffuseIndice"),m=e.XmlParser.parseUint(c,"EmissiveIndice");c=e.XmlParser.parseUint(c,"SpecularIndice");return new a(b,g,f,h,p,k,r,m,c)};a.prototype.getAmbientColorIndex=function(){return void 0!==this._ambientIndex?this._ambientIndex:null};a.prototype.getDiffuseColorIndex=function(){return void 0!==this._diffuseIndex?this._diffuseIndex:
null};a.prototype.getEmissiveColorIndex=function(){return void 0!==this._emissiveIndex?this._emissiveIndex:null};a.prototype.getSpecularColorIndex=function(){return void 0!==this._specularIndex?this._specularIndex:null};a.prototype.getAmbientAlpha=function(){return this._ambientAlpha};a.prototype.getDiffuseAlpha=function(){return this._diffuseAlpha};a.prototype.getEmissiveAlpha=function(){return this._emissiveAlpha};a.prototype.getSpecularAlpha=function(){return this._specularAlpha};a.prototype.getShininess=
function(){return this._shininess};return a}();e.Material=f;f=function(){function d(a,b){null!==a&&(this._color=a);null!==b&&(this._alpha=b)}d.parseXml=function(c){console.assert("Material"===c.localName);var b=null,g=null;c=c.getAttribute("Color");if(null!==c){var e=c.split(" ");if(4!==e.length)throw new a.XmlParseError('Expected "Color" attribute to have four channel components.');b=parseFloat(e[0]);g=parseFloat(e[1]);c=parseFloat(e[2]);e=parseFloat(e[3]);b=new a.Color(b,g,c);g=e}return new d(b,
g)};d.prototype.getColor=function(){return void 0!==this._color?this._color:null};d.prototype.getAlpha=function(){return void 0!==this._alpha?this._alpha:null};return d}();e.SimpleMaterial=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(){function a(c,b,d){this.surfaceArea=c;this.volume=b;this.centerOfGravity=d}a.parseBinary=function(c){var b=c.parseFloat_64(),g=c.parseFloat_64();c=c.parsePoint3_64();return new a(b,g,c)};return a}();a.PhysicalProperties=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(){function a(c,b,d,e){this._inclusionKey=c;this._bodyInstanceKey=b;this._topoItemType=d;this._itemIndex=e}a.parseBinary=function(a){var b=a.parseInstanceKey(),d=a.parsePmiTopoRef();a=a.parseIndex_32();return{bodyInstanceKey:b,topoItemType:d,itemIndex:a}};a.reify=function(c,b){c=c.getInclusionKey();return new a(c,b.bodyInstanceKey,b.topoItemType,b.itemIndex)};a.fromBodyInstance=function(c,b,g){c=c.getInstanceInc();return new a(c[0],c[1],b,g)};a.prototype.getBodyInstanceInc=
function(){return[this._inclusionKey,this._bodyInstanceKey]};a.prototype.getTopoItemType=function(){return this._topoItemType};a.prototype.getItemIndex=function(){return this._itemIndex};return a}();a.ReferenceOnTopology=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(){function d(a,b){console.assert(null!==a||null!==b);this._materialIndex=a;this._colorIndex=b}d.parseXml=function(c){console.assert("Style"===c.localName);var b=a.XmlParser.parseUint(c,"MaterialIndex");c=a.XmlParser.parseUint(c,"ColorIndex");return new d(b,c)};d.prototype.getMaterialIndex=function(){return this._materialIndex};d.prototype.getColorIndex=function(){return this._colorIndex};return d}();a.Style=f})(a.Tree||(a.Tree={}))})(a.Internal||
(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(){}d.parseBinary=function(c){for(var b=new a.Matrix,d=0;4>d;++d)for(var e=0;3>e;++e)b.m[4*d+e]=c.parseFloat_32();return b};d.parseXml=function(c){console.assert("Transformation"===c.localName);var b=new a.Matrix;c=c.getAttribute("RelativeTransfo");if(null!==c){c=c.split(" ");console.assert(16===c.length);for(var d=0;16>d;++d){var e=parseFloat(c[d]);console.assert(!isNaN(e));b.m[d]=e}}return b};return d}();e.Transform=f})(h.Tree||(h.Tree=
{}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a){a.markLoaded();var c=0;for(a=a.getRepresentationItems();c<a.length;c++)a[c].markLoaded()}function d(b){b=b.getRawPartDefinition();if(null!==b)if(b instanceof h.LazyPromise){if(!b.isResolved())return b.then(f)}else return a.Util.TypeAssert(b),b.then(function(a){if(null!==a&&(a=a.value,!a.isResolved()))return a.then(f)})}function c(a){var c=e.forcePrototype(a);return void 0!==c?c.then(function(){return d(a)}):d(a)}e.forcePartDefinition=c;e.forcePartDefinitions=
function(b){return __awaiter(this,void 0,void 0,function(){var d,f;return __generator(this,function(h){switch(h.label){case 0:return d=[],f={enterProductOccurrence:function(a){a=c(a);void 0!==a&&d.push(a)}},[4,e.WalkerAsync.walk(f,b,e.WalkRestriction.None)];case 1:return h.sent(),[2,a.Util.waitForAll(d)]}})})}})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a){a=a.getPrototype();if(null!==a){var b=a.getProductOccurrence();return(b.isResolved()?d(b.getResolved()):b.then(d)).then(function(){console.assert(b.isResolved());b.getResolved().markLoaded()})}}function d(c){return __awaiter(this,void 0,void 0,function(){var b,d;return __generator(this,function(l){switch(l.label){case 0:return b=[],d={enterProductOccurrence:function(a){a=f(a);void 0!==a&&b.push(a)}},[4,e.WalkerAsync.walk(d,c,e.WalkRestriction.None)];
case 1:return l.sent(),[2,a.Util.waitForAll(b)]}})})}e.forcePrototype=f;e.forcePrototypes=d})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(c,b,d,f,v,p){var k=[];return(c=c.walk({enterAnyBody:function(b){if(!v.has(b)){v.add(b);if(b instanceof e.BodyInstance){if(!h.hasBits(d,1)||b.isOutOfHierarchy()&&!f)return}else if(b instanceof e.PmiBody){if(!h.hasBits(d,2))return}else if(a.Util.TypeAssert(b),!h.hasBits(d,4))return;b=b.getInstanceInc();k.push(b[0],b[1])}}},b,p))?c.then(function(){return k}):k}function d(a,b,d,l,h){return f(e.WalkerSync,a,b,d,l,h)}e.gatherInstanceIncs=function(a,b,d,
l){return f(e.WalkerAsync,a,b,d,l,e.WalkRestriction.None)};e.gatherInstanceIncsSync=d;e.gatherInstanceIncsByNodeIdsSync=function(c,b,g,f){for(var h=null,p=new Set,k=0;k<b.length;k++){var r=b[k],m=c.lookupAnyTreeNode(r);if(null===m)throw new a.InvalidNodeIdError(r);r=e.isOutOfHierarchy(m);r=d(m,g,r,p,f);if(null===h)h=r;else for(m=0;m<r.length;m++)h.push(r[m])}return null!==h?h:[]}})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){a.gatherParentsOfPendingExternalModels=function(f){return __awaiter(this,void 0,void 0,function(){var d,c,b;return __generator(this,function(g){d=[];c=function(a){a.hasPendingExternalModels()&&d.push(a)};b={enterProductOccurrence:c};a.WalkerAsync.walk(b,f,a.WalkRestriction.None);return[2,d]})})}})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){e.getBoundingByNodeId=function(f,d,c,b,g,l){return __awaiter(this,void 0,void 0,function(){var h;return __generator(this,function(p){h=e.gatherInstanceIncsByNodeIdsSync(f,c,b,e.WalkRestriction.None);if(0===h.length)throw new a.CommunicatorError("Cannot get the bounding of node without geometry.");return[2,d.getPartsBounding(h,g,l)]})})}})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){a.getNodeColorMap=function(f,d,c){return __awaiter(this,void 0,void 0,function(){var b,g,l,h,p,k,r,m,n,q;return __generator(this,function(t){switch(t.label){case 0:return b=[],g=[],l={enterAnyBody:function(c){c instanceof a.BodyInstance&&(b.push(c),c=c.getInstanceInc(),g.push(c[0],c[1]))}},[4,a.WalkerAsync.walk(l,f,a.WalkRestriction.None)];case 1:return t.sent(),h=new Map,[4,d.getPartColor(g,c)];case 2:p=t.sent();k=p.length;console.assert(k===b.length);for(r=
0;r<k;++r)m=p[r],null!==m&&(n=b[r],q=n.getParent().getRuntimeId(),h.set(q,m));return[2,h]}})})}})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){e.getVisibilityState=function(f){return __awaiter(this,void 0,void 0,function(){var d,c,b,g;return __generator(this,function(l){switch(l.label){case 0:return d=new Set,c=new Set,b={enterAnyBody:function(a){if(a instanceof e.BodyInstance){a=a.getParent();var b=a.getRuntimeId();a.isVisible()?d.add(b):c.add(b)}}},[4,e.WalkerAsync.walk(b,f,e.WalkRestriction.None)];case 1:return l.sent(),g=d.size>=c.size,[2,new a.VisibilityState(g,g?c:d)]}})})}})(h.Tree||(h.Tree=
{}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a,c){var b=function(a){c.push(a)};return e.WalkerAsync.walk({enterProductOccurrence:b,enterAnyBody:b,enterCadView:b,enterPmi:b,enterPartDefinition:b,enterRepresentationItem:b},a,e.WalkRestriction.None)}e.markContextsLoaded=function(d){return __awaiter(this,void 0,void 0,function(){var c,b,g,e,h,p,k,r,m;return __generator(this,function(n){switch(n.label){case 0:c=[];b=[];g=0;for(e=d;g<e.length;g++)h=e[g],p=f(h,b),c.push(p);return[4,a.Util.waitForAll(c)];
case 1:n.sent();k=0;for(r=b;k<r.length;k++)m=r[k],m.markLoaded();return[2]}})})}})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){a.resetTransforms=function(f){return __awaiter(this,void 0,void 0,function(){var d,c,b;return __generator(this,function(g){switch(g.label){case 0:return d=!1,c=function(a){a.hasLocalTransformOverride()&&(a.removeLocalTransformOverride(),d=!0)},b={enterProductOccurrence:c,enterPmi:c,enterCadView:c,enterAnyBody:function(a){a.preventFromResetting()||c(a)}},[4,a.WalkerAsync.walk(b,f,a.WalkRestriction.None)];case 1:return g.sent(),[2,d]}})})}})(a.Tree||(a.Tree={}))})(a.Internal||
(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){a.setMeshLevels=function(f,d,c){for(var b=[],g=new Set,l=function(a){if(g.has(a))return!1;g.add(a);return!0},l={followProductOccurrence:l,followPmi:l,followCadView:l,followAnyBody:l,enterAnyBody:function(a){a.isOutOfHierarchy()||(a=a.getInstanceInc(),b.push(a[0],a[1]))}},h=0;h<d.length;h++)a.WalkerSync.walk(l,d[h],a.WalkRestriction.None);f.setMeshLevel(b,c)}})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){e.updateScMatrices=function(f,d,c,b){return __awaiter(this,void 0,void 0,function(){var g=this,l,v,p,k,r,m,n,q,t,u,w,z;return __generator(this,function(y){switch(y.label){case 0:l=[];v=[];p=[];k=new Set;r=function(b){if(k.has(b))return!1;k.add(b);b=b.getLocalTransform();if(null!==b){var c=h.last(l),c=a.Matrix.multiply(b,c);l.push(c)}return!0};m=function(a){null!==a.getLocalTransform()&&(console.assert(1<l.length),l.pop())};n={followProductOccurrence:r,leaveProductOccurrence:m,
followPmi:r,leavePmi:m,followCadView:r,leaveCadView:m,followAnyBody:r,enterAnyBody:function(a){if(!a.isOutOfHierarchy()||b)a=a.getInstanceInc(),p.push(a[0],a[1]),v.push(h.last(l))},leaveAnyBody:m};q=new h.PromiseQueue(1,!0);t=function(a){var b=h.Lazy.create(function(){return __awaiter(g,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return console.assert(0===l.length),b=e.getNetMatrix(a.getParent()),l.push(b),[4,e.WalkerAsync.walk(n,a,e.WalkRestriction.None)];
case 1:return c.sent(),console.assert(1===l.length),l.pop(),[2]}})})});q.push(b)};u=0;for(w=c;u<w.length;u++)z=w[u],t(z);return[4,q.waitForIdle()];case 1:return y.sent(),console.assert(2*v.length===p.length),[4,f.setMatrices(p,v)];case 2:return y.sent(),d.trigger("_updateTransform",b),[2]}})})}})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(e){function f(a){for(var c=[],d=0;d<a.length;d++){var e=a[d].getInstanceInc();c.push(e[0],e[1])}return c}function d(a){for(var c=[],d=0;d<a.length;d++){var e=a[d].getRuntimeId();c.push(e)}return c}function c(b,c,l,v,p,k,r,m,n){return __awaiter(this,void 0,void 0,function(){var q,t,u,w,z,y,x,A,B,C,D,G,E,I;return __generator(this,function(F){switch(F.label){case 0:if(v instanceof e.AttachContext)switch(console.assert(0===p.size),console.assert(null===l),console.assert(null===
n),console.assert(null!==k),q=function(a){v.getChildren().forEach(function(b){p.set(b,a)})},k){case 0:console.assert(!0===m);q(!1);break;case 1:q(!0);break;case 2:console.assert(r),console.assert(!0===m)}else console.assert(null===k);null!==n&&console.assert(n.isAConfigurationNode());t=0;null===m&&(m=b.getInitiallyHiddenStayHidden());u=[];w=[];z=[];y=function(a){var b=x(a,!1);null!==b&&a.setVisibility(b)};x=function(b,c){var d=p.get(b);void 0!==d?z.push(d):0<z.length&&z.push(a.last(z));if(e.isOutOfHierarchy(b))return null;
if(null!==n&&0===t)return!1;if(void 0!==d)return d;var d=b.isVisible(),g=b.isInitiallyShown();if(0<z.length){if(c=a.last(z),c!==d)return c&&!g&&m?b instanceof e.PmiBody&&(b=b.getParent(),!0===p.get(b))?!0:null:c}else if(r&&d!==g&&!c)return g;return null};A=function(a){a;0<z.length&&z.pop()};B={enterProductOccurrence:function(a){(n===a||0<t)&&++t;y(a)},leaveProductOccurrence:function(a){A(a);0<t&&--t},enterPmi:y,leavePmi:A,enterCadView:y,leaveCadView:A,enterAnyBody:function(a){var b=a.preventFromResetting(),
b=x(a,b);null!==b&&(a.setVisibility(b),b?u.push(a):w.push(a))},leaveAnyBody:A};return[4,e.WalkerAsync.walk(B,v,e.WalkRestriction.None)];case 1:return F.sent(),console.assert(0===z.length),null===k?(C=f(u),D=f(w),c.pauseRendering(),c.setPartVisibility(C,!0,!0),c.setPartVisibility(D,!1,!0),c.resumeRendering(),null!==l&&(G=d(u),E=d(w),l.trigger("visibilityChanged",G,E))):(I=v.getAttachScope(),console.assert(0!==I),c.setVisibilityByAttachment(I,k)),[2]}})})}e.updateVisibilitiesByAttachment=function(a,
d,e,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(h){return[2,c(a,d,null,e,new Map,f,2===f,1!==f,null)]})})};e.updateVisibilities=function(a,d,e,f,h,k,r,m){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return[2,c(a,d,e,f,h,null,k,r,m)]})})};e.synchronizePmiVisibilities=function(a,c){return __awaiter(this,void 0,void 0,function(){var d,h,p,k,r;return __generator(this,function(m){switch(m.label){case 0:return d=[],h=[],p={enterAnyBody:function(a){if(a instanceof
e.PmiBody||a instanceof e.ViewFrame){var b=a.isVisible();a.setVisibility(b);b?d.push(a):h.push(a)}}},[4,e.WalkerAsync.walk(p,c,e.WalkRestriction.None)];case 1:return m.sent(),k=f(d),r=f(h),a.pauseRendering(),a.synchronizeVisibilities(k,!0),a.synchronizeVisibilities(r,!1),a.resumeRendering(),[2]}})})}})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(a,b){this._visitor=new e.TotalVisitor(a,b)}d.walk=function(a,b,g){if(g===e.WalkRestriction.LoadedNodesOnly&&!b.isLoaded())return Promise.resolve();var f=new d(a,g);if(b instanceof e.NodeMixin)return f._walkAnyTreeNode(b);var v=new h.ActionQueue(1,!1);a=function(a){v.push(function(){return f._walkAnyTreeNode(a)})};g=0;for(b=b.getChildren();g<b.length;g++)a(b[g]);return v.waitForIdle()};d.forceLazyPromises=function(a){return this.walk({},
a,e.WalkRestriction.None)};d.prototype._walkAnyTreeNode=function(c){c instanceof e.ProductOccurrence?c=this._walkProductOccurrence(c):c instanceof e.Pmi?c=this._walkPmi(c):c instanceof e.CadView?c=this._walkCadView(c):(a.Util.TypeAssert(c),c=this._walkAnyBody(c));return void 0===c?Promise.resolve():c};d.prototype._walkRepresentationItem=function(a){this._visitor.followRepresentationItem(a)&&(this._visitor.enterRepresentationItem(a),this._visitor.leaveRepresentationItem(a))};d.prototype._walkPartDefinition=
function(a){if(this._visitor.followPartDefinition(a)){this._visitor.enterPartDefinition(a);for(var b=0,d=a.getRepresentationItems();b<d.length;b++)this._walkRepresentationItem(d[b]);this._visitor.leavePartDefinition(a)}};d.prototype._walkAnyBody=function(a){this._visitor.followAnyBody(a)&&(this._visitor.enterAnyBody(a),this._visitor.leaveAnyBody(a))};d.prototype._walkPmi=function(a){if(this._visitor.followPmi(a)){this._visitor.enterPmi(a);for(var b=0,d=a.getPmiBodies();b<d.length;b++)this._walkAnyBody(d[b]);
this._visitor.leavePmi(a)}};d.prototype._walkCadView=function(a){if(this._visitor.followCadView(a)){this._visitor.enterCadView(a);var b=a.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(a)}};d.prototype._walkProductOccurrence=function(c){var b=this,d=new h.ActionQueue(1,!1);if(this._visitor.followProductOccurrence(c)){this._visitor.enterProductOccurrence(c);var e=c.getRawPartDefinition();null!==e&&(e instanceof h.LazyPromise?d.push(function(){if(e.isResolved())return b._walkPartDefinition(e.getResolved())}):
(a.Util.TypeAssert(e),d.push(function(){return e.then(function(a){return null!==a&&(a=a.value,a.isResolved())?b._walkPartDefinition(a.getResolved()):Promise.resolve()})})));var f=c.tryGetChildrenSync();if(null!==f)for(var p=function(a){d.push(function(){return b._walkProductOccurrence(a)})},k=0;k<f.length;k++)p(f[k]);else d.push(function(){return c.getChildren().then(function(a){if(0!==a.length){for(var c=new h.ActionQueue(1,!1),d=function(a){c.push(function(){return b._walkProductOccurrence(a)})},
g=0;g<a.length;g++)d(a[g]);if(!c.isIdle())return c.waitForIdle()}})});f=function(a){d.push(function(){return b._walkAnyBody(a)})};p=0;for(k=c.getBodyInstances();p<k.length;p++)f(k[p]);f=function(a){d.push(function(){return b._walkPmi(a)})};p=0;for(k=c.getPmis();p<k.length;p++)f(k[p]);f=function(a){d.push(function(){return b._walkCadView(a)})};p=0;for(k=c.getCadViews();p<k.length;p++)f(k[p]);d.push(function(){return b._visitor.leaveProductOccurrence(c)})}if(!d.isIdle())return d.waitForIdle()};return d}();
e.WalkerAsync=f})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){function f(a){return a.isLoaded()}function d(){return!0}var c;(function(a){a[a.None=0]="None";a[a.LoadedNodesOnly=1]="LoadedNodesOnly"})(c=e.WalkRestriction||(e.WalkRestriction={}));var b=function(){return function(b,e){this.followProductOccurrence=d;this.leaveProductOccurrence=this.enterProductOccurrence=h.nop;this.followPartDefinition=d;this.leavePartDefinition=this.enterPartDefinition=h.nop;this.followRepresentationItem=d;this.leaveRepresentationItem=this.enterRepresentationItem=
h.nop;this.followAnyBody=d;this.leaveAnyBody=this.enterAnyBody=h.nop;this.followCadView=d;this.leaveCadView=this.enterCadView=h.nop;this.followPmi=d;this.leavePmi=this.enterPmi=h.nop;e===c.LoadedNodesOnly?(console.assert(void 0===b.followProductOccurrence),console.assert(void 0===b.followAnyBody),console.assert(void 0===b.followCadView),console.assert(void 0===b.followPmi),this.followPmi=this.followCadView=this.followAnyBody=this.followProductOccurrence=f):a.Util.TypeAssert(e);void 0!==b.followProductOccurrence&&
(this.followProductOccurrence=b.followProductOccurrence);void 0!==b.enterProductOccurrence&&(this.enterProductOccurrence=b.enterProductOccurrence);void 0!==b.leaveProductOccurrence&&(this.leaveProductOccurrence=b.leaveProductOccurrence);void 0!==b.followPartDefinition&&(this.followPartDefinition=b.followPartDefinition);void 0!==b.enterPartDefinition&&(this.enterPartDefinition=b.enterPartDefinition);void 0!==b.leavePartDefinition&&(this.leavePartDefinition=b.leavePartDefinition);void 0!==b.followRepresentationItem&&
(this.followRepresentationItem=b.followRepresentationItem);void 0!==b.enterRepresentationItem&&(this.enterRepresentationItem=b.enterRepresentationItem);void 0!==b.leaveRepresentationItem&&(this.leaveRepresentationItem=b.leaveRepresentationItem);void 0!==b.followAnyBody&&(this.followAnyBody=b.followAnyBody);void 0!==b.enterAnyBody&&(this.enterAnyBody=b.enterAnyBody);void 0!==b.leaveAnyBody&&(this.leaveAnyBody=b.leaveAnyBody);void 0!==b.followCadView&&(this.followCadView=b.followCadView);void 0!==b.enterCadView&&
(this.enterCadView=b.enterCadView);void 0!==b.leaveCadView&&(this.leaveCadView=b.leaveCadView);void 0!==b.followPmi&&(this.followPmi=b.followPmi);void 0!==b.enterPmi&&(this.enterPmi=b.enterPmi);void 0!==b.leavePmi&&(this.leavePmi=b.leavePmi)}}();e.TotalVisitor=b})(h.Tree||(h.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(){function d(c,b){this._visitor=new a.TotalVisitor(c,b)}d.walk=function(c,b,g){if(g!==a.WalkRestriction.LoadedNodesOnly||b.isLoaded())return c=new d(c,g),b instanceof a.ProductOccurrence?c._walkProductOccurrence(b):b instanceof a.Pmi?c._walkPmi(b):b instanceof a.CadView?c._walkCadView(b):c._walkAnyBody(b)};d.prototype._walkRepresentationItem=function(a){console.assert(a.isLoaded());this._visitor.followRepresentationItem(a)&&(this._visitor.enterRepresentationItem(a),
this._visitor.leaveRepresentationItem(a))};d.prototype._walkPartDefinition=function(a){console.assert(a.isLoaded());if(this._visitor.followPartDefinition(a)){this._visitor.enterPartDefinition(a);for(var b=0,d=a.getRepresentationItems();b<d.length;b++)this._walkRepresentationItem(d[b]);this._visitor.leavePartDefinition(a)}};d.prototype._walkAnyBody=function(a){console.assert(a.isLoaded());this._visitor.followAnyBody(a)&&(this._visitor.enterAnyBody(a),this._visitor.leaveAnyBody(a))};d.prototype._walkPmi=
function(a){console.assert(a.isLoaded());if(this._visitor.followPmi(a)){this._visitor.enterPmi(a);for(var b=0,d=a.getPmiBodies();b<d.length;b++)this._walkAnyBody(d[b]);this._visitor.leavePmi(a)}};d.prototype._walkCadView=function(a){console.assert(a.isLoaded());if(this._visitor.followCadView(a)){this._visitor.enterCadView(a);var b=a.getViewFrame();null!==b&&this._walkAnyBody(b);this._visitor.leaveCadView(a)}};d.prototype._walkProductOccurrence=function(a){console.assert(a.isLoaded());if(this._visitor.followProductOccurrence(a)){this._visitor.enterProductOccurrence(a);
var b=a.getPartDefinitionSync();null!==b&&this._walkPartDefinition(b);for(var b=0,d=a.getChildrenSync();b<d.length;b++)this._walkProductOccurrence(d[b]);b=0;for(d=a.getBodyInstances();b<d.length;b++)this._walkAnyBody(d[b]);b=0;for(d=a.getPmis();b<d.length;b++)this._walkPmi(d[b]);b=0;for(d=a.getCadViews();b<d.length;b++)this._walkCadView(d[b]);this._visitor.leaveProductOccurrence(a)}};return d}();a.WalkerSync=f})(a.Tree||(a.Tree={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(){this.plane=new a.Plane;this.instanceNodeId=this.meshId=this.referenceGeometry=null;this.color=a.Color.createFromFloat(.65,.65,.65);this.lineColor=a.Color.black();this.opacity=.35;this.matrix=new a.Matrix}e.prototype.toJson=function(){return{plane:{normal:this.plane.normal,d:this.plane.d},referenceGeometry:this.referenceGeometry}};e.prototype.forJson=function(){return this.toJson()};e.prototype.fromJson=function(d){d=h.deepClone(d);var c=d.plane;
this.plane=new a.Plane;var b=c.normal;this.plane.normal=new a.Point3(b.x,b.y,b.z);this.plane.d=c.d;d=d.referenceGeometry;if(Array.isArray(d))for(c=0;c<d.length;++c)d[c]=a.Point3.fromJson(d[c]);this.referenceGeometry=d};e.prototype.getMatrix=function(){return this.matrix.copy()};e.prototype.setMatrix=function(a){this.matrix=a.copy()};e.prototype.setReferenceGeometry=function(a){if(a){this.referenceGeometry=[];for(var c=0;c<a.length;c++)this.referenceGeometry.push(a[c].copy())}else this.referenceGeometry=
null};e.prototype.getReferenceGeometry=function(){if(this.referenceGeometry){for(var a=[],c=0,b=this.referenceGeometry;c<b.length;c++)a.push(b[c].copy());return a}return null};e.prototype.createMeshData=function(){var d=this.referenceGeometry;if(null===d)return null;var c=new a.MeshData,b=[],g=[];b.push(d[0].x,d[0].y,d[0].z);b.push(d[1].x,d[1].y,d[1].z);b.push(d[3].x,d[3].y,d[3].z);b.push(d[1].x,d[1].y,d[1].z);b.push(d[2].x,d[2].y,d[2].z);b.push(d[3].x,d[3].y,d[3].z);for(var e=a.Plane.createFromPoints(d[0],
d[1],d[2]).normal,f=0;6>f;f++)g.push(e.x,e.y,e.z);c.addFaces(b,g);c.addPolyline([d[0].x,d[0].y,d[0].z,d[1].x,d[1].y,d[1].z]);c.addPolyline([d[1].x,d[1].y,d[1].z,d[2].x,d[2].y,d[2].z]);c.addPolyline([d[2].x,d[2].y,d[2].z,d[3].x,d[3].y,d[3].z]);c.addPolyline([d[3].x,d[3].y,d[3].z,d[0].x,d[0].y,d[0].z]);return c};return e}();h.CuttingPlane=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(a,d,c,b,g){this._cuttingPlanes=[];this._isActive=!1;this._viewer=a;this._model=d;this._callbackManager=c;this._cuttingManager=b;this._engine=g}e.deprecated=function(a,d,c){a;var b=c.value;c.value=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];this._callbackManager.trigger("deprecated","CuttingSection",d);return b.apply(this,a)};return c};e.prototype.addPlane=function(e,d){void 0===d&&(d=null);return __awaiter(this,void 0,void 0,function(){var c,
b;return __generator(this,function(g){switch(g.label){case 0:c=this._engine.getCuttingSectionLimits();if(this._cuttingPlanes.length>=c.maxCuttingPlanesPerSection)return[2,!1];b=new a.Internal.CuttingPlane;b.plane=e.copy();b.setReferenceGeometry(d);this._cuttingPlanes.push(b);return this._isActive?[4,this._resetCuttingPlane(b)]:[2,!0];case 1:return g.sent(),[4,this._engine.updateCuttingSection(this)];case 2:return g.sent(),[2,!0]}})})};e.prototype.setPlane=function(a,d,c){void 0===c&&(c=null);return __awaiter(this,
void 0,void 0,function(){var b;return __generator(this,function(g){switch(g.label){case 0:b=this._cuttingPlanes[a];if(void 0===b)return[3,2];b.plane=d.copy();b.setReferenceGeometry(c);return this._isActive?[4,this._resetCuttingPlane(b)]:[3,2];case 1:return g.sent(),[2,this._engine.updateCuttingSection(this)];case 2:return[2]}})})};e.prototype.updatePlane=function(e,d,c,b,g){void 0===c&&(c=new a.Matrix);void 0===b&&(b=!1);void 0===g&&(g=!1);return __awaiter(this,void 0,void 0,function(){var l,h,p;
return __generator(this,function(k){switch(k.label){case 0:l=this._cuttingPlanes[e];if(void 0===l)return[3,3];l.plane=d.copy();if(!this._isActive)return[3,3];if(null===l.instanceNodeId)return[3,2];this._engine.pauseRendering();h=l.getMatrix();g&&(h=new a.Matrix);p=a.Matrix.multiply(h,c);b&&l.setMatrix(p);return[4,Promise.all([this._model.setNodeMatrix(l.instanceNodeId,p),this._engine.updateCuttingSection(this)])];case 1:return k.sent(),this._engine.resumeRendering(),[3,3];case 2:return[2,this._engine.updateCuttingSection(this)];
case 3:return[2]}})})};e.prototype.removePlane=function(e){var d=[],c=this._cuttingPlanes[e];void 0!==c&&null!==c.meshId&&null!==c.instanceNodeId&&(d.push(this._destroyMeshes([c.meshId],[c.instanceNodeId])),this._cuttingPlanes.splice(e,1));this._isActive&&d.push(this._engine.updateCuttingSection(this));return a.Util.waitForAll(d)};e.prototype.getPlane=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.plane.copy():null};e.prototype.getNodeId=function(a){a=this._cuttingPlanes[a];return void 0!==
a?a.instanceNodeId:null};e.prototype.getReferenceGeometry=function(a){a=this._cuttingPlanes[a];return void 0!==a?a.getReferenceGeometry():null};e.prototype.getPlaneIndexByNodeId=function(a){for(var d=0;d<this._cuttingPlanes.length;d++)if(this._cuttingPlanes[d].instanceNodeId===a)return d;return null};e.prototype.setPlaneOpacity=function(a,d){a=this._cuttingPlanes[a];void 0!==a&&(a.opacity=d,null!==a.instanceNodeId&&this._model.setNodesOpacity([a.instanceNodeId],d))};e.prototype.setPlaneTransparency=
function(a,d){this.setPlaneOpacity(a,d);return Promise.resolve()};e.prototype.setItemTransparency=function(a,d){return this.setPlaneTransparency(a,d)};e.prototype.setColor=function(a){for(var d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var g=b[c];g.color.assign(a);null!==g.instanceNodeId&&d.push(g.instanceNodeId)}return this._model.setNodesFaceColor(d,a)};e.prototype.setOpacity=function(a){for(var d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var g=b[c];g.opacity=a;null!==g.instanceNodeId&&d.push(g.instanceNodeId)}this._model.setNodesOpacity(d,
a)};e.prototype.setTransparency=function(a){this.setOpacity(a);return Promise.resolve()};e.prototype.getCount=function(){return this._cuttingPlanes.length};e.prototype.clear=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.deactivate()];case 1:return a.sent(),this._cuttingPlanes.length=0,[2]}})})};e.prototype.activate=function(){return __awaiter(this,void 0,void 0,function(){var e,d,c,b,g;return __generator(this,function(l){switch(l.label){case 0:if(this._isActive)return[2];
this._isActive=!0;if(!(0<this._cuttingPlanes.length))return[3,2];this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,.9999995231628418);e=[];d=[];c=0;for(b=this._cuttingPlanes;c<b.length;c++)g=b[c],e.push(this._createCuttingPlaneGeometry(g).then(function(a){null!==a&&d.push(a)}));return[4,a.Util.waitForAll(e)];case 1:l.sent(),this._initCuttingPlanesByNodeId(d),l.label=2;case 2:return[2,this._engine.addCuttingSection(this)]}})})};e.prototype.deactivate=function(){return __awaiter(this,
void 0,void 0,function(){var e;return __generator(this,function(d){return this._isActive?(this._isActive=!1,e=[],e.push(this._destroyGeometry()),e.push(this._engine.removeCuttingSection(this)),this._cuttingManager.hasActiveCuttingSection()||this._engine.setDefaultDepthRange(0,1),[2,a.Util.waitForAll(e)]):[2]})})};e.prototype.isActive=function(){return this._isActive};e.prototype.toJson=function(){for(var a=[],d=0;d<this._cuttingPlanes.length;d++)a[d]=this._cuttingPlanes[d].toJson();return{planes:a}};
e.prototype.forJson=function(){return this.toJson()};e.prototype.fromJson=function(e){return __awaiter(this,void 0,void 0,function(){var d,c,b,g,l,h;return __generator(this,function(p){switch(p.label){case 0:return[4,this.clear()];case 1:p.sent();d=a.Internal.deepClone(e);c=d.planes;b=0;for(g=c;b<g.length;b++)l=g[b],h=new a.Internal.CuttingPlane,h.fromJson(l),this._cuttingPlanes.push(h);return[2,this.activate()]}})})};e.prototype._initCuttingPlanesByNodeId=function(e){this._model.setInstanceModifier(a.InstanceModifier.IgnoreCutting,
e,!0);this._model.setInstanceModifier(a.InstanceModifier.IgnoreExplosion,e,!0);this._cuttingManager.getStandinGeometryPickable()||this._model.setInstanceModifier(a.InstanceModifier.IgnoreSelection,e,!0)};e.prototype._destroyGeometry=function(){for(var a=[],d=[],c=0,b=this._cuttingPlanes;c<b.length;c++){var g=b[c];null!==g.meshId&&a.push(g.meshId);null!==g.instanceNodeId&&d.push(g.instanceNodeId);g.meshId=null;g.instanceNodeId=null}return this._destroyMeshes(a,d)};e.prototype._getInstanceNodeIds=function(){for(var a=
[],d=0,c=this._cuttingPlanes;d<c.length;d++){var b=c[d].instanceNodeId;null!==b&&a.push(b)}return a};e.prototype._resetCuttingPlane=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:if(null===a.meshId||null===a.instanceNodeId)return[3,2];d=this._destroyMeshes([a.meshId],[a.instanceNodeId]);a.meshId=null;a.instanceNodeId=null;return[4,d];case 1:return c.sent(),[2,this._createInstanceGeometry(a)];case 2:if(null!==a.referenceGeometry)return[2,
this._createInstanceGeometry(a)];c.label=3;case 3:return[2]}})})};e.prototype._createInstanceGeometry=function(a){return __awaiter(this,void 0,void 0,function(){var d,c;return __generator(this,function(b){switch(b.label){case 0:return d=[],[4,this._createCuttingPlaneGeometry(a)];case 1:return c=b.sent(),null!==c&&d.push(c),this._initCuttingPlanesByNodeId(d),[2]}})})};e.prototype._destroyMeshes=function(e,d){return __awaiter(this,void 0,void 0,function(){var c,b,g,l;return __generator(this,function(h){switch(h.label){case 0:return c=
[],c.push(this._model.deleteMeshInstances(d)),c.push(this._model.deleteMeshes(e)),[4,a.Util.waitForAll(c)];case 1:h.sent();b=0;for(g=d;b<g.length;b++)l=g[b],this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.delete(l);return[2]}})})};e.prototype._createCuttingPlaneGeometry=function(e){return __awaiter(this,void 0,void 0,function(){var d,c,b,g,l,h,p,k;return __generator(this,function(r){switch(r.label){case 0:d=e.createMeshData();if(null===d)return[2,null];d.setBackfacesEnabled(!0);
return[4,this._model.createMesh(d)];case 1:return c=r.sent(),e.meshId=c,b=a.MeshInstanceCreationFlags.OverrideSceneVisibility|a.MeshInstanceCreationFlags.ExcludeBounding|a.MeshInstanceCreationFlags.DoNotXRay,g=e.plane.copy(),l=g.normal.copy().scale(-g.d),h=(new a.Matrix).setTranslationComponent(l.x,l.y,l.z),e.setMatrix(h.copy()),p=new a.MeshInstanceData(c,h,null,e.color,null,null,b),p.setOpacity(e.opacity),p.setLineColor(e.lineColor),this._engine.pauseRendering(),[4,this._model.createMeshInstance(p,
void 0,!0,!0)];case 2:return k=r.sent(),e.instanceNodeId=k,this._viewer.selectionManager._incrementalBlacklistedInstanceNodes.add(k),this._model.setDepthRange([k],4.76837158203125E-7,1),this._engine.resumeRendering(),[2,k]}})})};__decorate([e.deprecated],e.prototype,"setPlaneTransparency",null);__decorate([e.deprecated],e.prototype,"setItemTransparency",null);__decorate([e.deprecated],e.prototype,"setTransparency",null);__decorate([e.deprecated],e.prototype,"forJson",null);return e}();a.CuttingSection=
h})(Communicator||(Communicator={}));
(function(a){(function(a){function e(a,d){for(var c=0;c<d.length;c++)a.push(d[c])}a.emptyBytes=new Uint8Array(0);a.copyArray=function(a){return a.slice()};a.append=function(a,d){for(var c=0;c<d.length;c++)a.push(d[c])};a.last=function(a){console.assert(0<a.length);return a[a.length-1]};a.all=function(a){for(var d=0;d<a.length;d++)if(!a[d])return!1;return!0};a.chunkify=function(a,d){for(var c=[],b=0;b<a.length;b+=d)c.push(a.slice(b,b+d));return c};a.filterInPlace=function(a,d){for(var c=0,b=0;b<a.length;++b){var g=
a[b];d(g)&&(a[c++]=g)}a.length=c};a.mapInPlace=function(a,d){for(var c=0;c<a.length;++c)a[c]=d(a[c]);return a};a.concatInPlace=e;a.concatAll=function(a){for(var d=[],c=0;c<a.length;c++)e(d,a[c]);return d}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(){this._leftToRight=new Map;this._rightToLeft=new Map}a.prototype.set=function(a,c){this._leftToRight.set(a,c);this._rightToLeft.set(c,a)};a.prototype.getLeft=function(a){return this._rightToLeft.get(a)};a.prototype.getRight=function(a){return this._leftToRight.get(a)};return a}();a.Bimap=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(d){this.value=d}a.create=function(d){return new a(d)};return a}();a.Boxed=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(){this._stopTime=this._currentTime=0}a.prototype.stop=function(){this._stopTime=this._currentTime};a.prototype.isTicking=function(){this._refreshCurrentTime();return 0<this._remainingDuration()};a.prototype.tickFor=function(a){this._refreshCurrentTime();this._remainingDuration()>=a||(this._stopTime=this._currentTime+a)};a.prototype._remainingDuration=function(){return this._stopTime-this._currentTime};a.prototype._refreshCurrentTime=function(){this._currentTime=
Date.now()};return a}();a.Clock=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function e(d){this._planes=[];this._absPlanes=[];this._signs=[];this._distanceScale=[];for(var c=d.length,b=0;b<d.length;b++)this._planes.push(d[b].slice());for(d=0;d<c;++d)for(this._planes[d][3]=-this._planes[d][3],this._absPlanes[d]=a.cwiseAbs3(this._planes[d]),this._signs[d]=[0,0,0],b=0;3>b;++b)this._signs[d][b]=0<=this._planes[d][b]?1:-1;for(d=0;d<c;++d)b=a.squaredNorm3(this._planes[d]),this._distanceScale[d]=0===b?0:1/b}e.fromPlaneCoefficients=function(a){for(var c=
[],b=0;b<a.length;b++){var g=a[b];c.push([g.x,g.y,g.z,g.w])}return new e(c)};e.createFrustumFromMatrix=function(d){for(var c=[],b=0;3>b;++b)c[b]=a.sub4(a.col4(d,3),a.col4(d,b));for(b=0;3>b;++b)c[b+3]=a.add4(a.col4(d,3),a.col4(d,b));return new e(c)};e.prototype.testAxisAlignedBox=function(d,c){for(var b=this._planes.length,g=2,e=0;e<b;++e){var f=a.dot3(this._planes[e],d),p=a.dot3(this._absPlanes[e],c);if(f+p<=this._planes[e][3])return 0;f-p<this._planes[e][3]&&(g=1)}return g};e.prototype.axisAlignedBoxNotOutside=
function(d,c){for(var b=this._planes.length,g=0;g<b;++g)if(a.dot3(this._planes[g],a.add3(d,a.cwiseProduct3(c,this._signs[g])))<=this._planes[g][3])return!1;return!0};e.prototype.sphereNotOutside=function(d,c){for(var b=this._planes.length,g=0;g<b;++g){var e=a.dot3(this._planes[g],d)-this._planes[g][3];if(0>e&&e*e*this._distanceScale[g]>=c)return!1}return!0};e.prototype.sphereFullyInside=function(d,c){for(var b=this._planes.length,g=0;g<b;++g){var e=a.dot3(this._planes[g],d)-this._planes[g][3];if(0>
e||e*e*this._distanceScale[g]<c)return!1}return!0};e.prototype.pointInside=function(d){for(var c=this._planes.length,b=0;b<c;++b)if(0>a.dot3(this._planes[b],d)-this._planes[b][3])return!1;return!0};return e}();a.ConvexVolume=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(a){a.nop=function(){};a.identity=function(a){return a}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(e,d){return new Promise(function(c,b){var g=new XMLHttpRequest;g.open("GET",e,!0);d&&(g.responseType=d);g.onload=function(d){d;4===g.readyState&&(200===g.status?c(g):(d=new a.LoadError('XMLHttpRequest failed to GET "'+e+'" with status '+g.status+"."),b(d)))};g.onerror=function(a){b(a)};g.send()})}h.httpRequest=e;h.httpRequestBuffer=function(a){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(c){switch(c.label){case 0:return[4,
e(a,"arraybuffer")];case 1:return d=c.sent(),[2,new Uint8Array(d.response)]}})})}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(a){a.copyMap=function(a){var f=new Map;a.forEach(function(a,c){f.set(c,a)});return f};a.copySet=function(a){var f=new Set;a.forEach(function(a){f.add(a)});return f};a.toSet=function(a){for(var f=new Set,d=0;d<a.length;d++)f.add(a[d]);return f}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(d){this._deferredValue=d}a.create=function(d){return new a(d)};a.prototype.get=function(){null!==this._deferredValue&&(this._resolvedValue=this._deferredValue(),this._deferredValue=null);return this._resolvedValue};return a}();a.Lazy=e})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));
(function(a){(function(h){h.Lazy=a.Util.Lazy;var e=function(){function a(c){this._value=c}a.create=function(c){return new a(c)};a.prototype.get=function(){"function"===typeof this._value&&(this._value=this._value());return this._value};return a}();h.LazyObject=e;var f=function(){function d(a){"function"===typeof a&&(a=e.create(a));a instanceof Promise&&(a=this._rectifyResult(a));this._value=a}d.create=function(a){return new d(a)};d.prototype.isUnforced=function(){return this._value instanceof e};
d.prototype.isResolved=function(){return!(this._value instanceof e)&&!(this._value instanceof Promise)};d.prototype.getResolved=function(){console.assert(this.isResolved());return this._value};d.prototype.then=function(c,b){this._value instanceof e&&(this._value=this._rectifyResult(this._value.get()));if(this._value instanceof Promise)return this._value.then(c,b);a.Util.TypeAssert(this._value);return Promise.resolve(this._value).then(c,b)};d.prototype._rectifyResult=function(a){var b=this;return a instanceof
Promise?a.then(function(a){return b._value=a}):a};return d}();h.LazyPromise=f})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){a.fromIntegerMap=function(a){if(a instanceof Map)return a;for(var f=new Map,d=0,c=Object.keys(a);d<c.length;d++){var b=c[d],g=a[b];f.set(parseInt(b,10),g)}return f};a.fromRealNumberMap=function(a){if(a instanceof Map)return a;for(var f=new Map,d=0,c=Object.keys(a);d<c.length;d++){var b=c[d];f.set(Number(b),a[b])}return f};a.fromStringMap=function(a){if(a instanceof Map)return a;for(var f=new Map,d=0,c=Object.keys(a);d<c.length;d++){var b=c[d];f.set(b,a[b])}return f}})(a.Internal||
(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(h){h.Todo=function(){for(var e=[],f=0;f<arguments.length;f++)e[f]=arguments[f];e;throw new a.InternalLogicError;};h.Void={}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(h){h.TypeAssert=function(a){a};h.TypeAssertNever=function(e){e;throw new a.InternalLogicError;}})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));
(function(a){a=a.Internal||(a.Internal={});a=a.CompileTime||(a.CompileTime={});a.enable=!0;a.disable=!1})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(d){this._heap=[];this._comparator=d}a.prototype.clear=function(){this._heap.length=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._heap.length},enumerable:!0,configurable:!0});a.prototype.peek=function(){return this._heap[0]};a.prototype.push=function(a){this._heap.push(a);this._siftUp()};a.prototype.pop=function(){var a=this.peek(),c=this.length-1;0<c&&this._swap(0,c);this._heap.pop();this._siftDown();return a};a.prototype.replace=
function(a){var c=this.peek();this._heap[0]=a;this._siftDown();return c};a.prototype._greater=function(a,c){return this._comparator(this._heap[a],this._heap[c])};a.prototype._swap=function(a,c){b=[this._heap[c],this._heap[a]];this._heap[a]=b[0];this._heap[c]=b[1];var b};a.prototype._siftUp=function(){for(var a=this.length-1;0<a&&this._greater(a,(a+1>>>1)-1);)this._swap(a,(a+1>>>1)-1),a=(a+1>>>1)-1};a.prototype._siftDown=function(){for(var a=0;(a<<1)+1<this.length&&this._greater((a<<1)+1,a)||a+1<<
1<this.length&&this._greater(a+1<<1,a);){var c=a+1<<1<this.length&&this._greater(a+1<<1,(a<<1)+1)?a+1<<1:(a<<1)+1;this._swap(a,c);a=c}};return a}();a.PriorityQueue=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(a){a.waitForAll=function(a){return Promise.all(a)}})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){return function(){this.items=[];this.next=null}}(),f=function(){function a(){this.clear()}a.prototype.clear=function(){this._tail=this._head=new e;this._size=0};Object.defineProperty(a.prototype,"length",{get:function(){return this._size},enumerable:!0,configurable:!0});a.prototype.push=function(a){++this._size;if(1024===this._tail.items.length){var b=new e;this._tail=this._tail.next=b}this._tail.items.push(a)};a.prototype.pop=function(){console.assert(0<
this._size);console.assert(0<this._head.items.length);--this._size;var a=this._head.items.shift();if(0===this._head.items.length){var b=this._head.next;null===b?console.assert(this._head===this._tail):this._head=b}return a};return a}();a.Queue=f})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(a){var e=function(){return function(a,d){this.value=a;this.kids=d.slice()}}();a.RoseTree=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(a){var d=[];a.forEach(function(a){d.push(a)});return d}h.setToArray=e;h.setSubtraction=function(f,d){f=e(f).filter(function(a){return!d.has(a)});return a.Internal.toSet(f)}})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));
(function(a){(function(a){a.utf8ArrayToStr=function(a){if("undefined"!==typeof window&&8192>a.length&&"escape"in window){var b=void 0;try{var d=String.fromCharCode.apply(null,a),e=window.escape(d),b=decodeURIComponent(e)}catch(f){b=""}return b}for(var h,p,k,b="",e=a.length,d=0;d<e;)switch(h=a[d++],h>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(h);break;case 12:case 13:p=a[d++];b+=String.fromCharCode((h&31)<<6|p&63);break;case 14:p=a[d++],k=a[d++],b+=String.fromCharCode((h&
15)<<12|(p&63)<<6|(k&63)<<0)}return b};var e=/^\d+$/;a.isBase10Number=function(a){return e.test(a)};var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz`~!@#$%^&*()_+-=[]{};:'\",.<>\\|/?".split("");a.compressUint=function(a){console.assert(0<=a);if(0===a)return f[0];for(var b=[];0!==a;){var d=Math.floor(a/f.length);b.push(f[a%f.length]);a=d}return b.join("")};var d="0000000 000000 00000 0000 000 00 0 ".split(" ");a.zeroPadHex32=function(a){a=a.toString(16);return d[a.length-1]+a}})(a.Internal||
(a.Internal={}))})(Communicator||(Communicator={}));(function(a){(function(a){(function(a){a.isEmpty=function(a){return null===a||void 0===a};a.toArray=function(a){return Array.isArray(a)?a.slice():null===a||void 0===a?[]:[a]};a.fromArray=function(a){return 0===a.length?null:1===a.length?a[0]:a};a.push=function(a,d){return a?Array.isArray(a)?(a.push(d),a):[a,d]:d}})(a.TerseArray||(a.TerseArray={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(){this._afterActionIdlePromise=this._beforeActionIdlePromise=this._action=this._timerId=null}e.prototype.isIdle=function(d){if(0===d)return null===this._timerId;a.Util.TypeAssert(d);return null===this._action};e.prototype.waitForIdle=function(d){if(0===d){if(null===this._timerId)return Promise.resolve();null===this._beforeActionIdlePromise&&(this._beforeActionIdlePromise=h.OpenPromise.create());return this._beforeActionIdlePromise}a.Util.TypeAssert(d);
if(null===this._action)return Promise.resolve();null===this._afterActionIdlePromise&&(this._afterActionIdlePromise=h.OpenPromise.create());return this._afterActionIdlePromise};e.prototype._triggerIdlePromise=function(d){0===d?null!==this._beforeActionIdlePromise&&(this._beforeActionIdlePromise.resolve(),this._beforeActionIdlePromise=null):(a.Util.TypeAssert(d),null!==this._afterActionIdlePromise&&(this._afterActionIdlePromise.resolve(),this._afterActionIdlePromise=null))};e.prototype._clearTimeout=
function(){null!==this._timerId&&(clearTimeout(this._timerId),this._timerId=null)};e.prototype.clear=function(){this._clearTimeout();this._triggerIdlePromise(0);this._action=null;this._triggerIdlePromise(1)};e.prototype.set=function(a,c){var b=this;this._clearTimeout();this._action=c;this._timerId=setTimeout(function(){b._timerId=null;b._triggerIdlePromise(0);var a=b._afterActionIdlePromise;b._afterActionIdlePromise=null;b._action();null===b._timerId&&(b._action=null);null!==a&&a.resolve()},a)};return e}();
h.Timer=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));(function(a){a=a.Internal||(a.Internal={});a=a.Unicode||(a.Unicode={});a.Subscript2="\u00b2";a.Subscript3="\u00b3"})(Communicator||(Communicator={}));
(function(a){(function(a){function e(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]}function f(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a}a.toVec3=function(a){return[a.x,a.y,a.z]};a.cwiseAbs3=function(a){return[Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2])]};a.cwiseProduct3=function(a,c){return[a[0]*c[0],a[1]*c[1],a[2]*c[2]]};a.add3=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2]]};a.sub3=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]};a.add4=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2],
a[3]+c[3]]};a.sub4=function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2],a[3]-c[3]]};a.dot3=e;a.squaredNorm3=f;a.norm3=function(a){return Math.sqrt(f(a))};a.scale3=function(a,c){return[a*c[0],a*c[1],a*c[2]]};a.row4=function(a,c){a=a.m;c*=4;return[a[c],a[c+1],a[c+2],a[c+3]]};a.col4=function(a,c){a=a.m;return[a[c],a[c+4],a[c+8],a[c+12]]};a.projectSquaredSize=function(a,c,b){a=e(a,b)+b[3];a*=a;1E-5>a&&(a=1E-5);return c/a}})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function e(d,c){this._failed=!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;console.assert(0<d,"Don't create a non-progressible queue.");this._maxActivePromises=d;this._suppressFailures=c;this._deferredActions=new a.Queue}e.prototype.isIdle=function(){return 0===this._activePromiseCount};e.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){if(this.isIdle()){if(this._failed)throw this._failureError;
return[2]}null===this._idlePromise&&(this._idlePromise=a.OpenPromise.create());return[2,this._idlePromise]})})};e.prototype.push=function(d){"function"===typeof d&&(d=a.Lazy.create(d));this._activePromiseCount<this._maxActivePromises?(console.assert(0===this._deferredActions.length),this._immediateAction(d)):this._deferredActions.push(d)};e.prototype._immediateAction=function(a){var c=this;if(this._failed)return console.assert(0===this._deferredActions.length),!0;var b;try{b=a.get()}catch(g){this._suppressFailures||
(this._failed=!0,this._failureError=g,this._deferredActions.clear())}if(void 0===b)return!0;++this._activePromiseCount;b.then(function(a){c._finalizePromise();return a}).catch(function(a){c._finalizePromise();throw a;});return!1};e.prototype._finalizePromise=function(){--this._activePromiseCount;this._failed&&console.assert(0===this._deferredActions.length);if(0<this._deferredActions.length){do{var a=this._deferredActions.pop();if(!this._immediateAction(a))break}while(0<this._deferredActions.length)
}this._tryActivateIdlePromise()};e.prototype._tryActivateIdlePromise=function(){0===this._activePromiseCount&&(console.assert(0===this._deferredActions.length),null!==this._idlePromise&&(this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null))};return e}();a.ActionQueue=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function e(a){this._idlePromise=this._pending=this._active=null;this._suppressFailures=a}e.prototype.isIdle=function(){return null===this._active};e.prototype.waitForIdle=function(){if(this.isIdle())return Promise.resolve();null===this._idlePromise&&(this._idlePromise=a.OpenPromise.create());return this._idlePromise};e.prototype.set=function(d){var c=this;"function"===typeof d&&(d=a.Lazy.create(d));if(null===this._active){var b=void 0;try{b=d.get()}catch(g){return this._advance(!this._suppressFailures,
g)}if(void 0===b)return this._advance(!1,null);this._active=b.then(function(){c._advance(!1,null)}).catch(function(a){c._advance(!c._suppressFailures,a)})}else this._pending=d};e.prototype._advance=function(a,c){this._active=null;a&&(this._pending=null);null===this._pending?null!==this._idlePromise&&(a?this._idlePromise.reject(c):this._idlePromise.resolve(),this._idlePromise=null):(a=this._pending,this._pending=null,this.set(a))};e.prototype.clear=function(){this._pending=null};return e}();a.CurrentAction=
e})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(){this._action=new a.Util.CurrentAction(!0);this._latestPromise=null;this._timestamp=0}e.prototype.isIdle=function(){return null===this._latestPromise&&this._action.isIdle()};e.prototype.set=function(a){var c=this,b=++this._timestamp;null!==this._latestPromise&&this._latestPromise.reject(void 0);var g=h.OpenPromise.create();this._latestPromise=g;this._action.clear();this._action.waitForIdle().then(function(){b===c._timestamp&&c._action.set(function(){if(b===
c._timestamp){g===c._latestPromise&&(c._latestPromise=null);"function"===typeof a&&(a=h.Lazy.create(a));var e;try{e=a.get()}catch(f){return c._advance(g,!0,f)}return void 0===e?c._advance(g,!1,null):e.then(function(){return c._advance(g,!1,null)},function(a){return c._advance(g,!0,a)})}})});return g};e.prototype._advance=function(a,c,b){a===this._latestPromise&&(this._latestPromise=null);c?a.reject(b):a.resolve()};return e}();h.CurrentActionSync=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator=
{}));(function(a){(function(a){(function(a){a.create=function(){var a,d,c=new Promise(function(b,c){a=b;d=c});c.resolve=a;c.reject=d;return c}})(a.OpenPromise||(a.OpenPromise={}))})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));(function(a){(a.Internal||(a.Internal={})).OpenPromise=a.Util.OpenPromise})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(){this._cache=new Map}a.prototype.clear=function(){this._cache.clear()};a.prototype.load=function(a,c){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(g){b=this._cache.get(a);if(void 0!==b)return[2,b];this._cache.set(a,c);return[2,c]})})};return a}();a.PromiseCache=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(b,c,d){this._lazyPromise=b;this._wrapperPromise=c;null!==d&&(this.compareValue=d)}a.prototype.kill=function(){this._lazyPromise=null};a.prototype.fetch=function(a,c){var d=this;null===this._lazyPromise?(this._wrapperPromise.reject(null),setTimeout(c,0)):a(this._lazyPromise).then(function(a){d._wrapperPromise.resolve(a)}).catch(function(a){d._wrapperPromise.reject(a)})};return a}();a._DeferredPromise=e;var f=function(){function c(a,c,d){this._failed=
!1;this._failureError=null;this._activePromiseCount=0;this._idlePromise=null;this._latestPromise=Promise.resolve();this._needsResorting=!1;console.assert(0<a,"Don't create a non-progressible queue.");this._maxActivePromises=a;this._deferredPromises=c;this._failureFailsAll=d}c.prototype.maxActivePromises=function(){return this._maxActivePromises};c.prototype.isIdle=function(){return 0===this._activePromiseCount};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){if(this.isIdle()){if(this._failureFailsAll&&this._failed)throw this._failureError;return[2]}null===this._idlePromise&&(this._idlePromise=a.OpenPromise.create());return[2,this._idlePromise]})})};c.prototype.killDeferred=function(){for(var a=[];0<this._deferredPromises.length;){var c=this._dequeue();c.kill();a.push(c)}for(var d=0;d<a.length;d++)c=a[d],this._queue(c)};c.prototype._push=function(b,c){"function"===typeof b&&(b=a.Lazy.create(b));return this._latestPromise=b=this._activePromiseCount<
this._maxActivePromises?this._immediatePromise(b):this._deferPromise(b,c)};c.prototype._resort=function(){console.assert(this._needsResorting);this._needsResorting=!1;for(var a=[];0<this._deferredPromises.length;){var c=this._dequeue();a.push(c)}for(var d=0;d<a.length;d++)c=a[d],this._queue(c)};c.prototype._deferPromise=function(b,c){var d=a.OpenPromise.create();b=new e(b,d,c);this._queue(b);return d};c.prototype._immediatePromise=function(a){return __awaiter(this,void 0,void 0,function(){var c,d;
return __generator(this,function(e){switch(e.label){case 0:if(this._failureFailsAll&&this._failed)throw this._failureError;++this._activePromiseCount;e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.get()];case 2:return c=e.sent(),this._finalizePromise(),[2,c];case 3:throw d=e.sent(),this._failureFailsAll&&!this._failed&&(this._failed=!0,this._failureError=d,null!==this._idlePromise&&this._idlePromise.reject(d)),this._finalizePromise(),d;case 4:return[2]}})})};c.prototype._finalizePromise=function(){var a=
this;--this._activePromiseCount;0<this._deferredPromises.length?(this._needsResorting&&this._resort(),this._dequeue().fetch(function(c){return a._immediatePromise(c)},function(){a._finalizePromise()})):0===this._activePromiseCount&&(null!==this._idlePromise&&(this._failureFailsAll&&this._failed?this._idlePromise.reject(this._failureError):this._idlePromise.resolve(),this._idlePromise=null),this._latestPromise=Promise.resolve())};return c}();a.PromiseQueueImpl=f;var d=function(c){function b(b,d){return c.call(this,
b,new a.Queue,d)||this}__extends(b,c);b.prototype._queue=function(a){this._deferredPromises.push(a)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(a){return this._push(a,null)};b.prototype.waitOnLatest=function(){return this._latestPromise.then(a.nop,a.nop)};return b}(f);a.PromiseQueue=d;f=function(c){function b(b,d,e){var f=this,f=new a.PriorityQueue(function(a,b){return d(a.compareValue,b.compareValue)});return f=c.call(this,b,f,e)||this}__extends(b,
c);b.prototype._queue=function(a){this._deferredPromises.push(a)};b.prototype._dequeue=function(){return this._deferredPromises.pop()};b.prototype.push=function(a,b){return this._push(a,b)};b.prototype.markDirty=function(){this._needsResorting=!0};return b}(f);a.PriorityPromiseQueue=f})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){a.create=function(){var a,d,c=new Promise(function(b,g){a=function(a){c.state=1;b(a)};d=function(a){c.state=2;g(a)}});c.state=0;c.resolve=a;c.reject=d;return c}})(a.TrackedOpenPromise||(a.TrackedOpenPromise={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){a.create=function(a,d){var c=new Promise(function(b,g){d.catch(g).then(function(){c.isReady=!0;b(a)})});c.unsafeValue=a;c.readyPromise=d;c.isReady=!1;return c}})(a.UnsafePromise||(a.UnsafePromise={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(d){function c(b,c,e,f){var h=d.call(this)||this;h._position=new a.Point2(b,c);h._modifiers=e;h._inputType=f;return h}__extends(c,d);c.prototype.getPosition=function(){return this._position.copy()};c.prototype.shiftDown=function(){return(this._modifiers&a.KeyModifiers.Shift)===a.KeyModifiers.Shift};c.prototype.altDown=function(){return(this._modifiers&a.KeyModifiers.Alt)===a.KeyModifiers.Alt};c.prototype.controlDown=function(){return(this._modifiers&a.KeyModifiers.Control)===
a.KeyModifiers.Control};c.prototype.commandDown=function(){return(this._modifiers&a.KeyModifiers.Command)===a.KeyModifiers.Command};c.prototype.getEventType=function(){return this._inputType};c.prototype.getModifiers=function(){return this._modifiers};return c}(h.InputEvent);h.MouseInputEventBase=e;var f=function(a){function c(b,c,e,f,h,k){b=a.call(this,b,c,h,k)||this;b._button=e;b._buttons=f;return b}__extends(c,a);c.prototype.getButton=function(){return this._button};c.prototype.getButtons=function(){return this._buttons};
return c}(e);h.MouseInputEvent=f;e=function(a){function c(b,c,e,f,h,k){b=a.call(this,b,c,h,k)||this;b._wheelDelta=e;b._buttons=f;return b}__extends(c,a);c.prototype.getWheelDelta=function(){return this._wheelDelta};c.prototype.getButtons=function(){return this._buttons};return c}(e);h.MouseWheelInputEvent=e})(a.Event||(a.Event={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(a){this._selection=a}e.prototype.getType=function(){return this._selection?this._selection.getSelectionType():a.SelectionType.None};e.prototype.getSelection=function(){return this._selection};e._createNull=function(){return new e(a.Selection.SelectionItem.create())};return e}();h.NodeSelectionEvent=e})(a.Event||(a.Event={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c,b,d,l,h){var p=e.call(this)||this;p._id=c;p._position=new a.Point2(b,d);p._buttons=l;p._inputType=h;return p}__extends(d,e);d.prototype.getId=function(){return this._id};d.prototype.getPosition=function(){return this._position};d.prototype.getEventType=function(){return this._inputType};d.prototype.getButtons=function(){return this._buttons};return d}(h.InputEvent);h.TouchInputEvent=e})(a.Event||(a.Event={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function a(){}a.calculate=function(a,c,b,g){var e=2/(c+2*b+g);a=a<=c?this._PA(a,e,c):a>=c&&a<=c+b?this._PA(a,e,c):this._PC(a,e,c,b,g);return a=Math.min(a,1)};a._PA=function(a,c,b){return a*a*.5*c/b};a._PB=function(a,c,b){return this._PA(b,c,b)+(a-b)*c};a._PC=function(a,c,b,g,e){return this._PB(b+g,c,b)+(a-(b+g))*c*(1-.5*(a-(b+g))/e)};return a}();a.EaseInEaseOut=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(d,c,b,g,f){this._startTime=this._completeCallback=null;this._progress=0;this._targetMoveDelta=this._positionMoveDelta=null;this._interpolationUsesRotation=!1;this._endQuaternion=this._beginQuaternion=null;this._fieldHeightDelta=this._fieldWidthDelta=this._viewVectorLengthDelta=this._viewVectorLength=0;this._beginCam=d.copy();this._endCam=c.copy();d=a.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()).normalize();c=this._endCam.getUp().normalize();
c=a.Point3.cross(c,d);d=a.Point3.cross(d,c);this._endCam.setUp(d.normalize());this._completeCallback=g;this._duration=b;this._view=f}e.prototype.isComplete=function(){return 1<=this._progress};e.prototype.getCallback=function(){return this._completeCallback};e.prototype.stop=function(){};e.prototype.start=function(){this._startTime=Date.now();this._progress=0;this._init();this._view.getProjectionMode()!==this._endCam.getProjection()&&this._view.setProjectionMode(this._endCam.getProjection())};e.prototype.update=
function(){if(null!==this._startTime){var d=(Date.now()-this._startTime)/this._duration,d=Math.min(d,1),d=Math.max(d,0),d=h.EaseInEaseOut.calculate(d,.49,.02,.49),d=Math.min(d,1),d=Math.max(d,0),c=a.Point3.scale(this._positionMoveDelta,d),b=a.Point3.scale(this._targetMoveDelta,d),g=this._beginCam.getUp(),e=a.Point3.add(this._beginCam.getPosition(),c),b=a.Point3.add(this._beginCam.getTarget(),b),c=this._beginCam.getWidth()+d*this._fieldWidthDelta,f=this._beginCam.getHeight()+d*this._fieldHeightDelta;
if(this._interpolationUsesRotation){var e=this._viewVectorLength+this._viewVectorLengthDelta*d,p=a.Quaternion.interpolate(this._beginQuaternion,this._endQuaternion,d),p=a.Quaternion.toMatrix(p),e=new a.Point3(b.x-p.m[8]*e,b.y-p.m[9]*e,b.z-p.m[10]*e);g.set(p.m[4],p.m[5],p.m[6])}g=a.Camera.create(e,b,g,this._endCam.getProjection(),c,f,this._endCam.getNearLimit());this._view.setCamera(g);this._progress=d;1<=this._progress&&this._view.setCamera(this._endCam)}};e.prototype._init=function(){var d=a.Point3.subtract(this._beginCam.getTarget(),
this._beginCam.getPosition()),c=a.Point3.subtract(this._endCam.getTarget(),this._endCam.getPosition()),b=d.length(),g=c.length()-b;d.normalize();c.normalize();var c=a.Point3.subtract(d,c),e=a.Point3.subtract(this._endCam.getUp(),this._beginCam.getUp()),d=!0;1E-4>c.length()&&1E-4>e.length()&&(d=!1);e=c=null;if(d){var c=this._beginCam.getMatrixFromCamera(),e=this._endCam.getMatrixFromCamera(),c=a.Quaternion.createFromMatrix(c),e=a.Quaternion.createFromMatrix(e),f=a.Quaternion.subtract(c,e).magnitudeSquared();
a.Quaternion.add(c,e).magnitudeSquared()<f&&e.negate()}this._interpolationUsesRotation=d;this._beginQuaternion=c;this._endQuaternion=e;this._viewVectorLength=b;this._viewVectorLengthDelta=g;this._positionMoveDelta=a.Point3.subtract(this._endCam.getPosition(),this._beginCam.getPosition());this._targetMoveDelta=a.Point3.subtract(this._endCam.getTarget(),this._beginCam.getTarget());this._fieldWidthDelta=this._endCam.getWidth()-this._beginCam.getWidth();this._fieldHeightDelta=this._endCam.getHeight()-
this._beginCam.getHeight()};return e}();h.CameraInterpolation=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){var e=function(){function e(){this._activeInterpolation=null;this._updateTimer=new a.Timer;this._updateInterval=16}e.prototype.stop=function(){this._activeInterpolation&&this._activeInterpolation.stop();this._activeInterpolation=null;this._updateTimer.clear()};e.prototype.start=function(a,c){void 0===c&&(c=!0);if(this._activeInterpolation&&!c)return!1;this.stop();this._activeInterpolation=a;this._activeInterpolation.start();this.update();return!0};e.prototype.update=function(){var a=
this;if(this._activeInterpolation)if(this._activeInterpolation.update(),this._activeInterpolation.isComplete()){var c=this._activeInterpolation.getCallback();null!==c&&c()}else this._updateTimer.isIdle(0)&&this._updateTimer.set(this._updateInterval,function(){a.update()})};return e}();a.InterpolationManager=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(){this._positionOffset=a.Point2.zero();this._position=a.Point2.zero();this._activeNoteText=null;this._createTextBox()}d.prototype._createTextBox=function(){var c=this;this._container=document.createElement("div");this._container.className="noteTextElement";this._textArea=document.createElement("textarea");this._textArea.oninput=function(){null!==c._activeNoteText&&c._activeNoteText.saveTextValue()};this._container.appendChild(this._textArea);
var b=7;["blue","red","green","white","black"].forEach(function(d){var g=document.createElement("button");g.className="noteButton color "+d;g.style.top=b+"px";b+=25;g.id=d+"_button";var e;switch(d){case "blue":e=a.Color.blue();break;case "red":e=a.Color.red();break;case "green":e=a.Color.green();break;case "white":e=a.Color.white();break;case "black":e=a.Color.black();break;default:e=a.Color.white()}g.onmousedown=function(){null!==c._activeNoteText&&c._activeNoteText.setColor(e)};c._container.appendChild(g)});
var d=document.createElement("button");d.className="noteButton trash";d.style.top=b+"px";d.onmousedown=function(){null!==c._activeNoteText&&c._activeNoteText.remove()};this._container.appendChild(d)};d.prototype.setPositionOffset=function(a){this._positionOffset=a};d.prototype.getPositionOffset=function(){return this._positionOffset.copy()};d.prototype.setPosition=function(c){this._position=a.Point2.add(c,this._positionOffset);this._container.style.left=this._position.x+"px";this._container.style.top=
this._position.y+"px"};d.prototype.getPosition=function(){return this._position.copy()};d.prototype.setText=function(a){var b=this._container.querySelector("textarea");null!==b&&(b.value=a)};d.prototype.getText=function(){var a=this._container.querySelector("textarea");return null!==a?a.value:""};d.prototype.setSize=function(a){this._container.style.width=a.x+"px";this._container.style.height=a.y+"px"};d.prototype.getSize=function(){var c=this._container.getBoundingClientRect();return new a.Point2(c.width,
c.height)};d.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto"};d.prototype.blur=function(){this._container.blur()};d.prototype.hide=function(){this._container.style.visibility="hidden";this._activeNoteText=null};d.prototype.show=function(a){this._container.style.visibility="visible";this._activeNoteText=a};d.prototype.getHtmlContainer=function(){return this._container};d.prototype.setHtmlContainer=function(a){this._container=a};return d}();e.NoteTextElement=
f})(h.Note||(h.Note={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){return function(){this.rotate=this.viewPlane=this.plane=this.axis=null}}(),f=function(){return function(c,b,d,e,f){this.vector=b;this.matrix=d;this.nodeId=e;this.position=c;this.handleType=f;this.translation=a.Point3.zero()}}(),d=function(c){function b(b){var d=c.call(this)||this;d._meshIds=new e;d._scaleModifier=1;d._id=0;d._handleData=new Map;d._translationFromInitialHandlePosition=a.Point3.zero();d._viewer=b;d._callbacks={camera:function(){d._updateCamera()},
_assemblyTreeReady:function(){return __awaiter(d,void 0,void 0,function(){var a=this,b,c,d,g;return __generator(this,function(e){this._updateViewport();this._hideOverlay();b=this._createMeshId(this._getAxisMeshData()).then(function(b){a._meshIds.axis=b});c=this._createMeshId(this._getPlaneMeshData()).then(function(b){a._meshIds.plane=b});d=this._createMeshId(this._getViewPlaneMeshData()).then(function(b){a._meshIds.viewPlane=b});g=this._createMeshId(this._getRotateMeshData()).then(function(b){a._meshIds.rotate=
b});b;c;d;g;return[2]})})},modelSwitchStart:function(){d.removeHandles()}};d._viewer.setCallbacks(d._callbacks);return d}__extends(b,c);b.prototype.remove=function(){null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);c.prototype.remove.call(this)};b.prototype._getAxisMeshData=function(){return a.Util.generateConeCylinderMeshData(b._cylinderRadius,b._segmentCount,b._cylinderHeight,b._coneBaseRadius,b._capHeight,b._taperHeight)};b.prototype._getPlaneMeshData=
function(){var c=new a.Point3(b._planeOffset,0,b._planeOffset),d=new a.Point3(b._planeOffset+b._planeLength,0,b._planeOffset),e=new a.Point3(b._planeOffset+b._planeLength,0,b._planeOffset+b._planeLength),f=new a.Point3(b._planeOffset,0,b._planeOffset+b._planeLength),h=[c.x,c.y,c.z,d.x,d.y,d.z,e.x,e.y,e.z,c.x,c.y,c.z,e.x,e.y,e.z,f.x,f.y,f.z],r=new a.Point3(0,-1,0),r=[r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z,r.x,r.y,r.z],m=new a.MeshData;m.addFaces(h,r);m.setBackfacesEnabled(!0);
m.addPolyline([c.x,c.y,c.z,d.x,d.y,d.z]);m.addPolyline([d.x,d.y,d.z,e.x,e.y,e.z]);m.addPolyline([e.x,e.y,e.z,f.x,f.y,f.z]);m.addPolyline([f.x,f.y,f.z,c.x,c.y,c.z]);return m};b.prototype._getViewPlaneMeshData=function(){return a.Util.generateSphereMeshData()};b.prototype._getRotateMeshData=function(b,c,d){void 0===b&&(b=35);void 0===c&&(c=12);void 0===d&&(d=.5);var e=b*Math.PI/180*.5;b=[];for(var f=-e;f<=e;f+=.1){var h=Math.sin(f)*c;b.push(Math.cos(f)*c);b.push(0);b.push(h)}c=new a.Point3(0,0,1);d=
a.Util.createCylinderMeshDataFromArc(b,c,10,d);d.setBackfacesEnabled(!0);return d};b.prototype.setAxisMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.axis?[3,2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),this._meshIds.axis=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.axis,a)];case 3:return[2]}})})};b.prototype.setPlaneMeshData=function(a){return __awaiter(this,
void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.plane?[3,2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),this._meshIds.plane=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.plane,a)];case 3:return[2]}})})};b.prototype.setViewPlaneMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.viewPlane?[3,
2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),this._meshIds.viewPlane=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.viewPlane,a)];case 3:return[2]}})})};b.prototype.setRotateMeshData=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null!==this._meshIds.rotate?[3,2]:[4,this._createMeshId(a)];case 1:return b=c.sent(),this._meshIds.rotate=b,[3,3];case 2:return[2,this._viewer.model.replaceMesh(this._meshIds.rotate,
a)];case 3:return[2]}})})};b.prototype.getOverlayId=function(){return a.BuiltinOverlayIndex.Handles};b.prototype._hideOverlay=function(){this._viewer.overlayManager.setVisibility(a.BuiltinOverlayIndex.Handles,!1)};b.prototype.hideOverlay=function(){this._hideOverlay();return Promise.resolve()};b.prototype._showOverlay=function(){this._viewer.overlayManager.setVisibility(a.BuiltinOverlayIndex.Handles,!0);this._updateCamera()};b.prototype.showOverlay=function(){this._showOverlay();return Promise.resolve()};
b.prototype._updateViewport=function(){this._viewer.overlayManager.setViewport(a.BuiltinOverlayIndex.Handles,a.OverlayAnchor.UpperLeftCorner,0,a.OverlayUnit.ProportionOfCanvas,0,a.OverlayUnit.ProportionOfCanvas,1,a.OverlayUnit.ProportionOfCanvas,1,a.OverlayUnit.ProportionOfCanvas)};b.prototype.updateViewport=function(){this._updateViewport();return Promise.resolve()};b.prototype.addHandles=function(b,c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return this._scaleModifier=
c,this._translationFromInitialHandlePosition.assign(a.Point3.zero()),[4,this.createDefaultHandles(b)];case 1:return d.sent(),this._showOverlay(),[2]}})})};b.prototype._updateCamera=function(){this._viewer.overlayManager.setCamera(a.BuiltinOverlayIndex.Handles,this._viewer.view.getCamera())};b.prototype.getVector=function(a){return(a=this._handleData.get(a))?(a=a.vector,null===a?null:a.copy()):null};b.prototype.getHandleType=function(a){return(a=this._handleData.get(a))?a.handleType:null};b.prototype.getPosition=
function(a){if(a=this._handleData.get(a)){var b=a.translation.copy();return a.position.copy().add(this._translationFromInitialHandlePosition).add(b)}return null};b.prototype.getHandleNodeIds=function(){var a=[];this._handleData.forEach(function(b,c){a.push(c)});return a};b.prototype.removeHandles=function(){this._viewer.model.deleteMeshInstances(this.getHandleNodeIds());this._handleData.clear();this._id=0;this._hideOverlay();return Promise.resolve()};b.prototype.isEmpty=function(){return 0===this._handleData.size};
b.prototype.createDefaultHandles=function(c){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return d=[],d.push(this.addViewPlaneHandle(c,b._viewPlaneColor)),d.push(this.addAxisTranslationHandle(c,new a.Point3(1,0,0),b._xColor,new a.Point3(0,1,0))),d.push(this.addAxisTranslationHandle(c,new a.Point3(0,1,0),b._yColor,new a.Point3(0,0,1))),d.push(this.addAxisTranslationHandle(c,new a.Point3(0,0,1),b._zColor,new a.Point3(1,0,0))),d.push(this.addPlaneTranslationHandle(c,
new a.Point3(1,0,0),b._zColor,a.Color.black(),new a.Point3(0,-1,0))),d.push(this.addPlaneTranslationHandle(c,new a.Point3(0,1,0),b._xColor,a.Color.black(),new a.Point3(0,0,-1))),d.push(this.addPlaneTranslationHandle(c,new a.Point3(0,0,1),b._yColor,a.Color.black(),new a.Point3(-1,0,0))),d.push(this.addRotateHandle(c,new a.Point3(1,0,0),b._zColor,new a.Point3(0,-1,0))),d.push(this.addRotateHandle(c,new a.Point3(0,1,0),b._xColor,new a.Point3(0,0,-1))),d.push(this.addRotateHandle(c,new a.Point3(0,0,1),
b._yColor,new a.Point3(-1,0,0))),[4,Promise.all(d)];case 1:return e.sent(),[2]}})})};b.prototype._createMeshId=function(a){return __awaiter(this,void 0,void 0,function(){var b,c;return __generator(this,function(d){switch(d.label){case 0:return b=this._viewer.model,[4,b.createMesh(a)];case 1:return c=d.sent(),b._preventMeshDeletion(c),[2,c]}})})};b.prototype.addAxisTranslationHandle=function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var h,r,m,n;return __generator(this,function(q){switch(q.label){case 0:return(h=
this._meshIds.axis)?[3,2]:[4,this._createMeshId(this._getAxisMeshData())];case 1:return h=q.sent(),this._meshIds.axis=h,[2,this.addAxisTranslationHandle(b,c,d,e)];case 2:return r="handle-axis-translation-"+this._id++,m=this._getRotationMatrixFromVector(c,e),[4,this._createMeshInstance(h,r,d,null,b.copy(),m)];case 3:return n=q.sent(),this._handleData.set(n,new f(b.copy(),c.copy(),m.copy(),n,a.HandleType.Axis)),[2,n]}})})};b.prototype.addViewPlaneHandle=function(b,c){return __awaiter(this,void 0,void 0,
function(){var d,e;return __generator(this,function(h){switch(h.label){case 0:return(d=this._meshIds.viewPlane)?[3,2]:[4,this._createMeshId(this._getViewPlaneMeshData())];case 1:return d=h.sent(),this._meshIds.viewPlane=d,[2,this.addViewPlaneHandle(b,c)];case 2:return[4,this._createMeshInstance(d,"handle-sphere-instance",c,null,b,new a.Matrix)];case 3:return e=h.sent(),this._handleData.set(e,new f(b.copy(),null,new a.Matrix,e,a.HandleType.ViewPlane)),[2,e]}})})};b.prototype.addPlaneTranslationHandle=
function(b,c,d,e,h){return __awaiter(this,void 0,void 0,function(){var r,m,n,q;return __generator(this,function(t){switch(t.label){case 0:return(r=this._meshIds.plane)?[3,2]:[4,this._createMeshId(this._getPlaneMeshData())];case 1:return r=t.sent(),this._meshIds.plane=r,[2,this.addPlaneTranslationHandle(b,c,d,e,h)];case 2:return m="handle-plane-translation-"+this._id++,n=this._getRotationMatrixFromVector(c,h),[4,this._createMeshInstance(r,m,d,e,b,n)];case 3:return q=t.sent(),this._handleData.set(q,
new f(b.copy(),c.copy(),n.copy(),q,a.HandleType.Plane)),[2,q]}})})};b.prototype.addRotateHandle=function(b,c,d,e){return __awaiter(this,void 0,void 0,function(){var h,r,m,n;return __generator(this,function(q){switch(q.label){case 0:return(h=this._meshIds.rotate)?[3,2]:[4,this._createMeshId(this._getRotateMeshData())];case 1:return h=q.sent(),this._meshIds.rotate=h,[2,this.addRotateHandle(b,c,d,e)];case 2:return r="handle-rotate-"+this._id++,m=this._getRotationMatrixFromVector(c,e),[4,this._createMeshInstance(h,
r,d,null,b,m)];case 3:return n=q.sent(),this._handleData.set(n,new f(b.copy(),c.copy(),m.copy(),n,a.HandleType.Rotate)),[2,n]}})})};b.prototype._getRotationMatrixFromVector=function(b,c){c||(c=new a.Point3(1,0,0),.001>a.Point3.cross(c,b).squaredLength()&&(c=new a.Point3(0,1,0)));c=a.Point3.cross(c,b).normalize();var d=a.Point3.cross(c,b).normalize();b.normalize();var e=new a.Matrix;e.m[0]=c.x;e.m[1]=c.y;e.m[2]=c.z;e.m[3]=0;e.m[4]=b.x;e.m[5]=b.y;e.m[6]=b.z;e.m[7]=0;e.m[8]=d.x;e.m[9]=d.y;e.m[10]=d.z;
e.m[11]=0;e.m[12]=0;e.m[13]=0;e.m[14]=0;e.m[15]=1;return e};b.prototype._createMeshInstance=function(b,c,d,e,f,h){return __awaiter(this,void 0,void 0,function(){var m,n,q;return __generator(this,function(t){m=this._createTransformationMatrix(f,new a.Matrix);m=a.Matrix.multiply(h,m);n=new a.MeshInstanceData(b,m,c,d||void 0,e||void 0);n.setOpacity(1);n.setCreationFlags(a.MeshInstanceCreationFlags.SuppressCameraScale|a.MeshInstanceCreationFlags.DoNotCut|a.MeshInstanceCreationFlags.DoNotExplode|a.MeshInstanceCreationFlags.ExcludeBounding|
a.MeshInstanceCreationFlags.DoNotXRay|a.MeshInstanceCreationFlags.OverrideSceneVisibility|a.MeshInstanceCreationFlags.AlwaysDraw);n.setOverlayIndex(a.BuiltinOverlayIndex.Handles);q=this._viewer.model;return[2,q.createMeshInstance(n,void 0,!0,!0)]})})};b.prototype._createTransformationMatrix=function(c,d){var e=b._defaultScale*this._scaleModifier,e=(new a.Matrix).setScaleComponent(e,e,e),e=a.Matrix.multiply(e,d);e.setTranslationComponent(c.x,c.y,c.z);return e};b.prototype.updatePosition=function(b,
c,d){return __awaiter(this,void 0,void 0,function(){var e=this,f,h;return __generator(this,function(m){switch(m.label){case 0:return f=this._viewer.model,h=[],this._handleData.forEach(function(m,q){var t=m.matrix,u=m.position.copy();u.add(b.copy());d&&m.position.assign(u);m=m.translation.copy();u.add(m);t=e._createTransformationMatrix(u,a.Matrix.multiply(t,c));h.push(f.setNodeMatrix(q,t))}),[4,Promise.all(h)];case 1:return m.sent(),[2]}})})};b.prototype.resetTranslation=function(){var b=this;this._translationFromInitialHandlePosition&&
(this._handleData.forEach(function(a){a.translation.add(b._translationFromInitialHandlePosition)}),this._translationFromInitialHandlePosition.assign(a.Point3.zero()))};b.prototype.getTranslation=function(){return this._translationFromInitialHandlePosition};b.className="Communicator.Markup.HandleMarkup";b._defaultScale=.02;b._cylinderRadius=.5;b._coneBaseRadius=.9;b._cylinderHeight=7;b._capHeight=1.2;b._taperHeight=.2;b._segmentCount=20;b._planeOffset=1;b._planeLength=2.5;b._xColor=new a.Color(168,
56,59);b._yColor=new a.Color(96,166,50);b._zColor=new a.Color(41,81,185);b._viewPlaneColor=a.Color.white();return b}(h.MarkupItem);h.HandleMarkup=d})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function e(a,c,b){this._markupItems=new Map;this._selectedMarkup=this._activeView=null;this._pendingUpdateHandleTimer=new h.Timer;this._callbackManager=a;this._domElements=c;this._markupRenderer=b}e.prototype.shutdown=function(){this.setActiveView(null);this._markupItems.forEach(function(a){a.remove()});this._markupItems.clear()};e.prototype._updateLater=function(a){var c=this;this._pendingUpdateHandleTimer.isIdle(0)&&this._pendingUpdateHandleTimer.set(0,
function(){c.update()});null!==a&&this._pendingUpdateHandleTimer.waitForIdle(1).then(function(){a.resolve()})};e.prototype.updateLater=function(){this._updateLater(null)};e.prototype.update=function(){this._pendingUpdateHandleTimer.clear();this.renderMarkup();this.renderActiveViewMarkup()};e.prototype.registerMarkupItem=function(d){var c=a.GUID.create();this._markupItems.set(c,d);return c};e.prototype.unregisterMarkupItem=function(a){var c=this._markupItems.get(a);c&&(c.remove&&c.remove(),this._markupItems.delete(a))};
e.prototype.getActiveView=function(){return this._activeView};e.prototype.setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var c,b,e,f,v,p;return __generator(this,function(k){switch(k.label){case 0:this._selectedMarkup&&(this._selectedMarkup.onDeselect(),this._selectedMarkup=null);c=this._activeView;this._activeView=a;if(null===c||c===a)return[3,2];b=c.getMarkup();e=0;for(f=b;e<f.length;e++)v=f[e],v.remove();p=h.OpenPromise.create();this._updateLater(p);return[4,p];case 1:return k.sent(),
this._callbackManager.trigger("viewDeactivated",c),[3,4];case 2:return[4,this._pendingUpdateHandleTimer.waitForIdle(1)];case 3:k.sent(),k.label=4;case 4:return[2]}})})};e.prototype.renderMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getMarkupSvgElement());this._markupRenderer._clear();this._markupItems.forEach(function(a){a.draw()});this._markupRenderer._finalize()};e.prototype.renderActiveViewMarkup=function(){this._markupRenderer._setCanvas(this._domElements.getRedlineSvgElement());
this._markupRenderer._clear();if(this._activeView){for(var a=0,c=this._activeView.getMarkup();a<c.length;a++)c[a].draw();this._markupRenderer._finalize()}};e.prototype.pick=function(a){if(this._activeView)for(var c=0,b=this._activeView.getMarkup();c<b.length;c++){var e=b[c];if(e.hit(a))return e}var f=null;this._markupItems.forEach(function(b){null===f&&b.hit(a)&&(f=b)});return f};e.prototype.select=function(a){if(this._selectedMarkup&&a!==this._selectedMarkup)this._selectedMarkup.onDeselect();if(this._selectedMarkup=
a)this._selectedMarkup.onSelect();this.update()};e.prototype.getSelected=function(){return this._selectedMarkup};return e}();h.MarkupItemManager=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b._center=a.Point2.zero();b._radius=1;return b}__extends(b,c);b.prototype.set=function(a,b){this._center.assign(a);this.setRadius(b)};b.prototype.getCenter=function(){return this._center.copy()};b.prototype.setCenter=function(a){this._center.assign(a)};b.prototype.getRadius=function(){return this._radius};b.prototype.setRadius=function(a){this._radius=a};return b}(e.FilledShape);e.Circle=
f;var d=function(){return function(a,b){this.center=a.copy();this.radius=b}}();e._MarkupCircleData=d;f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._circles=[];return b}__extends(b,a);b.prototype.clear=function(){this._circles=[]};b.prototype.addCircle=function(a,b){this._circles.push(new d(a,b))};b.prototype.getCircles=function(){return this._circles};return b}(e.FilledShape);e.CircleCollection=f})(h.Shape||(h.Shape={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator=
{}));
(function(a){(function(h){(function(e){var f=function(c){function b(b,d){var e=c.call(this)||this;e._p1=b?b.copy():a.Point2.zero();e._p2=d?d.copy():a.Point2.zero();return e}__extends(b,c);b.prototype.set=function(a,b){this._p1.assign(a);this._p2.assign(b)};b.prototype.getP1=function(){return this._p1.copy()};b.prototype.setP1=function(a){this._p1.assign(a)};b.prototype.getP2=function(){return this._p2};b.prototype.setP2=function(a){this._p2.assign(a)};return b}(e.EndcapShape);e.Line=f;var d=function(){return function(a,
b){this.p1=a.copy();this.p2=b.copy()}}();e._MarkupLineData=d;f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._lines=[];return b}__extends(b,a);b.prototype.addLine=function(a,b){this._lines.push(new d(a,b))};b.prototype.getLines=function(){return this._lines};b.prototype.clear=function(){this._lines=[]};return b}(e.EndcapShape);e.LineCollection=f})(h.Shape||(h.Shape={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function c(){this._padding=5;this._text=new e.TextMarkupBase;this._box=new e.RectangleBase;this._box.setFillOpacity(0);this._box.setFillColor(a.Color.white())}c.prototype._assign=function(a){this._text._assign(a._text);this._box._assign(a._box);this._padding=a._padding};c.prototype.getTextPortion=function(){return this._text};c.prototype.getBoxPortion=function(){return this._box};c.prototype.getPadding=function(){return this._padding};c.prototype.setPadding=
function(a){this._padding=a};return c}();e.TextBoxBase=f;var d=function(c){function b(b,d){var e=c.call(this)||this;e._position=a.Point2.zero();e._textStr="";b&&e._position.assign(b);d&&(e._textStr=d);return e}__extends(b,c);b.prototype._assign=function(a){c.prototype._assign.call(this,a);this._position.assign(a._position)};b.prototype.getPosition=function(){return this._position.copy()};b.prototype.setPosition=function(a){this._position.assign(a)};b.prototype.getTextString=function(){return this._textStr};
b.prototype.setTextString=function(a){this._textStr=a};return b}(f);e.TextBox=d;f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._textStrings=[];return b}__extends(b,a);b.prototype.clear=function(){this._textStrings=[]};b.prototype.addString=function(a,b){this._textStrings.push(new e._MarkupTextData(a,b))};b.prototype.getStrings=function(){return this._textStrings};return b}(f);e.TextBoxCollection=f})(h.Shape||(h.Shape={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator=
{}));
(function(a){(function(h){var e=function(){return function(a,c){this.markupView=a;this.itemResults=c}}();h._MarkupViewConstruction=e;var f=function(){function d(a,b,d,e,f,h){void 0===h&&(h=null);this._faceVisibility=this._lineVisibility=!0;this._markupItems=new Set;this._sheetId=null;this._colorMap=new Map;this._snapshotImage=null;this._defaultVisibility=!0;this._visibilityExceptions=new Set;this._uniqueId=a;this._camera=d;this._name=b;this._explodeMagnitude=e;this._cuttingPlaneData=f;this._sheetId=h}
d.prototype.getCamera=function(){return this._camera};d.prototype.getSheetId=function(){return this._sheetId};d.prototype.getUniqueId=function(){return this._uniqueId};d.prototype.getName=function(){return this._name};d.prototype.setName=function(a){this._name=a};d.prototype.getLineVisibility=function(){return this._lineVisibility};d.prototype.setLineVisibility=function(a){this._lineVisibility=a};d.prototype.getFaceVisibility=function(){return this._faceVisibility};d.prototype.setFaceVisibility=function(a){this._faceVisibility=
a};d.prototype.addMarkupItem=function(a){this._markupItems.add(a)};d.prototype.getMarkup=function(){return a.Util.setToArray(this._markupItems)};d.prototype.removeMarkup=function(a){a.remove();return this._markupItems.delete(a)};d.prototype.getCuttingPlaneData=function(){return this._cuttingPlaneData};d.prototype.setCuttingPlaneData=function(a){this._cuttingPlaneData=a};d.prototype.getExplodeMagnitude=function(){return this._explodeMagnitude};d.prototype.setExplodeMagnitude=function(a){this._explodeMagnitude=
a};d.prototype.getColorMap=function(){return this._colorMap};d.prototype.setColorMap=function(a){this._colorMap=a};d.prototype.getDefaultVisibility=function(){return this._defaultVisibility};d.prototype.setDefaultVisibility=function(a){this._defaultVisibility=a};d.prototype.getVisibilityExceptions=function(){return this._visibilityExceptions};d.prototype.setVisibilityExceptions=function(a){this._visibilityExceptions=a};d.prototype.getSnapshotImage=function(){return this._snapshotImage};d.prototype.setSnapshotImage=
function(a){this._snapshotImage=a};d.prototype._handleLoadMarkupItem=function(a){return a instanceof h.MarkupItem?(this.addMarkupItem(a),!0):!1};d._construct=function(c,b){return __awaiter(this,void 0,void 0,function(){var g,f,h,p,k,r,m,n,q,t,u,w,z,y,x,A,B,C,D,G,E;return __generator(this,function(I){switch(I.label){case 0:g=a.Camera.fromJson(c.camera);c.hasOwnProperty("sheetId")&&c.sheetId&&(h=parseInt(c.sheetId,10),isNaN(h)||(f=h));p=new d(c.uniqueId,c.name,g,c.explodeMagnitude,c.cuttingData,f);
p.setLineVisibility(c.lineVisibility);p.setFaceVisibility(c.faceVisibility);void 0!==c.defaultVisibility&&void 0!==c.visibilityExceptions&&(p.setDefaultVisibility(c.defaultVisibility),k=new Set,c.visibilityExceptions.forEach(function(a){k.add(a)}),p.setVisibilityExceptions(k));r=new Map;m=c.colors;if(Array.isArray(m))for(n=0,q=m;n<q.length;n++)t=q[n],u=t[0],w=a.Color.fromJson(t[1]),r.set(u,w);p.setColorMap(r);z=[];console.assert(Array.isArray(c.markup));y=0;for(x=c.markup;y<x.length;y++)if(A=x[y],
B=a.Internal.classFromString(A.className))C=B.fromJson(A,b),C instanceof Promise?z.push(C.then(function(a){return p._handleLoadMarkupItem(a)})):z.push(Promise.resolve(p._handleLoadMarkupItem(C)));D=c.imageSrc;void 0!==D&&0<D.length&&(G=new Image,G.src=D,p.setSnapshotImage(G));return[4,Promise.all(z)];case 1:return E=I.sent(),[2,new e(p,E)]}})})};d.prototype.toJson=function(){var a={uniqueId:this._uniqueId,name:this._name,camera:this._camera.toJson(),cuttingData:this._cuttingPlaneData,explodeMagnitude:this._explodeMagnitude,
lineVisibility:this._lineVisibility,faceVisibility:this._faceVisibility,markup:[],sheetId:this._sheetId,defaultVisibility:this._defaultVisibility,visibilityExceptions:[],colors:[],imageSrc:""};this._markupItems.forEach(function(b){var d=b.toJson();d.className=b.getClassName();a.markup.push(d)});this._visibilityExceptions.forEach(function(b){a.visibilityExceptions.push(b)});this._colorMap.forEach(function(b,d){a.colors.push([d,b.toJson()])});null!==this._snapshotImage&&(a.imageSrc=this._snapshotImage.src);
return a};d.prototype.forJson=function(){return this.toJson()};return d}();h.MarkupView=f})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a,b,d,l,h,p){var k=e.call(this)||this;k._markupViews=new Map;k._defaultViewCounter=1;k._markupItemManager=b;k._callbackManager=d;k._explodeManager=l;k._cuttingManager=h;k._viewer=a;k._sheetManager=p;k._initEvents();return k}__extends(d,e);d.prototype._initEvents=function(){var a=this;this._callbackManager.bind({modelSwitchStart:function(){a._markupItemManager.shutdown()}})};d.prototype.getView=function(a){a=this._markupViews.get(a);return void 0!==
a?a:null};d.prototype.getViewKeys=function(){var a=[];this._markupViews.forEach(function(b,d){b;a.push(d)});return a};d.prototype.loadData=function(c){return __awaiter(this,void 0,void 0,function(){var b=this,d,e,f,p,k;return __generator(this,function(r){d=[];e=0;for(f=c;e<f.length;e++)p=f[e],k=a.Markup.MarkupView._construct(p,this._viewer).then(function(a){if(!h.all(a.itemResults))return!1;a=a.markupView;var c=a.getUniqueId();return b._markupViews.has(c)?!1:(b._markupViews.set(c,a),b._callbackManager.trigger("viewLoaded",
a),!0)}),d.push(k);return[2,Promise.all(d)]})})};d.prototype.exportMarkup=function(){var a=[];this._markupViews.forEach(function(b){a.push(b.toJson())});return a};d.prototype.createView=function(c,b,d,e,f,h){void 0===c&&(c=this._createDefaultViewName());void 0===b&&(b=!0);void 0===d&&(d=null);void 0===e&&(e=null);void 0===f&&(f=null);void 0===h&&(h=null);var k=this._viewer.view,r=a.GUID.create();c=new a.Markup.MarkupView(r,c,k.getCamera(),this._explodeManager.getMagnitude(),this._cuttingManager.toJson(),
d);this._markupViews.set(r,c);c.setLineVisibility(k.getLineVisibility());c.setFaceVisibility(k.getFaceVisibility());null!==e&&(c.setDefaultVisibility(e.defaultVisibility),c.setVisibilityExceptions(e.visibilityExceptions));null!==f&&c.setColorMap(f);null!==h&&c.setSnapshotImage(h);this._markupItemManager.setActiveView(c);b&&this._callbackManager.trigger("viewCreated",c);return c};d.prototype._activateSheet=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return null!==
a?[2,this._sheetManager.setActiveSheetId(a,!0,!1)]:[2]})})};d.prototype._activateViewImpl=function(a,b){return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return[4,this._activateSheet(a.getSheetId())];case 1:return e.sent(),d=this._viewer.view,d.setFaceVisibility(a.getFaceVisibility()),d.setLineVisibility(a.getLineVisibility()),0<b?[4,this._markupItemManager.setActiveView(null)]:[3,4];case 2:return e.sent(),[4,d._setCameraPromise(a.getCamera(),
b)];case 3:return e.sent(),[3,5];case 4:d.setCamera(a.getCamera()),e.label=5;case 5:return[4,this._setActiveView(a)];case 6:return e.sent(),[2]}})})};d.prototype._activateView=function(a,b){a=this._markupViews.get(a);return void 0!==a?(b=this._activateViewImpl(a,b),h.UnsafePromise.create(!0,b)):h.UnsafePromise.create(!1,Promise.resolve())};d.prototype.activateView=function(c,b){void 0===b&&(b=a.DefaultTransitionDuration);return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,
this._activateView(c,b)]})})};d.prototype.deprecatedActivateView=function(c,b){void 0===b&&(b=a.DefaultTransitionDuration);return this._activateView(c,b).unsafeValue};d.prototype._setActiveView=function(a){return __awaiter(this,void 0,void 0,function(){var b,d,e,f;return __generator(this,function(h){switch(h.label){case 0:return[4,this._markupItemManager.setActiveView(a)];case 1:return h.sent(),[4,this._cuttingManager.fromJson(a.getCuttingPlaneData())];case 2:return h.sent(),[4,this._viewer.model.setNodesColors(a.getColorMap())];
case 3:h.sent();b=a.getVisibilityExceptions();if(!(0<b.size))return[3,6];d=a.getDefaultVisibility();e=this._viewer.model.getAbsoluteRootNode();return[4,this._viewer.model.setNodesVisibility([e],d)];case 4:return h.sent(),f=[],b.forEach(function(a){f.push(a)}),[4,this._viewer.model.setNodesVisibility(f,!d)];case 5:h.sent(),h.label=6;case 6:return[2,this._explodeManager.setMagnitude(a.getExplodeMagnitude())]}})})};d.prototype.deleteView=function(a){var b=this._markupViews.get(a);return void 0!==b?(this._callbackManager.trigger("viewDeleted",
b),b===this._markupItemManager.getActiveView()&&this._markupItemManager.setActiveView(null),this._markupViews.delete(a),!0):!1};d.prototype._createDefaultViewName=function(){return"View "+this._defaultViewCounter++};d.prototype.toJson=function(){return this.exportMarkup()};d.prototype.forJson=function(){return this.toJson()};return d}(a.MarkupTypeManager);h.MarkupViewManager=e})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b,c,e,f,h){void 0===c&&(c=null);void 0===e&&(e=null);void 0===f&&(f=null);void 0===h&&(h=null);var k=d.call(this)||this;k._uniqueId=a.GUID.create();k._lineMeshId=null;k._lineMeshInstanceId=null;k._lineColor=a.Color.red();k._lineOpacity=1;k._viewer=b;k._firstPoint=c;k._secondPoint=e;k._firstNodeId=f;k._secondNodeId=h;return k}__extends(c,d);c.prototype.setLineColor=function(a){this._lineColor=a};c.prototype.getLineColor=function(){return this._lineColor};
c.prototype.setLineOpacity=function(a){this._lineOpacity=a};c.prototype.getLineOpacity=function(){return this._lineOpacity};c.prototype.setLinePattern=function(a,c,d){this._linePattern=a;this._linePatternLength=c;this._linePatternLengthUnit=d};c.prototype.getLinePattern=function(){return void 0!==this._linePattern?this._linePattern:null};c.prototype.getLinePatternLength=function(){return void 0!==this._linePatternLength?this._linePatternLength:null};c.prototype.getLinePatternLengthUnit=function(){return void 0!==
this._linePatternLengthUnit?this._linePatternLengthUnit:null};c.prototype.setFirstPoint=function(a){this._firstPoint=a};c.prototype.getFirstPoint=function(){return this._firstPoint};c.prototype.setSecondPoint=function(a){this._secondPoint=a};c.prototype.getSecondPoint=function(){return this._secondPoint};c.prototype.setFirstNodeId=function(a){this._firstNodeId=a};c.prototype.getFirstNodeId=function(){return this._firstNodeId};c.prototype.setSecondNodeId=function(a){this._secondNodeId=a};c.prototype.getSecondNodeId=
function(){return this._secondNodeId};c.prototype.getNodeId=function(){return this._lineMeshInstanceId};c.prototype.removeLine=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(c){switch(c.label){case 0:return a=this._viewer.model,null===this._lineMeshInstanceId?[3,3]:[4,a.deleteMeshInstances([this._lineMeshInstanceId])];case 1:return c.sent(),this._lineMeshInstanceId=null,null===this._lineMeshId?[3,3]:[4,a.deleteMeshes([this._lineMeshId])];case 2:c.sent(),
this._lineMeshId=null,c.label=3;case 3:return[2]}})})};c.prototype.updateLine=function(){return __awaiter(this,void 0,void 0,function(){var b,c,d,e,f;return __generator(this,function(h){switch(h.label){case 0:return[4,this.removeLine()];case 1:h.sent();if(null===this._firstPoint||null===this._secondPoint)return[3,4];b=new a.MeshData;b.addPolyline([this._firstPoint.x,this._firstPoint.y,this._firstPoint.z,this._secondPoint.x,this._secondPoint.y,this._secondPoint.z]);c=this._viewer.model;return[4,c.createMesh(b)];
case 2:return this._lineMeshId=d=h.sent(),e=new a.MeshInstanceData(d),e.setLineColor(this._lineColor),e.setLineOpacity(this._lineOpacity),e.setCreationFlags(a.MeshInstanceCreationFlags.ExcludeBounding),[4,c.createMeshInstance(e)];case 3:f=h.sent(),void 0!==this._linePattern&&c.setNodesLinePattern([f],this._linePattern,this._linePatternLength,this._linePatternLengthUnit),this._lineMeshInstanceId=f,h.label=4;case 4:return[2]}})})};c.prototype.getId=function(){return this._uniqueId};c.prototype.setId=
function(a){this._uniqueId=a};c.prototype.getClassName=function(){return c.className};c.prototype.toJson=function(){return{className:this.getClassName(),uniqueId:this._uniqueId,firstPoint:this.getFirstPoint(),secondPoint:this.getSecondPoint(),firstNodeId:this.getFirstNodeId(),secondNodeId:this.getSecondNodeId(),lineColor:this.getLineColor(),lineOpacity:this.getLineOpacity(),linePattern:this.getLinePattern(),linePatternLength:this.getLinePatternLength(),linePatternLengthUnit:this.getLinePatternLengthUnit()}};
c.fromJson=function(b,d){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(f){e=new c(d,a.Point3.fromJson(b.firstPoint),a.Point3.fromJson(b.secondPoint),b.firstNodeId,b.secondNodeId);e.setId(b.uniqueId);e.setLineColor(a.Color.fromJson(b.lineColor));e.setLineOpacity(b.lineOpacity);e.setLinePattern(b.linePattern,b.linePatternLength,b.linePatternLengthUnit);return[2,e]})})};c.className="Communicator.Markup.Line.LineMarkup";return c}(h.MarkupItem);e.LineMarkup=f})(h.Line||
(h.Line={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(a){var c=d.call(this)||this;c._stage=0;c._finalized=!1;c._uniqueId="";c._positions=[];c._name="";c._measurementValue=0;c._unitMultiplier=1;c._textShape=new h.Shape.TextBox;c._visibility=!0;c._positions=[];c._lineShapes=[];c._viewer=a;return c}__extends(c,d);c.prototype.getName=function(){return this._name};c.prototype.setName=function(a){this._name=a};c.prototype._getStage=function(){return this._stage};c.prototype._nextStage=function(){this._stage++};
c.prototype._setId=function(a){this._uniqueId=a};c.prototype._getId=function(){return this._uniqueId};c.prototype.adjust=function(a){a};c.prototype._isFinalized=function(){return this._finalized};c.prototype.update=function(){};c.prototype.draw=function(){this.update()};c.prototype.setVisibility=function(a){this._visibility=a;this.draw();var c=this._viewer._getCallbackManager();a?c.trigger("measurementShown",this):c.trigger("measurementHidden",this)};c.prototype.getVisibility=function(){return this._visibility};
c.prototype.toJson=function(){return{}};c.prototype.forJson=function(){return this.toJson()};c.prototype.getMeasurementValue=function(){return this._measurementValue};c.prototype.getUnitMultiplier=function(){return this._unitMultiplier};c.prototype.setMeasurementText=function(a){this._textShape.setTextString(a)};c.prototype.getMeasurementText=function(){return this._textShape.getTextString()};c.prototype._setMeasurementValue=function(b){this._measurementValue=b/this._unitMultiplier;this.setMeasurementText(a.Util.formatWithUnit(this._measurementValue,
this._unitMultiplier));this._viewer.trigger("measurementValueSet",this)};c._serializePointArray=function(a){for(var c=[],d=0;d<a.length;d++)c.push(a[d].toJson());return c};c._constructPointArray=function(b){for(var c=[],d=0;d<b.length;d++){var e=a.Point3.fromJson(b[d]);c.push(e)}return c};return c}(h.MarkupItem);e.MeasureMarkup=f})(h.Measure||(h.Measure={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(e){var f=function(d){function c(b){var c=d.call(this,b)||this;c._lineEdgeShape=new a.Shape.Polyline;c._linePositions=[];c._name="MeasureLength";c._positions=[];c._lineShapes=[];c._lineEdgeShape.setStrokeWidth(4);c._lineEdgeShape.setStrokeColor(b.measureManager.getMeasurementEdgeColor());return c}__extends(c,d);c.prototype.setLineGeometry=function(a){this._lineEdgeShape.setStrokeColor(this._viewer.measureManager.getMeasurementEdgeColor());this._linePositions=a;this._stage=
1};c.prototype.reset=function(){this._stage=0};c.prototype.adjust=function(a){d.prototype.adjust.call(this,a)};c.prototype.update=function(){d.prototype.update.call(this);var a=this._viewer.measureManager,c=a.getMeasurementColor(),a=a.getMeasurementEdgeColor();this._lineShapes.forEach(function(a){a.setStrokeColor(c)});this._lineEdgeShape.setStrokeColor(a)};c.prototype.draw=function(){};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureLengthMarkup"};return c}(e.MeasureMarkup);
e.MeasureLengthMarkup=f})(a.Measure||(a.Measure={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b,c,e,f){var p=d.call(this,b)||this;p._circlePoints=[];p._radius=0;p._surfaceCenter=a.Point3.zero();p._surfaceAxis1=a.Point3.zero();p._surfaceAxis2=a.Point3.zero();p._circlePlane=new a.Plane;p._arrowsInvert=!1;p._name="MeasureCircleEdgeLength";p._lineProperties=c;p._matrix=e.copy();p._unitMultiplier=f;p._textShape.getBoxPortion().setFillOpacity(1);p._textShape.getBoxPortion().setFillColor(new a.Color(255,255,255));for(c=0;5>c;c++)p._lineShapes.push(new h.Shape.Line),
p._lineShapes[c].setStrokeColor(b.measureManager.getMeasurementColor());return p}__extends(c,d);c.prototype.createCircleData=function(){a.Util.generatePointsOnCircle(this._circlePoints,this._lineProperties.origin,this._lineProperties.radius,32,this._lineProperties.normal);this._matrix.transformArray(this._circlePoints,this._circlePoints);this._positions[0]=this._circlePoints[0].copy();this._positions[1]=this._circlePoints[16].copy();var b=new a.Point3(this._lineProperties.radius,0,0),c=new a.Point3(0,
0,0);this._matrix.transform(b,b);this._matrix.transform(c,c);this._radius=a.Point3.subtract(c,b).length();a.Point3.subtract(this._positions[1],this._positions[0]);this._positions[4]=this._positions[1].copy();this._surfaceCenter=this._matrix.transform(this._lineProperties.origin);b=new a.Point3(this._lineProperties.origin.x+this._lineProperties.normal.x,this._lineProperties.origin.y+this._lineProperties.normal.y,this._lineProperties.origin.z+this._lineProperties.normal.z);this._surfaceAxis1=this._matrix.transform(b);
b.set(this._lineProperties.origin.x-this._lineProperties.normal.x,this._lineProperties.origin.y-this._lineProperties.normal.y,this._lineProperties.origin.z-this._lineProperties.normal.z);this._surfaceAxis2=this._matrix.transform(b);b=new a.Point3(this._circlePoints[0].x,this._circlePoints[0].y,this._circlePoints[0].z);c=new a.Point3(this._circlePoints[1].x,this._circlePoints[1].y,this._circlePoints[1].z);this._circlePlane=a.Plane.createFromPoints(b,c,this._surfaceCenter)};c.prototype.setLineGeometry=
function(a){d.prototype.setLineGeometry.call(this,a);this._positions[0]=this._linePositions[0];this._positions[0].equals(this._positions[this._positions.length-1])?this._positions[1]=this._positions[Math.floor(this._positions.length/2)]:this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[1]=this._linePositions[this._linePositions.length-1];this._positions[2]=this._linePositions[1].copy();this.createCircleData();this._setMeasurementValue(this._radius)};c.prototype.adjust=
function(b){d.prototype.adjust.call(this,b);var c=this._viewer.view.raycastFromPoint(b);if(null!==c){b=this._surfaceCenter;var e=this._circlePlane,f=e.rayIntersection(c);null===f&&(f=a.Point3.add(b,c.direction.copy().scale(-2*this._radius)),f=a.Plane.createFromPointAndNormal(f,c.direction).rayIntersection(c),console.assert(null!==f),c=new a.Ray(f,e.normal),f=e.rayIntersection(c),null===f&&(f=e.rayIntersection(c.negate())));null===f&&(console.assert(!1),f=b.copy());c=a.Point3.subtract(f,b).normalize().scale(this._radius);
e=a.Point3.add(b,c);b=a.Point3.subtract(b,c);this._positions[0]=e;this._positions[1]=b;this._positions[2]=e.copy();this._positions[3]=b.copy();this._positions[4]=f.copy();this._positions[5]=this._surfaceCenter.copy();this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new a.Point3((this._positions[4].x+this._positions[5].x)/2,(this._positions[4].y+this._positions[5].y)/2,(this._positions[4].z+this._positions[5].z)/2),c=a.Point3.subtract(this._positions[5],
this._positions[4]);this._arrowsInvert=2*a.Point3.subtract(this._positions[2],b).length()>c.length()};c.prototype.update=function(){d.prototype.update.call(this);var b=this._viewer.view;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=0,e=this._linePositions;c<e.length;c++){var f=a.Point2.fromPoint3(b.projectPoint(e[c]));this._lineEdgeShape.pushPoint(f)}}if(1<this._stage){c=Array(6);for(e=0;e<this._positions.length;e++)c[e]=a.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._textShape&&
this._textShape.setPosition(c[4]);this._lineShapes[0].set(c[5],c[2]);this._lineShapes[1].set(c[5],c[4]);b=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.None);this._lineShapes[0].setEndcapsInverted(this._arrowsInvert);this._lineShapes[0].setEndEndcapColor(b);this._lineShapes[0].setStartEndcapColor(b)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()){this.update();
var a=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:a.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var c=0;2>c;c++)a.drawLine(this._lineShapes[c]);a.drawTextBox(this._textShape);a.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){var a=e.MeasureMarkup._serializePointArray(this._linePositions),c=e.MeasureMarkup._serializePointArray(this._positions);return{matrix:this._matrix.toJson(),lineOrigin:this._lineProperties.origin,lineRadius:this._lineProperties.radius,
lineNormal:this._lineProperties.normal,linePositions:a,positions:c,text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,d){var f=a.Matrix.fromJson(b.matrix),h=b.lineRadius,p=a.Point3.fromJson(b.lineOrigin),k=a.Point3.fromJson(b.lineNormal),h=new a.SubentityProperties.CircleElement(h,p,k);d=new c(d,h,f,b.unitMultiplier||1);f=e.MeasureMarkup._constructPointArray(b.linePositions);
h=e.MeasureMarkup._constructPointArray(b.positions);d.setLineGeometry(f);d._positions=h;d._textShape.setTextString(b.text);d._stage=3;d._measurementValue=b.measurementValue;return d};c.construct=function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureCircleEdgeLengthMarkup"};return c}(e.MeasureLengthMarkup);e.MeasureCircleEdgeLengthMarkup=f})(h.Measure||(h.Measure={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b){b=d.call(this,b)||this;b._faceSelection=[];b._arcArray=[];b._lineGeometryShape=new h.Shape.Polyline;b.planeIntersectionLine=[];b._pointOnLine=a.Point3.zero();b._plane1=new a.Plane;b._plane2=new a.Plane;b._secondPoint=a.Point3.zero();b._firstPoint=a.Point3.zero();b._textPos=a.Point3.zero();b._intermediatePoint=a.Point3.zero();b._textAnchorPoint=a.Point3.zero();b._name="MeasureFaceFaceAngle";b._lineGeometryShape.setStrokeWidth(2);
b._lineGeometryShape.setStrokeColor(b._viewer.measureManager.getMeasurementColor());b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new a.Color(255,255,255));for(var c=0;5>c;c++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[c].setStrokeColor(b._viewer.measureManager.getMeasurementColor());return b}__extends(c,d);c.prototype.getFirstSelection=function(){return this._faceSelection[0]};c.prototype.setFirstFace=function(b){this._viewer.model.setNodeFaceColor(b.getNodeId(),
b.getFaceEntity().getCadFaceIndex(),new a.Color(255,0,0));this._faceSelection.push(b);this._firstPoint=this._faceSelection[0].getPosition().copy();this._plane1.setFromPointAndNormal(b.getPosition(),b.getFaceEntity().getNormal());this._clickpointOriginal1=this._firstPoint.copy();this._stage++};c.prototype.setSecondFace=function(b){this._faceSelection[1]=b;this._secondPoint=this._faceSelection[1].getPosition().copy();this._viewer.model.setNodeFaceColor(b.getNodeId(),b.getFaceEntity().getCadFaceIndex(),
new a.Color(255,0,0));this._plane2.setFromPointAndNormal(b.getPosition(),b.getFaceEntity().getNormal());this.planeIntersectionLine[0]=new a.Point3(0,0,0);this.planeIntersectionLine[1]=new a.Point3(0,0,0);if(2!==a.Util.intersect3d2Planes(this._plane1,this._firstPoint,this._plane2,this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1]))return!1;b=a.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);b.normalize();this.planeIntersectionLine[0].set(this.planeIntersectionLine[0].x-
100*b.x,this.planeIntersectionLine[0].y-100*b.y,this.planeIntersectionLine[0].z-100*b.z);this.planeIntersectionLine[1].set(this.planeIntersectionLine[1].x+100*b.x,this.planeIntersectionLine[1].y+100*b.y,this.planeIntersectionLine[1].z+100*b.z);a.Util.computePointToLineDistance(this._secondPoint,this.planeIntersectionLine[0],this.planeIntersectionLine[1],this._pointOnLine);var c=new a.Point3(0,0,0),d=new a.Point3(0,0,0);c.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z);a.Util.computePointToLineDistance(this._pointOnLine,
this._firstPoint,c,d);this._firstPoint=d.copy();this._clickpointOriginal2=this._secondPoint.copy();var c=new a.Matrix,d=a.Point3.subtract(this._secondPoint,this._pointOnLine),e=d.length(),f=a.Point3.subtract(this._firstPoint,this._pointOnLine);f.normalize();this._intermediatePoint.set(this._pointOnLine.x+f.x*e,this._pointOnLine.y+f.y*e,this._pointOnLine.z+f.z*e);this._angle=a.Util.computeAngleBetweenVector(d,f);if(0===this._angle)return!1;this._measurementValue=this._angle;this._textShape.setTextString(this._measurementValue.toFixed(2)+
"\u00b0");this._viewer.trigger("measurementValueSet",this);this._textPos=this._pointOnLine.copy();var e=!1,h=new a.Point3(0,0,0),f=new a.Point3(0,0,0);a.Util.computeOffaxisRotation(b,1,c);c.transform(d,f);h.set(f.x+this._pointOnLine.x,f.y+this._pointOnLine.y,f.z+this._pointOnLine.z);var h=a.Point3.subtract(h,this._firstPoint),r=h.length();a.Util.computeOffaxisRotation(b,-1,c);c.transform(d,f);h.set(f.x+this._pointOnLine.x,f.y+this._pointOnLine.y,f.z+this._pointOnLine.z);a.Point3.subtract(h,this._firstPoint);
h.length()<r&&(e=!0);h=this._angle/30;for(r=0;r<=this._angle;r+=h)e?a.Util.computeOffaxisRotation(b,-r,c):a.Util.computeOffaxisRotation(b,r,c),c.transform(d,f),this._arcArray.push(new a.Point3(f.x+this._pointOnLine.x,f.y+this._pointOnLine.y,f.z+this._pointOnLine.z));this._stage++;return!0};c.prototype.adjust=function(b){d.prototype.adjust.call(this,b);if(!(1>=this._stage)&&(b=this._viewer.view.raycastFromPoint(b),null!==b)){var c=new a.Point3(b.origin.x+1E6*b.direction.x,b.origin.y+1E6*b.direction.y,
b.origin.z+1E6*b.direction.z),e=new a.Point3(0,0,0);a.Util.intersectionPlaneLine(b.origin,c,this._pointOnLine,this._firstPoint,this._secondPoint,e);this._textPos=e.copy();new a.Point3(0,0,0);b=a.Point3.subtract(e,this._pointOnLine);c=b.length();b=a.Point3.subtract(this._secondPoint,this._pointOnLine);b.normalize();this._secondPoint.set(this._pointOnLine.x+b.x*c,this._pointOnLine.y+b.y*c,this._pointOnLine.z+b.z*c);b=a.Point3.subtract(this.planeIntersectionLine[1],this.planeIntersectionLine[0]);b.normalize();
var c=new a.Matrix,e=a.Point3.subtract(this._secondPoint,this._pointOnLine),f=e.length(),h=a.Point3.subtract(this._firstPoint,this._pointOnLine);h.normalize();this._intermediatePoint.set(this._pointOnLine.x+h.x*f,this._pointOnLine.y+h.y*f,this._pointOnLine.z+h.z*f);var h=!1,f=new a.Point3(0,0,0),k=new a.Point3(0,0,0);a.Util.computeOffaxisRotation(b,1,c);c.transform(e,k);f.set(k.x+this._pointOnLine.x,k.y+this._pointOnLine.y,k.z+this._pointOnLine.z);var f=a.Point3.subtract(f,this._firstPoint),r=f.length();
a.Util.computeOffaxisRotation(b,-1,c);c.transform(e,k);f.set(k.x+this._pointOnLine.x,k.y+this._pointOnLine.y,k.z+this._pointOnLine.z);f=a.Point3.subtract(f,this._firstPoint);f.length()<r&&(h=!0);r=99999;f=this._viewer.view.projectPoint(this._textPos);this._arcArray=[];for(var m=this._angle/30,n=0;n<=this._angle;n+=m){h?a.Util.computeOffaxisRotation(b,-n,c):a.Util.computeOffaxisRotation(b,n,c);c.transform(e,k);var q=new a.Point3(k.x+this._pointOnLine.x,k.y+this._pointOnLine.y,k.z+this._pointOnLine.z),
q=this._viewer.view.projectPoint(q),q=(new a.Point3(f.x-q.x,f.y-q.y,f.z-q.z)).length();r>q&&(r=q);this._arcArray.push(new a.Point3(k.x+this._pointOnLine.x,k.y+this._pointOnLine.y,k.z+this._pointOnLine.z))}20>=r?this._textAnchorPoint=this._textPos:(c=this._viewer.view.projectPoint(this._intermediatePoint),b=this._viewer.view.projectPoint(this._secondPoint),c=new a.Point3(c.x-f.x,c.y-f.y,c.z-f.z),b=new a.Point3(b.x-f.x,b.y-f.y,b.z-f.z),c=c.length(),b=b.length(),this._textAnchorPoint=c<b?this._intermediatePoint:
this._secondPoint)}};c.prototype._nextStage=function(){this._stage++;2<this._stage&&(this._finalized=!0,this.cleanup())};c.prototype.cleanup=function(){var a=this,c=function(c){c=a._faceSelection[c];a._viewer.model.unsetNodeFaceColor(c.getNodeId(),c.getFaceEntity().getCadFaceIndex())};2<=this._stage&&c(1);1<=this._stage&&c(0)};c.prototype.update=function(){d.prototype.update.call(this);var b=this._viewer.view;if(1<this._stage){this._lineGeometryShape.clearPoints();for(var c=0,e=this._arcArray;c<e.length;c++)this._lineGeometryShape.pushPoint(a.Point2.fromPoint3(b.projectPoint(e[c])));
this._lineGeometryShape.setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineGeometryShape.setEndEndcapSize(5);this._lineGeometryShape.setStartEndcapSize(5);this._lineGeometryShape.setEndEndcapColor(this._viewer.measureManager.getMeasurementColor());this._lineGeometryShape.setStartEndcapColor(this._viewer.measureManager.getMeasurementColor());c=Array(10);c[0]=b.projectPoint(this._textPos);c[1]=b.projectPoint(this._firstPoint);
c[2]=b.projectPoint(this._clickpointOriginal1);c[3]=b.projectPoint(this._secondPoint);c[4]=b.projectPoint(this._clickpointOriginal2);c[5]=b.projectPoint(this._intermediatePoint);c[6]=b.projectPoint(this._textAnchorPoint);this._behindView=!1;b=Array(10);for(e=0;6>=e;e++)0>=c[e].z&&(this._behindView=!0),b[e]=a.Point2.fromPoint3(c[e]);this._textShape&&this._textShape.setPosition(b[0]);this._lineShapes[0].set(b[1],b[2]);this._lineShapes[1].set(b[1],b[5]);this._lineShapes[2].set(b[3],b[4]);this._lineShapes[3].set(b[6],
b[0])}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var a=this._viewer.markupManager.getRenderer();switch(this._stage){case 2:case 3:case 4:for(var c=0;4>c;c++)a.drawLine(this._lineShapes[c]);a.drawTextBox(this._textShape);a.drawPolyline(this._lineGeometryShape)}}};c.prototype.toJson=function(){for(var a=[],c=0,d=this._arcArray;c<d.length;c++){var e=d[c].toJson();a.push(e)}return{text:this._textShape.getTextString(),
textPos:this._textPos.toJson(),arcArray:a,firstPoint:this._firstPoint.toJson(),clickpointOriginal1:this._clickpointOriginal1.toJson(),secondPoint:this._secondPoint.toJson(),clickpointOriginal2:this._clickpointOriginal2.toJson(),intermediatePoint:this._intermediatePoint.toJson(),textAnchorPoint:this._textAnchorPoint.toJson(),measurementValue:this._measurementValue,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,d){d=new c(d);for(var e=0,f=
b.arcArray;e<f.length;e++){var h=a.Point3.fromJson(f[e]);d._arcArray.push(h)}d._textShape.setTextString(b.text);d._textPos.assign(b.textPos);d._firstPoint.assign(b.firstPoint);d._clickpointOriginal1=a.Point3.fromJson(b.clickpointOriginal1);d._secondPoint.assign(b.secondPoint);d._clickpointOriginal2=a.Point3.fromJson(b.clickpointOriginal2);d._intermediatePoint.assign(b.intermediatePoint);d._textAnchorPoint.assign(b.textAnchorPoint);d._measurementValue=b.measurementValue;d._stage=3;return d};c.construct=
function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceAngleMarkup"};return c}(e.MeasureMarkup);e.MeasureFaceFaceAngleMarkup=f})(h.Measure||(h.Measure={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b){b=d.call(this,b)||this;b._faceSelection=[];b._line1PreviewShape1=new h.Shape.Line;b._line1PreviewShape2=new h.Shape.Line;b._line2PreviewShape1=new h.Shape.Line;b._line2PreviewShape2=new h.Shape.Line;b._matrix1=new a.Matrix;b._matrix2=new a.Matrix;b._lineGeometryShape=new h.Shape.Polyline;b._parallelFaces=!1;b._triangulatedDistance=!0;b._pointsOnSameRay=!1;b._arrowsInvert=!1;b._faceData=[];b._distance=0;b._surfaceCenter=[a.Point3.zero(),
a.Point3.zero()];b._surfaceAxis1=[a.Point3.zero(),a.Point3.zero()];b._surfaceAxis2=[a.Point3.zero(),a.Point3.zero()];b._cylinderAxisInfinite1=[a.Point3.zero(),a.Point3.zero()];b._cylinderAxisInfinite2=[a.Point3.zero(),a.Point3.zero()];b._firstPointHelper=a.Point3.zero();b._secondPointHelper=a.Point3.zero();b._secondPoint=a.Point3.zero();b._firstPoint=a.Point3.zero();b._textPos=a.Point3.zero();b._name="MeasureFaceFaceDistance";b._lineGeometryShape.setStrokeWidth(2);b._lineGeometryShape.setStrokeColor(b._viewer.measureManager.getMeasurementColor());
b._textShape=new h.Shape.TextBox;b._textShape.getBoxPortion().setFillOpacity(1);b._textShape.getBoxPortion().setFillColor(new a.Color(255,255,255));for(var c=0;5>c;c++)b._lineShapes.push(new h.Shape.Line),b._lineShapes[c].setStrokeColor(b._viewer.measureManager.getMeasurementColor());return b}__extends(c,d);c.prototype.setUnitMultiplier=function(a){this._unitMultiplier=a};c.prototype.setFirstFace=function(b,c,d,e){var f=b.getNodeId(),h=b.getFaceEntity(),r=b.getPosition();this._matrix1=d.copy();this._viewer.model.setNodeFaceColor(f,
h.getCadFaceIndex(),new a.Color(255,0,0));this._faceSelection[0]=b;this._firstPoint=r.copy();this._faceData[0]=c;this._faceData[0]instanceof a.SubentityProperties.PlaneElement?(b=this._faceData[0],c=new a.Point3(b.origin.x+b.normal.x,b.origin.y+b.normal.y,b.origin.z+b.normal.z),this._matrix1.transform(c,this._surfaceAxis1[0]),this._matrix1.transform(b.origin,this._surfaceCenter[0])):this._faceData[0]instanceof a.SubentityProperties.CylinderElement&&this.createCylinderData(this._faceData[0],d,e);this._stage++};
c.prototype.getFirstSelection=function(){return this._faceSelection[0]||null};c.prototype.getFirstFaceData=function(){return this._faceData[0]||null};c.prototype.cleanup=function(){var a=this._viewer.model;2<=this._stage&&a.unsetNodeFaceColor(this._faceSelection[1].getNodeId(),this._faceSelection[1].getFaceEntity().getCadFaceIndex());1<=this._stage&&a.unsetNodeFaceColor(this._faceSelection[0].getNodeId(),this._faceSelection[0].getFaceEntity().getCadFaceIndex())};c.prototype.createCylinderData=function(b,
c,d){d=a.Point3.subtract(d.max,d.min).length()/4;var e=new a.Point3(b.origin.x+1E4*b.normal.x,b.origin.y+1E4*b.normal.y,b.origin.z+1E4*b.normal.z),f=new a.Point3(b.origin.x-1E4*b.normal.x,b.origin.y-1E4*b.normal.y,b.origin.z-1E4*b.normal.z),h=new a.Point3(0,0,0);a.Util.computePointToLineDistance(b.origin,e,f,h);this._surfaceCenter[this._stage]=new a.Point3(0,0,0);c.transform(h,this._surfaceCenter[this._stage]);e=new a.Point3(h.x+b.normal.x,h.y+b.normal.y,h.z+b.normal.z);this._surfaceAxis1[this._stage]=
new a.Point3(0,0,0);c.transform(e,this._surfaceAxis1[this._stage]);e.set(h.x-b.normal.x,h.y-b.normal.y,h.z-b.normal.z);this._surfaceAxis2[this._stage]=new a.Point3(0,0,0);c.transform(e,this._surfaceAxis2[this._stage]);new a.Point3(0,0,0);b=this._surfaceAxis1[this._stage].copy();b=a.Point3.subtract(b,this._surfaceCenter[this._stage]);b.normalize();this._surfaceAxis1[this._stage].set(this._surfaceCenter[this._stage].x+b.x*d,this._surfaceCenter[this._stage].y+b.y*d,this._surfaceCenter[this._stage].z+
b.z*d);this._surfaceAxis2[this._stage].set(this._surfaceCenter[this._stage].x-b.x*d,this._surfaceCenter[this._stage].y-b.y*d,this._surfaceCenter[this._stage].z-b.z*d);this._cylinderAxisInfinite1[this._stage]=new a.Point3(this._surfaceCenter[this._stage].x+b.x*d*1E3,this._surfaceCenter[this._stage].y+b.y*d*1E3,this._surfaceCenter[this._stage].z+b.z*d*1E3);this._cylinderAxisInfinite2[this._stage]=new a.Point3(this._surfaceCenter[this._stage].x-b.x*d*1E3,this._surfaceCenter[this._stage].y-b.y*d*1E3,
this._surfaceCenter[this._stage].z-b.z*d*1E3)};c.prototype.setSecondFace=function(b,c,d,e,f){return __awaiter(this,void 0,void 0,function(){var h,r,m,n,q,t,u,w,z,y,x,A,B,C,D,G,E,I,F,K,L,H,M;return __generator(this,function(J){switch(J.label){case 0:h=this._faceSelection[0];r=this._faceData[0];if(void 0===h||void 0===r)throw new a.CommunicatorError("setSecondFace() called before setFirstFace()");if(d instanceof a.SubentityProperties.PlaneElement)m=r,n=new a.Point3(m.origin.x+m.normal.x,m.origin.y+
m.normal.y,m.origin.z+m.normal.z),this._matrix1.transform(n,this._surfaceAxis1[0]),this._matrix1.transform(m.origin,this._surfaceCenter[0]);else if(d instanceof a.SubentityProperties.CylinderElement)this.createCylinderData(d,e,f);else return[2];return[4,this._viewer.model.computeMinimumFaceFaceDistance(h.getNodeId(),h.getFaceEntity().getCadFaceIndex(),c.getNodeId(),c.getFaceEntity().getCadFaceIndex())];case 1:q=J.sent();if(0===q.distance)return[2];this._matrix2=e.copy();this._secondPoint=c.getPosition().copy();
if(!(r instanceof a.SubentityProperties.PlaneElement&&d instanceof a.SubentityProperties.PlaneElement))return[3,2];t=d;n=new a.Point3(t.origin.x+t.normal.x,t.origin.y+t.normal.y,t.origin.z+t.normal.z);this._matrix2.transform(n,this._surfaceAxis1[1]);this._matrix2.transform(t.origin,this._surfaceCenter[1]);u=new a.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);w=new a.Point3(this._surfaceAxis1[1].x-
this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);u.normalize();w.normalize();z=new a.Point3(-u.x,-u.y,-u.z);u.equalsWithTolerance(w,1E-5)||z.equalsWithTolerance(w,1E-5)?(this._secondPointHelper=new a.Point3(this._secondPoint.x,this._secondPoint.y,this._secondPoint.z),this._firstPointHelper=new a.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z),y=new a.Plane,y.setFromPointAndNormal(this._surfaceCenter[0],u),
x=new a.Plane,x.setFromPointAndNormal(this._surfaceCenter[1],w),A=new a.Point3(this._firstPoint.x+u.x,this._firstPoint.y+u.y,this._firstPoint.z+u.z),a.Util.intersectionPlaneLine2(h.getPosition(),A,x,this._secondPoint),z.equalsWithTolerance(w,1E-5)&&(B=new a.Point3(-u.x,-u.y,-u.z),y.setFromPointAndNormal(this._surfaceCenter[0],B)),this._distance=C=Math.abs(x.d-y.d)/y.normal.length(),this._setMeasurementValue(this._distance),this._parallelFaces=!0,this._triangulatedDistance=!1,D=new a.Point3(0,1,0),
G=a.Point3.subtract(this._secondPoint,this._firstPoint),E=new a.Point3(0,0,0),E=a.Point3.subtract(this._secondPointHelper,this._firstPoint),I=a.Util.computeAngleBetweenVector(D,G),F=a.Util.computeAngleBetweenVector(D,E),this._textPos.assign(this._secondPoint),.1>I-F&&-.1<I-F&&(this._pointsOnSameRay=!0)):(this._firstPoint.assign(q.pos1),this._secondPoint.assign(q.pos2),this._textPos.assign(q.pos2),this._distance=q.distance,this._setMeasurementValue(this._distance));return[3,8];case 2:if(!(r instanceof
a.SubentityProperties.CylinderElement&&d instanceof a.SubentityProperties.CylinderElement))return[3,3];u=new a.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);w=new a.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,this._surfaceAxis1[1].z-this._surfaceCenter[1].z);u.normalize();w.normalize();z=new a.Point3(-u.x,-u.y,-u.z);if(u.equalsWithTolerance(w,
1E-5)||z.equalsWithTolerance(w,1E-5)){K=new a.Point3(0,0,0);a.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],K);this._firstPoint=K.copy();L=new a.Point3(this._firstPoint.x,this._firstPoint.y,this._firstPoint.z);L=a.Point3.subtract(L,this._surfaceCenter[0]);L.set(0,0,0);a.Util.computePointToLineDistance(this._firstPoint,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],K);this._secondPoint=K.copy();C=a.Point3.subtract(this._secondPoint,
this._firstPoint).length();if(1E-7>C)return[2];this._triangulatedDistance=!1;this._textPos.assign(this._secondPoint);this._setMeasurementValue(C)}else{this._distance=a.Util.distanceLineLine(this._cylinderAxisInfinite1[0],this._cylinderAxisInfinite2[0],this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],this._firstPoint,this._secondPoint);if(1E-7>this._distance)return[2];this._textPos.assign(this._firstPoint);this._setMeasurementValue(this._distance)}return[3,8];case 3:if(!(r instanceof a.SubentityProperties.CylinderElement&&
d instanceof a.SubentityProperties.PlaneElement))return[3,5];u=new a.Point3(this._surfaceAxis1[0].x-this._surfaceCenter[0].x,this._surfaceAxis1[0].y-this._surfaceCenter[0].y,this._surfaceAxis1[0].z-this._surfaceCenter[0].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(c.getNodeId(),c.getFaceEntity().getCadFaceIndex(),new a.Ray(this._surfaceCenter[0],u))];case 4:H=J.sent();this._distance=H.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(H.pos1);this._secondPoint.assign(H.pos2);
this._textPos.assign(H.pos2);this._viewer.model.setNodeFaceColor(c.getNodeId(),c.getFaceEntity().getCadFaceIndex(),new a.Color(255,0,0));this._faceData[1]=d;this._faceSelection[1]=c;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 5:if(!(r instanceof a.SubentityProperties.PlaneElement&&d instanceof a.SubentityProperties.CylinderElement))return[3,7];u=new a.Point3(this._surfaceAxis1[1].x-this._surfaceCenter[1].x,this._surfaceAxis1[1].y-this._surfaceCenter[1].y,
this._surfaceAxis1[1].z-this._surfaceCenter[1].z);return[4,this._viewer.model.computeMinimumFaceLineDistance(h.getNodeId(),h.getFaceEntity().getCadFaceIndex(),new a.Ray(this._surfaceCenter[1],u))];case 6:H=J.sent();this._distance=H.distance;if(1E-7>this._distance)return[2];this._firstPoint.assign(H.pos1);this._secondPoint.assign(H.pos2);this._textPos.assign(H.pos2);this._viewer.model.setNodeFaceColor(c.getNodeId(),c.getFaceEntity().getCadFaceIndex(),new a.Color(255,0,0));this._faceData[1]=d;this._faceSelection[1]=
c;this._stage++;this.adjust(b);this._setMeasurementValue(this._distance);return[3,8];case 7:this._firstPoint.assign(q.pos1);this._secondPoint.assign(q.pos2);this._textPos.assign(q.pos2);this._distance=q.distance;if(1E-7>this._distance)return[2];this._setMeasurementValue(this._distance);J.label=8;case 8:return M=this._viewer.model.setNodeFaceColor(c.getNodeId(),c.getFaceEntity().getCadFaceIndex(),new a.Color(255,0,0)),this._faceData[1]=d,this._faceSelection[1]=c,this._stage++,this.adjust(b),[2,M]}})})};
c.prototype.adjust=function(b){d.prototype.adjust.call(this,b);if(!(1>=this._stage)){var c=this._viewer.view.raycastFromPoint(b);if(null!==c){var e=new a.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z),f=a.Util.oneVectorCross(c.direction),h;new a.Point3(0,0,0);h=a.Point3.cross(c.direction,f);h.normalize();var k;new a.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2);
k=this._textPos.copy();f.set(k.x+f.x,k.y+f.y,k.z+f.z);h.set(k.x+h.x,k.y+h.y,k.z+h.z);b=new a.Point3(0,0,0);a.Util.intersectionPlaneLine(c.origin,e,k,f,h,b);2===this._stage?a.Util.computePointToLineDistance(b,this._firstPoint,this._secondPoint,this._textPos):this._parallelFaces||this._triangulatedDistance?(c=new a.Point3(0,0,0),this._pointsOnSameRay||(a.Util.computePointToLineDistance(b,this._secondPoint,this._secondPointHelper,c),new a.Point3(0,0,0),b=a.Point3.subtract(c,this._secondPoint),this._secondPoint=
c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+b.x,this._textPos.y+b.y,this._textPos.z+b.z))):(c=new a.Point3(0,0,0),a.Util.computePointToLineDistance(b,this._cylinderAxisInfinite1[1],this._cylinderAxisInfinite2[1],c),b=a.Point3.subtract(c,this._secondPoint),this._secondPoint=c.copy(),this._firstPoint.set(this._firstPoint.x+b.x,this._firstPoint.y+b.y,this._firstPoint.z+b.z),this._textPos.set(this._textPos.x+b.x,
this._textPos.y+b.y,this._textPos.z+b.z));this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}}};c.prototype._updateArrowsInverted=function(){var b=new a.Point3((this._firstPoint.x+this._secondPoint.x)/2,(this._firstPoint.y+this._secondPoint.y)/2,(this._firstPoint.z+this._secondPoint.z)/2),c=a.Point3.subtract(this._secondPoint,this._firstPoint);2*a.Point3.subtract(this._textPos,b).length()>c.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype._nextStage=function(){this._stage++;
if(3<this._stage||2<this._stage&&this._triangulatedDistance)this._finalized=!0,this.cleanup()};c.prototype.update=function(){d.prototype.update.call(this);var b=this._viewer.view;this._behindView=!1;if(0!==this._stage){for(var c=Array(10),e=[],f=0;10>f;f++)e.push(new a.Point3(0,0,0));this._faceData[0]instanceof a.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[0]),e[1]=b.projectPoint(this._surfaceAxis1[0]),e[2]=b.projectPoint(this._surfaceAxis2[0]),c[0]=a.Point2.fromPoint3(e[0]),
c[1]=a.Point2.fromPoint3(e[1]),c[2]=a.Point2.fromPoint3(e[2]),this._line1PreviewShape1.set(c[0],c[1]),this._line1PreviewShape2.set(c[0],c[2]));1<this._stage&&this._faceData[1]instanceof a.SubentityProperties.CylinderElement&&(e[0]=b.projectPoint(this._surfaceCenter[1]),e[1]=b.projectPoint(this._surfaceAxis1[1]),e[2]=b.projectPoint(this._surfaceAxis2[1]),c[0]=a.Point2.fromPoint3(e[0]),c[1]=a.Point2.fromPoint3(e[1]),c[2]=a.Point2.fromPoint3(e[2]),this._line2PreviewShape1.set(c[0],c[1]),this._line2PreviewShape2.set(c[0],
c[2]));1<this._stage&&(e[0]=b.projectPoint(this._textPos),e[1]=b.projectPoint(this._firstPoint),e[2]=b.projectPoint(this._secondPoint),c[0]=a.Point2.fromPoint3(e[0]),c[1]=a.Point2.fromPoint3(e[1]),c[2]=a.Point2.fromPoint3(e[2]),this._textShape&&this._textShape.setPosition(c[0]),this._lineShapes[0].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[0].setEndcapsInverted(this._arrowsInvert),this._lineShapes[0].setEndEndcapColor(this._viewer.measureManager.getMeasurementColor()),
this._lineShapes[0].setStartEndcapColor(this._viewer.measureManager.getMeasurementColor()),this._lineShapes[0].set(c[1],c[2]),this._faceData[1]instanceof a.SubentityProperties.CylinderElement&&this._faceData[0]instanceof a.SubentityProperties.CylinderElement?(e[3]=b.projectPoint(this._surfaceCenter[0]),e[4]=b.projectPoint(this._surfaceCenter[1]),c[3]=a.Point2.fromPoint3(e[3]),c[4]=a.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[1],c[3]),this._lineShapes[2].set(c[2],c[4]),this._lineShapes[3].set(c[0],
c[1])):(e[3]=b.projectPoint(this._firstPointHelper),e[4]=b.projectPoint(this._secondPointHelper),c[3]=a.Point2.fromPoint3(e[3]),c[4]=a.Point2.fromPoint3(e[4]),this._lineShapes[1].set(c[2],c[4]),this._lineShapes[2].set(c[1],c[3]),this._lineShapes[3].set(c[1],c[0])));for(f=0;6>f;f++)0>e[f].z&&(this._behindView=!0)}};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var b=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:this._faceData[0]instanceof
a.SubentityProperties.CylinderElement&&(b.drawLine(this._line1PreviewShape1),b.drawLine(this._line1PreviewShape2));break;case 2:case 3:case 4:this._faceData[0]instanceof a.SubentityProperties.CylinderElement&&this._faceData[1]instanceof a.SubentityProperties.CylinderElement?(3>this._stage&&(b.drawLine(this._line1PreviewShape1),b.drawLine(this._line1PreviewShape2),b.drawLine(this._line2PreviewShape1),b.drawLine(this._line2PreviewShape2)),b.drawLine(this._lineShapes[0]),b.drawLine(this._lineShapes[1]),
b.drawLine(this._lineShapes[2])):(this._viewer.markupManager.getRenderer().drawLine(this._lineShapes[0]),this._parallelFaces&&(b.drawLine(this._lineShapes[1]),b.drawLine(this._lineShapes[2]))),b.drawLine(this._lineShapes[3]),b.drawTextBox(this._textShape)}}};c._serializeFaceProp=function(b){return b instanceof a.SubentityProperties.CylinderElement?{type:"CylinderElement",origin:b.origin.toJson(),normal:b.normal.toJson(),radius:b.radius}:b instanceof a.SubentityProperties.PlaneElement?{type:"PlaneElement",
origin:b.origin.toJson(),normal:b.normal.toJson()}:null};c._constructFaceProp=function(b){if("CylinderElement"===b.type){var c=a.Point3.fromJson(b.origin),d=a.Point3.fromJson(b.normal);return new a.SubentityProperties.CylinderElement(b.radius,c,d)}return"PlaneElement"===b.type?(c=a.Point3.fromJson(b.origin),d=a.Point3.fromJson(b.normal),new a.SubentityProperties.PlaneElement(c,d)):null};c.prototype.toJson=function(){for(var a=[],d=0,e=this._faceData;d<e.length;d++)a.push(c._serializeFaceProp(e[d]));
for(var d=[],e=0,f=this._surfaceCenter;e<f.length;e++)d.push(f[e].toJson());for(var e=[],h=0,k=this._surfaceAxis1;h<k.length;h++)f=k[h],e.push(f.toJson());for(var h=[],k=0,r=this._surfaceAxis2;k<r.length;k++)f=r[k],h.push(f.toJson());return{text:this._textShape.getTextString(),textPos:this._textPos.toJson(),firstPoint:this._firstPoint.toJson(),secondPoint:this._secondPoint.toJson(),firstPointHelper:this._firstPointHelper.toJson(),secondPointHelper:this._secondPointHelper.toJson(),measurementValue:this._measurementValue,
unitMultiplier:this._unitMultiplier,parallelFaces:this._parallelFaces,faceData:a,surfaceCenter:d,surfaceAxis1:e,surfaceAxis2:h,name:this.getName(),className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,d){d=new c(d);d.setName(a.name);d._textShape.setTextString(a.text);d._textPos.assign(a.textPos);d._firstPoint.assign(a.firstPoint);d._firstPointHelper.assign(a.firstPointHelper);d._secondPoint.assign(a.secondPoint);d._secondPointHelper.assign(a.secondPointHelper);
console.assert(Array.isArray(a.faceData));for(var e=0,f=a.faceData;e<f.length;e++){var h=c._constructFaceProp(f[e]);console.assert(null!==h);d._faceData.push(h)}d._surfaceCenter[0].assign(a.surfaceCenter[0]);d._surfaceCenter[1].assign(a.surfaceCenter[1]);d._surfaceAxis1[0].assign(a.surfaceAxis1[0]);d._surfaceAxis1[1].assign(a.surfaceAxis1[1]);d._surfaceAxis2[0].assign(a.surfaceAxis2[0]);d._surfaceAxis2[1].assign(a.surfaceAxis2[1]);d._stage=4;d._parallelFaces=a.parallelFaces;d._measurementValue=a.measurementValue;
d._unitMultiplier=a.unitMultiplier||1;return d};c.construct=function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureFaceFaceDistanceMarkup"};return c}(e.MeasureMarkup);e.MeasureFaceFaceDistanceMarkup=f})(h.Measure||(h.Measure={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b){var c=d.call(this,b)||this;c._firstPointShape=new h.Shape.Circle;c._secondPointShape=new h.Shape.Circle;c._name="MeasurePointPointDistance";c._lineShapes=[];for(var e=0;6>e;e++)c._lineShapes.push(new h.Shape.Line),c._lineShapes[e].setStrokeColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setEndEndcapColor(c._viewer.measureManager.getMeasurementColor()),c._lineShapes[e].setStartEndcapColor(c._viewer.measureManager.getMeasurementColor());
c._viewer=b;c.initCircle(c._firstPointShape);c.initCircle(c._secondPointShape);c._textShape=new h.Shape.TextBox;c._textShape.getBoxPortion().setFillOpacity(1);c._textShape.getBoxPortion().setFillColor(new a.Color(255,255,255));return c}__extends(c,d);c.prototype.initCircle=function(a){a.setRadius(2.5);a.setFillColor(this._viewer.measureManager.getMeasurementColor())};c.prototype.setUnitMultiplier=function(a){this._unitMultiplier=a};c.prototype.setFirstPointPosition=function(a){this._stage=1;this._positions[0]=
a.copy()};c.prototype.setSecondPointPosition=function(b){this._stage=2;this._positions[1]=b.copy();this._positions[2]=b.copy();this._setMeasurementValue(a.Point3.subtract(this._positions[1],this._positions[0]).length())};c.prototype._getStage=function(){return this._stage};c.prototype.finalize=function(){this._stage++};c.prototype.getFirstPointPosition=function(){return this._positions[0]};c.prototype.adjust=function(b){d.prototype.adjust.call(this,b);var c=this._viewer.view.raycastFromPoint(b);if(null!==
c){b=this._positions[0];var e=this._positions[1],f=new a.Point3(1,0,0);e.equals(b)||(f=a.Point3.subtract(e,b));var h=this._viewer.view.getCamera().getUp(),k=a.Point3.cross(c.direction,h).normalize(),r=new a.Point3((b.x+e.x)/2,(b.y+e.y)/2,(b.z+e.z)/2),h=new a.Point3(r.x+h.x,r.y+h.y,r.z+h.z),m=new a.Point3(r.x+k.x,r.y+k.y,r.z+k.z),n=new a.Point3(c.origin.x+1E6*c.direction.x,c.origin.y+1E6*c.direction.y,c.origin.z+1E6*c.direction.z),k=new a.Point3(0,0,0);a.Util.intersectionPlaneLine(c.origin,n,r,h,m,
k);this._positions[2].assign(k);new a.Point3(0,0,0);c=Math.abs(f.x)<=Math.abs(f.y)&&Math.abs(f.x)<=Math.abs(f.z)?new a.Point3(1,0,0):Math.abs(f.y)<=Math.abs(f.x)&&Math.abs(f.y)<=Math.abs(f.z)?new a.Point3(0,1,0):new a.Point3(0,0,1);c=a.Point3.cross(c,f);r=a.Point3.cross(c,f);c.set(b.x+c.x,b.y+c.y,b.z+c.z);r.set(b.x+r.x,b.y+r.y,b.z+r.z);h=new a.Point3(k.x+1E4*f.x,k.y+1E4*f.y,k.z+1E4*f.z);f=new a.Point3(k.x-1E4*f.x,k.y-1E4*f.y,k.z-1E4*f.z);a.Util.intersectionPlaneLine(h,f,b,c,r,k);f=a.Point3.subtract(k,
b);this._positions[3]=new a.Point3(b.x+f.x,b.y+f.y,b.z+f.z);this._positions[4]=new a.Point3(e.x+f.x,e.y+f.y,e.z+f.z);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=new a.Point3((this._positions[3].x+this._positions[4].x)/2,(this._positions[3].y+this._positions[4].y)/2,(this._positions[3].z+this._positions[4].z)/2),c=a.Point3.subtract(this._positions[4],this._positions[3]);2*a.Point3.subtract(this._positions[2],b).length()>
c.length()?this._arrowsInvert=!0:this._arrowsInvert=!1};c.prototype.update=function(){d.prototype.update.call(this);var b=this._viewer.view,c=Array(6);if(0<this._stage){this._behindView=!1;for(var e=0;e<this._positions.length;e++)0>=b.projectPoint(this._positions[e]).z&&(this._behindView=!0),c[e]=a.Point2.fromPoint3(b.projectPoint(this._positions[e]));this._firstPointShape.setCenter(c[0])}1<this._stage&&(this._textShape&&this._textShape.setPosition(c[2]),this._secondPointShape.setCenter(c[1]),this._lineShapes[0].set(c[0],
c[1]),this._lineShapes[1].set(c[3],c[4]),this._lineShapes[2].set(c[0],c[3]),this._lineShapes[3].set(c[1],c[4]),this._lineShapes[4].set(c[3],c[2]),this._lineShapes[5].set(c[3],c[4]),this._lineShapes[5].setEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setStartEndcapType(h.Shape.EndcapType.Arrowhead),this._lineShapes[5].setEndcapsInverted(this._arrowsInvert))};c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var a=
this._viewer.markupManager.getRenderer();switch(this._stage){case 1:a.drawCircle(this._firstPointShape);break;case 2:case 3:a.drawCircle(this._firstPointShape);a.drawCircle(this._secondPointShape);for(var c=0,d=this._lineShapes;c<d.length;c++)a.drawLine(d[c]);a.drawTextBox(this._textShape)}}};c.prototype.toJson=function(){return{name:this._name,measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),
textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,d){d=new c(d);d._name=b.name;d._positions[0]=a.Point3.fromJson(b.measurePoint1);d._positions[1]=a.Point3.fromJson(b.measurePoint2);d._positions[2]=a.Point3.fromJson(b.textPoint);d._textShape.setTextString(b.text);d._positions[3]=a.Point3.fromJson(b.leaderPoint1);
d._positions[4]=a.Point3.fromJson(b.leaderPoint2);d._measurementValue=b.measurementValue;d._unitMultiplier=b.unitMultiplier||1;d._updateArrowsInverted();d._stage=2;return d};c.construct=function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasurePointPointDistanceMarkup"};return c}(e.MeasureMarkup);e.MeasurePointPointDistanceMarkup=f})(h.Measure||(h.Measure={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b,c,e,f){b=d.call(this,b)||this;b._lineProperties=null;b._worldSpaceLength=0;b._arrowsInvert=!1;b._name="MeasureStraightEdgeLength";b._lineProperties=c;b._matrix=e.copy();b._matrix.setTranslationComponent(0,0,0);b._unitMultiplier=f;c=b._viewer.measureManager.getMeasurementColor();for(e=0;5>e;e++)f=new h.Shape.Line,f.setStrokeColor(c),f.setEndEndcapColor(c),f.setStartEndcapColor(c),b._lineShapes.push(f);c=b._textShape.getBoxPortion();
c.setFillOpacity(1);c.setFillColor(new a.Color(255,255,255));return b}__extends(c,d);c.prototype.setLineGeometry=function(b){d.prototype.setLineGeometry.call(this,b);this._positions[0]=this._linePositions[0];this._positions[2]=this._linePositions[0].copy();this._positions[1]=this._linePositions[this._linePositions.length-1];null!==this._lineProperties&&-1!==this._lineProperties.length?(b=new a.Point3(this._lineProperties.length,0,0),this._matrix.transform(b,b),b=this._worldSpaceLength=b.length()):
b=a.Point3.subtract(this._positions[1],this._positions[0]).length();this._setMeasurementValue(b)};c.prototype.adjust=function(b){d.prototype.adjust.call(this,b);var c=this._viewer.view,e=c.raycastFromPoint(b);if(null!==e){b=this._positions[0];var f=this._positions[1],h=new a.Point3(1,0,0);f.equals(b)||(h=a.Point3.subtract(f,b));var k=c.getCamera().getUp(),c=a.Point3.cross(e.direction,k).normalize(),r=a.Point3.add(b,f).scale(.5),k=a.Point3.add(r,k),m=a.Point3.add(r,c),n=a.Point3.add(a.Point3.scale(e.direction,
1E6),e.origin),c=new a.Point3(0,0,0);a.Util.intersectionPlaneLine(e.origin,n,r,k,m,c);this._positions[2].assign(c);new a.Point3(0,0,0);e=Math.abs(h.x)<=Math.abs(h.y)&&Math.abs(h.x)<=Math.abs(h.z)?new a.Point3(1,0,0):Math.abs(h.y)<=Math.abs(h.x)&&Math.abs(h.y)<=Math.abs(h.z)?new a.Point3(0,1,0):new a.Point3(0,0,1);e=a.Point3.cross(e,h);r=a.Point3.cross(e,h);e.add(b);r.add(b);k=a.Point3.add(a.Point3.scale(h,1E4),c);h=a.Point3.add(a.Point3.scale(h,-1E4),c);a.Util.intersectionPlaneLine(k,h,b,e,r,c);h=
a.Point3.subtract(c,b);this._positions[3]=a.Point3.add(b,h);this._positions[4]=a.Point3.add(f,h);this._updateArrowsInverted();this._viewer.markupManager.refreshMarkup()}};c.prototype._updateArrowsInverted=function(){var b=a.Point3.add(this._positions[3],this._positions[4]).scale(.5),c=a.Point3.subtract(this._positions[4],this._positions[3]);this._arrowsInvert=2*a.Point3.subtract(this._positions[2],b).squaredLength()>c.squaredLength()};c.prototype.update=function(){d.prototype.update.call(this);var b=
this._viewer.view;this._behindView=!1;if(0<this._stage){this._lineEdgeShape.clearPoints();for(var c=Array(this._linePositions.length),e=0;e<this._linePositions.length;e++)c[e]=b.projectPoint(this._linePositions[e]),0>=c[e].z&&(this._behindView=!0),this._lineEdgeShape.pushPoint(a.Point2.fromPoint3(c[e]))}if(1<this._stage){for(var f=Array(6),c=Array(6),e=0;e<this._positions.length;e++)c[e]=b.projectPoint(this._positions[e]),0>=c[e].z&&(this._behindView=!0),f[e]=a.Point2.fromPoint3(c[e]);this._textShape&&
this._textShape.setPosition(f[2]);b=this._viewer.measureManager.getMeasurementColor();this._lineShapes[0].set(f[3],f[4]);this._lineShapes[1].set(f[0],f[3]);this._lineShapes[2].set(f[1],f[4]);this._lineShapes[3].set(f[3],f[2]);this._lineShapes[4].set(f[3],f[4]);this._lineShapes[4].setEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setStartEndcapType(h.Shape.EndcapType.Arrowhead);this._lineShapes[4].setEndcapsInverted(this._arrowsInvert);this._lineShapes[4].setEndEndcapColor(b);this._lineShapes[4].setStartEndcapColor(b)}};
c.prototype.draw=function(){if(this._visibility&&0===this._viewer.explodeManager.getMagnitude()&&(this.update(),!this._behindView)){var a=this._viewer.markupManager.getRenderer();switch(this._stage){case 1:a.drawPolyline(this._lineEdgeShape);break;case 2:case 3:for(var c=0,d=this._lineShapes;c<d.length;c++)a.drawLine(d[c]);a.drawTextBox(this._textShape);a.drawPolyline(this._lineEdgeShape)}}};c.prototype.toJson=function(){return{name:this._name,measurePoint1:this._positions[0].copy(),measurePoint2:this._positions[1].copy(),
leaderPoint1:this._positions[3].copy(),leaderPoint2:this._positions[4].copy(),textPoint:this._positions[2].copy(),text:this._textShape.getTextString(),measurementValue:this._measurementValue,unitMultiplier:this._unitMultiplier,className:this.getClassName(),matrix:this._matrix.toJson()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(b,d){var e=a.Matrix.fromJson(b.matrix);d=new c(d,null,e,b.unitMultiplier||1);d._name=b.name;d._positions[0]=a.Point3.fromJson(b.measurePoint1);
d._positions[1]=a.Point3.fromJson(b.measurePoint2);d._positions[2]=a.Point3.fromJson(b.textPoint);d._textShape.setTextString(b.text);d._positions[3]=a.Point3.fromJson(b.leaderPoint1);d._positions[4]=a.Point3.fromJson(b.leaderPoint2);d._measurementValue=b.measurementValue;d._updateArrowsInverted();d._stage=2;return d};c.construct=function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Measure.MeasureStraightEdgeLengthMarkup"};return c}(e.MeasureLengthMarkup);
e.MeasureStraightEdgeLengthMarkup=f})(h.Measure||(h.Measure={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(b,c){var d;d=Math.abs(b.x);var e=Math.abs(b.y),f=Math.abs(b.z);d=d<=e&&d<=f?new a.Point3(1,0,0):e<=d&&e<=f?new a.Point3(0,1,0):new a.Point3(0,0,1);b=a.Point3.cross(d,b);return c?(c.assign(b),c):b}function f(a,b,c,d){var e=c.normal.x*(b.x-a.x)+c.normal.y*(b.y-a.y)+c.normal.z*(b.z-a.z);if(1E-5>Math.abs(e))return!1;c=-(c.d+c.normal.x*a.x+c.normal.y*a.y+c.normal.z*a.z)/e;d.x=a.x+c*(b.x-a.x);d.y=a.y+c*(b.y-a.y);d.z=a.z+c*(b.z-a.z);return 0>c||1<c?!1:!0}function d(a){return Math.PI/
180*a}function c(a){return 180/Math.PI*a}function b(b,c,d){c=a.Point3.subtract(c,b);b=a.Point3.subtract(d,b);b=a.Point3.dot(b,c)/c.squaredLength();return Math.max(0,Math.min(1,b))}h.oneVectorCross=e;h.intersectionPlaneLine2=f;h.computePointToLineDistance=function(b,c,d,e){var f=a.Point3.subtract(d,c),h=f.squaredLength(),m=0;0<h&&(m=((b.x-c.x)*(d.x-c.x)+(b.y-c.y)*(d.y-c.y)+(b.z-c.z)*(d.z-c.z))/h);f.set(f.x*m,f.y*m,f.z*m);e.set(c.x+f.x,c.y+f.y,c.z+f.z);new a.Point3(0,0,0);return a.Point3.subtract(b,
e).length()};h.formatWithUnit=function(a,b){b=.01>Math.abs(b-25.4/72)?"points":.01>Math.abs(b-25.4)?"inch":.01>Math.abs(b-1)?"mm":.01>Math.abs(b-10)?"cm":.01>Math.abs(b-25.4/6)?"picas":.01>Math.abs(b-12*25.4)?"ft":.01>Math.abs(b-914.4)?"yd":.01>Math.abs(b-1E3)?"m":.01>Math.abs(b-1E6)?"km":.01>Math.abs(b-1609344)?"mi":"mm";for(var c,d=2;9>d&&(c=a.toFixed(d),0===parseFloat(c));d++);0===parseFloat(c)&&(c="0");return c+b};h.degreesToRadians=d;h.radiansToDegrees=c;h.computeOffaxisRotation=function(b,c,
e){b=b.copy().normalize();var f=d(c);c=Math.cos(f);var f=Math.sin(f),h=1-c,r=h*b.x*b.y,m=h*b.x*b.z,n=h*b.y*b.z;void 0===e&&(e=new a.Matrix);e.m[0]=h*b.x*b.x+c;e.m[1]=f*b.z+r;e.m[2]=m-f*b.y;e.m[3]=0;e.m[4]=r-f*b.z;e.m[5]=h*b.y*b.y+c;e.m[6]=f*b.x+n;e.m[7]=0;e.m[8]=f*b.y+m;e.m[9]=n-f*b.x;e.m[10]=h*b.z*b.z+c;e.m[11]=0;e.m[12]=0;e.m[13]=0;e.m[14]=0;e.m[15]=1;return e};h.intersect3d2Planes=function(b,c,d,e,f,h){var m=a.Point3.cross(b.normal,d.normal),n=Math.abs(m.x),q=Math.abs(m.y),t=Math.abs(m.z);if(1E-7>
n+q+t)return d=a.Point3.subtract(e,c),0===a.Point3.dot(b.normal,d)?1:0;n=n>q?n>t?1:3:q>t?2:3;q=a.Point3.zero();c=-a.Point3.dot(b.normal,c);e=-a.Point3.dot(d.normal,e);switch(n){case 1:q.x=0;q.y=(e*b.normal.z-c*d.normal.z)/m.x;q.z=(c*d.normal.y-e*b.normal.y)/m.x;break;case 2:q.x=(c*d.normal.z-e*b.normal.z)/m.y;q.y=0;q.z=(e*b.normal.x-c*d.normal.x)/m.y;break;case 3:q.x=(e*b.normal.y-c*d.normal.y)/m.z,q.y=(c*d.normal.x-e*b.normal.x)/m.z,q.z=0}f.assign(q);h.set(q.x+m.x,q.y+m.y,q.z+m.z);return 2};h.intersectionPlaneLine=
function(b,c,d,e,h,r){var m=new a.Plane;m.normal.x=(e.y-d.y)*(h.z-d.z)-(e.z-d.z)*(h.y-d.y);m.normal.y=(e.z-d.z)*(h.x-d.x)-(e.x-d.x)*(h.z-d.z);m.normal.z=(e.x-d.x)*(h.y-d.y)-(e.y-d.y)*(h.x-d.x);m.normal.normalize();m.d=-m.normal.x*d.x-m.normal.y*d.y-m.normal.z*d.z;return f(b,c,m,r)};h.computeAngleBetweenVector=function(b,d){b=b.copy().normalize();var e=d.copy().normalize();d=a.Point3.cross(b,e).length();b=a.Point3.dot(b,e);return c(Math.atan2(d,b))};h.generatePointsOnCircle=function(b,c,d,f,h){for(var r=
2*Math.PI/f,m=0;m<f;m++)b[m]=new a.Point3(0,d*Math.cos(r*m),d*Math.sin(r*m));b[f]=b[0].copy();d=e(h);d.normalize();r=a.Point3.cross(d,h);r.normalize();var m=new a.Matrix,n=m.m;n[0]=h.x;n[1]=h.y;n[2]=h.z;n[3]=0;n[4]=d.x;n[5]=d.y;n[6]=d.z;n[7]=0;n[8]=r.x;n[9]=r.y;n[10]=r.z;n[11]=0;n[12]=0;n[13]=0;n[14]=0;n[15]=1;m.transformArray(b,b);for(m=0;m<=f;m++)b[m].set(b[m].x+c.x,b[m].y+c.y,b[m].z+c.z)};h.distanceLineLine=function(b,c,d,e,f,h){var m=0,n=0,q=a.Point3.subtract(c,b),t=a.Point3.subtract(e,d),u=a.Point3.dot(q,
b),w=a.Point3.dot(q,t),z=a.Point3.dot(q,q),y=a.Point3.dot(q,d),x=a.Point3.dot(t,t),A=a.Point3.dot(t,d),B=a.Point3.dot(t,b);e=a.Point3.dot(q,e);var C=a.Point3.dot(t,c),D=z*x-w*w;0===D?(0!==z?(y=(y-u)/z,0>y?y=0:1<y&&(y=1),u=(e-u)/z,0>u?u=0:1<u&&(u=1)):u=y=0,0!==x?(B=(B-A)/x,0>B?B=0:1<B&&(B=1),x=(C-A)/x,0>x?x=0:1<x&&(x=1)):x=B=0,m=(y+u)/2,n=(B+x)/2):(c=(w*B-w*A-x*u+x*y)/D,w=(z*B-z*A+w*y-w*u)/D,y=(y-u)/z,B=(B-A)/x,u=(e-u)/z,x=(C-A)/x,0<=c&&1>=c&&0<=w&&1>=w?(m=c,n=w):0>c&&0<=w&&1>=w?(m=c,n=B):1<c&&0<=
w&&1>=w?(m=c,n=x):0<=c&&1>=c&&0>w?(m=y,n=w):0<=c&&1>=c&&1<w?(m=u,n=w):0>c&&0>w?(m=y,n=B):0>c&&1<w?(m=u,n=B):1<c&&0>w?(m=y,n=x):1<c&&1<w&&(m=u,n=x),0>m?m=0:1<m&&(m=1),0>n?n=0:1<n&&(n=1));f.x=m*q.x+b.x;f.y=m*q.y+b.y;f.z=m*q.z+b.z;h.x=n*t.x+d.x;h.y=n*t.y+d.y;h.z=n*t.z+d.z;return a.Point3.subtract(h,f).length()};h.lineLineIntersect=function(b,c,d,e){var f=a.Point3.zero(),h=a.Point3.zero(),m,n=a.Point3.zero(),q=a.Point3.zero(),t=a.Point3.zero(),u;n.x=b.x-d.x;n.y=b.y-d.y;n.z=b.z-d.z;q.x=e.x-d.x;q.y=e.y-
d.y;q.z=e.z-d.z;if(1E-12>Math.abs(q.x)&&1E-12>Math.abs(q.y)&&1E-12>Math.abs(q.z))return null;t.x=c.x-b.x;t.y=c.y-b.y;t.z=c.z-b.z;if(1E-12>Math.abs(t.x)&&1E-12>Math.abs(t.y)&&1E-12>Math.abs(t.z))return null;c=n.x*q.x+n.y*q.y+n.z*q.z;e=q.x*t.x+q.y*t.y+q.z*t.z;m=n.x*t.x+n.y*t.y+n.z*t.z;n=q.x*q.x+q.y*q.y+q.z*q.z;u=(t.x*t.x+t.y*t.y+t.z*t.z)*n-e*e;if(1E-12>Math.abs(u))return null;m=(c*e-m*n)/u;c=(c+e*m)/n;f.x=b.x+m*t.x;f.y=b.y+m*t.y;f.z=b.z+m*t.z;h.x=d.x+c*q.x;h.y=d.y+c*q.y;h.z=d.z+c*q.z;return f};h.closestPointScalarFromPointToSegment=
b;h.closestPointFromPointToSegment=function(c,d,e){e=b(c,d,e);d=a.Point3.subtract(d,c).scale(e);return a.Point3.add(c,d)};h.isPointOnLineSegment=function(c,d,e,f){var h=b(c,d,e);if(0>h||1<h)return!1;d=a.Point3.subtract(d,c).scale(h);c=a.Point3.add(c,d);return a.Point3.subtract(c,e).squaredLength()<=f*f}})(a.Util||(a.Util={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f;(function(a){a[a.Created=0]="Created";a[a.Hidden=1]="Hidden";a[a.Shown=2]="Shown"})(f=e._NoteTextEvent||(e._NoteTextEvent={}));var d=function(c){function b(b,d,e,f,h){var r=c.call(this)||this;r._uniqueId=a.GUID.create();r._noteElementId=null;r._position=a.Point3.zero();r._text="";r._color=a.Color.white();r._sphereRadius=.03;r._deleted=!1;r._active=!1;r._viewer=b;r._noteTextManager=d;r._selectionPosition=e;r._selectionNormal=f;r._partId=h;r._noteTextManager.addNote(r);
r._init();return r}__extends(b,c);b.prototype._init=function(){return __awaiter(this,void 0,void 0,function(){var a=this,b,c,d,e,h;return __generator(this,function(m){switch(m.label){case 0:return b=this._createPinTransformationMatrix(this._selectionPosition,this._selectionNormal),[4,Promise.all([this._createPinStemInstance(b),this._createPinSphereInstance(b)])];case 1:return c=m.sent(),d=c[0],e=c[1],this._stemInstanceId=d,this._sphereInstanceId=e,[4,this._restore(!1)];case 2:return m.sent(),this._callbacks=
{visibilityChanged:function(){a._matchPartVisibility()}},this._viewer.setCallbacks(this._callbacks),h=this._viewer._getCallbackManager(),h.trigger("_noteTextEvent",f.Created,this),[2]}})})};b.prototype._matchPartVisibility=function(){if(void 0!==this._sphereInstanceId&&void 0!==this._stemInstanceId){var a=this._viewer.model,b=a.getNodeVisibility(this._partId),c=a.getNodeVisibility(this._sphereInstanceId);b===c||this._noteTextManager.getExplodeActive()||a.setNodesVisibility([this._stemInstanceId,this._sphereInstanceId],
b);a=this._noteTextManager.getActiveItem();null===a||a.getStemInstanceId()!==this._stemInstanceId||b||this.hide()}};b.prototype.updatePosition=function(){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(b){switch(b.label){case 0:return void 0===this._sphereInstanceId?[2]:[4,this._viewer.model.getNodeRealBounding(this._sphereInstanceId)];case 1:return this._pinBoundingBox=a=b.sent(),this._position=this._pinBoundingBox.center(),this.setText(this._text),[2]}})})};
b.prototype._restore=function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._noteTextManager.setActiveItemHandle(this._viewer.markupManager.registerMarkup(this)),this._noteTextManager.setActiveItem(this),this._show(a),[4,Promise.all([this._updateColor(),this.draw()])];case 1:return b.sent(),[2]}})})};b.prototype.restore=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._restore(!0)]})})};
b.prototype.setText=function(a){this._text=a;this._noteTextManager.getNoteTextElement().setText(a)};b.prototype.saveTextValue=function(){this._text=this._noteTextManager.getNoteTextElement().getText()};b.prototype.draw=function(){return __awaiter(this,void 0,void 0,function(){var b,c,d;return __generator(this,function(e){switch(e.label){case 0:if(this._deleted||!this._active)return[2];this._behindView=!1;return[4,this.updatePosition()];case 1:return e.sent(),b=this._viewer.view.projectPoint(this._position),
0>=b.z&&(this._behindView=!0),this._behindView?null!==this._noteElementId&&null!==document.getElementById(this._noteElementId)&&(this._viewer.markupManager.removeMarkupElement(this._noteElementId),this._noteElementId=null):(c=new a.Point2(b.x,b.y),d=this._noteTextManager.getNoteTextElement(),d.setPosition(c),null===this._noteElementId&&(this._noteElementId=this._viewer.markupManager.addMarkupElement(d.getHtmlContainer()))),[2]}})})};b.prototype.hit=function(b){var c=this._noteTextManager.getNoteTextElement(),
d=c.getPosition(),c=c.getSize();return a.Internal.pointInRect(b,d,c)};b.prototype.getClassName=function(){return b.className};b.prototype.getUniqueId=function(){return this._uniqueId};b.prototype.getSphereInstanceId=function(){return this._sphereInstanceId};b.prototype.getStemInstanceId=function(){return this._stemInstanceId};b.prototype.onSelect=function(){this._noteTextManager.getNoteTextElement().focus()};b.prototype.onDeselect=function(){this._noteTextManager.getNoteTextElement().blur()};b.prototype.hide=
function(){var a=this._noteTextManager.getNoteTextElement();a.hide();this.setText(a.getText());this._noteTextManager.setActiveItem(null);this._active=!1;this._viewer._getCallbackManager().trigger("_noteTextEvent",f.Hidden,this)};b.prototype._show=function(a){this._noteTextManager.getNoteTextElement().show(this);this._active=!0;a&&this._viewer._getCallbackManager().trigger("_noteTextEvent",f.Shown,this)};b.prototype.show=function(){this._show(!0)};b.prototype.remove=function(){return __awaiter(this,
void 0,void 0,function(){var b,d;return __generator(this,function(e){switch(e.label){case 0:return null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null),b=this._viewer.model,d=[],void 0!==this._stemInstanceId&&d.push(b.deleteMeshInstances([this._stemInstanceId])),void 0!==this._sphereInstanceId&&d.push(b.deleteMeshInstances([this._sphereInstanceId])),this.hide(),this._noteTextManager.removeNote(this),this._deleted=!0,[4,a.Util.waitForAll(d)];case 1:return e.sent(),
c.prototype.remove.call(this),[2]}})})};b.prototype.getRemoved=function(){return this._deleted};b.prototype.setColor=function(a){this._color=a;this._updateColor();return Promise.resolve()};b.prototype.getColor=function(){return this._color};b.prototype.getPartId=function(){return this._partId};b.prototype._updateColor=function(){void 0!==this._sphereInstanceId&&this._viewer.model.setNodesFaceColor([this._sphereInstanceId],this._color)};b.prototype._createPinTransformationMatrix=function(b,c){var d=
0,e=c.x;Math.abs(c.y)<Math.abs(e)&&(e=c.y,d=1);Math.abs(c.z)<Math.abs(e)&&(d=2);e=[0,0,0];e[d]=1;var d=a.Point3.createFromArray(e),d=a.Point3.cross(c,d).normalize(),e=a.Point3.cross(c,d),f=new a.Matrix;f.m=[c.x,c.y,c.z,0,d.x,d.y,d.z,0,e.x,e.y,e.z,0,0,0,0,1];f=a.Matrix.multiply(f,(new a.Matrix).setScaleComponent(this._sphereRadius,this._sphereRadius,this._sphereRadius));f.setTranslationComponent(b.x,b.y,b.z);return f};b.prototype._createPinStemInstance=function(b){return __awaiter(this,void 0,void 0,
function(){var c,d,e,f;return __generator(this,function(h){c=this._noteTextManager.getPinStemMeshId();if(null===c)throw new a.CommunicatorError("stem mesh hasn't been created yet");d=new a.MeshInstanceData(c,b,"pin-stem-instance",void 0,a.Color.black());d.setOpacity(1);e=a.MeshInstanceCreationFlags.SuppressCameraScale|a.MeshInstanceCreationFlags.DoNotCut|a.MeshInstanceCreationFlags.DoNotExplode|a.MeshInstanceCreationFlags.DoNotXRay|a.MeshInstanceCreationFlags.ExcludeBounding|a.MeshInstanceCreationFlags.OverrideSceneVisibility|
a.MeshInstanceCreationFlags.AlwaysDraw;d.setCreationFlags(e);f=this._viewer.model;return[2,f.createMeshInstance(d,void 0,!0)]})})};b.prototype._createPinSphereInstance=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,e,f;return __generator(this,function(h){c=this._noteTextManager.getPinSphereMeshId();if(null===c)throw new a.CommunicatorError("sphere mesh hasn't been created yet");d=new a.MeshInstanceData(c,b,"pin-sphere-instance",a.Color.white(),void 0);d.setOpacity(1);e=a.MeshInstanceCreationFlags.SuppressCameraScale|
a.MeshInstanceCreationFlags.DoNotCut|a.MeshInstanceCreationFlags.DoNotExplode|a.MeshInstanceCreationFlags.DoNotXRay|a.MeshInstanceCreationFlags.ExcludeBounding|a.MeshInstanceCreationFlags.OverrideSceneVisibility|a.MeshInstanceCreationFlags.AlwaysDraw;d.setCreationFlags(e);f=this._viewer.model;return[2,f.createMeshInstance(d,void 0,!0)]})})};b.prototype.toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),selectionPosition:this._selectionPosition.toJson(),selectionNormal:this._selectionNormal.toJson(),
text:this._text,color:this._color,partId:this._partId}};b.prototype.forJson=function(){return this.toJson()};b._fromJson=function(c,d,e){if(!e.findById(c.uniqueId)){var f=a.Point3.fromJson(c.selectionPosition),h=a.Point3.fromJson(c.selectionNormal);d=new b(d,e,f,h,c.partId);d._uniqueId=c.uniqueId;d.setText(c.text);d.setColor(a.Color.fromJson(c.color));return d}return null};b.fromJson=function(a,c,d){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(f){e=b._fromJson(a,
c,d);return[2,e]})})};b.className="Communicator.Markup.Note.NoteText";return b}(h.MarkupItem);e.NoteText=d})(h.Note||(h.Note={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c){var b=e.call(this)||this;b._pinSphereMeshId=null;b._pinStemMeshId=null;b._noteTextList=[];b._activeItemHandle=null;b._activeItem=null;b._explodeActive=!1;b._cuttingActive=!1;b._isolateActive=!1;b._stemLength=2;b._sphereIterations=2;b._viewer=c;b._noteTextElement=new a.Markup.Note.NoteTextElement;b._noteTextElement.setPositionOffset(new a.Point2(12,-24));b._viewer.setCallbacks({sceneReady:function(){b._init()}});return b}__extends(d,e);d.prototype._init=
function(){return __awaiter(this,void 0,void 0,function(){var a,b,e,f;return __generator(this,function(h){switch(h.label){case 0:return null===d._globalPinSphereMeshData&&(d._globalPinSphereMeshData=this._createPinSphereMeshData()),null===d._globalPinStemMeshData&&(d._globalPinStemMeshData=this._createPinStemMeshData()),a=this._viewer.model,b=a.createMesh(d._globalPinSphereMeshData),e=a.createMesh(d._globalPinStemMeshData),[4,Promise.all([b,e])];case 1:return f=h.sent(),this._pinSphereMeshId=f[0],
this._pinStemMeshId=f[1],[2]}})})};d.prototype._createPinStemMeshData=function(){var c=new a.MeshData;c.addPolyline([0,0,0,this._stemLength,0,0]);return c};d.prototype._createPinSphereMeshData=function(){var c=(1+Math.sqrt(5))/2,b=Math.sqrt(10+2*Math.sqrt(5))/(4*c),d=b/2,c=b/(2*c),e=[];e[0]=new a.Point3(-c,d,0);e[1]=new a.Point3(c,d,0);e[2]=new a.Point3(-c,-d,0);e[3]=new a.Point3(c,-d,0);e[4]=new a.Point3(0,-c,d);e[5]=new a.Point3(0,c,d);e[6]=new a.Point3(0,-c,-d);e[7]=new a.Point3(0,c,-d);e[8]=new a.Point3(d,
0,-c);e[9]=new a.Point3(d,0,c);e[10]=new a.Point3(-d,0,-c);e[11]=new a.Point3(-d,0,c);for(d=0;d<e.length;d++){var f=e[d];f.normalize()}for(var h=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],k=12,c=function(b){var c=[];h.map(function(b){var d=e[b[0]],f=e[b[1]],g=e[b[2]];e[k++]=(new a.Point3(d.x+f.x,d.y+f.y,d.z+f.z)).scale(.5).normalize();e[k++]=(new a.Point3(f.x+g.x,f.y+g.y,
f.z+g.z)).scale(.5).normalize();e[k++]=(new a.Point3(g.x+d.x,g.y+d.y,g.z+d.z)).scale(.5).normalize();c.push([b[0],k-3,k-1]);c.push([k-3,k-2,k-1]);c.push([k-3,b[1],k-2]);c.push([k-2,b[2],k-1])});h=c},d=0;d<this._sphereIterations;d++)c(d);for(var c=[],b=[],r=0,m=h;r<m.length;r++)for(var n=m[r],d=0;3>d;d++)f=e[n[d]],c.push(f.x+this._stemLength+1),c.push(f.y),c.push(f.z),f=f.normalize(),b.push(f.x),b.push(f.y),b.push(f.z);d=new a.MeshData;d.addFaces(c,b);d.setFaceWinding(a.FaceWinding.CounterClockwise);
return d};d.prototype.getPinStemMeshId=function(){return this._pinStemMeshId};d.prototype.getPinSphereMeshId=function(){return this._pinSphereMeshId};d.prototype.getNoteTextElement=function(){return this._noteTextElement};d.prototype.setNoteTextElement=function(a){this._noteTextElement.hide();this._noteTextElement=a};d.prototype.getNoteTextList=function(){return this._noteTextList};d.prototype.addNote=function(a){this._noteTextList.push(a);this._activeItem=a};d.prototype.removeNote=function(a){a=
this._noteTextList.indexOf(a);this._noteTextList.splice(a,1)};d.prototype.updatePinVisibility=function(){return __awaiter(this,void 0,void 0,function(){var a,b,d,e,f,h,k;return __generator(this,function(r){if(0<this._noteTextList.length){a=[];b=0;for(d=this._noteTextList;b<d.length;b++)e=d[b],f=e.getSphereInstanceId(),h=e.getStemInstanceId(),void 0!==f&&a.push(f),void 0!==h&&a.push(h);k=this._viewer.model.setNodesVisibility(a,!this._explodeActive);this._explodeActive&&this._noteTextElement.hide();
return[2,k]}return[2]})})};d.prototype.explode=function(a){this._explodeActive=0<a;return this.updatePinVisibility()};d.prototype.getExplodeActive=function(){return this._explodeActive};d.prototype.checkCuttingActive=function(){this._cuttingActive=!1;if(0<this._noteTextList.length)for(var a=this._viewer.cuttingManager,b=0;b<a.getCuttingSectionCount();b++){var d=a.getCuttingSection(b);if(null!==d&&d.isActive()){this._cuttingActive=!0;break}}return this.updatePinVisibility()};d.prototype.getCuttingActive=
function(){return this._cuttingActive};d.prototype.setIsolateActive=function(a){this._isolateActive=a};d.prototype.getIsolateActive=function(){return this._isolateActive};d.prototype.getActiveItem=function(){return this._activeItem};d.prototype.setActiveItem=function(a){this._activeItem=a};d.prototype.getActiveItemHandle=function(){return this._activeItemHandle};d.prototype.setActiveItemHandle=function(a){this._activeItemHandle=a};d.prototype.getItemList=function(){return this._noteTextList};d.prototype.selectPin=
function(a){this._activeItem&&this._activeItem.hide();a=a.getNodeId();return null!==a&&(a=this._getNoteTextFromNodeId(a),null!==a)?(a.restore(),!0):!1};d.prototype.checkPinInstance=function(a){return null!==this._getNoteTextFromNodeId(a)};d.prototype._getNoteTextFromNodeId=function(a){for(var b=0,d=this._noteTextList;b<d.length;b++){var e=d[b];if(e.getSphereInstanceId()===a||e.getStemInstanceId()===a)return e}return null};d.prototype.findById=function(a){for(var b=0,d=this._noteTextList;b<d.length;b++)if(a===
d[b].getUniqueId())return!0;return!1};d.prototype.loadData=function(c){for(var b=[],d=0;d<c.length;d++){var e=a.Markup.Note.NoteText.fromJson(c[d],this._viewer,this).then(function(a){return null!==a});b.push(e)}return Promise.all(b)};d.prototype.exportMarkup=function(){for(var a=[],b=0,d=this._noteTextList;b<d.length;b++)a.push(d[b].toJson());return a};d._globalPinSphereMeshData=null;d._globalPinStemMeshData=null;return d}(a.MarkupTypeManager);h.NoteTextManager=e})(a.Internal||(a.Internal={}))})(Communicator||
(Communicator={}));
(function(a){(function(a){(function(e){var f=function(a){function c(b){var c=a.call(this)||this;c._viewer=b;return c}__extends(c,a);c.prototype.onDragStart=function(a){a;return!1};c.prototype.onDragMove=function(a){a;return!1};c.prototype.onDragEnd=function(a){a;return!1};c.prototype.remove=function(){this._viewer.trigger("redlineDeleted",this);this._viewer.markupManager.refreshMarkup()};return c}(a.MarkupItem);e.RedlineItem=f})(a.Redline||(a.Redline={}))})(a.Markup||(a.Markup={}))})(Communicator||
(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b){b=d.call(this,b)||this;b._uniqueId=a.GUID.create();b._centerPt=a.Point3.zero();b._radiusPt=a.Point3.zero();b._circleShape=new h.Shape.Circle;b._previousDragPlanePosition=a.Point3.zero();b._circleShape.setFillOpacity(0);b._circleShape.setStrokeColor(a.Color.red());b._circleShape.setStrokeWidth(2);return b}__extends(c,d);c.prototype.setCenter=function(a){this._centerPt.assign(a)};c.prototype.getCenter=function(){return this._centerPt.copy()};c.prototype.setRadiusPoint=
function(a){this._radiusPt.assign(a)};c.prototype.getRadiusPoint=function(){return this._radiusPt.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var b=this._viewer.view,c=a.Point2.fromPoint3(b.projectPoint(this._centerPt)),b=a.Point2.fromPoint3(b.projectPoint(this._radiusPt)),b=a.Point2.distance(c,b);this._circleShape.set(c,b)};c.prototype.draw=function(){this._update();this._viewer.markupManager.getRenderer().drawCircle(this._circleShape)};c.prototype.hit=
function(b){this._update();var c=this._circleShape.getStrokeWidth();b=a.Point2.distance(this._circleShape.getCenter(),b)-this._circleShape.getRadius();return Math.abs(b)<=c};c.prototype.onSelect=function(){this._circleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._circleShape.setStrokeWidth(2)};c.prototype.isValid=function(){return this._circleShape.getRadius()>c._validRadiusTolerance};c.prototype.onDragStart=function(a){var c=this._viewer.view;a=c.getCamera().getCameraPlaneIntersectionPoint(a,
c);null!==a&&this._previousDragPlanePosition.assign(a);return!1};c.prototype.onDragMove=function(b){var c=this._viewer.view;b=c.getCamera().getCameraPlaneIntersectionPoint(b,c);null!==b&&(c=a.Point3.subtract(b,this._previousDragPlanePosition),this._centerPt.add(c),this._radiusPt.add(c),this._previousDragPlanePosition.assign(b));return!0};c.prototype.toJson=function(){return{uniqueId:this._uniqueId,centerPoint:this._centerPt.toJson(),radiusPoint:this._radiusPt.toJson(),className:this.getClassName()}};
c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,d){d=new c(d);d._uniqueId=a.uniqueId;d.setCenter(a.centerPoint);d.setRadiusPoint(a.radiusPoint);return d};c.construct=function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineCircle"};c._validRadiusTolerance=1;return c}(e.RedlineItem);e.RedlineCircle=f})(h.Redline||(h.Redline={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(a){this._points.push(a.copy())};return c}(a.EndcapShape);a.Polyline=f;f=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polylines=[];return b}__extends(c,a);c.prototype.clear=function(){this._polylines=
[]};c.prototype.createPolyline=function(){var a=[];this._polylines.push(a);return a};c.prototype.getPolylines=function(){return this._polylines};return c}(a.EndcapShape);a.PolylineCollection=f})(a.Shape||(a.Shape={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b){b=d.call(this,b)||this;b._uniqueId=a.GUID.create();b._points=[];b._polylineShape=new h.Shape.Polyline;b._previousDragPlanePosition=a.Point3.zero();b._polylineShape.setStrokeWidth(2);b._polylineShape.setStrokeColor(a.Color.red());return b}__extends(c,d);c.prototype.addPoint=function(a){this._points.push(a.copy())};c.prototype.getPoints=function(){var a=[];this._points.forEach(function(c){a.push(c.copy())});return a};c.prototype._update=
function(){var b=this._viewer.view;this._polylineShape.clearPoints();for(var c=0,d=this._points;c<d.length;c++){var e=a.Point2.fromPoint3(b.projectPoint(d[c]));this._polylineShape.pushPoint(e)}};c.prototype.draw=function(){this._update();this.isValid()&&this._viewer.markupManager.getRenderer().drawPolyline(this._polylineShape)};c.prototype.hit=function(b){this._update();var c=this._polylineShape.getStrokeWidth(),d=this._polylineShape.getPoints();if(1<d.length)for(var e=1;e<d.length;e++)if(a.Internal.pointOnLineSegment2d(b,
d[e-1],d[e],c))return!0;return!1};c.prototype.onSelect=function(){this._polylineShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._polylineShape.setStrokeWidth(2)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlinePolyline"};c.prototype.isValid=function(){return 1<this._points.length};c.prototype.onDragStart=function(a){var c=this._viewer.view;a=c.getCamera().getCameraPlaneIntersectionPoint(a,c);null!==a&&this._previousDragPlanePosition.assign(a);return!1};
c.prototype.onDragMove=function(b){var c=this._viewer.view;b=c.getCamera().getCameraPlaneIntersectionPoint(b,c);if(null!==b){for(var c=a.Point3.subtract(b,this._previousDragPlanePosition),d=0,e=this._points;d<e.length;d++)e[d].add(c);this._polylineShape.clearPoints();this._previousDragPlanePosition.assign(b)}return!0};c.prototype.toJson=function(){for(var a=[],c=0,d=this._points;c<d.length;c++)a.push(d[c].toJson());return{uniqueId:this._uniqueId,points:a}};c.prototype.forJson=function(){return this.toJson()};
c.fromJson=function(b,d){d=new c(d);d._uniqueId=b.uniqueId;var e=0;for(b=b.points;e<b.length;e++)d.addPoint(a.Point3.fromJson(b[e]));return d};c.construct=function(a,d){return c.fromJson(a,d)};return c}(e.RedlineItem);e.RedlinePolyline=f})(h.Redline||(h.Redline={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b){b=d.call(this,b)||this;b._uniqueId=a.GUID.create();b._point1=a.Point3.zero();b._point2=a.Point3.zero();b._rectangleShape=new h.Shape.Rectangle;b._previousDragPlanePosition=a.Point3.zero();b._rectangleShape.setFillOpacity(0);b._rectangleShape.setStrokeColor(a.Color.red());b._rectangleShape.setStrokeWidth(2);return b}__extends(c,d);c.prototype.setPoint1=function(a){this._point1.assign(a)};c.prototype.getPoint1=function(){return this._point1.copy()};
c.prototype.setPoint2=function(a){this._point2.assign(a)};c.prototype.getPoint2=function(){return this._point2.copy()};c.prototype.getUniqueId=function(){return this._uniqueId};c.prototype._update=function(){var b=this._viewer.view,c=b.projectPoint(this._point1),d=b.projectPoint(this._point2),b=new a.Point2(Math.min(c.x,d.x),Math.min(c.y,d.y)),c=new a.Point2(Math.max(c.x,d.x),Math.max(c.y,d.y)),c=a.Point2.subtract(c,b);this._rectangleShape.setPosition(b);this._rectangleShape.setSize(c)};c.prototype.draw=
function(){this._update();this._viewer.markupManager.getRenderer().drawRectangle(this._rectangleShape)};c.prototype.hit=function(b){this._update();var c=this._rectangleShape.getStrokeWidth(),d=this._rectangleShape.getPosition(),e=this._rectangleShape.getSize(),f=new a.Point2(d.x+e.x,d.y),h=new a.Point2(d.x,d.y+e.y),e=new a.Point2(d.x+e.x,d.y+e.y);return a.Internal.pointOnLineSegment2d(b,d,f,c)||a.Internal.pointOnLineSegment2d(b,f,e,c)||a.Internal.pointOnLineSegment2d(b,e,h,c)||a.Internal.pointOnLineSegment2d(b,
h,d,c)?!0:!1};c.prototype.onSelect=function(){this._rectangleShape.setStrokeWidth(4)};c.prototype.onDeselect=function(){this._rectangleShape.setStrokeWidth(2)};c.prototype.isValid=function(){var a=this._rectangleShape.getSize();return a.x>c._validSizeTolerance.x&&a.y>c._validSizeTolerance.y};c.prototype.onDragStart=function(a){var c=this._viewer.view;a=c.getCamera().getCameraPlaneIntersectionPoint(a,c);null!==a&&this._previousDragPlanePosition.assign(a);return!1};c.prototype.onDragMove=function(b){var c=
this._viewer.view;b=c.getCamera().getCameraPlaneIntersectionPoint(b,c);null!==b&&(c=a.Point3.subtract(b,this._previousDragPlanePosition),this._point1.add(c),this._point2.add(c),this._previousDragPlanePosition.assign(b));return!0};c.prototype.toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),point1:this._point1.toJson(),point2:this._point2.toJson()}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,d){d=new c(d);d._uniqueId=a.uniqueId;d.setPoint1(a.point1);
d.setPoint2(a.point2);return d};c.construct=function(a,d){return c.fromJson(a,d)};c.prototype.getClassName=function(){return"Communicator.Markup.Redline.RedlineRectangle"};c._validSizeTolerance=new a.Point2(5,5);return c}(e.RedlineItem);e.RedlineRectangle=f})(h.Redline||(h.Redline={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(){function d(a,b){this._sizeChanged=!1;this._sizeUpdateCallback=a;this._textUpdateCallback=b;this._createTextBox()}d.prototype._createTextBox=function(){var c=this;this._currentSize=d._defaultSize.copy();this._textArea=document.createElement("textarea");this._textArea.style.position="absolute";this._textArea.style.width=d._defaultSize.x+"px";this._textArea.style.height=d._defaultSize.y+"px";this._textArea.style.zIndex="1";this._textArea.style.pointerEvents=
"none";this._textArea.style.resize="none";this.setBorderWidth(2);this._textArea.onmousemove=function(b){b.stopPropagation();b=new a.Point2(parseInt(c._textArea.style.width,10),parseInt(c._textArea.style.height,10));c.setSize(b)};this._textArea.onmouseup=function(a){a.stopPropagation();c._sizeChanged&&(c._sizeChanged=!1,c._sizeUpdateCallback(c._currentSize))};this._textArea.oninput=function(){c._textUpdateCallback(c._textArea.value)}};d.prototype.setPosition=function(a){this._textArea.style.left=a.x+
"px";this._textArea.style.top=a.y+"px"};d.prototype.setBorderWidth=function(a){this._textArea.style.outline=a+"px solid red"};d.prototype.setText=function(a){this._textArea.textContent=a};d.prototype.setSize=function(a){this._currentSize.equals(a)||(this._sizeChanged=!0,this._currentSize.assign(a),this._textArea.style.width=a.x+"px",this._textArea.style.height=a.y+"px")};d.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents="auto";this._textArea.style.resize="both"};
d.prototype.blur=function(){this._textArea.blur();this._textArea.style.pointerEvents="none";this._textArea.style.resize="none"};d.prototype.getTextArea=function(){return this._textArea};d._defaultSize=new a.Point2(100,100);return d}();e.RedlineTextElement=f})(h.Redline||(h.Redline={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){var f=function(d){function c(b,f){void 0===f&&(f=c.defaultText);var h=d.call(this,b)||this;h._uniqueId=a.GUID.create();h._position=a.Point3.zero();h._size=new a.Point2(100,100);h._redlineElementId=null;h._previousDragPlanePosition=a.Point3.zero();h._text=f;h._redlineTextElement=new e.RedlineTextElement(function(a){h.setSize(a)},function(a){h.setText(a)});h._redlineTextElement.setText(h._text);h._callbacks={selectionArray:function(){h.onDeselect()}};h._viewer.setCallbacks(h._callbacks);
return h}__extends(c,d);c.prototype.setPosition=function(a){this._position.assign(a)};c.prototype.getPosition=function(){return this._position.copy()};c.prototype.setSize=function(a){this._viewer.trigger("redlineUpdated",this);this._size.assign(a)};c.prototype.setText=function(a){this._viewer.trigger("redlineUpdated",this);this._text=a};c.prototype.draw=function(){var b=a.Point2.fromPoint3(this._viewer.view.projectPoint(this._position));this._redlineTextElement.setPosition(b);null===this._redlineElementId&&
(this._redlineElementId=this._viewer.markupManager.addMarkupElement(this._redlineTextElement.getTextArea()))};c.prototype.hit=function(b){var c=this._redlineTextElement.getTextArea(),d=new a.Point2(parseFloat(c.style.left||"0"),parseFloat(c.style.top||"0")),c=new a.Point2(parseFloat(c.style.width||"0"),parseFloat(c.style.height||"0"));return a.Internal.pointInRect(b,d,c)};c.prototype.getClassName=function(){return c.className};c.prototype.onSelect=function(){this._redlineTextElement.setBorderWidth(4);
this._redlineTextElement.focus()};c.prototype.onDeselect=function(){this._redlineTextElement.setBorderWidth(2);this._redlineTextElement.blur()};c.prototype.isValid=function(){return 0<this._text.length};c.prototype.remove=function(){this._redlineElementId&&(this._viewer.markupManager.removeMarkupElement(this._redlineElementId),this._redlineElementId=null);null!==this._callbacks&&(this._viewer.unsetCallbacks(this._callbacks),this._callbacks=null);d.prototype.remove.call(this)};c.prototype.onDragStart=
function(a){var c=this._viewer.view;a=c.getCamera().getCameraPlaneIntersectionPoint(a,c);null!==a&&this._previousDragPlanePosition.assign(a);return!1};c.prototype.onDragMove=function(b){var c=this._viewer.view;b=c.getCamera().getCameraPlaneIntersectionPoint(b,c);if(null!==b){var c=a.Point3.subtract(b,this._previousDragPlanePosition),d=this.getPosition();d.add(c);this.setPosition(d);this._previousDragPlanePosition.assign(b)}return!0};c.prototype.toJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),
position:this._position.toJson(),size:this._size.toJson(),text:this._text}};c.prototype.forJson=function(){return this.toJson()};c.fromJson=function(a,d){d=new c(d,a.text);d._uniqueId=a.uniqueId;d.setPosition(a.position);d.setSize(a.size);return d};c.construct=function(a,d){return c.fromJson(a,d)};c.className="Communicator.Markup.Redline.RedlineText";c.defaultText="Type Here...";return c}(e.RedlineItem);e.RedlineText=f})(h.Redline||(h.Redline={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator=
{}));
(function(a){(function(h){(function(e){var f=function(){function d(){this._svgDefsElement=this._svgCanvas=null;this._svgElements=[];this._svgTextElements=[]}d.prototype._setCanvas=function(a){this._svgCanvas=a;this._svgDefsElement=document.createElementNS(e.Util.svgNamespace,"defs");this._svgCanvas.appendChild(this._svgDefsElement)};d.prototype._clear=function(){if(null===this._svgCanvas||null===this._svgDefsElement)throw new a.CommunicatorError("canvas not set");for(;this._svgCanvas.firstChild;)this._svgCanvas.removeChild(this._svgCanvas.firstChild);this._svgElements=
[];for(this._svgTextElements=[];this._svgDefsElement.firstChild;)this._svgDefsElement.removeChild(this._svgDefsElement.firstChild);this._svgCanvas.appendChild(this._svgDefsElement)};d.prototype._finalize=function(){if(null===this._svgCanvas)throw new a.CommunicatorError("canvas not set");for(var c=0,b=this._svgElements;c<b.length;c++){var d=b[c];this._svgCanvas.appendChild(d)}c=0;for(b=this._svgTextElements;c<b.length;c++)d=b[c],this._svgCanvas.appendChild(d)};d.prototype.drawCircle=function(a){return this._addCircleNode(a.getCenter(),
a.getRadius(),a)};d.prototype.drawCircles=function(a){for(var b=[],d=0,e=a.getCircles();d<e.length;d++){var f=e[d],f=this._addCircleNode(f.center,f.radius,a);b.push(f)}return b};d.prototype.drawLine=function(a){return this._addLineElement(a.getP1(),a.getP2(),a)};d.prototype.drawLines=function(a){for(var b=[],d=0,e=a.getLines();d<e.length;d++){var f=e[d],f=this._addLineElement(f.p1,f.p2,a);b.push(f)}return b};d.prototype.drawText=function(a){return this._addTextElement(a.getText(),a.getPosition(),
a)};d.prototype.drawTexts=function(a){for(var b=[],d=0,e=a.getStrings();d<e.length;d++){var f=e[d],f=this._addTextElement(f.text,f.position,a);b.push(f)}return b};d.prototype.measureText=function(c,b){if(null===this._svgCanvas)throw new a.CommunicatorError("canvas not set");c=this._createTextElement(c,a.Point2.zero(),b);this._svgCanvas.appendChild(c);b=c.getBoundingClientRect();b=new a.Point2(b.width,b.height);this._svgCanvas.removeChild(c);return b};d.prototype.measureTextBox=function(a){var b=this.measureText(a.getTextString(),
a.getTextPortion());b.x+=2*a.getBoxPortion().getStrokeWidth();b.y+=2*a.getBoxPortion().getStrokeWidth();b.x+=2*a.getPadding();b.y+=2*a.getPadding();return b};d.prototype.drawPolyline=function(a){return this._addPolylineElement(a.getPoints(),a)};d.prototype.drawPolylines=function(a){for(var b=[],d=0,e=a.getPolylines();d<e.length;d++){var f=this._addPolylineElement(e[d],a);b.push(f)}return b};d.prototype.drawPolygon=function(a){return this._addPolygonElement(a.getPoints(),a)};d.prototype.drawPolygons=
function(a){for(var b=[],d=0,e=a.getPolygons();d<e.length;d++){var f=this._addPolygonElement(e[d],a);b.push(f)}return b};d.prototype.drawRectangle=function(a){return this._addRectangleElement(a.getPosition(),a.getSize(),a)};d.prototype.drawRectangles=function(a){for(var b=[],d=0,e=a.getRectangles();d<e.length;d++){var f=e[d],f=this._addRectangleElement(f.position,f.size,a);b.push(f)}return b};d.prototype.drawTextBox=function(a){return this._addTextBoxElement(a.getTextString(),a.getPosition(),a)};
d.prototype.drawTextBoxes=function(a){for(var b=[],d=0,e=a.getStrings();d<e.length;d++){var f=e[d],f=this._addTextBoxElement(f.text,f.position,a);b.push(f)}return b};d.prototype._addTextBoxElement=function(a,b,d){var e=this.measureText(a,d.getTextPortion());e.x+=2*d.getPadding();e.y+=2*d.getPadding();var f=[],e=this._addRectangleElement(b,e,d.getBoxPortion(),!0);f.push(e);b=b.copy();b.x+=d.getPadding();b.y+=d.getPadding()/2+d.getBoxPortion().getStrokeWidth();a=this._addTextElement(a,b,d.getTextPortion());
f.push(a);return f};d.prototype._renderEndcaps=function(c,b,d,f){if(null===this._svgDefsElement)throw new a.CommunicatorError("canvas not set");d.getStartEndcapType()===a.Markup.Shape.EndcapType.Arrowhead?(d.getEndcapsInverted()?(c=e.Util.createEndArrowMarker(d.getStartEndcapSize(),d.getStartEndcapColor()),c.refX.baseVal.value=d.getStartEndcapSize()):c=e.Util.createStartArrowMarker(d.getStartEndcapSize(),d.getStartEndcapColor()),f.style.markerStart="url(#"+c.id+")",this._svgDefsElement.appendChild(c)):
d.getStartEndcapType()===a.Markup.Shape.EndcapType.Circle&&(c=e.Util.createCircleMarker(c,d.getStrokeWidth(),d.getStartEndcapSize(),d.getStartEndcapColor()),this._addSVGElement(c));d.getEndEndcapType()===a.Markup.Shape.EndcapType.Arrowhead?(c=d.getEndcapsInverted()?e.Util.createStartArrowMarker(d.getEndEndcapSize(),d.getEndEndcapColor()):e.Util.createEndArrowMarker(d.getEndEndcapSize(),d.getEndEndcapColor()),f.style.markerEnd="url(#"+c.id+")",this._svgDefsElement.appendChild(c)):d.getEndEndcapType()===
a.Markup.Shape.EndcapType.Circle&&(c=e.Util.createCircleMarker(b,d.getStrokeWidth(),d.getEndEndcapSize(),d.getEndEndcapColor()),this._addSVGElement(c))};d.prototype._createTextElement=function(a,b,d){var f=document.createElementNS(e.Util.svgNamespace,"text"),h=0;for(a=a.split("\n");h<a.length;h++){var p=a[h],k=document.createElementNS(e.Util.svgNamespace,"tspan");k.textContent=p;k.setAttributeNS(null,"x",""+b.x);k.setAttributeNS(null,"dy","1.2em");f.appendChild(k)}(h=d.getFontFamily())&&f.setAttributeNS(null,
"font-family",h);f.setAttributeNS(null,"font-size",d.getFontSize().toString());f.setAttributeNS(null,"x",""+b.x);f.setAttributeNS(null,"y",""+b.y);this._setGenericFillAttributes(f,d);this._setGenericStrokeAttributes(f,d);return f};d.prototype._addTextElement=function(a,b,d){a=this._createTextElement(a,b,d);this._addSVGTextItemElement(a);return a};d.prototype._addRectangleElement=function(a,b,d,f){void 0===f&&(f=!1);var h=document.createElementNS(e.Util.svgNamespace,"rect");h.setAttributeNS(null,"x",
a.x.toString());h.setAttributeNS(null,"y",a.y.toString());h.setAttributeNS(null,"width",b.x.toString());h.setAttributeNS(null,"height",b.y.toString());a=d.getBorderRadius();0<a&&(h.setAttributeNS(null,"rx",a.toString()),h.setAttributeNS(null,"ry",a.toString()));this._setGenericFillAttributes(h,d);this._setGenericStrokeAttributes(h,d);f?this._addSVGTextItemElement(h):this._addSVGElement(h);return h};d.prototype._addLineElement=function(a,b,d){var f=document.createElementNS(e.Util.svgNamespace,"line");
f.setAttributeNS(null,"x1",a.x.toString());f.setAttributeNS(null,"y1",a.y.toString());f.setAttributeNS(null,"x2",b.x.toString());f.setAttributeNS(null,"y2",b.y.toString());this._setGenericStrokeAttributes(f,d);this._addSVGElement(f);this._renderEndcaps(a,b,d,f);return f};d.prototype._addPolygonElement=function(a,b){a=e.Util.svgPointString(a);var d=document.createElementNS(e.Util.svgNamespace,"polygon");d.setAttributeNS(null,"points",a);this._setGenericStrokeAttributes(d,b);this._setGenericFillAttributes(d,
b);this._addSVGElement(d);return d};d.prototype._addPolylineElement=function(a,b){var d=e.Util.svgPointString(a),f=document.createElementNS(e.Util.svgNamespace,"polyline");f.setAttributeNS(null,"points",d);f.setAttributeNS(null,"fill","none");this._renderEndcaps(a[0],a[a.length-1],b,f);this._setGenericStrokeAttributes(f,b);this._addSVGElement(f);return f};d.prototype._addCircleNode=function(a,b,d){var f=document.createElementNS(e.Util.svgNamespace,"circle");f.setAttributeNS(null,"cx",a.x.toString());
f.setAttributeNS(null,"cy",a.y.toString());f.setAttributeNS(null,"r",b.toString());this._setGenericFillAttributes(f,d);this._setGenericStrokeAttributes(f,d);this._addSVGElement(f);return f};d.prototype._setGenericFillAttributes=function(a,b){a.setAttributeNS(null,"fill",e.Util.svgColorRgbString(b.getFillColor()));a.setAttributeNS(null,"fill-opacity",b.getFillOpacity().toString())};d.prototype._setGenericStrokeAttributes=function(a,b){a.setAttributeNS(null,"stroke",e.Util.svgColorRgbString(b.getStrokeColor()));
a.setAttributeNS(null,"stroke-width",b.getStrokeWidth().toString())};d.prototype._addSVGTextItemElement=function(a){this._svgTextElements.push(a)};d.prototype._addSVGElement=function(a){this._svgElements.push(a)};return d}();e.SVGMarkupRenderer=f})(h.SVG||(h.SVG={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(h){(function(e){(function(e){function d(a){return"rgb("+a.r+", "+a.g+", "+a.b+")"}e.svgNamespace="http://www.w3.org/2000/svg";e.svgColorRgbString=d;e.svgPointString=function(a){for(var b="",d=0;d<a.length;d++)d&&(b+=" "),b+=a[d].x+","+a[d].y;return b};e.createStartArrowMarker=function(c,b){var g=1.1*c,h=new a.Point2(g,0),v=new a.Point2(g,c),p=new a.Point2(0,c/2),k=document.createElementNS(e.svgNamespace,"marker");k.id=a.GUID.create();k.markerWidth.baseVal.value=g;k.markerHeight.baseVal.value=
c;k.setOrientToAuto();k.refY.baseVal.value=c/2;c="M"+h.x+","+h.y+" L"+v.x+","+v.y+" L"+p.x+","+p.y+" Z";g=document.createElementNS(e.svgNamespace,"path");g.setAttribute("d",c);g.setAttributeNS(null,"fill",d(b));k.appendChild(g);return k};e.createEndArrowMarker=function(c,b){var g=1.1*c,h=a.Point2.zero(),v=new a.Point2(0,c),p=new a.Point2(g,c/2),k=document.createElementNS(e.svgNamespace,"marker");k.id=a.GUID.create();k.markerWidth.baseVal.value=g;k.markerHeight.baseVal.value=c;k.setOrientToAuto();
k.refY.baseVal.value=c/2;k.refX.baseVal.value=c;c="M"+h.x+","+h.y+" L"+v.x+","+v.y+" L"+p.x+","+p.y+" Z";g=document.createElementNS(e.svgNamespace,"path");g.setAttribute("d",c);g.setAttributeNS(null,"fill",d(b));k.appendChild(g);return k};e.createCircleMarker=function(a,b,g,h){g/=2;h=d(h);var v=document.createElementNS(e.svgNamespace,"circle");v.setAttributeNS(null,"cx",a.x.toString());v.setAttributeNS(null,"cy",a.y.toString());v.setAttributeNS(null,"r",g.toString());v.setAttributeNS(null,"fill",
h);0<b&&(v.setAttributeNS(null,"stroke-width",b.toString()),v.setAttributeNS(null,"stroke",h));return v}})(e.Util||(e.Util={}))})(h.SVG||(h.SVG={}))})(a.Internal||(a.Internal={}))})(Communicator||(Communicator={}));
(function(a){(function(a){(function(a){var f=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._points=[];return b}__extends(c,a);c.prototype.clearPoints=function(){this._points=[]};c.prototype.getPoints=function(){return this._points};c.prototype.pushPoint=function(a){this._points.push(a.copy())};return c}(a.FilledShape);a.Polygon=f;f=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._polygons=[];return b}__extends(c,a);c.prototype.clear=function(){this._polygons=
[]};c.prototype.createPolygon=function(){var a=[];this._polygons.push(a);return a};c.prototype.getPolygons=function(){return this._polygons};return c}(a.FilledShape);a.PolygonCollection=f})(a.Shape||(a.Shape={}))})(a.Markup||(a.Markup={}))})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(e,d){this.origin=a.Point3.zero();this.direction=new a.Point3(0,0,1);e&&this.origin.assign(e);d&&this.direction.assign(d)}e.prototype.copy=function(){return new e(this.origin,this.direction)};e.prototype.assign=function(a){this.origin.assign(a.origin);this.direction.assign(a.direction);return this};e.prototype.negate=function(){this.direction.negate();return this};return e}();a.Ray=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(){this.normal=a.Point3.zero();this.d=0}e.prototype.setFromPointAndNormal=function(e,d){this.normal.assign(d);this.d=-a.Point3.dot(d,e);return this};e.prototype.setFromPoints=function(e,d,c){this.normal=a.Point3.cross(a.Point3.subtract(d,e),a.Point3.subtract(c,e)).normalize();this.d=-a.Point3.dot(e,this.normal)};e.prototype.setFromCoefficients=function(a,d,c,b){this.normal.set(a,d,c);this.d=b};e.prototype.getCoefficients=function(){var a=this.normal;return[a.x,
a.y,a.z,this.d]};e.prototype.distanceToPoint=function(e){return a.Point3.dot(this.normal,e)+this.d};e.prototype.rayIntersection=function(e){var d=a.Point3.zero();return this.intersectsRay(e,d)?d:null};e.prototype.intersectsRay=function(e,d){var c=a.Point3.dot(this.normal,e.direction),b=this.distanceToPoint(e.origin),g=-b/c;return 0<=g&&0<Math.abs(c)?(d&&(c=e.direction.copy().scale(g),d.set(e.origin.x+c.x,e.origin.y+c.y,e.origin.z+c.z)),!0):0<=g&&0>=Math.abs(b)?(d&&d.assign(e.origin),!0):!1};e.prototype.determineSide=
function(a){return 0<this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z+this.d?!0:!1};e.prototype.copy=function(){var a=new e;a.normal.assign(this.normal);a.d=this.d;return a};e.prototype.assign=function(a){this.normal.assign(a.normal);this.d=a.d};e.prototype.equals=function(a){return this.normal.equals(a.normal)&&this.d===a.d};e.createFromPointAndNormal=function(a,d){return(new e).setFromPointAndNormal(a,d)};e.createFromPoints=function(a,d,c){var b=new e;b.setFromPoints(a,d,c);return b};e.createFromCoefficients=
function(a,d,c,b){var g=new e;g.setFromCoefficients(a,d,c,b);return g};return e}();a.Plane=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function a(e,d,c,b){this.x=e;this.y=d;this.z=c;this.w=b}a.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this};a.prototype.set=function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b};a.prototype.assign=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w};a.zero=function(){return new a(0,0,0,0)};return a}();a.Point4=h})(Communicator||(Communicator={}));
(function(a){var h=function(){function e(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b}e.prototype.set=function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b};e.prototype.copy=function(){return new e(this.x,this.y,this.z,this.w)};e.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w};e.prototype.fromArray=function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this};e.prototype.toArray=function(a){a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return this};
e.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};e.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};e.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)};e.add=function(a,d){return new e(a.x+d.x,a.y+d.y,a.z+d.z,a.w+d.w)};e.subtract=function(a,d){return new e(a.x-d.x,a.y-d.y,a.z-d.z,a.w-d.w)};e.Identity=function(){return new e(0,0,0,1)};e.toMatrix=
function(e){var d=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,d=2/d,c=e.x*d,b=e.y*d,g=e.z*d,d=e.w*c,h=e.w*b,v=e.w*g,c=e.x*c,p=e.x*b,k=e.x*g,b=e.y*b,r=e.y*g;e=e.z*g;g=new a.Matrix;g.m[0]=1-(b+e);g.m[1]=p+v;g.m[2]=k-h;g.m[3]=0;g.m[4]=p-v;g.m[5]=1-(c+e);g.m[6]=r+d;g.m[7]=0;g.m[8]=k+h;g.m[9]=r-d;g.m[10]=1-(c+b);g.m[11]=0;g.m[12]=0;g.m[13]=0;g.m[14]=0;g.m[15]=1;return g};e.createFromMatrix=function(a){var d=[],c=a.m[0]+a.m[5]+a.m[10];if(0<c){var b=Math.sqrt(c+1);d[3]=.5*b;b=.5/b;d[0]=b*(a.m[6]-a.m[9]);d[1]=b*(a.m[8]-
a.m[2]);d[2]=b*(a.m[1]-a.m[4])}else{c=0;a.m[5]>a.m[0]&&(c=1);a.m[10]>a.m[4*c+c]&&(c=2);var b=[1,2,0],g=b[c],h=b[g],b=Math.sqrt(a.m[4*c+c]-(a.m[4*g+g]+a.m[4*h+h])+1);d[c]=.5*b;b=.5/b;d[3]=b*(a.m[4*g+h]-a.m[4*h+g]);d[g]=b*(a.m[4*c+g]+a.m[4*g+c]);d[h]=b*(a.m[4*c+h]+a.m[4*h+c])}return e.Identity().fromArray(d)};e.interpolate=function(a,d,c){var b=[],g=[],h=[];a.toArray(b);d.toArray(g);a=b[0]*g[0]+b[1]*g[1]+b[2]*g[2]+b[3]*g[3];if(1+a>e._epsilon){if(1-a>e._epsilon){d=e._arccos(a);var v=1/Math.sin(d);a=
v*Math.sin((1-c)*d);c=v*Math.sin(c*d)}else a=1-c;for(d=0;4>d;++d)h[d]=a*b[d]+c*g[d]}else for(h[0]=-b[1],h[1]=b[0],h[2]=-b[3],h[3]=b[2],a=Math.sin(.5*Math.PI*(1-c)),c=Math.sin(.5*Math.PI*c),d=0;3>d;++d)h[d]=a*b[d]+c*h[d];return e.Identity().fromArray(h)};e._arccos=function(a){return-1>a?Math.PI:1<a?0:Math.acos(a)};e._epsilon=1E-5;return e}();a.Quaternion=h})(Communicator||(Communicator={}));
(function(a){(function(h){var e;(function(a){a[a.None=0]="None";a[a.IgnoreCapping=1]="IgnoreCapping"})(e=h.SelectionRequirements||(h.SelectionRequirements={}));var f=function(){function d(){}d.prototype.onMouseDown=function(a){a};d.prototype.onMouseMove=function(a){a};d.prototype.onMouseUp=function(a){a};d.prototype.onMousewheel=function(a){a};d.prototype.onTouchStart=function(a){a};d.prototype.onTouchMove=function(a){a};d.prototype.onTouchEnd=function(a){a};d.prototype.onKeyDown=function(a){a};d.prototype.onKeyUp=
function(a){a};d.prototype.onDeactivate=function(){};d.prototype.onActivate=function(){};d.prototype.onViewOrientationChange=function(){};d.prototype.stopInteraction=function(){};d.prototype.needsSelection=function(a,b,d){return!1};d.prototype._selectionMask=function(c){return a.SelectionMask.All};d.prototype.selectionRequirements=function(a){return e.None};d.prototype._onlySelectOverlays=function(a){return!1};return d}();h.Operator=f})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){function a(c,b){this._button=c;this._modifier=b}a.prototype.getButton=function(){return this._button};a.prototype.getModifier=function(){return this._modifier};return a}();h.ButtonModifier=e;var f=function(d){function c(b){var c=d.call(this)||this;c._ptFirst=a.Point2.zero();c._ptPrevious=a.Point2.zero();c._ptCurrent=a.Point2.zero();c._dragging=!1;c._dragCount=0;c._primaryTouchId=null;c._mapping=[];c._buttonModifierActive=!1;c._doubleClickInterval=200;c._firstMouseDownTime=
null;c._isDoubleClick=!1;c._viewer=b;return c}__extends(c,d);c.prototype.onDoubleClick=function(a){a};c.prototype.onMouseDown=function(a){this._firstMouseDownTime?Date.now()-this._firstMouseDownTime<this._doubleClickInterval?(this._isDoubleClick=!0,this._firstMouseDownTime=null):this._firstMouseDownTime=Date.now():(this._firstMouseDownTime=Date.now(),this._isDoubleClick=!1);if(this._isDoubleClick)this.onDoubleClick(a);else{if(this._buttonModifierActive=this.checkMapping(a))a=a.getPosition(),this._ptFirst.assign(a),
this._ptPrevious.assign(a),this._ptCurrent.assign(a);this._dragging=!0}};c.prototype.onMouseMove=function(a){this.isActive()&&(this._ptPrevious.assign(this._ptCurrent),this._ptCurrent.assign(a.getPosition()),this._dragging&&!this._ptCurrent.equals(this._ptPrevious)&&(++this._dragCount,1===this._dragCount&&this._viewer.trigger("beginInteraction")))};c.prototype.onMouseUp=function(a){a;this._buttonModifierActive&&this.stopInteraction();this._dragging=!1};c.prototype.stopInteraction=function(){this._viewer.trigger("endInteraction");
this._dragging=!1;this._dragCount=0;this._buttonModifierActive=!1};c.prototype.isDragging=function(){return this._dragging};c.prototype.isActive=function(){return(this._buttonModifierActive||null!==this._primaryTouchId)&&!this._isDoubleClick&&!this._viewer.getContextMenuStatus()};c.prototype.onTouchStart=function(b){if(null===this._primaryTouchId){this._primaryTouchId=b.getId();var c=b.getPosition(),c=new a.Event.MouseInputEvent(c.x,c.y,a.Button.None,b.getButtons(),a.KeyModifiers.None,a.MouseInputType.Down);
c._setCompositePickResult(b._getCompositePickResult());this.onMouseDown(c)}b.setHandled(this.setHandled())};c.prototype.onTouchMove=function(b){if(this._primaryTouchId===b.getId()){var c=b.getPosition(),c=new a.Event.MouseInputEvent(c.x,c.y,a.Button.None,b.getButtons(),a.KeyModifiers.None,a.MouseInputType.Move);c._setCompositePickResult(b._getCompositePickResult());this.onMouseMove(c)}b.setHandled(this.setHandled())};c.prototype.onTouchEnd=function(b){if(this._primaryTouchId===b.getId()){var c=b.getPosition(),
c=new a.Event.MouseInputEvent(c.x,c.y,a.Button.None,b.getButtons(),a.KeyModifiers.None,a.MouseInputType.Up);c._setCompositePickResult(b._getCompositePickResult());this.onMouseUp(c);this._primaryTouchId=null}b.setHandled(this.setHandled())};c.prototype.addMapping=function(b,c){void 0===c&&(c=a.KeyModifiers.None);this._mapping.push(new e(b,c))};c.prototype.clearMapping=function(){this._mapping=[]};c.prototype.setMapping=function(b,c){void 0===c&&(c=a.KeyModifiers.None);this._mapping=[];this._mapping.push(new e(b,
c))};c.prototype.checkMapping=function(a){if(0===this._mapping.length)return!0;for(var c=0,d=this._mapping;c<d.length;c++){var e=d[c];if(e.getButton()===a.getButton()&&e.getModifier()===a.getModifiers())return!0}return!1};c.prototype.setHandled=function(){return!1};c.prototype.onDeactivate=function(){var a=this.stopInteraction();this._primaryTouchId=null;return a};return c}(h.Operator);h.OperatorBase=f})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(d){function c(b){b=d.call(this,b)||this;b._rectangle=new a.Markup.Shape.Rectangle;b._markupHandle=null;b._dim=new a.Point2(0,0);b.initialPosition=new a.Point2(0,0);b.currentPosition=new a.Point2(0,0);b.min=new a.Point2(0,0);b.max=new a.Point2(0,0);b._name="_RectangleMarkup";b._rectangle.setFillOpacity(0);return b}__extends(c,d);c.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawRectangle(this._rectangle)};c.prototype.updateCurrentPosition=
function(b){this.currentPosition.assign(b);this._rectangle.setStrokeColor(this.initialPosition.x<this.currentPosition.x?a.Color.red():a.Color.blue());this.min.assign(this.initialPosition);this.max.assign(this.currentPosition);this.max.x<this.min.x&&(b=this.max.x,this.max.x=this.min.x,this.min.x=b);this.max.y<this.min.y&&(b=this.max.y,this.max.y=this.min.y,this.min.y=b);this._dim.assign(this.max);this._dim.subtract(this.min);this._updateRectangleVertices()};c.prototype._updateRectangleVertices=function(){this._rectangle.setPosition(this.min);
this._rectangle.setSize(this._dim)};c.prototype.activate=function(a){this.initialPosition.assign(a);this.currentPosition.assign(a);this.min.assign(a);this.max.assign(a);this._dim.set(0,0);this._rectangle.setStrokeWidth(1);this._updateRectangleVertices();this._markupHandle=this._viewer.markupManager.registerMarkup(this)};c.prototype.deactivate=function(){this.initialPosition.set(0,0);this.currentPosition.set(0,0);this.min.set(0,0);this.max.set(0,0);this._dim.set(0,0);this._rectangle.setStrokeWidth(0);
this._updateRectangleVertices();var a=this._viewer.markupManager;null!==this._markupHandle&&(a.unregisterMarkup(this._markupHandle),this._markupHandle=null);a.refreshMarkup()};c.prototype.isActive=function(){return null!==this._markupHandle};return c}(a.Markup.Measure.MeasureMarkup),f=function(d){function c(b){var c=d.call(this,b)||this;c._forceEffectiveSceneVisibilityMask=a.SelectionMask.None;c._rectangleMarkup=new e(b);c._incrementalSelection=a.Util.IncrementalSelection.create("SelectionManager",
b);b.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.clearSelection()];case 1:return a.sent(),[2,this.waitForIdle()]}})})},selectionArray:function(a){0===a.length&&c._incrementalSelection.stopSelection()}});return c}__extends(c,d);c.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};c.prototype.setForceEffectiveSceneVisibilityMask=
function(a){this._forceEffectiveSceneVisibilityMask=a};c.prototype.hasActiveSelection=function(){return!this._incrementalSelection.isIdle()};c.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};c.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.clearSelection()]})})};c.prototype._allowSelection=
function(a,c){return a.x===c.x||a.y===c.y?!1:!0};c.prototype._createBeginConfig=function(b,c,d){var e=new a.IncrementalPickConfig;e.forceEffectiveSceneVisibilityMask=this._forceEffectiveSceneVisibilityMask;e.ignoreCuttingSections=!1;e.ignoreUnrequestedInstances=!0;d&&(e.mustBeFullyContained=!0);return{pickConfig:e,areaCssMin:b,areaCssMax:c}};c.prototype._performSelection=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,e,f,h;return __generator(this,function(r){switch(r.label){case 0:return c=
this._rectangleMarkup.min.copy(),d=this._rectangleMarkup.max.copy(),e=this._rectangleMarkup.initialPosition.x<this._rectangleMarkup.currentPosition.x,b?[4,this.clearSelection()]:[3,2];case 1:r.sent(),r.label=2;case 2:if(!this._allowSelection(c,d))return[2];f=this._createBeginConfig(c,d,e);r.label=3;case 3:return r.trys.push([3,5,,6]),[4,this._incrementalSelection.performSelection(f)];case 4:return[2,r.sent()];case 5:h=r.sent();if(!(h instanceof a.SelectionInvalidatedError))throw h;return[3,6];case 6:return[2]}})})};
c.prototype.setHandled=function(){return!0};c.prototype.onKeyUp=function(b){b.getKeyCode()===a.KeyCode.Escape&&this.clearSelection();d.prototype.onKeyUp.call(this,b)};c.prototype.onMouseDown=function(a){d.prototype.onMouseDown.call(this,a);this.isActive()&&(a.setHandled(!0),this._rectangleMarkup.isActive()&&this._rectangleMarkup.deactivate(),this._rectangleMarkup.activate(a.getPosition()))};c.prototype.onMouseMove=function(a){d.prototype.onMouseMove.call(this,a);this.isActive()&&this._rectangleMarkup.isActive()&&
(a.setHandled(!0),this._rectangleMarkup.updateCurrentPosition(a.getPosition()),this._viewer.markupManager.refreshMarkup())};c.prototype.onMouseUp=function(a){if(this.isActive()&&this._rectangleMarkup.isActive()){a.setHandled(!0);this._rectangleMarkup.updateCurrentPosition(a.getPosition());var c=!a.controlDown();this._performSelection(c)}this._rectangleMarkup.isActive()&&this._rectangleMarkup.deactivate();d.prototype.onMouseUp.call(this,a)};return c}(h.OperatorBase);h.AreaSelectionOperator=f})(a.Operator||
(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a){var b=e.call(this,a)||this;b._axisTriad=a.view.getAxisTriad();return b}__extends(d,e);d.prototype.needsSelection=function(c,b,d){return(c===a.EventType.MouseUp||c===a.EventType.TouchEnd)&&this._axisTriad.getEnabled()&&this._axisTriad._geometryHasBeenCreated()&&this._axisTriad._insideOverlay(d)?!0:!1};d.prototype._selectionMask=function(c){c;return a.SelectionMask.Face};d.prototype._onlySelectOverlays=function(){return!0};d.prototype.onMouseUp=
function(c){if(this._axisTriad.getEnabled()&&25>a.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()){var b=c._getPickResult(this._selectionMask(a.EventType.MouseUp)),b=this._axisTriad._onClickSelection(b);b}e.prototype.onMouseUp.call(this,c)};return d}(h.OperatorBase);h.AxisTriadOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(){return function(a,c,b,e,f){this.section=a;this.node=c;this.planeIndex=b;this.plane=e;this.selectionPosition=f;this.origPlaneD=e.d}}(),f=function(d){function c(a,c){a=d.call(this,a)||this;a._handled=!1;a._context=null;a._cuttingManager=c;return a}__extends(c,d);c.prototype.onMouseDown=function(a){var c=this;d.prototype.onMouseDown.call(this,a);this._handled=!1;this.isActive()&&function(){return __awaiter(c,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return[4,this._startSelection(a)];case 1:return c.sent(),[2]}})})}()};c.prototype.onMouseMove=function(a){d.prototype.onMouseMove.call(this,a);var c=this._context;this.isActive()&&null!==c&&(a.setHandled(!0),this._updatePlane(a.getPosition(),c,!1),this._viewer.trigger("cuttingPlaneDrag",c.section,c.planeIndex))};c.prototype._updatePlane=function(b,c,d){var e=c.selectionPosition,f=c.plane.normal.copy().add(c.selectionPosition),h=this._viewer.view.unprojectPoint(b,
0);b=this._viewer.view.unprojectPoint(b,.5);null!==h&&null!==b&&(e=a.Util.lineLineIntersect(e,f,h,b),null!==e&&(e=a.Point3.subtract(e,c.selectionPosition),e=0>a.Point3.dot(e,c.plane.normal)?e.length():-e.length(),c.plane.d=c.origPlaneD+e,e=c.plane.normal.copy().scale(-e),e=(new a.Matrix).setTranslationComponent(e.x,e.y,e.z),c.section.updatePlane(c.planeIndex,c.plane,e,d,!1)),this._cuttingManager.delayCapping())};c.prototype.onMouseUp=function(a){if(this.isActive()){var c=this._context;null!==c&&(this._updatePlane(a.getPosition(),
c,!0),this._viewer.trigger("cuttingPlaneDragEnd",c.section,c.planeIndex));this._context=null;a.setHandled(this._handled)}d.prototype.onMouseUp.call(this,a)};c.prototype.setHandled=function(){return this._handled};c.prototype._startSelection=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,f,h,k,r,m,n;return __generator(this,function(q){switch(q.label){case 0:return this._context=null,c=b.getPosition(),d=a.SelectionMask.Face|a.SelectionMask.Line,f=new a.PickConfig(d),f.ignoreCappingGeometry=
!0,f.forceEffectiveSceneVisibilityMask=a.SelectionMask.Face,[4,this._viewer.view.compositePickFromPoint(c,f)];case 1:h=q.sent();k=h.fetchMostRelevant(d);if(null===k)return[2];r=k.getNodeId();m=this._cuttingManager.getCuttingSectionFromNodeId(r);null!==m&&(b.setHandled(!0),this._handled=!0,n=m.getPlaneIndexByNodeId(r),this._context=new e(m,r,n,m.getPlane(n),k.getPosition()),this._cuttingManager.delayCapping(),this._viewer.trigger("cuttingPlaneDragStart",m,n));return[2]}})})};return c}(h.OperatorBase);
h.CuttingPlaneOperator=f})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c){var b=e.call(this,c)||this;b._draggingHandle=!1;b._rotationMatrix=new a.Matrix;b._newRotationMatrix=new a.Matrix;b._translation=a.Point3.zero();b._newTranslation=a.Point3.zero();b._nodeIds=[];b._initialLocalNodeMatrices=[];b._newLocalNodeMatrices=[];b._trackedPoints=[];b._trackedPointsPositions=[];b._trackedPointCount=0;b._previousContextClick=!1;b._overlayIndex=null;b._activeNodeId=null;b._handleEventType=a.HandleEventType.Translate;b._highlightedHandleId=
null;b._handleSize=1;b._explodeActive=!1;b._measureActive=!1;b._settingMatrixInProgress=!1;b._handleMarkup=new a.Markup.HandleMarkup(c);c.setCallbacks({explode:function(a){b._explodeActive=0<a;b._explodeActive&&b.removeHandles()},measurementBegin:function(){b._measureActive=!0;b.removeHandles()},measurementCreated:function(){b._measureActive=!1}});return b}__extends(d,e);d.prototype.setAxisMeshData=function(a){return this._handleMarkup.setAxisMeshData(a)};d.prototype.setPlaneMeshData=function(a){return this._handleMarkup.setPlaneMeshData(a)};
d.prototype.setViewPlaneMeshData=function(a){return this._handleMarkup.setViewPlaneMeshData(a)};d.prototype.setRotateMeshData=function(a){return this._handleMarkup.setRotateMeshData(a)};d.prototype.addTrackedPoint=function(a){var b=this._trackedPointCount;this._trackedPoints[b]=a.copy();this._trackedPointsPositions[b]=a.copy();++this._trackedPointCount;return b};d.prototype.getTrackedPoints=function(){return this._trackedPointsPositions};d.prototype.clearTrackedPoints=function(){this._trackedPoints.length=
0;this._trackedPointCount=this._trackedPointsPositions.length=0};d.prototype.isEnabled=function(){return!this._explodeActive&&!this._measureActive&&!this._viewer.isDrawingSheetActive()};d.prototype._guardEnabled=function(){if(!this.isEnabled()){var c=this._explodeActive?"Handles are not enabled when the model is exploded":this._measureActive?"Handles are not enabled while a measurement is in progress.":this._viewer.isDrawingSheetActive()?"Handles are not enabled for 2d drawings.":"Handles are not enabled.";
throw new a.CommunicatorError(c);}};d.prototype.setHandleSize=function(a){this._handleSize=a};d.prototype.addHandles=function(a,b){void 0===b&&(b=null);return __awaiter(this,void 0,void 0,function(){var d;return __generator(this,function(e){switch(e.label){case 0:return this._previousContextClick=!1,this._guardEnabled(),b?[3,2]:[4,this._viewer.model.getNodesBounding(a)];case 1:return d=e.sent(),[2,this.addHandles(a,d.center())];case 2:return[4,this.removeHandles()];case 3:return e.sent(),this._nodeIds=
a,[2,this._handleMarkup.addHandles(b,this._handleSize)]}})})};d.prototype.addAxisTranslationHandle=function(a,b,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addAxisTranslationHandle(a,b,d,e)]})})};d.prototype.addAxisRotationHandle=function(a,b,d,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(f){this._previousContextClick=!1;this._guardEnabled();
return[2,this._handleMarkup.addRotateHandle(a,b,d,e)]})})};d.prototype.addPlaneTranslationHandle=function(a,b,d,e,f){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(h){this._previousContextClick=!1;this._guardEnabled();return[2,this._handleMarkup.addPlaneTranslationHandle(a,b,d,e,f)]})})};d.prototype.addViewPlaneTranslationHandle=function(a,b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){this._previousContextClick=!1;this._guardEnabled();
return[2,this._handleMarkup.addViewPlaneHandle(a,b)]})})};d.prototype.setNodeIds=function(a){this._nodeIds=a};d.prototype.getNodeIds=function(){return this._nodeIds};d.prototype.showHandles=function(){this._handleMarkup.showOverlay()};d.prototype.updatePosition=function(c,b,d){b=a.Matrix.multiply(this._rotationMatrix,b);return this._handleMarkup.updatePosition(c,b,d)};d.prototype.getPosition=function(){var a=this._handleMarkup.getHandleNodeIds();return 0<a.length&&(a=this._handleMarkup.getPosition(a[0]),
null!==a)?a.copy():null};d.prototype.removeHandles=function(){this._rotationMatrix=new a.Matrix;this._newRotationMatrix=new a.Matrix;this._translation=a.Point3.zero();this._nodeIds=[];this._highlightedHandleId=null;return this._handleMarkup.removeHandles()};d.prototype.getTranslation=function(){return this._translation};d.prototype._initLocalNodeMatrices=function(){var a=this._viewer.model;this._initialLocalNodeMatrices=[];for(var b=0,d=this._nodeIds;b<d.length;b++)this._initialLocalNodeMatrices.push(a.getNodeMatrix(d[b]))};
d.prototype._getHandleEventType=function(c){return this._handleMarkup.getHandleType(c)===a.HandleType.Rotate?a.HandleEventType.Rotate:a.HandleEventType.Translate};d.prototype._rotate=function(c,b,d){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return!this._draggingHandle||this._settingMatrixInProgress?[2]:[4,this._genericTransform(c,b,a.Point3.zero(),d)];case 1:return e.sent(),this._viewer.trigger("handleEvent",a.HandleEventType.Rotate,
this._nodeIds,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),[2]}})})};d.prototype._translate=function(c,b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return!this._draggingHandle||this._settingMatrixInProgress?[2]:[4,this._genericTransform(a.Point3.zero(),0,c,b)];case 1:return d.sent(),this._viewer.trigger("handleEvent",a.HandleEventType.Translate,this._nodeIds,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),[2]}})})};
d.prototype._genericTransform=function(c,b,d,e){return __awaiter(this,void 0,void 0,function(){var f,h,k,r,m,n,q,t,u,w,z,y,x,A,B,C;return __generator(this,function(D){switch(D.label){case 0:this._settingMatrixInProgress=!0;f=this._viewer.model;h=new a.Matrix;this._newTranslation=d;0<c.squaredLength()&&(h=this._getRotationMatrix(c,a.Point3.zero(),b),this._newRotationMatrix=h.copy());k=[];k.push(this.updatePosition(this._newTranslation,this._newRotationMatrix,!1));this._newLocalNodeMatrices=[];for(r=
0;r<this._nodeIds.length;r++)m=this._newTranslation.copy(),n=this._nodeIds[r],q=this._initialLocalNodeMatrices[r].copy(),t=c.copy(),u=e.copy(),w=void 0,z=f.getNodeParent(n),null!==z?(w=f.getNodeNetMatrix(z),y=a.Matrix.inverse(w),null!==y&&(y.transform(u,u),y.setTranslationComponent(0,0,0),y.transform(t,t),y.transform(m,m))):w=null,0<c.squaredLength()&&(h=this._getRotationMatrix(t,u,w&&0>w.upperLeft3x3Determinant()?-b:b),q=a.Matrix.multiply(q,h)),q.setTranslationComponent(q.m[12]+m.x,q.m[13]+m.y,q.m[14]+
m.z),k.push(f.setNodeMatrix(n,q)),this._newLocalNodeMatrices.push(q);x=this._newRotationMatrix.copy();x.setTranslationComponent(d.x,d.y,d.z);for(r=0;r<this._trackedPoints.length;++r)A=this._trackedPoints[r].copy(),B=a.Point3.subtract(A,e),x.transform(B,B),C=a.Point3.add(B,e),this._trackedPointsPositions[r]=C;return[4,a.Util.waitForAll(k)];case 1:return D.sent(),this._settingMatrixInProgress=!1,[2]}})})};d.prototype._testRotate=function(c,b){return __awaiter(this,void 0,void 0,function(){var d,e;return __generator(this,
function(f){switch(f.label){case 0:d=this._handleMarkup.getHandleNodeIds();if(0===d.length)return[2];e=this._handleMarkup.getPosition(d[0]);if(null===e)return[2];this._startDragging(null,a.HandleEventType.Rotate);return[4,this._rotate(c,b,e)];case 1:return f.sent(),[4,this._stopDragging()];case 2:return f.sent(),[2]}})})};d.prototype._testTranslate=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._startDragging(null,
a.HandleEventType.Translate),[4,this._translate(c,a.Point3.zero())];case 1:return b.sent(),[4,this._stopDragging()];case 2:return b.sent(),[2]}})})};d.prototype._startDragging=function(a,b){this._activeNodeId=a;this._handleEventType=b;this._initLocalNodeMatrices();this._viewer.trigger("handleEventStart",this._handleEventType,this._nodeIds,this._initialLocalNodeMatrices);this._draggingHandle=!0};d.prototype._stopDragging=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(c){switch(c.label){case 0:return[4,this.updatePosition(this._newTranslation,this._newRotationMatrix,!0)];case 1:return c.sent(),this._draggingHandle=!1,this._viewer.trigger("handleEventEnd",this._handleEventType,this._nodeIds,this._initialLocalNodeMatrices,this._newLocalNodeMatrices),this._rotationMatrix=a.Matrix.multiply(this._rotationMatrix,this._newRotationMatrix),this._newRotationMatrix=new a.Matrix,this._handleMarkup.resetTranslation(),this._translation.add(this._newTranslation),this._newTranslation=
a.Point3.zero(),this._trackedPoints=this._trackedPointsPositions.slice(),[2]}})})};d.prototype.onMouseDown=function(c){e.prototype.onMouseDown.call(this,c);this._overlayIndex=null;var b=c._getPickResult(this._selectionMask(a.EventType.MouseDown));if(null!==b&&b.isNodeEntitySelection()){var b=b.getNodeId(),d=this._viewer.model.getNodeName(b);null!==d&&"handle-"===d.slice(0,7)&&(c.setHandled(!0),c=this._getHandleEventType(b),this._startDragging(b,c))}};d.prototype.onMouseMove=function(c){e.prototype.onMouseMove.call(this,
c);if(this._draggingHandle&&null!==this._activeNodeId){var b=this._viewer.view.getCamera();a.Point3.zero();a.Point3.zero();var d=this._handleMarkup.getHandleType(this._activeNodeId),h=this._handleMarkup.getVector(this._activeNodeId);c=this._handleMarkup.getPosition(this._activeNodeId);if(null!==d&&null!==c)switch(d){case a.HandleType.Axis:null!==h&&(b=this._getTranslationComponent(c,h,0),this._translate(b,c));break;case a.HandleType.Plane:null!==h&&(b=this._getTranslationComponent(c,h,1),this._translate(b,
c));break;case a.HandleType.ViewPlane:h=b.getTarget();b=b.getPosition();b=a.Point3.subtract(b,h).normalize();b=this._getTranslationComponent(c,b,2);this._translate(b,c);break;case a.HandleType.Rotate:null!==h&&(this._rotationMatrix.copy().setTranslationComponent(0,0,0).transform(h,h),b=this._getRotationAngle(c,h),this._rotate(h,b,c));break;default:a.Util.TypeAssertNever(d)}}else this._highlightHandle(c._getPickResult(this._selectionMask(a.EventType.MouseMove)))};d.prototype.onMouseUp=function(c){this._draggingHandle||
!(3>this._dragCount)||c.getButton()===a.Button.Right||this._previousContextClick||this._viewer.getContextMenuStatus()||0!==this._overlayIndex&&null!==this._overlayIndex||this.removeHandles();this._previousContextClick=c.getButton()===a.Button.Right||this._viewer.getContextMenuStatus();this._draggingHandle&&this._stopDragging();e.prototype.onMouseUp.call(this,c)};d.prototype.needsSelection=function(c){return this._handleMarkup.isEmpty()?!1:c===a.EventType.MouseDown||c===a.EventType.TouchStart||!this._dragging&&
c===a.EventType.MouseMove};d.prototype._selectionMask=function(c){c;return a.SelectionMask.Face};d.prototype._onlySelectOverlays=function(){return!0};d.prototype.setHandled=function(){return this._draggingHandle};d.prototype._getClosestPoint=function(c,b,d){var e=c.copy();c=c.copy().add(b);b=this._viewer.view.unprojectPoint(d,0);d=this._viewer.view.unprojectPoint(d,.5);return null!==b&&null!==d?a.Util.lineLineIntersect(e,c,b,d):null};d.prototype._getTranslationComponent=function(c,b,d){2!==d&&this._rotationMatrix.copy().setTranslationComponent(0,
0,0).transform(b,b);var e=null,f=null;1===d||2===d?(e=this._getPlaneIntersectionPoint(c,b,this._ptFirst),null!==e&&(f=this._getPlaneIntersectionPoint(e,b,this._ptCurrent))):0===d&&(e=this._getClosestPoint(c,b,this._ptFirst),null!==e&&(f=this._getClosestPoint(e,b,this._ptCurrent)));return null!==f&&null!==e?a.Point3.subtract(f,e):a.Point3.zero()};d.prototype._clearHighlightedHandle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return null===
this._highlightedHandleId?[3,2]:[4,this._viewer.model.unsetNodesFaceColor([this._highlightedHandleId])];case 1:a.sent(),this._highlightedHandleId=null,a.label=2;case 2:return[2]}})})};d.prototype._highlightHandle=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:if(null===c||!c.isNodeEntitySelection()||c.overlayIndex()!==a.BuiltinOverlayIndex.Handles)return[3,2];b=this._viewer.model;d=b.getNodeName(c.getNodeId());if(null===
d||"handle-"!==d.slice(0,7))return[3,2];e=c.getNodeId();return this._highlightedHandleId===e?[2]:[4,this._clearHighlightedHandle()];case 1:return f.sent(),this._highlightedHandleId=e,b.setNodesFaceColor([this._highlightedHandleId],a.Color.green()),[2];case 2:return[2,this._clearHighlightedHandle()]}})})};d.prototype._getPlaneIntersectionPoint=function(c,b,d){var e=this._viewer.view.unprojectPoint(d,0);d=this._viewer.view.unprojectPoint(d,.5);if(null===e||null===d)return null;e=new a.Ray(e,d.copy().subtract(e));
c=a.Plane.createFromPointAndNormal(c,b);b=a.Point3.zero();return c.intersectsRay(e,b)?b:null};d.prototype._getRotationAngle=function(c,b){console.assert(null!==c);var d=this._getPlaneIntersectionPoint(c,b,this._ptFirst),e=this._getPlaneIntersectionPoint(c,b,this._ptCurrent);if(null===d||null===e)return 0;d=a.Point3.subtract(d,c).normalize();c=a.Point3.subtract(e,c).normalize();e=a.Point3.dot(d,c);e=180*Math.acos(e)/Math.PI;0>a.Point3.dot(a.Point3.cross(d,c),b)&&(e=-e);return e};d.prototype._getRotationMatrix=
function(c,b,d){var e=(new a.Matrix).setTranslationComponent(-b.x,-b.y,-b.z);c=a.Matrix.createFromOffAxisRotation(c,d);b=(new a.Matrix).setTranslationComponent(b.x,b.y,b.z);return a.Matrix.multiply(a.Matrix.multiply(e,c),b)};return d}(h.OperatorBase);h.HandleOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a){var b=e.call(this,a)||this;b._navCube=a.view.getNavCube();return b}__extends(d,e);d.prototype.needsSelection=function(c,b,d){return!a.Event._isMouseEventType(c)&&c!==a.EventType.TouchEnd||this._dragging&&1<this._dragCount||!this._navCube.getEnabled()||!this._navCube._insideOverlay(d)?!1:!0};d.prototype._selectionMask=function(c){c;return a.SelectionMask.Face};d.prototype._onlySelectOverlays=function(){return!0};d.prototype.onMouseMove=function(c){e.prototype.onMouseMove.call(this,
c);this._navCube.getEnabled()&&(c=c._getPickResult(this._selectionMask(a.EventType.MouseMove)),this._navCube._onMoveSelection(c))};d.prototype.onMouseUp=function(c){if(this._navCube.getEnabled()&&25>a.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()){var b=c._getPickResult(this._selectionMask(a.EventType.MouseUp));this._navCube._onClickSelection(b)}e.prototype.onMouseUp.call(this,c)};return d}(h.OperatorBase);h.NavCubeOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator=
{}));
(function(a){(function(h){var e=function(e){function d(c,b){c=e.call(this,c)||this;c._insertNoteButton=a.Button.Left;c._callbackFlag=!1;c._noteTextManager=b;return c}__extends(d,e);d.prototype.onMouseDown=function(a){var b=this;e.prototype.onMouseDown.call(this,a);this.isActive()&&(this._callbackFlag||(this._viewer.setCallbacks({explode:function(a){b._noteTextManager.explode(a)},addCuttingSection:function(){b._noteTextManager.checkCuttingActive()},removeCuttingSection:function(){b._noteTextManager.checkCuttingActive()}}),this._callbackFlag=
!0),this._dragging=!1)};d.prototype.onMouseUp=function(c){var b=this;if(this.isActive()){var d=new a.PickConfig(a.SelectionMask.Face);if(this._ptFirst.equals(this._ptCurrent)&&c.getButton()===this._insertNoteButton||null!==this._primaryTouchId)d=this._viewer.view.pickFromPoint(c.getPosition(),d).then(function(d){b._noteTextManager.selectPin(d)||b._noteTextManager.getExplodeActive()||b._noteTextManager.getIsolateActive()||0!==d.overlayIndex()||(d.isFaceSelection()&&new a.Markup.Note.NoteText(b._viewer,
b._noteTextManager,d.getPosition(),d.getFaceEntity().getNormal(),d.getNodeId()),c.setHandled(!0))}),d}e.prototype.onMouseUp.call(this,c)};d.prototype.getNoteTextElement=function(){return this._noteTextManager.getNoteTextElement()};d.prototype.setNoteTextElement=function(a){this._noteTextManager.setNoteTextElement(a)};d.prototype.checkPinInstance=function(a){return null!==this._noteTextManager.checkPinInstance(a)};return d}(h.OperatorBase);h.NoteOperator=e})(a.Operator||(a.Operator={}))})(Communicator||
(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c){var b=e.call(this,c)||this;b._selectionButton=a.Button.Left;b._ignoreTransparency=!1;b._forceEffectiveSceneVisibilityMask=a.SelectionMask.None;b._incrementalSelection=a.Util.IncrementalSelection.create("SelectionManager",c);c.setCallbacks({_resetAssemblyTreeBegin:function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this.clearSelection()];case 1:return a.sent(),[2,this.waitForIdle()]}})})},
selectionArray:function(a){0===a.length&&b._incrementalSelection.stopSelection()}});return b}__extends(d,e);d.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};d.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};d.prototype.setIgnoreTransparency=function(a){this._ignoreTransparency=a};d.prototype.getIgnoreTransparency=function(){return this._ignoreTransparency};d.prototype.hasActiveSelection=
function(){return!this._incrementalSelection.isIdle()};d.prototype.waitForIdle=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.waitForIdle()]})})};d.prototype.clearSelection=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,this._incrementalSelection.clearSelection()]})})};d.prototype._createBeginConfig=function(c){var b=new a.IncrementalPickConfig;b.forceEffectiveSceneVisibilityMask=
this._forceEffectiveSceneVisibilityMask;b.ignoreUnrequestedInstances=!0;return{pickConfig:b,rayCssOrigin:c,rayCssBoxRadius:10}};d.prototype._selectionPredicate=function(a){return __awaiter(this,void 0,void 0,function(){var b,d,e;return __generator(this,function(f){switch(f.label){case 0:return b=this._viewer.model,d=a.getNodeId(),null===d?[2,!1]:[4,b.getNodesHaveTransparency([d])];case 1:return e=f.sent()[0],[2,!e]}})})};d.prototype._performSelection=function(a){return __awaiter(this,void 0,void 0,
function(){var b=this,d,e;return __generator(this,function(f){d=this._createBeginConfig(a);e=this._ignoreTransparency?function(a){return b._selectionPredicate(a)}:null;return[2,this._incrementalSelection.performSelection(d,e)]})})};d.prototype.setHandled=function(){return!0};d.prototype.onKeyUp=function(c){c.getKeyCode()===a.KeyCode.Escape&&this.clearSelection();e.prototype.onKeyUp.call(this,c)};d.prototype.onMouseUp=function(c){this.isActive()&&(c.getButton()===this._selectionButton||null!==this._primaryTouchId)&&
25>a.Point2.subtract(this._ptFirst,this._ptCurrent).squaredLength()&&(c.controlDown()||this.clearSelection(),this._performSelection(c.getPosition()));e.prototype.onMouseUp.call(this,c)};return d}(h.OperatorBase);h.RayDrillSelectionOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c,b){c=e.call(this,c)||this;c._selectionButton=a.Button.Left;c._forceEffectiveSceneVisibilityMask=a.SelectionMask.None;c._noteTextManager=b;return c}__extends(d,e);d.prototype.getForceEffectiveSceneVisibilityMask=function(){return this._forceEffectiveSceneVisibilityMask};d.prototype.setForceEffectiveSceneVisibilityMask=function(a){this._forceEffectiveSceneVisibilityMask=a};d.prototype.getSelectionButton=function(){return this._selectionButton};
d.prototype.setSelectionButton=function(a){this._selectionButton=a};d.prototype.onKeyUp=function(c){c.getKeyCode()===a.KeyCode.Escape&&this._viewer.selectionManager.clear();e.prototype.onKeyUp.call(this,c)};d.prototype.onMouseUp=function(c){var b=this;if(this.isActive()&&5>a.Point2.subtract(this._ptFirst,this._ptCurrent).length()&&(c.getButton()===this._selectionButton||null!==this._primaryTouchId)){var d=this._viewer.view,h=new a.PickConfig(a.SelectionMask.Face|a.SelectionMask.Line);h.forceEffectiveSceneVisibilityMask=
this._forceEffectiveSceneVisibilityMask;d=d.pickFromPoint(this._ptCurrent,h).then(function(d){var e=null!==b._viewer.cuttingManager.getCuttingSectionFromNodeId(d.getNodeId()),f=b._noteTextManager.selectPin(d),g=b._viewer.markupManager.pickMarkupItem(b._ptCurrent);if(g instanceof a.Markup.Redline.RedlineText)g.onSelect();f||e||null!==g||(d.isNodeSelection()?b._processSelectionClick(c,d):b._isDoubleClick||b._viewer.selectionManager.clear())});d}e.prototype.onMouseUp.call(this,c)};d.prototype.onDoubleClick=
function(a){a;return this._viewer.view.fitWorld()};d.prototype._getSelectionOrParentIfSelected=function(c){var b=this._viewer.model,d=c.getNodeId();if(!b.isNodeLoaded(d)||b.getNodeType(d)===a.NodeType.PmiBody)return c;var e=this._viewer.selectionManager,f=null;e.getSelectParentIfSelected()&&(f=e.containsParent(c));return null!==f?(b=a.Selection.SelectionItem.create(b.getNodeParent(f.getNodeId())),b.isNodeSelection()?b:c):e.contains(c)?(b=a.Selection.SelectionItem.create(b.getNodeParent(d)),b.isNodeSelection()?
b:c):c};d.prototype._processSelectionClick=function(a,b){var d=b.overlayIndex();if(0===d||null===d)d=this._viewer.selectionManager,a.controlDown()||a.commandDown()?d.toggle(b):(a=this._getSelectionOrParentIfSelected(b),d.set(a))};return d}(h.OperatorBase);h.SelectionOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(a,b,c){a.has(b)&&a.has(c)&&(a.delete(b),a.delete(c))}function f(b){e(b,a.WalkDirection.Forward,a.WalkDirection.Backward);e(b,a.WalkDirection.Left,a.WalkDirection.Right);e(b,a.WalkDirection.Up,a.WalkDirection.Down);e(b,a.WalkDirection.RotateLeft,a.WalkDirection.RotateRight);e(b,a.WalkDirection.TiltUp,a.WalkDirection.TiltDown)}function d(b,c){var d=new a.PickConfig(a.SelectionMask.Face);d.bimMask=b;d.ignoreOverlays=!0;null!==c&&(d.maxWorldDistance=c);return d}function c(b,
c,e,f){return __awaiter(this,void 0,void 0,function(){var g,h,l;return __generator(this,function(t){switch(t.label){case 0:return g=new a.Ray(c,e),h=d(a.BimMask.Floor,f),[4,b.pickFromRay(g,h)];case 1:return l=t.sent(),l.isFaceSelection()?[2,l.getPosition()]:[2,null]}})})}function b(b,c,e,f){return __awaiter(this,void 0,void 0,function(){var g,h,l;return __generator(this,function(t){switch(t.label){case 0:return g=new a.Ray(c,e),h=d(a.BimMask.Wall,f),[4,b.pickFromRay(g,h)];case 1:return l=t.sent(),
l.isFaceSelection()?[2,l]:[2,null]}})})}var g=function(){function b(a){this._nearbyDoors=new Set;this._viewer=a}b.prototype._performSphereSelection=function(b,c,d){var e=a.Util.IncrementalSelection.create("View",this._viewer),f=new a.IncrementalPickConfig(a.SelectionMask.Face);f.bimMask=d;f.onlyStreamedInstances=!0;f.ignoreUnrequestedInstances=!0;return e.performSelection({pickConfig:f,sphereCenter:b,sphereRadius:c})};b.prototype.updateNearbyDoors=function(b,c,d){return __awaiter(this,void 0,void 0,
function(){var e,f,g,h,l,v,z,y,x,A,B;return __generator(this,function(C){switch(C.label){case 0:return[4,this._performSphereSelection(b,c,a.BimMask.Door)];case 1:e=C.sent();f=new Set;g=0;for(h=e;g<h.length;g++)l=h[g],v=l.getNodeId(),f.add(v);z=a.Util.setSubtraction(f,this._nearbyDoors);y=a.Util.setSubtraction(this._nearbyDoors,f);x=a.Util.setToArray(z);A=a.Util.setToArray(y);B=this._viewer.model;B.setNodesOpacity(x,d);B.resetNodesOpacity(A);this._nearbyDoors=f;return[2]}})})};b.prototype.forgetNearbyDoors=
function(){var b=a.Util.setToArray(this._nearbyDoors);this._nearbyDoors.clear();this._viewer.model.resetNodesOpacity(b)};return b}(),l=function(d){function e(b){var c=d.call(this,b)||this;c._walkDistance=0;c._elevationSpeed=0;c._rotationSpeed=0;c._mouseLookSpeed=0;c._viewAngle=90;c._zoomDistance=0;c._tilt=0;c._majorAxis=a.Axis.X;c._previousWalkTime=0;c._maxExtents=0;c._walkActive=!1;c._activeWalk=new a.Util.CurrentAction(!0);c._keyUpMap=new Map;c._keyDownMap=new Map;c._tickTimerId=null;c._keyWalkMapping=
new Map;c._mouseLookEnabled=!0;c._bimModeEnabled=!1;c._syncronizedToggleBimMode=new a.Internal.CurrentActionSync;c._logical={floor:__assign({},e.Bim.Default.FloorConfig),wall:__assign({},e.Bim.Default.WallConfig),door:__assign({},e.Bim.Default.DoorConfig)};c._effective={floor:__assign({},e.Bim.Default.FloorConfig),wall:__assign({},e.Bim.Default.WallConfig),door:__assign({},e.Bim.Default.DoorConfig)};c._doorCache=new g(b);c._downAxis=new a.Point3(0,-1,0);c.addKeyMapping(a.KeyCode.a,a.WalkDirection.Left);
c.addKeyMapping(a.KeyCode.d,a.WalkDirection.Right);c.addKeyMapping(a.KeyCode.w,a.WalkDirection.Forward);c.addKeyMapping(a.KeyCode.s,a.WalkDirection.Backward);c.addKeyMapping(a.KeyCode.q,a.WalkDirection.RotateLeft);c.addKeyMapping(a.KeyCode.e,a.WalkDirection.RotateRight);c.addKeyMapping(a.KeyCode.r,a.WalkDirection.TiltUp);c.addKeyMapping(a.KeyCode.f,a.WalkDirection.TiltDown);c.addKeyMapping(a.KeyCode.x,a.WalkDirection.Up);c.addKeyMapping(a.KeyCode.c,a.WalkDirection.Down);c.addKeyMapping(a.KeyCode.LeftArrow,
a.WalkDirection.Left);c.addKeyMapping(a.KeyCode.RightArrow,a.WalkDirection.Right);c.addKeyMapping(a.KeyCode.UpArrow,a.WalkDirection.Forward);c.addKeyMapping(a.KeyCode.DownArrow,a.WalkDirection.Backward);b.setCallbacks({camera:function(b){b.getProjection()!==a.Projection.Perspective&&c._keyDownMap.clear()},subtreeLoaded:function(b,d){d===a.NodeSource.LoadModel&&c._updateSceneFloor()}});return c}__extends(e,d);e.prototype._updateSceneFloor=function(){var b=this._viewer.model.getViewAxes().upVector;
console.assert(b.isAxis());this._downAxis=a.Point3.scale(b,-1)};e.prototype.isBimModeEnabled=function(){return this._bimModeEnabled};e.prototype._enableBimMode=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return this._bimModeEnabled=!0,this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor),this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall),this._effective.door=this._scaleAgainstModelUnit(this._logical.door),
this._updateSceneFloor(),[4,this._applyGravity()];case 1:return a.sent(),[4,this._updateNearbyDoors()];case 2:return a.sent(),[2]}})})};e.prototype._disableBimMode=function(){this._bimModeEnabled=!1;this._doorCache.forgetNearbyDoors()};e.prototype.enableBimMode=function(){var a=this;return this._syncronizedToggleBimMode.set(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){this._enableBimMode();return[2]})})})};e.prototype.disableBimMode=function(){var a=this;
return this._syncronizedToggleBimMode.set(function(){a._disableBimMode()})};e.prototype._toggleBimMode=function(){var a=this;return this._syncronizedToggleBimMode.set(function(){return a._bimModeEnabled?a._disableBimMode():a._enableBimMode()})};e.prototype.addKeyMapping=function(a,b){this._keyWalkMapping.set(a,b)};e.prototype.getKeyMapping=function(){return a.Internal.copyMap(this._keyWalkMapping)};e.prototype.clearKeyMappings=function(){this._keyWalkMapping.clear()};e.prototype.onActivate=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this._viewer.view.setProjectionMode(a.Projection.Perspective),this._calculateInitialPosition(),0!==this._maxExtents?[3,2]:[4,this.resetDefaultWalkSpeeds()];case 1:b.sent(),b.label=2;case 2:return this._bimModeEnabled?[4,this._updateNearbyDoors()]:[3,4];case 3:b.sent(),b.label=4;case 4:return[2]}})})};e.prototype.resetDefaultWalkSpeeds=function(){return __awaiter(this,void 0,void 0,function(){var a,b;return __generator(this,
function(c){switch(c.label){case 0:return this._rotationSpeed=40,this._mouseLookSpeed=300,this._viewAngle=90,[4,this._viewer.model.getModelBounding(!0,!1)];case 1:return a=c.sent(),b=a.extents(),this._maxExtents=Math.max(b.x,b.y,b.z),this._walkDistance=this._maxExtents/10,this._elevationSpeed=this._maxExtents/10,this._zoomDistance=this._maxExtents/30,[2]}})})};e.prototype.getBimFloorConfig=function(){return __assign({},this._logical.floor)};e.prototype.setBimFloorConfig=function(a){this._logical.floor=
__assign({},a);this._effective.floor=this._scaleAgainstModelUnit(this._logical.floor)};e.prototype.getBimWallConfig=function(){return __assign({},this._logical.wall)};e.prototype.setBimWallConfig=function(a){this._logical.wall=__assign({},a);this._effective.wall=this._scaleAgainstModelUnit(this._logical.wall)};e.prototype.getBimDoorConfig=function(){return __assign({},this._logical.door)};e.prototype.setBimDoorConfig=function(a){this._logical.door=__assign({},a);this._effective.door=this._scaleAgainstModelUnit(this._logical.door)};
e.prototype._scaleAgainstModelUnit=function(a){var b=this._viewer.model,b=1/b.getNodeUnitMultiplier(b.getAbsoluteRootNode());a=__assign({},a);for(var c=0,d=Object.keys(a);c<d.length;c++){var e=d[c];"number"===typeof a[e]&&(a[e]*=b)}return a};e.prototype.onMouseDown=function(a){d.prototype.onMouseDown.call(this,a);this._viewer.focusInput(!0)};e.prototype.onMouseMove=function(b){d.prototype.onMouseMove.call(this,b);if(this._dragging&&this._mouseLookEnabled){this._viewer.view.setProjectionMode(a.Projection.Perspective);
var c=window.screen.width,e=window.screen.height;b.setHandled(!0);b=a.Point2.subtract(this._ptPrevious,this._ptCurrent);this.rotateLeft(b.x/c*this._mouseLookSpeed);this.tiltUp(b.y/e*this._mouseLookSpeed)}};e.prototype.onMouseUp=function(a){5<this._dragCount&&a.setHandled(!0);d.prototype.onMouseUp.call(this,a)};e.prototype.onMousewheel=function(b){var c=this;this._viewer.view.setProjectionMode(a.Projection.Perspective);var d=this._viewer.view,e=d.getCamera(),f=b.getPosition(),g=b.getWheelDelta();b=
d.pickFromPoint(f,new a.PickConfig(a.SelectionMask.Face)).then(function(b){var d=b.getPosition();null!==b&&null!==d?(b=a.Point3.subtract(e.getPosition(),d).normalize().scale(c._zoomDistance*g),c._applyWalkDelta(e,b)):c.walkForward(g*c._walkDistance)});b};e.prototype.onKeyDown=function(b){this._viewer.view.setProjectionMode(a.Projection.Perspective);var c=b.getKeyCode();c===a.KeyCode.v&&this._toggleBimMode();this._keyCodeActive(c)||(this._keyDownMap.set(c,b.getDate().getTime()),this._onKeyChange(c))};
e.prototype.onKeyUp=function(a){var b=a.getKeyCode();this._keyUpMap.set(b,a.getDate().getTime());this._onKeyChange(b)};e.prototype._keyCodeActive=function(a){var b=this._keyDownMap.get(a);return void 0!==b&&(a=this._keyUpMap.get(a),void 0===a||b>a)?!0:!1};e.prototype._onKeyChange=function(a){this._keyCodeActive(a)&&this._keyWalkMapping.has(a)&&(this._walkActive||(this._previousWalkTime=Date.now()),this._onTick())};e.prototype._execWalkDirection=function(b,c,d){switch(b){case a.WalkDirection.Forward:return this._walkForward(this._walkDistance*
c,d);case a.WalkDirection.Backward:return this._walkBackward(this._walkDistance*c,d);case a.WalkDirection.Left:return this._walkLeft(this._walkDistance*c,d);case a.WalkDirection.Right:return this._walkRight(this._walkDistance*c,d);case a.WalkDirection.Up:return this.walkUp(this._elevationSpeed*c);case a.WalkDirection.Down:return this.walkDown(this._elevationSpeed*c);case a.WalkDirection.RotateLeft:return this.rotateLeft(this._rotationSpeed*c);case a.WalkDirection.RotateRight:return this.rotateRight(this._rotationSpeed*
c);case a.WalkDirection.TiltUp:return this.tiltUp(this._rotationSpeed*c);case a.WalkDirection.TiltDown:return this.tiltDown(this._rotationSpeed*c);default:a.Util.TypeAssertNever(b)}};e.prototype._queueWalkDirections=function(b){var c=this,d=new Set;this._keyWalkMapping.forEach(function(a,b){c._keyCodeActive(b)&&d.add(a)});f(d);var e=a.Util.setToArray(d);e.sort();if(0<e.length){this._walkActive=!0;var g=this._bimModeEnabled;this._activeWalk.set(function(){var f=new a.Internal.ActionQueue(1,!0);if(0<
b)for(var h=function(a){f.push(function(){return c._execWalkDirection(a,b,g)})},l=0;l<e.length;l++)h(e[l]);g&&(d.has(a.WalkDirection.Up)||d.has(a.WalkDirection.Down)||f.push(function(){c._applyGravity()}),f.push(function(){c._updateNearbyDoors()}));if(!f.isIdle())return f.waitForIdle()})}};e.prototype._applyGravity=function(){return __awaiter(this,void 0,void 0,function(){var b,d,e,f,g,h,l,p,v,y;return __generator(this,function(x){switch(x.label){case 0:return b=this._viewer.view,d=b.getCamera(),
e=d.getPosition(),[4,c(b,e,this._downAxis,this._effective.floor.maxFallDistance)];case 1:f=x.sent();if(null!==f)return[3,3];e=a.Point3.subtract(e,a.Point3.scale(this._downAxis,this._effective.floor.avatarOffset));return[4,c(b,e,this._downAxis,this._effective.floor.maxFallDistance)];case 2:f=x.sent();if(null===f)return[2];x.label=3;case 3:g=new a.Point3(0,0,this._effective.floor.avatarOffset);h=a.Point3.add(f,g);l=a.Point3.subtract(h,e);p=l.length();if(p>this._effective.floor.negligibleClimbHeight&&
(v=a.Util.computeAngleBetweenVector(l,this._downAxis),(y=90<v)&&p>this._effective.floor.maxClimbHeight))return[2];this._applyWalkDelta(d,l);return[2]}})})};e.prototype._updateNearbyDoors=function(){var a=this._viewer.view.getCamera().getPosition();return this._doorCache.updateNearbyDoors(a,this._effective.door.transparencyRange,.5)};e.prototype._onTick=function(){var a=this,b=Date.now(),c=(b-this._previousWalkTime)/1E3;this._previousWalkTime=b;this._walkActive=!this._activeWalk.isIdle();this._queueWalkDirections(c);
null!==this._tickTimerId&&(cancelAnimationFrame(this._tickTimerId),this._tickTimerId=null);this._walkActive&&(this._tickTimerId=requestAnimationFrame(function(){a._onTick()}))};e.prototype._updateCamera=function(a){this._resetPosition(a);this._updateCameraTilt(a);this._updateCameraViewAngle(a);this._viewer.view.setCamera(a)};e.prototype._applyWalkDelta=function(b,c){b.dolly(a.Point3.scale(c,-1));this._updateCamera(b)};e.prototype._applyWalkDeltaWithCollisionCheck=function(b,c,d){return __awaiter(this,
void 0,void 0,function(){var e,f,g,h,l,p,v,x,A,B,C,D,G,E,I,F,K,L;return __generator(this,function(H){switch(H.label){case 0:return e=b.getPosition(),f=a.Matrix.createFromOffAxisRotation(d,90),g=f.transform(c),h=a.Matrix.createFromOffAxisRotation(d,-90),l=h.transform(c),p=this._testWallCollision(e,g,this._effective.wall.avatarOffset),v=this._testWallCollision(e,l,this._effective.wall.avatarOffset),x=this._testWallCollision(e,c,c.length()+this._effective.wall.avatarOffset),[4,Promise.all([p,v])];case 1:A=
H.sent();B=A[0];C=A[1];if(null!==B||null!==C)if(D=function(b){return null!==b?(b=b.getFaceEntity().getNormal(),90<a.Util.computeAngleBetweenVector(b,c)):!1},D(B)||D(C))return[2];return[4,x];case 2:return G=H.sent(),null!==G&&(E=c.length(),I=a.Point3.scale(c,1/E),F=a.Point3.subtract(G.getPosition(),e).length(),K=F-this._effective.wall.avatarOffset,L=Math.min(E,K),c=a.Point3.scale(I,L)),this._applyWalkDelta(b,c),[2]}})})};e.prototype._testWallCollision=function(a,c,d){return b(this._viewer.view,a,c,
d)};e.prototype._walkBackward=function(b,c){var d=this._viewer.view.getCamera();this._resetPosition(d);var e=d.getTarget(),f=d.getPosition(),g=d.getUp();b=a.Point3.subtract(f,e).normalize().copy().scale(b);return c?this._applyWalkDeltaWithCollisionCheck(d,b,g):this._applyWalkDelta(d,b)};e.prototype._walkForward=function(a,b){return this._walkBackward(-a,b)};e.prototype._walkLeft=function(b,c){var d=this._viewer.view.getCamera();this._resetPosition(d);var e=d.getTarget(),f=d.getPosition(),g=d.getUp(),
e=a.Point3.subtract(e,f).normalize();b=a.Point3.cross(g,e).normalize().copy().scale(b);return c?this._applyWalkDeltaWithCollisionCheck(d,b,g):this._applyWalkDelta(d,b)};e.prototype._walkRight=function(a,b){return this._walkLeft(-a,b)};e.prototype.walkBackward=function(a){return this._walkBackward(a,!1)};e.prototype.walkForward=function(a){return this._walkForward(a,!1)};e.prototype.walkLeft=function(a){return this._walkLeft(a,!1)};e.prototype.walkRight=function(a){return this._walkRight(a,!1)};e.prototype.walkDown=
function(a){var b=this._viewer.view.getCamera();this._resetPosition(b);a=b.getUp().normalize().scale(a);this._applyWalkDelta(b,a)};e.prototype.walkUp=function(a){this.walkDown(-a)};e.prototype.rotateRight=function(b){var c=this._viewer.view.getCamera();this._resetPosition(c);var d=c.getTarget(),e=c.getPosition(),f=a.Point3.subtract(e,d).length(),g=a.Point3.subtract(d,e).normalize();b=a.Util.degreesToRadians(b);b=Math.tan(b);b*=a.Point3.subtract(c.getTarget(),c.getPosition()).length();g=a.Point3.cross(g,
c.getUp()).scale(b);d=d.copy().add(g);f=a.Point3.subtract(d,e).normalize().scale(f);d=a.Point3.add(e,f);c.setTarget(d);this._updateCamera(c)};e.prototype.rotateLeft=function(a){this.rotateRight(-a)};e.prototype.tiltDown=function(a){this.setTilt(this._tilt+a);a=this._viewer.view.getCamera();this._resetPosition(a);this._updateCamera(a)};e.prototype.tiltUp=function(a){this.tiltDown(-a)};e.prototype._calculateInitialPosition=function(){var a=this._viewer.view.getCamera();this._majorAxis=this._calculateMajorAxis(a);
this.setTilt(this._calculateInitialTilt(a));this._resetPosition(a);this._updateCamera(a)};e.prototype._updateCameraViewAngle=function(b){var c=a.Util.degreesToRadians(this._viewAngle),c=Math.tan(c/2),c=a.Point3.subtract(b.getTarget(),b.getPosition()).length()*c;b.setWidth(c);b.setHeight(c)};e.prototype._updateCameraTilt=function(b){var c=b.getPosition(),d=b.getTarget(),e=b.getUp().normalize(),f=a.Point3.subtract(d,c).normalize(),e=a.Point3.cross(e,f).normalize(),d=a.Point3.distance(d,c);a.Matrix.createFromOffAxisRotation(e,
this._tilt).transform(f,f);b.setTarget(a.Point3.add(c,f.scale(d)))};e.prototype._calculateInitialTilt=function(b){var c=b.getTarget();b=b.getPosition();b=a.Point3.subtract(c,b);c=b.length();this._majorAxis===a.Axis.X?b.x=0:this._majorAxis===a.Axis.Y?b.y=0:this._majorAxis===a.Axis.Z&&(b.z=0);b=b.length();return 180/Math.PI*Math.acos(b/c)};e.prototype._resetPosition=function(b){this._majorAxis=this._calculateMajorAxis(b);var c=b.getPosition(),d=b.getTarget(),d=a.Point3.subtract(d,c),e=d.length();0<
this._walkDistance&&(e=this._walkDistance);switch(this._majorAxis){case a.Axis.X:d.set(0,d.y,d.z);b.setUp(new a.Point3(1,0,0));break;case a.Axis.Y:d.set(d.x,0,d.z);b.setUp(new a.Point3(0,1,0));break;case a.Axis.Z:d.set(d.x,d.y,0),b.setUp(new a.Point3(0,0,1))}d.normalize().scale(e);b.setTarget(a.Point3.add(c,d))};e.prototype._calculateMajorAxis=function(b){var c=b.getUp();b=Math.abs(c.x);var d=Math.abs(c.y),c=Math.abs(c.z);return c>=b&&c>=d?a.Axis.Z:d>=b&&d>=c?a.Axis.Y:a.Axis.X};e.prototype.setZoomSpeed=
function(a){this._zoomDistance=a};e.prototype.getZoomSpeed=function(){return this._zoomDistance};e.prototype.setTilt=function(a){this._tilt=Math.max(Math.min(a,45),-45);a=this._viewer.view.getCamera();this._updateCamera(a)};e.prototype.getTilt=function(){return this._tilt};e.prototype.setViewAngle=function(a){a=Math.max(Math.min(a,150),30);this._viewAngle!==a&&(this._viewAngle=a,this._updateCamera(this._viewer.view.getCamera()))};e.prototype.getViewAngle=function(){return this._viewAngle};e.prototype.setWalkSpeed=
function(a){this._walkDistance=a};e.prototype.getWalkSpeed=function(){return this._walkDistance};e.prototype.setElevationSpeed=function(a){this._elevationSpeed=a};e.prototype.getElevationSpeed=function(){return this._elevationSpeed};e.prototype.setRotationSpeed=function(a){this._rotationSpeed=a};e.prototype.getRotationSpeed=function(){return this._rotationSpeed};e.prototype.setMouseLookSpeed=function(a){this._mouseLookSpeed=a};e.prototype.getMouseLookSpeed=function(){return this._mouseLookSpeed};
e.prototype.setMouseLookEnabled=function(a){this._mouseLookEnabled=a};e.prototype.getMouseLookEnabled=function(){return this._mouseLookEnabled};return e}(h.OperatorBase);h.CameraKeyboardWalkOperator=l;(function(a){(function(a){(function(a){(function(a){a[a.avatarOffset=1500]="avatarOffset";a[a.maxClimbHeight=600]="maxClimbHeight";a[a.negligibleClimbHeight=20]="negligibleClimbHeight";a[a.maxFallDistance=5E3]="maxFallDistance"})(a.FloorConfig||(a.FloorConfig={}));(function(a){a[a.avatarOffset=150]=
"avatarOffset"})(a.WallConfig||(a.WallConfig={}));(function(a){a[a.transparencyRange=4E3]="transparencyRange"})(a.DoorConfig||(a.DoorConfig={}))})(a.Default||(a.Default={}))})(a.Bim||(a.Bim={}))})(l=h.CameraKeyboardWalkOperator||(h.CameraKeyboardWalkOperator={}))})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(d){function c(b,c){b=d.call(this,b)||this;b._cameraRotationMomentumEnabled=!1;b._isDown=!1;b._mouseDragged=!1;b._averagedMousePoints=new f;b._averageTimeIntervalMilliseconds=150;b._previousMouseMovePoint=a.Point2.zero();b._mouseMovePoint=a.Point2.zero();b._mouseMoveOffset=a.Point2.zero();b._previousMouseMoveTime=null;b._mouseMoveTime=null;b._mouseMoveElapsedTimeSeconds=0;b._rotationDegreesPerSecond=[0,0];b._animationLastTickTime=0;b._animationElapsedTimeSeconds=
0;b._animationIntervalResult=null;b._preferredAnimationIntervalMilliseconds=16;b._momentum=0;b._momentumLossPerSecond=0;b._degreesPerPixel=.5;b._maxRotationMagnitudeScale=8;b._initialSelectionPosition=null;b._cameraRotateFunction=c;return b}__extends(c,d);c.prototype.getCameraRotationMomentumEnabled=function(){return this._cameraRotationMomentumEnabled};c.prototype.setCameraRotationMomentumEnabled=function(a){a!==this._cameraRotationMomentumEnabled&&((this._cameraRotationMomentumEnabled=a)||this.stopAnimation())};
c.prototype.isCurrentlyAnimating=function(){return this._cameraRotationMomentumEnabled&&0<this.getMomentum()};c.prototype.onDeactivate=function(){var a=d.prototype.onDeactivate.call(this);this.stopAnimation();return a};c.prototype.onViewOrientationChange=function(){d.prototype.onViewOrientationChange.call(this);this.stopAnimation()};c.prototype.supportsAnimation=function(){return!0};c.prototype.onMouseDown=function(a){d.prototype.onMouseDown.call(this,a);this.isActive()&&(this._initialSelectionPosition=
a.getPosition(),this._isDown=!0,this.stopAnimation(),this._mouseDragged=!1,this._mouseMoveTime=this._previousMouseMoveTime=Date.now(),this._mouseMovePoint.assign(this._initialSelectionPosition),this._previousMouseMovePoint.assign(this._mouseMovePoint),this._averagedMousePoints.clear(),this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime))};c.prototype.onMouseMove=function(b){d.prototype.onMouseMove.call(this,b);this.isActive()&&this._isDown&&(this._mouseDragged=!0,this._previousMouseMovePoint.assign(this._mouseMovePoint),
this._mouseMovePoint.assign(b.getPosition()),this._mouseMoveOffset=a.Point2.subtract(this._mouseMovePoint,this._previousMouseMovePoint),this._previousMouseMoveTime=this._mouseMoveTime,this._mouseMoveTime=Date.now(),this._mouseMoveElapsedTimeSeconds=null===this._previousMouseMoveTime?0:(this._mouseMoveTime-this._previousMouseMoveTime)/1E3,this._averagedMousePoints.add(this._mouseMovePoint,this._mouseMoveTime),b=this._getMouseMoveOffsetForRotation(),this._rotateCamera(b))};c.prototype.onMouseUp=function(a){if(this.isActive()&&
(this._isDown=!1,this._mouseDragged&&this.getCameraRotationMomentumEnabled())){this._mouseMoveOffset=this._averagedMousePoints.getAverageOffsetWithinMilliseconds(this._averageTimeIntervalMilliseconds);var c=this._getMouseMoveOffsetForRotation();if(0!==c[0]||0!==c[1]){for(var e=0;2>e;e++){var f=Math.abs(c[e])*this._maxRotationMagnitudeScale;this._rotationDegreesPerSecond[e]=c[e]/this._mouseMoveElapsedTimeSeconds;this._rotationDegreesPerSecond[e]<-f?this._rotationDegreesPerSecond[e]=-f:this._rotationDegreesPerSecond[e]>
f&&(this._rotationDegreesPerSecond[e]=f)}this._momentum=1;this._momentumLossPerSecond=0;this._startAnimation()}else this._momentum=0}d.prototype.onMouseUp.call(this,a)};c.prototype._rotateCamera=function(a){this._cameraRotateFunction(a)};c.prototype.stopAnimation=function(){null!==this._animationIntervalResult&&(clearInterval(this._animationIntervalResult),this._animationIntervalResult=null)};c.prototype.getMomentum=function(){return this._momentum};c.prototype.isAnimating=function(){return null!==
this._animationIntervalResult};c.prototype._startAnimation=function(){var a=this;null===this._animationIntervalResult&&(this._animationLastTickTime=Date.now(),this._animationIntervalResult=window.setInterval(function(){a._onTick()},this._preferredAnimationIntervalMilliseconds))};c.prototype._getMouseMoveOffsetForRotation=function(){return[-this._mouseMoveOffset.x*this._degreesPerPixel,this._mouseMoveOffset.y*this._degreesPerPixel]};c.prototype._onTick=function(){var a=Date.now();this._animationElapsedTimeSeconds=
(a-this._animationLastTickTime)/1E3;this._animationLastTickTime=a;this._rotateCamera([this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[0],this._animationElapsedTimeSeconds*this._rotationDegreesPerSecond[1]]);if(0<this._momentumLossPerSecond)if(this._momentum=Math.max(0,this._momentum-this._animationElapsedTimeSeconds*this._momentumLossPerSecond),0<this._momentum)for(a=0;a<this._rotationDegreesPerSecond.length;a++)this._rotationDegreesPerSecond[a]*=this._momentum;else{for(a=0;a<this._rotationDegreesPerSecond.length;a++)this._rotationDegreesPerSecond[a]=
0;this._rotateCamera(this._rotationDegreesPerSecond);this.stopAnimation()}};return c}(h.OperatorBase);h.CameraOrbitBaseOperator=e;var f=function(){function d(a){void 0===a&&(a=10);this._count=0;this._points=Array(a);this._times=Array(a)}d.prototype.clear=function(){this._count=0};d.prototype.add=function(a,b){void 0===b&&(b=Date.now());var d=this._count%this._points.length;void 0===this._points[d]?this._points[d]=a.copy():this._points[d].assign(a);this._times[d]=b;this._count++};d.prototype.getAverageOffsetWithinMilliseconds=
function(c,b){void 0===b&&(b=Date.now());var d=-1,e=a.Point2.zero(),f=Math.min(this._points.length,this._count);if(0<f){for(var h=0,k=0;k<f;k++){var r=(this._count-1-k)%this._points.length;if(b-this._times[r]>c)break;d=r;e.add(this._points[r]);h++}1<h?(e.subtract(this._points[d]),h--,e.scale(1/h)):(d=-1,e.set(0,0))}return 0<=d?a.Point2.subtract(e,this._points[d]):e};return d}()})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(d){function c(b,c,e){var f=d.call(this)||this;f._circle=new a.Markup.Shape.Circle;f._viewer=b;f._position=c;f._circle.setRadius(e);return f}__extends(c,d);c.prototype.draw=function(){if(this._circle){var b=this._viewer.view.projectPoint(this._position);this._circle.setCenter(a.Point2.fromPoint3(b));this._viewer.markupManager.getRenderer().drawCircle(this._circle)}};return c}(a.Markup.MarkupItem);h.OrbitMarkup=e;var f=function(d){function c(b){var c=d.call(this,
b,function(b){if(!c._viewer.isDrawingSheetActive())if(null!==c._pickPosition){if(null===c._circleMarkupHandler){var d=new e(c._viewer,c._pickPosition,c._circleRadius);c._circleMarkupHandler=c._viewer.markupManager.registerMarkup(d)}c._orbitByTurnTiltWithTarget(b,c._pickPosition)}else switch(d=c._viewer.view.getCamera(),c._orbitFallbackMode){default:case a.OrbitFallbackMode.CameraTarget:c._orbitByTurnTiltWithTarget(b,d.getTarget());break;case a.OrbitFallbackMode.ModelCenter:c._modelCenter&&c._orbitByTurnTiltWithTarget(b,
c._modelCenter);break;case a.OrbitFallbackMode.OrbitTarget:c._orbitByTurnTiltWithTarget(b,c._orbitTarget)}})||this;c._orbitTarget=a.Point3.zero();c._orbitFallbackMode=a.OrbitFallbackMode.ModelCenter;c._modelCenter=null;c._circleMarkupHandler=null;c._circleRadius=3;c._updateCameraCenterAction=new a.Util.CurrentAction(!1);c._updateCameraCenterTimer=new a.Internal.Timer;c._primaryButton=a.Button.Middle;c._pickPosition=null;c._viewer.setCallbacks({sceneReady:function(){c._updateModelCenter()},modelSwitched:function(){c._updateModelCenter()},
visibilityChanged:function(){c._updateModelCenter()},_updateTransform:function(a){a||c._updateModelCenter()},_geometryCreated:function(){c._updateModelCenter()},hwfParseComplete:function(){c._updateModelCenter()}});return c}__extends(c,d);c.prototype._updateModelCenter=function(b){var c=this;void 0===b&&(b=50);this._updateCameraCenterTimer.clear();this._updateCameraCenterAction.set(function(){return __awaiter(c,void 0,void 0,function(){var c=this,d,e,f,g;return __generator(this,function(h){switch(h.label){case 0:d=
new a.Box,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._viewer.model.getModelBounding(!0,!1)];case 2:return d=h.sent(),d.isDegenerate()&&0<b?(this._updateCameraCenterTimer.set(500,function(){c._updateModelCenter(b-1)}),[2]):[3,4];case 3:return e=h.sent(),f=!1,SC.isError(e)&&(g=SC.getStateFailure(e),1===g&&(f=!0)),console.assert(f),[3,4];case 4:return this._modelCenter=d.center(),[2]}})})})};c.prototype.onMouseDown=function(b){d.prototype.onMouseDown.call(this,b);this.isActive()&&b.getButton()===
this._primaryButton&&(b=b._getPickResult(a.SelectionMask.Face),null!==b&&0===b.overlayIndex()?this._pickPosition=b.getPosition():this._pickPosition=null)};c.prototype.onMouseUp=function(a){d.prototype.onMouseUp.call(this,a);a.getButton()===this._primaryButton&&(this._pickPosition=null);this._removeMarkup()};c.prototype._removeMarkup=function(){null!==this._circleMarkupHandler&&(this._viewer.markupManager.unregisterMarkup(this._circleMarkupHandler),this._circleMarkupHandler=null)};c.prototype._orbitByTurnTiltWithTarget=
function(b,c){var d=this._viewer.view,e=d.getCamera(),f=e.getPosition().subtract(c),h=e.getTarget().subtract(c),r=e.getUp().normalize(),m=a.Point3.subtract(h,f).normalize(),m=a.Point3.cross(r,m).normalize(),m=a.Matrix.createFromOffAxisRotation(m,b[1]);b=a.Matrix.createFromOffAxisRotation(r,b[0]);m=a.Matrix.multiply(b,m);b=m.transform(f);h=m.transform(h);r=m.transform(a.Point3.add(f,r));r.subtract(b);f=b;f.add(c);h.add(c);e.setPosition(f);e.setTarget(h);e.setUp(r);d.setCamera(e)};c.prototype.setOrbitFallbackMode=
function(a){this._orbitFallbackMode=a};c.prototype.getOrbitFallbackMode=function(){return this._orbitFallbackMode};c.prototype.setOrbitTarget=function(a){this._orbitTarget=a};c.prototype.getOrbitTarget=function(){return this._orbitTarget};c.prototype.setPrimaryButton=function(a){this._primaryButton=a};c.prototype.getPrimaryButton=function(){return this._primaryButton};c.prototype.needsSelection=function(b,c){return b===a.EventType.MouseDown&&c===this._primaryButton};c.prototype._selectionMask=function(b){return a.SelectionMask.Face};
return c}(h.CameraOrbitBaseOperator);h.CameraOrbitOperator=f})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c){c=e.call(this,c)||this;c._cameraPtPrevious=a.Point3.zero();return c}__extends(d,e);d.prototype.onMouseDown=function(a){e.prototype.onMouseDown.call(this,a);if(this.isActive()||this._viewer.isDrawingSheetActive()){var b=this._viewer.view;(a=b.getCamera().getCameraPlaneIntersectionPoint(a.getPosition(),b))&&this._cameraPtPrevious.assign(a)}};d.prototype.onMouseMove=function(c){e.prototype.onMouseMove.call(this,c);if(this.isActive()||this._viewer.isDrawingSheetActive()){var b=
this._viewer.view,d=b.getCamera();if(c=d.getCameraPlaneIntersectionPoint(c.getPosition(),b))c=a.Point3.subtract(c,this._cameraPtPrevious),d.dolly(c),b.setCamera(d)}};return d}(h.OperatorBase);h.CameraPanOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c){c=e.call(this,c)||this;c._mouseMoveZoomDelta=3;c._mouseWheelZoomDelta=.25;c._pinchZoomModifier=2.5;c._zoomToMousePosition=!0;c._mouseMoveZoomFactor=1;c._mouseWheelZoomFactor=-1;c._mouseWheelAdjustCameraTarget=!1;c._secondaryTouchId=null;c._lastTouch1=a.Point2.zero();c._lastTouch2=a.Point2.zero();c._prevLen=0;return c}__extends(d,e);d.prototype.setMouseWheelZoomInverted=function(a){this._mouseWheelZoomFactor=a?-1:1};d.prototype.getMouseWheelZoomInverted=
function(){return 1===this._mouseWheelZoomFactor};d.prototype.setMouseMoveZoomInverted=function(a){this._mouseMoveZoomFactor=a?-1:1};d.prototype.getMouseMoveZoomInverted=function(){return 1===this._mouseMoveZoomFactor};d.prototype.setMouseMoveZoomDelta=function(a){this._mouseMoveZoomDelta=a};d.prototype.getMouseMoveZoomDelta=function(){return this._mouseMoveZoomDelta};d.prototype.setMouseWheelZoomDelta=function(a){this._mouseWheelZoomDelta=a};d.prototype.getMouseWheelZoomDelta=function(){return this._mouseWheelZoomDelta};
d.prototype.setZoomToMousePosition=function(a){this._zoomToMousePosition=a};d.prototype.getZoomToMousePosition=function(){return this._zoomToMousePosition};d.prototype.setMouseWheelAdjustCameraTarget=function(a){this._mouseWheelAdjustCameraTarget=a};d.prototype.getMouseWheelAdjustCameraTarget=function(){return this._mouseWheelAdjustCameraTarget};d.prototype.onMouseMove=function(a){e.prototype.onMouseMove.call(this,a);if(this.isDragging()&&this.isActive()){var b=this._viewer.view;a=b.pointToWindowPosition(this._ptCurrent);
b=b.pointToWindowPosition(this._ptPrevious);this._doZoom(1-this._mouseMoveZoomDelta*this._mouseMoveZoomFactor*(a.y-b.y))}};d.prototype.onMousewheel=function(a){var b=1-this._mouseWheelZoomDelta*this._mouseWheelZoomFactor*a.getWheelDelta();this._doZoom(b,void 0,a.getPosition())};d.prototype.onTouchStart=function(c){var b=this._viewer.view;null===this._primaryTouchId?(this._primaryTouchId=c.getId(),this._lastTouch1.assign(b.pointToWindowPosition(c.getPosition()))):null===this._secondaryTouchId&&(this._secondaryTouchId=
c.getId(),this._lastTouch2.assign(b.pointToWindowPosition(c.getPosition())));null!==this._primaryTouchId&&null!==this._secondaryTouchId&&(this._prevLen=a.Point2.subtract(this._lastTouch2,this._lastTouch1).length(),this._dragging=!0)};d.prototype.onTouchMove=function(c){var b=this._viewer.view,d=c.getId();c=c.getPosition();d===this._primaryTouchId?this._lastTouch1.assign(b.pointToWindowPosition(c)):d===this._secondaryTouchId&&this._lastTouch2.assign(b.pointToWindowPosition(c));this._dragging&&d===
this._secondaryTouchId&&(b=a.Point2.subtract(this._lastTouch2,this._lastTouch1).length(),this._doZoom(1-(this._prevLen-b)*this._pinchZoomModifier),this._prevLen=b)};d.prototype.onTouchEnd=function(a){a=a.getId();this._primaryTouchId===a?this._primaryTouchId=null:this._secondaryTouchId===a&&(this._secondaryTouchId=null);this._dragging=!1};d.prototype.onDeactivate=function(){this._secondaryTouchId=this._primaryTouchId=null};d.prototype._doZoom=function(c,b,d){var e=this;void 0===b&&(b=this._viewer.view.getCamera());
var f=this._viewer.view,h=1/c;d&&this._zoomToMousePosition?(c=function(c){if(null!==c&&c.isEntitySelection()){var r=b.getPosition().subtract(b.getTarget()),m=a.Point3.subtract(b.getTarget(),b.getPosition());c=a.Point3.subtract(c.getPosition(),b.getPosition());m=b.getPosition().add(m.scale(a.Point3.dot(m,c)/a.Point3.dot(m,m)));b.setTarget(m);b.setPosition(a.Point3.add(m,r))}r=b.getCameraPlaneIntersectionPoint(d,e._viewer.view);e._zoomHelper(h,b);m=b.getCameraPlaneIntersectionPoint(d,e._viewer.view);
null!==r&&null!==m&&b.dolly(a.Point3.subtract(m,r));f.setCamera(b)},this._mouseWheelAdjustCameraTarget?this._viewer.view.pickFromPoint(d,new a.PickConfig).then(c):c(null)):this._zoomHelper(h,b)};d.prototype._zoomHelper=function(c,b){var d=this._viewer.view;b.setWidth(b.getWidth()*c);b.setHeight(b.getHeight()*c);var e=b.getPosition(),f=b.getTarget();c=a.Point3.subtract(f,e).scale(c);b.setPosition(a.Point3.subtract(f,c));d.setCamera(b)};return d}(h.OperatorBase);h.CameraZoomOperator=e})(a.Operator||
(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a,b,d,h){a=e.call(this,a)||this;a._activeOperator=null;a._activeTouchCount=0;a._touchMoveCount=0;a._returnToOrbit=!1;a._orbitOperator=b;a._panOperator=d;a._zoomOperator=h;return a}__extends(d,e);d.prototype.needsSelection=function(a,b,d){return this._orbitOperator.needsSelection(a,b)||this._panOperator.needsSelection(a,b,d)||this._zoomOperator.needsSelection(a,b,d)};d.prototype.selectionRequirements=function(a){return this._orbitOperator.selectionRequirements(a)|
this._panOperator.selectionRequirements(a)|this._zoomOperator.selectionRequirements(a)};d.prototype.onViewOrientationChange=function(){this._activeTouchCount=0;this._returnToOrbit=!1};d.prototype.onMouseDown=function(a){e.prototype.onMouseDown.call(this,a);this._setActiveOperatorForMouseInput(a);if(this._activeOperator)this._activeOperator.onMouseDown(a)};d.prototype.onMouseMove=function(a){e.prototype.onMouseMove.call(this,a);if(this._activeOperator&&this._dragging&&3<this._dragCount)this._activeOperator.onMouseMove(a)};
d.prototype.onMouseUp=function(a){if(this._activeOperator)this._activeOperator.onMouseUp(a);this._activeOperator instanceof h.CameraOrbitOperator||this._orbitOperator._removeMarkup();e.prototype.onMouseUp.call(this,a)};d.prototype.onMousewheel=function(a){this._zoomOperator.onMousewheel(a)};d.prototype.onTouchStart=function(a){++this._activeTouchCount;this._orbitOperator.onTouchStart(a);this._zoomOperator.onTouchStart(a);this._viewer.isDrawingSheetActive()&&(this._panOperator.onTouchStart(a),this._orbitOperator.onDeactivate());
1===this._activeTouchCount&&(this._primaryTouchId=a.getId());2===this._activeTouchCount&&(this._orbitOperator.onDeactivate(),this._panOperator.onTouchStart(a),this._zoomOperator.onTouchStart(a))};d.prototype.onTouchMove=function(a){++this._touchMoveCount;5<this._touchMoveCount&&(this._returnToOrbit?(this._orbitOperator.onTouchStart(a),this._returnToOrbit=!1):1===this._activeTouchCount?(this._orbitOperator.onTouchMove(a),this._zoomOperator.onTouchMove(a),this._panOperator.onTouchMove(a)):2===this._activeTouchCount&&
(this._zoomOperator.onTouchMove(a),this._panOperator.onTouchMove(a)))};d.prototype.onTouchEnd=function(a){2===this._activeTouchCount&&(this._returnToOrbit=!0);this._zoomOperator.onTouchEnd(a);this._panOperator.onTouchEnd(a);this._orbitOperator.onTouchEnd(a);0<this._activeTouchCount&&--this._activeTouchCount;0===this._activeTouchCount&&(this._touchMoveCount=0)};d.prototype.stopInteraction=function(){var c=[],b;b=e.prototype.stopInteraction.call(this);void 0!==b&&c.push(b);this._touchMoveCount=this._activeTouchCount=
0;b=this._zoomOperator.onDeactivate();void 0!==b&&c.push(b);b=this._panOperator.onDeactivate();void 0!==b&&c.push(b);b=this._orbitOperator.onDeactivate();void 0!==b&&c.push(b);return a.Util.waitForAll(c)};d.prototype._setActiveOperatorForMouseInput=function(c){var b=this._viewer.operatorManager,d=b.getOperator(a.OperatorId.Orbit),e=b.getOperator(a.OperatorId.Pan),b=b.getOperator(a.OperatorId.Zoom),f=this._viewer.isDrawingSheetActive();!f&&d.checkMapping(c)?this._activeOperator=this._orbitOperator:
f||e.checkMapping(c)?this._activeOperator=this._panOperator:b.checkMapping(c)?this._activeOperator=this._zoomOperator:this._activeOperator=null};d.prototype.onDeactivate=function(){e.prototype.onDeactivate.call(this);this._orbitOperator.onDeactivate();this._panOperator.onDeactivate();this._zoomOperator.onDeactivate()};return d}(h.OperatorBase);h.CameraNavigationOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c){var b=e.call(this,c,function(a){b._rotateAroundAxis(b._rotationAxis,a[0])})||this;b._rotationAxis=new a.Point3(0,0,1);b._tiltAmount=12;return b}__extends(d,e);d.prototype._rotateAroundAxis=function(c,b){var d=this._viewer.view,e=d.getCamera(),f=e.getPosition(),h=e.getUp().normalize(),k=e.getTarget();c=a.Matrix.createFromOffAxisRotation(c,b);b=(new a.Matrix).setTranslationComponent(-k.x,-k.y,-k.z);b=a.Matrix.multiply(b,c);k=(new a.Matrix).setTranslationComponent(k.x,
k.y,k.z);a.Matrix.multiply(b,k).transform(f,f);c.transform(h,h);h.normalize();e.setPosition(f);e.setUp(h);d.setCamera(e)};d.prototype.onMousewheel=function(c){c=c.getWheelDelta();var b=this._viewer.view.getCamera(),d=b.getUp().normalize(),b=a.Point3.subtract(b.getTarget(),b.getPosition()).normalize(),d=a.Point3.cross(d,b).normalize();0<c?this._rotateAroundAxis(d,this._tiltAmount):this._rotateAroundAxis(d,-this._tiltAmount)};d.prototype.setRotationAxis=function(c){var b=!0;switch(c){case a.Axis.X:this._rotationAxis.set(1,
0,0);break;case a.Axis.Y:this._rotationAxis.set(0,1,0);break;case a.Axis.Z:this._rotationAxis.set(0,0,1);break;default:b=!1}return b};return d}(h.CameraOrbitBaseOperator);h.CameraTurntableOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c,b,d){var h=e.call(this)||this;c;h._keyboardWalkOperator=d;h._walkOperator=b;h._activeOperator=b;h._walkMode=a.WalkMode.Mouse;h._active=!1;return h}__extends(d,e);d.prototype.setWalkMode=function(c){var b=this;this._walkMode!==c&&(this._walkMode=c,c===a.WalkMode.Keyboard?(this._activeOperator=this._keyboardWalkOperator,this._active&&(c=this._walkOperator.onDeactivate().then(function(){b._keyboardWalkOperator.onActivate()}),c)):(this._activeOperator=
this._walkOperator,this._active&&(this._keyboardWalkOperator.onDeactivate(),this._walkOperator.onActivate())))};d.prototype.getWalkMode=function(){return this._activeOperator instanceof h.CameraKeyboardWalkOperator?a.WalkMode.Keyboard:a.WalkMode.Mouse};d.prototype.onMouseDown=function(a){this._activeOperator.onMouseDown(a)};d.prototype.onMouseMove=function(a){this._activeOperator.onMouseMove(a)};d.prototype.onMouseUp=function(a){this._activeOperator.onMouseUp(a)};d.prototype.onMousewheel=function(a){this._activeOperator.onMousewheel(a)};
d.prototype.onTouchStart=function(a){this._activeOperator.onTouchStart(a)};d.prototype.onTouchMove=function(a){this._activeOperator.onTouchMove(a)};d.prototype.onTouchEnd=function(a){this._activeOperator.onTouchEnd(a)};d.prototype.onKeyDown=function(a){this._activeOperator.onKeyDown(a)};d.prototype.onKeyUp=function(a){this._activeOperator.onKeyUp(a)};d.prototype.onDeactivate=function(){return this._activeOperator.onDeactivate()};d.prototype.onActivate=function(){this._active=!0;return this._activeOperator.onActivate()};
d.prototype.onViewOrientationChange=function(){this._active=!1;this._activeOperator.onViewOrientationChange()};d.prototype.selectionRequirements=function(a){return this._activeOperator.selectionRequirements(a)};d.prototype.needsSelection=function(a,b,d){return this._activeOperator.needsSelection(a,b,d)};d.prototype.stopInteraction=function(){return this._activeOperator.stopInteraction()};return d}(h.Operator);h.CameraWalkModeOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator=
{}));
(function(a){(function(h){var e=function(e){function d(c){c=e.call(this,c)||this;c._tilt=0;c._isWalking=!1;c._majorAxis=a.Axis.X;c._timerId=null;c._walkButton=a.Button.None;c._previousTimestamp=0;c._activeTouchCount=0;c._maxDistance=200;c._walkSpeed=0;c._minTargetDistance=0;c._rotationSpeed=120;return c}__extends(d,e);d.prototype.onActivate=function(){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,f,h;return __generator(this,function(k){switch(k.label){case 0:return c=this._viewer.view,b=
this._viewer.model,[4,b.getModelBounding(!0,!1)];case 1:return d=k.sent(),e=d.extents(),f=Math.max(e.x,e.y,e.z),this._walkSpeed=f/5,this._minTargetDistance=f/20,c.getProjectionMode()!==a.Projection.Perspective&&c.setProjectionMode(a.Projection.Perspective),this._calculateInitialPosition(),h=this._viewer._getCallbackManager(),h.trigger("walkOperatorActivated"),[2]}})})};d.prototype.onKeyDown=function(c){c=c.getKeyCode();c===a.KeyCode.PgUp&&(this._walkSpeed*=1.2);c===a.KeyCode.PgDown&&(this._walkSpeed*=
.8)};d.prototype.onDeactivate=function(){var a=this._resetCameraTarget();this.stopWalking();return a};d.prototype.onMouseDown=function(c){e.prototype.onMouseDown.call(this,c);var b=this._viewer.view;b.getProjectionMode()!==a.Projection.Perspective&&(b.setProjectionMode(a.Projection.Perspective),this._calculateInitialPosition());this.isActive()&&(this.stopWalking(),this._isWalking=!0,this._walkButton=c.getButton())};d.prototype.onMouseMove=function(a){e.prototype.onMouseMove.call(this,a);this._isWalking&&
null===this._timerId&&this.isActive()&&(this._previousTimestamp=Date.now(),this._onTick())};d.prototype.onMouseUp=function(a){this.isActive()&&this.stopWalking();e.prototype.onMouseUp.call(this,a)};d.prototype.onTouchStart=function(c){e.prototype.onTouchStart.call(this,c);++this._activeTouchCount;1===this._activeTouchCount?this._walkButton=a.Button.Left:2===this._activeTouchCount?this._walkButton=a.Button.Right:3===this._activeTouchCount&&(this._walkButton=a.Button.None)};d.prototype.onTouchMove=
function(c){3===this._activeTouchCount&&this._primaryTouchId===c.getId()?(this._ptCurrent.assign(c.getPosition()),c=a.Point2.subtract(this._ptCurrent,this._ptPrevious),this._adjustTilt(c.y/100*1.5)):3>this._activeTouchCount&&e.prototype.onTouchMove.call(this,c)};d.prototype.onTouchEnd=function(a){e.prototype.onTouchEnd.call(this,a);0<this._activeTouchCount&&--this._activeTouchCount};d.prototype.onMousewheel=function(a){0<a.getWheelDelta()?this._adjustTilt(3):this._adjustTilt(-3)};d.prototype.stopWalking=
function(){null!==this._timerId&&(cancelAnimationFrame(this._timerId),this._timerId=null);this._isWalking=!1};d.prototype._majorAxisRotate=function(c,b){var d=Math.PI/180*b;b=Math.sin(d);d=Math.cos(d);return this._majorAxis===a.Axis.X?new a.Point3(c.x,c.y*d-c.z*b,c.y*b+c.z*d):this._majorAxis===a.Axis.Y?new a.Point3(c.z*b+c.x*d,c.y,c.z*d-c.x*b):new a.Point3(c.x*d-c.y*b,c.x*b+c.y*d,c.z)};d.prototype._testWalk=function(c,b,d){return __awaiter(this,void 0,void 0,function(){var e,f,h;return __generator(this,
function(k){switch(k.label){case 0:return e=new a.Event.MouseInputEvent(0,0,d,a.Buttons.None,a.KeyModifiers.None,a.MouseInputType.Down),f=new a.Event.MouseInputEvent(0,c,d,a.Buttons.None,a.KeyModifiers.None,a.MouseInputType.Move),h=new a.Event.MouseInputEvent(0,c,d,a.Buttons.None,a.KeyModifiers.None,a.MouseInputType.Up),this.onMouseDown(e),this.onMouseMove(f),[4,a.Internal.sleep(b)];case 1:return k.sent(),this.onMouseUp(h),[2]}})})};d.prototype._onTick=function(){var c=this,b=Date.now(),d=(b-this._previousTimestamp)/
1E3;this._previousTimestamp=b;var b=this._viewer.view,e=b.getCamera();this._resetPosition(e);var f=e.getUp().normalize(),h=e.getTarget(),k=e.getPosition(),r=a.Point3.subtract(h,k).normalize(),m=a.Point3.cross(f,r).normalize(),n=a.Point3.distance(h,k),q=a.Point2.subtract(this._ptCurrent,this._ptFirst),t=new a.Point2(Math.abs(q.x)/this._maxDistance,Math.abs(q.y)/this._maxDistance),u=this._rotationSpeed*d*t.x,w=this._walkSpeed*d*t.x,d=this._walkSpeed*d*t.y;this._walkButton===a.Button.Left?(0!==q.x&&
(0<q.x?r.assign(this._majorAxisRotate(r,-u)):0>q.x&&r.assign(this._majorAxisRotate(r,u))),0!==q.y&&(0>q.y?k.add(r.copy().scale(d)):0<q.y&&k.add(r.copy().scale(-d)))):this._walkButton===a.Button.Right&&(0<Math.abs(q.y)&&(f.scale(d),0<q.y&&f.negate(),k.add(f)),0<Math.abs(q.x)&&(d=m.copy().scale(w),0<q.x&&d.negate(),k.add(d)));q=Math.max(this._walkSpeed*t.y,this._minTargetDistance);a.Matrix.createFromOffAxisRotation(m,this._tilt).transform(r,r);h.assign(a.Point3.add(k,r.scale(q)));r=q*e.getWidth()/n;
n=q*e.getHeight()/n;e.setWidth(r);e.setHeight(n);e.setPosition(k);e.setTarget(h);b.setCamera(e);this._timerId=requestAnimationFrame(function(){c._onTick()})};d.prototype._calculateInitialPosition=function(){var c=this._viewer.view,b=c.getCamera();this._majorAxis=this._calculateMajorAxis(b);this._setClampedTiltValue(this._calculateInitialTilt(b));this._resetPosition(b);var d=b.getPosition(),e=b.getTarget(),f=b.getUp().normalize(),h=a.Point3.subtract(e,d).normalize(),f=a.Point3.cross(f,h).normalize(),
e=a.Point3.distance(e,d);a.Matrix.createFromOffAxisRotation(f,this._tilt).transform(h,h);b.setTarget(a.Point3.add(d,h.scale(e)));c.setCamera(b)};d.prototype._calculateInitialTilt=function(c){void 0===c&&(c=this._viewer.view.getCamera());var b=c.getPosition();c=c.getTarget();c=a.Point3.subtract(c,b);b=c.length();this._majorAxis===a.Axis.X?c.x=0:this._majorAxis===a.Axis.Y?c.y=0:this._majorAxis===a.Axis.Z&&(c.z=0);c=c.length();return 180/Math.PI*Math.acos(c/b)};d.prototype._resetPosition=function(c){void 0===
c&&(c=this._viewer.view.getCamera());this._majorAxis=this._calculateMajorAxis(c);var b=c.getPosition(),d=c.getTarget(),d=a.Point3.subtract(d,b),e=d.length();switch(this._majorAxis){case a.Axis.X:d.set(0,d.y,d.z);c.setUp(new a.Point3(1,0,0));break;case a.Axis.Y:d.set(d.x,0,d.z);c.setUp(new a.Point3(0,1,0));break;case a.Axis.Z:d.set(d.x,d.y,0),c.setUp(new a.Point3(0,0,1))}d.normalize().scale(e);c.setTarget(a.Point3.add(b,d))};d.prototype._calculateMajorAxis=function(c){void 0===c&&(c=this._viewer.view.getCamera());
var b=c.getUp();c=Math.abs(b.x);var d=Math.abs(b.y),b=Math.abs(b.z);return b>=c&&b>=d?a.Axis.Z:d>=c&&d>=b?a.Axis.Y:a.Axis.X};d.prototype._adjustTilt=function(c){var b=this._viewer.view;this._setClampedTiltValue(this._tilt+=c);c=b.getCamera();this._resetPosition(c);var d=c.getTarget(),e=c.getPosition(),f=a.Point3.distance(d,e),h=c.getUp().normalize(),d=a.Point3.subtract(d,e).normalize(),h=a.Point3.cross(h,d).normalize();a.Matrix.createFromOffAxisRotation(h,this._tilt).transform(d,d);d.normalize().scale(f);
c.setTarget(a.Point3.add(e,d));b.setCamera(c)};d.prototype._resetCameraTarget=function(){return __awaiter(this,void 0,void 0,function(){var c,b,d,e,f,h;return __generator(this,function(k){switch(k.label){case 0:return c=this._viewer.view,b=c.getCanvasSize(),d=new a.Point2(Math.round(b.x/2),Math.round(b.y/2)),e=new a.PickConfig,[4,c.pickFromPoint(d,e)];case 1:return f=k.sent(),f.isEntitySelection()&&(h=c.getCamera(),h.setTarget(f.getPosition()),c.updateCamera(h)),[2]}})})};d.prototype._setClampedTiltValue=
function(a){this._tilt=Math.max(Math.min(a,d.MAX_TILT),d.MIN_TILT)};d.MAX_TILT=45;d.MIN_TILT=-45;return d}(h.OperatorBase);h.CameraWalkOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(c,b){c=e.call(this,c)||this;c._pickConfig=new a.PickConfig(a.SelectionMask.Line);c._moveSelectionAction=new a.Util.CurrentAction(!0);c._lengthMarkup=null;c._edgeMarkup=null;c._measureManager=b;c._pickConfig.restrictLinesAndPointsToSelectedFaceInstances=!1;return c}__extends(d,e);d.prototype.onActivate=function(){null===this._edgeMarkup&&(this._edgeMarkup=new a.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,null,new a.Matrix,1))};
d.prototype._unregisterEdgeMarkup=function(){if(null!==this._edgeMarkup){var a=this._edgeMarkup._getId();""!==a&&(this._viewer.markupManager.unregisterMarkup(a),this._edgeMarkup._setId(""))}};d.prototype._registerEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup._setId(this._viewer.markupManager.registerMarkup(this._edgeMarkup)))};d.prototype._resetEdgeMarkup=function(){null!==this._edgeMarkup&&(this._unregisterEdgeMarkup(),this._edgeMarkup.reset())};d.prototype._performMoveSelection=
function(a,b){return __awaiter(this,void 0,void 0,function(){var d,e,f;return __generator(this,function(h){switch(h.label){case 0:return d=this._viewer.view,[4,d.pickFromPoint(a,this._pickConfig)];case 1:return e=h.sent(),(f=e.getLineEntity())&&0===e.overlayIndex()&&0!==(f.getLineBits()&4)?(b.setLineGeometry(f.getPoints()),this._registerEdgeMarkup()):this._resetEdgeMarkup(),[2]}})})};d.prototype._performUpSelection=function(c){return __awaiter(this,void 0,void 0,function(){var b,d,e,f,h,k,r,m,n;return __generator(this,
function(q){switch(q.label){case 0:return b=this._viewer.view,d=this._viewer.model,e=this._viewer._getCallbackManager(),[4,b.pickFromPoint(c,this._pickConfig)];case 1:f=q.sent();if(f.overlayIndex())return[2];if(this._lengthMarkup&&2===this._lengthMarkup._getStage())return this._lengthMarkup._nextStage(),this._measureManager.finalizeMeasurement(this._lengthMarkup),this._lengthMarkup=null,[2];if(this._lengthMarkup||!f.isLineSelection())return[2];h=f.getLineEntity();if(0===(h.getLineBits()&4))return[2];
k=f.getNodeId();r=d.getNodeUnitMultiplier(k);return[4,d.getEdgeProperty(k,h.getLineId())];case 2:m=q.sent();e.trigger("measurementBegin");if(!m)return[2];m instanceof a.SubentityProperties.LineElement||m instanceof a.SubentityProperties.OtherEdgeElement?(n=d.getNodeNetMatrix(k),this._lengthMarkup=new a.Markup.Measure.MeasureStraightEdgeLengthMarkup(this._viewer,m,n,r),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(h.getPoints()),this._lengthMarkup._nextStage(),
this._lengthMarkup.adjust(c)):m instanceof a.SubentityProperties.CircleElement&&(n=d.getNodeNetMatrix(k),this._lengthMarkup=new a.Markup.Measure.MeasureCircleEdgeLengthMarkup(this._viewer,m,n,r),this._measureManager.addMeasurement(this._lengthMarkup),this._lengthMarkup.setLineGeometry(h.getPoints()),this._lengthMarkup._nextStage(),this._lengthMarkup.adjust(c));2===this._lengthMarkup._getStage()&&e.trigger("measurementValueSet",this._lengthMarkup);return[2]}})})};d.prototype.onMouseMove=function(a){var b=
this;e.prototype.onMouseMove.call(this,a);var d=this._edgeMarkup;if(null!==d){var h=a.getPosition();this.isDragging()&&null===this._primaryTouchId?this._resetEdgeMarkup():(null===this._lengthMarkup&&this._moveSelectionAction.set(function(){return b._performMoveSelection(h,d)}),this._viewer.markupManager.refreshMarkup(),null!==this._lengthMarkup&&0<this._lengthMarkup._getStage()&&this._lengthMarkup.adjust(h))}};d.prototype._onMouseUpImpl=function(a){if(this.isActive()){var b=null!==this._primaryTouchId&&
null!==this._lengthMarkup;if(3>this._dragCount||b)a=a.getPosition(),this._performUpSelection(a)}};d.prototype.onMouseUp=function(a){this._onMouseUpImpl(a);e.prototype.onMouseUp.call(this,a)};d.prototype.setDraggingEnabled=function(a){this._dragging=a};d.prototype.onKeyUp=function(a){a};d.prototype.onKeyDown=function(c){c.getKeyCode()===a.KeyCode.Escape&&(null!==this._lengthMarkup?(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null):this._measureManager.removeLastMeasurement(),
null!==this._edgeMarkup&&this._resetEdgeMarkup())};d.prototype.setHandled=function(){return null!==this._lengthMarkup};d.prototype.onDeactivate=function(){null!==this._lengthMarkup&&(this._measureManager.removeMeasurement(this._lengthMarkup),this._lengthMarkup=null);null!==this._edgeMarkup&&this._resetEdgeMarkup()};return d}(h.OperatorBase);h.MeasureEdgeLengthOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(d){return d.getSelectionType()!==a.SelectionType.None?(d=d.getFaceEntity().getCadFaceBits(),0!==(d&2)&&0!==(d&1)):!1}var f=function(d){function c(b,c){b=d.call(this,b)||this;b._moveSelectionAction=new a.Util.CurrentAction(!0);b._currentHighlight=null;b._markup=null;b._measureManager=c;return b}__extends(c,d);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,f,h,k,r,m,n;return __generator(this,function(q){switch(q.label){case 0:return c=this._viewer.view,d=this._viewer.model,[4,c.pickFromPoint(b,new a.PickConfig)];case 1:f=q.sent();if(0!==f.overlayIndex()||!f.isFaceSelection())return[2];h=f.getNodeId();k=f.getFaceEntity();if(d.getNodeType(f.getNodeId())!==a.NodeType.BodyInstance||this._markup&&(r=this._markup.getFirstSelection(),
h===r.getNodeId()&&(m=r.getFaceEntity().getCadFaceIndex(),n=k.getCadFaceIndex(),m===n)))return[2];null!==this._currentHighlight?f.equals(this._currentHighlight)?f.getSelectionType()===a.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),e(f)&&(this._currentHighlight=f,d.setNodeFaceColor(h,k.getCadFaceIndex(),a.Color.yellow()))):null===this._currentHighlight&&e(f)&&(this._currentHighlight=f,d.setNodeFaceColor(h,k.getCadFaceIndex(),a.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=
function(b){return __awaiter(this,void 0,void 0,function(){var c,d,f,h,k,r;return __generator(this,function(m){switch(m.label){case 0:return c=this._viewer.view,d=this._viewer.model,[4,c.pickFromPoint(b,new a.PickConfig)];case 1:f=m.sent();if(f.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(this._measureManager.finalizeMeasurement(this._markup),this._markup=null),[2];if(!f.isFaceSelection()||
d.getNodeType(f.getNodeId())!==a.NodeType.BodyInstance||this._markup&&!(1>=this._markup._getStage())||!e(f))return[2];h=f.getFaceEntity();return[4,d.getFaceProperty(f.getNodeId(),h.getCadFaceIndex())];case 2:k=m.sent();if(!(k instanceof a.SubentityProperties.PlaneElement))return[2];this._unsetCurrentHighlight();null===this._markup?(this._markup=new a.Markup.Measure.MeasureFaceFaceAngleMarkup(this._viewer),this._markup.setFirstFace(f),this._measureManager.addMeasurement(this._markup)):(r=this._markup.setSecondFace(f))&&
this._markup.adjust(b);return[2]}})})};c.prototype.onMouseMove=function(a){d.prototype.onMouseMove.call(this,a);a=a.getPosition();(!this._markup||1>=this._markup._getStage())&&this._performMoveSelection(a);this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(a)};c.prototype._onMouseUpImpl=function(a){var c=this;if(this.isActive()){var d=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(3>this._dragCount||d){var e=
a.getPosition();this._moveSelectionAction.set(function(){return c._performUpSelection(e)})}}};c.prototype.onMouseUp=function(a){this._onMouseUpImpl(a);d.prototype.onMouseUp.call(this,a)};c.prototype.setDraggingEnabled=function(a){this._dragging=a};c.prototype.onKeyUp=function(a){a};c.prototype.onKeyDown=function(b){b.getKeyCode()===a.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};
c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};return c}(h.OperatorBase);h.MeasureFaceFaceAngleOperator=f})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(d){return d.getSelectionType()!==a.SelectionType.None?0!==(d.getFaceEntity().getCadFaceBits()&1):!1}var f=function(d){function c(b,c){b=d.call(this,b)||this;b._moveSelectionAction=new a.Util.CurrentAction(!0);b._currentHighlight=null;b._markup=null;b._measureManager=c;return b}__extends(c,d);c.prototype._unsetCurrentHighlight=function(){null!==this._currentHighlight&&(this._viewer.model.unsetNodeFaceColor(this._currentHighlight.getNodeId(),this._currentHighlight.getFaceEntity().getCadFaceIndex()),
this._currentHighlight=null)};c.prototype._performMoveSelection=function(b){return __awaiter(this,void 0,void 0,function(){var c,d,f,h,k,r;return __generator(this,function(m){switch(m.label){case 0:return c=this._viewer.view,d=this._viewer.model,[4,c.pickFromPoint(b,new a.PickConfig)];case 1:f=m.sent();if(0!==f.overlayIndex()||!f.isFaceSelection())return[2];h=f.getNodeId();k=f.getFaceEntity();if(d.getNodeType(h)!==a.NodeType.BodyInstance||this._markup&&(r=this._markup.getFirstSelection(),null!==r&&
h===r.getNodeId()&&k.getCadFaceIndex()===r.getFaceEntity().getCadFaceIndex()))return[2];null!==this._currentHighlight?f.equals(this._currentHighlight)?f.getSelectionType()===a.SelectionType.None&&this._unsetCurrentHighlight():(this._unsetCurrentHighlight(),e(f)&&(this._currentHighlight=f,d.setNodeFaceColor(h,k.getCadFaceIndex(),a.Color.yellow()))):e(f)&&(this._currentHighlight=f,d.setNodeFaceColor(h,k.getCadFaceIndex(),a.Color.yellow()));return[2]}})})};c.prototype._performUpSelection=function(b){return __awaiter(this,
void 0,void 0,function(){var c,d,f,h,k,r,m,n;return __generator(this,function(q){switch(q.label){case 0:return c=this._viewer.view,d=this._viewer.model,[4,c.pickFromPoint(b,new a.PickConfig)];case 1:f=q.sent();if(f.overlayIndex())return[2];if(this._markup&&1<this._markup._getStage())return this._viewer.trigger("measurementBegin"),this._markup._nextStage(),this._markup._isFinalized()&&(this._measureManager.finalizeMeasurement(this._markup),this._markup=null),[2];if(!f.isFaceSelection())return[2];h=
f.getNodeId();k=f.getFaceEntity();return e(f)&&d.getNodeType(h)===a.NodeType.BodyInstance&&(!this._markup||1>=this._markup._getStage())?[4,d.getFaceProperty(h,k.getCadFaceIndex())]:[2];case 2:r=q.sent();if(!r)return[2];m=d.getNodeNetMatrix(h);this._unsetCurrentHighlight();return r instanceof a.SubentityProperties.PlaneElement||r instanceof a.SubentityProperties.CylinderElement?[4,d.getNodesBounding([h])]:[3,4];case 3:n=q.sent(),this._markup?this._markup.setSecondFace(b,f,r,m,n):(this._markup=new a.Markup.Measure.MeasureFaceFaceDistanceMarkup(this._viewer),
this._markup.setUnitMultiplier(d.getNodeUnitMultiplier(h)),this._markup.setFirstFace(f,r,m,n),this._measureManager.addMeasurement(this._markup)),q.label=4;case 4:return[2]}})})};c.prototype.onMouseMove=function(a){var c=this;d.prototype.onMouseMove.call(this,a);var e=a.getPosition();(!this._markup||1>=this._markup._getStage())&&this._moveSelectionAction.set(function(){return c._performMoveSelection(e)});this._viewer.markupManager.refreshMarkup();null!==this._markup&&0<this._markup._getStage()&&this._markup.adjust(e)};
c.prototype._onMouseUpImpl=function(a){if(this.isActive()){var c=null!==this._primaryTouchId&&null!==this._markup&&1<this._markup._getStage();if(3>this._dragCount||c)a=a.getPosition(),this._performUpSelection(a)}};c.prototype.onMouseUp=function(a){this._onMouseUpImpl(a);d.prototype.onMouseUp.call(this,a)};c.prototype.setDraggingEnabled=function(a){this._dragging=a};c.prototype.onKeyUp=function(a){a};c.prototype.onKeyDown=function(b){b.getKeyCode()===a.KeyCode.Escape&&(null!==this._markup?(this._markup.cleanup(),
this._measureManager.removeMeasurement(this._markup),this._markup=null):this._measureManager.removeLastMeasurement())};c.prototype.setHandled=function(){return null!==this._markup&&1<this._markup._getStage()};c.prototype.onDeactivate=function(){d.prototype.onDeactivate.call(this);this._unsetCurrentHighlight();null!==this._markup&&(this._measureManager.removeMeasurement(this._markup),this._markup.cleanup(),this._markup=null)};return c}(h.OperatorBase);h.MeasureFaceFaceDistanceOperator=f})(a.Operator||
(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){function e(b,c){var d=new a.Point4(c.x,c.y,c.z,1);c=new a.Point4(0,0,0,0);b.view.getFullCameraMatrix().transform4(d,c);d=1/c.w;c=new a.Point2(c.x*d,c.y*d);d=b.model.getClientDimensions();b=d[0];d=d[1];c.x=.5*b*(c.x+1);c.y=.5*d*(c.y+1);c.x=Math.max(0,Math.min(c.x,b));c.y=d-Math.max(0,Math.min(c.y,d));return c}var f=function(){return function(a,c,d){this.worldPosition=a;this.screenPosition=c;this.selectionItem=d}}(),d=function(b){function c(d){var e=b.call(this,d)||this;e._cursorSprite=
new a.Markup.Shape.Circle;e._name="CursorMarkup";e._cursorSprite.setFillColor(d.measureManager.getMeasurementColor());e._markupId=d.markupManager.registerMarkup(e);return e}__extends(c,b);c.prototype.draw=function(){this._viewer.markupManager.getRenderer().drawCircle(this._cursorSprite)};c.prototype.enable=function(a){this._cursorSprite.setRadius(a?2.5:0)};c.prototype.setPosition=function(a){this._cursorSprite.setCenter(a)};c.prototype.destroy=function(){this._viewer.markupManager.unregisterMarkup(this._markupId)};
return c}(a.Markup.Measure.MeasureMarkup),c=function(b){function c(d,e){var f=b.call(this,d)||this;f._updateCursorSpriteAction=new a.Util.CurrentAction(!0);f._measureMarkup=null;f._cursorMarkup=null;f._draggingEnabled=!0;f._viewer=d;f._measureManager=e;f._snappingConfig={enabled:!0,preferVertices:!0};return f}__extends(c,b);c.prototype._getStage=function(){return null===this._measureMarkup?0:this._measureMarkup._getStage()};c.prototype._draw=function(){var a=!1;2>this._getStage()&&null!==this._cursorMarkup&&
(this._cursorMarkup.draw(),a=!0);null!==this._measureMarkup&&(this._measureMarkup.draw(),a=!0);a&&this._viewer.markupManager.refreshMarkup()};c.prototype._activateCursorSprite=function(){null!==this._cursorMarkup&&this._cursorMarkup.enable(!0)};c.prototype._createConfig=function(b){return new a.PickConfig(b?a.SelectionMask.All:a.SelectionMask.Face)};c.prototype._finalizeMeasurement=function(a,b){return __awaiter(this,void 0,void 0,function(){var c,d,e;return __generator(this,function(f){switch(f.label){case 0:c=
this._measureMarkup;if(null===c)return console.assert(!1),[2];d=this._createConfig(b);return[4,this._viewer.view.pickFromPoint(a,d)];case 1:e=f.sent();if(e.overlayIndex())return[2];this._measureMarkup.finalize();this._measureManager.finalizeMeasurement(this._measureMarkup);this._measureMarkup=null;return[2]}})})};c.prototype._getLineSnapPoint=function(b,c){console.assert(2!=this._getStage());var d=this._snappingConfig.preferVertices?b.getBestVertex():null;if(null!==d)return d;d=b.getPosition();if(!c||
0===this._getStage())return d;console.assert(null!==this._measureMarkup);c=b.getPoints();var f;a:{for(b=0;b<c.length-1;b++)if(a.Util.isPointOnLineSegment(c[b],c[b+1],d,1E-10)){f=b;break a}f=0}b=c[f];c=c[f+1];f=this._measureMarkup.getFirstPointPosition();b=a.Util.closestPointFromPointToSegment(b,c,f);c=e(this._viewer,b);f=e(this._viewer,d);c=a.Point2.subtract(c,f).squaredLength();f=this._viewer.getSelectionManager().getPickTolerance();return c<=f*f?b:d};c.prototype._getSelectionCursorPoints=function(a,
b){return __awaiter(this,void 0,void 0,function(){var c,d,g,h,n,q,t,u;return __generator(this,function(w){switch(w.label){case 0:c=this._getStage();if(2<=c)return[2,null];d=this._createConfig(b);return[4,this._viewer.view.pickFromPoint(a,d)];case 1:g=w.sent();if(0!==g.overlayIndex())return[2,null];h=g.getPosition();n=a;this._snappingConfig.enabled&&(q=g.getLineEntity(),t=g.getPointEntity(),q||t)&&(u=null,null!==q?u=this._getLineSnapPoint(q,b):null!==t&&(u=t.getPosition()),null!==u&&(h=u,n=e(this._viewer,
h)));return[2,new f(h,n,g)]}})})};c.prototype._updateMeasurementPoints=function(b,c){return __awaiter(this,void 0,void 0,function(){var d,e;return __generator(this,function(f){switch(f.label){case 0:return d=this._getStage(),console.assert(2>d),this._viewer.trigger("measurementBegin"),[4,this._getSelectionCursorPoints(b,c)];case 1:e=f.sent();if(null===e||null===e.worldPosition)return[2];null===this._measureMarkup&&(this._measureMarkup=new a.Markup.Measure.MeasurePointPointDistanceMarkup(this._viewer),
this._measureManager.addMeasurement(this._measureMarkup));0===d?(this._measureMarkup.setFirstPointPosition(e.worldPosition),this._measureMarkup.setUnitMultiplier(e.selectionItem.isNodeSelection()?this._viewer.model.getNodeUnitMultiplier(e.selectionItem.getNodeId()):1)):1!==d||e.worldPosition.equals(this._measureMarkup.getFirstPointPosition())||(this._measureMarkup.setSecondPointPosition(e.worldPosition),this._measureMarkup.adjust(e.screenPosition));return[2]}})})};c.prototype._updateCursorSpriteImpl=
function(a,b){return __awaiter(this,void 0,void 0,function(){var c;return __generator(this,function(d){switch(d.label){case 0:return null===this._cursorMarkup?[3,3]:b?[4,this._getSelectionCursorPoints(a,b)]:[3,2];case 1:return c=d.sent(),null!==c&&this._cursorMarkup.setPosition(c.screenPosition),[3,3];case 2:this._cursorMarkup.setPosition(a),d.label=3;case 3:return this._draw(),[2]}})})};c.prototype._updateCursorSprite=function(a,b){var c=this;this._updateCursorSpriteAction.set(function(){return c._updateCursorSpriteImpl(a,
b)})};c.prototype._useSnapping=function(a){return this._snappingConfig.enabled&&!a.altDown()};c.prototype.onMouseMove=function(a){b.prototype.onMouseMove.call(this,a);this._activateCursorSprite();var c=this._getStage();2>c?(c=a.getPosition(),this._updateCursorSprite(c,this._useSnapping(a))):2===c&&(this._measureMarkup.adjust(a.getPosition()),a.setHandled(!0));this._draw()};c.prototype.onMouseUp=function(a){if(this.isActive()){this._activateCursorSprite();var c=this._getStage(),d=null!==this._primaryTouchId&&
null!==this._measureMarkup&&1<c;if(3>this._dragCount||d){var d=this._useSnapping(a),e=a.getPosition();1>=c?this._updateMeasurementPoints(e,d):this._finalizeMeasurement(e,d)}}b.prototype.onMouseUp.call(this,a)};c.prototype.setDraggingEnabled=function(a){this._draggingEnabled=a};c.prototype.onKeyUp=function(a){a};c.prototype._clearMeasurement=function(){null!==this._measureMarkup?(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null):this._measureManager.removeLastMeasurement()};
c.prototype.onKeyDown=function(b){b.getKeyCode()===a.KeyCode.Escape&&this._clearMeasurement()};c.prototype.setHandled=function(){return 1<this._getStage()};c.prototype.onActivate=function(){var a=this;this._cursorMarkup=new d(this._viewer);this._viewer.isDrawingSheetActive()&&function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._viewer.setBackgroundSelectionEnabled(!0)];case 1:return a.sent(),[2]}})})}()};c.prototype.onDeactivate=
function(){var a=this;null!==this._cursorMarkup&&(this._cursorMarkup.destroy(),this._cursorMarkup=null);null!==this._measureMarkup&&(this._measureManager.removeMeasurement(this._measureMarkup),this._measureMarkup=null);this._viewer.isDrawingSheetActive()&&function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,this._viewer.setBackgroundSelectionEnabled(!1)];case 1:return a.sent(),[2]}})})}()};return c}(h.OperatorBase);h.MeasurePointPointDistanceOperator=
c})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){var h=function(e){function f(a){var c=e.call(this,a)||this;c._activeRedlineItem=null;c._newRedlineItem=null;c._viewer=a;return c}__extends(f,e);f.prototype.createRedlineItem=function(a){a;return null};f.prototype.updateRedlineItem=function(a){a};f.prototype.finalizeRedlineItem=function(a){a;return null};f.prototype.onMouseDown=function(d){e.prototype.onMouseDown.call(this,d);this.isActive()&&(d.getButton()!==a.Button.Left&&null===this._primaryTouchId||this._redlineOperatorStart(),d.setHandled(!0))};
f.prototype.onMouseMove=function(a){e.prototype.onMouseMove.call(this,a);this.isActive()&&(this._redlineOperatorMove(),a.setHandled(!0))};f.prototype.onMouseUp=function(d){this.isActive()&&(d.getButton()!==a.Button.Left&&null===this._primaryTouchId||this._redlineOperatorEnd(),d.setHandled(!0));e.prototype.onMouseUp.call(this,d)};f.prototype.onMousewheel=function(a){a.setHandled(!0)};f.prototype.setDraggingEnabled=function(a){this._dragging=a};f.prototype.setHandled=function(){return!0};f.prototype._isRedlineItem=
function(d){return Object.getPrototypeOf(d)instanceof a.Markup.Redline.RedlineItem};f.prototype.onKeyUp=function(d){d=d.getKeyCode();if(d===a.KeyCode.Backspace||d===a.KeyCode.Delete){d=this._viewer.markupManager;var c=d.getSelectedMarkup(),b=d.getActiveMarkupView();null!==c&&this._isRedlineItem(c)&&null!==b&&(b.removeMarkup(c),d.selectMarkup(null))}};f.prototype._removeRedlineTextIfInvalid=function(a){if(!a.isValid()){var c=this._viewer.markupManager.getActiveMarkupView();null!==c&&(c.removeMarkup(a),
this._viewer.trigger("redlineDeleted",a));a.remove()}};f.prototype._redlineOperatorStart=function(){var a=this._viewer.markupManager,c=a.pickMarkupItem(this._ptFirst),b=a.getSelectedMarkup();c?(this._activeRedlineItem=c,this._dragging&&this._activeRedlineItem.onDragStart(this._ptFirst)&&a.refreshMarkup()):(a.selectMarkup(null),this._markupIsTextArea(b)?this._removeRedlineTextIfInvalid(b):this._newRedlineItem=this.createRedlineItem(this._ptFirst))};f.prototype._redlineOperatorMove=function(){this._activeRedlineItem?
this._dragging&&this._activeRedlineItem.onDragMove(this._ptCurrent)&&this._viewer.markupManager.refreshMarkup():this.updateRedlineItem(this._ptCurrent)};f.prototype._redlineOperatorEnd=function(){var a=this._viewer.markupManager;this._activeRedlineItem?this._ptFirst.equals(this._ptCurrent)?a.selectMarkup(this._activeRedlineItem):(this._viewer.trigger("redlineUpdated",this._activeRedlineItem),this._dragging&&this._activeRedlineItem.onDragEnd(this._ptCurrent)&&a.refreshMarkup()):this._newRedlineItem&&
(a=this.finalizeRedlineItem(this._ptCurrent))&&this._attachNewMarkupToView(a);this._newRedlineItem=this._activeRedlineItem=null};f.prototype._attachNewMarkupToView=function(d){return __awaiter(this,void 0,void 0,function(){var c,b,e,f,h,p,k,r,m,n;return __generator(this,function(q){switch(q.label){case 0:c=this._viewer;b=c.model;e=c.markupManager;f=e.getActiveMarkupView();h=!1;if(null!==f)return[3,3];p=b.getAbsoluteRootNode();return[4,b.getVisibilityState(p)];case 1:return k=q.sent(),[4,b.getNodeColorMap(b.getAbsoluteRootNode(),
a.ElementType.Faces)];case 2:r=q.sent(),m=e.createMarkupView(void 0,!1,k,r,null),f=e.getMarkupView(m),h=!0,q.label=3;case 3:return null!==f&&(f.addMarkupItem(d),e.selectMarkup(d)),n=this._viewer._getCallbackManager(),h&&null!==f&&n.trigger("viewCreated",f),n.trigger("redlineCreated",d),[2]}})})};f.prototype._markupIsTextArea=function(d){return d?d.getClassName()===a.Markup.Redline.RedlineText.className:!1};return f}(a.Operator.OperatorBase);a.RedlineOperator=h})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a){a=e.call(this,a)||this;a._redlineCircle=null;a._previewHandle=null;a._centerSet=!1;return a}__extends(d,e);d.prototype.createRedlineItem=function(c){var b=this._viewer.view;this._redlineCircle=new a.Markup.Redline.RedlineCircle(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineCircle);c=b.getCamera().getCameraPlaneIntersectionPoint(c,b);null!==c&&(this._centerSet=!0,this._redlineCircle.setCenter(c),this._redlineCircle.setRadiusPoint(c));
return this._redlineCircle};d.prototype.updateRedlineItem=function(a){var b=this._viewer.view;this._redlineCircle&&(a=b.getCamera().getCameraPlaneIntersectionPoint(a,b),null!==a&&(this._centerSet||(this._centerSet=!0,this._redlineCircle.setCenter(a)),this._redlineCircle.setRadiusPoint(a),this._viewer.markupManager.refreshMarkup()))};d.prototype.finalizeRedlineItem=function(a){a;a=this._viewer.markupManager;var b=null;this._redlineCircle&&(this._redlineCircle.isValid()&&(b=this._redlineCircle),this._redlineCircle=
null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),this._previewHandle=null),a.refreshMarkup());return b};return d}(a.RedlineOperator);h.RedlineCircleOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a){a=e.call(this,a)||this;a._redlinePolyline=null;a._previewHandle=null;return a}__extends(d,e);d.prototype.createRedlineItem=function(c){var b=this._viewer.view;this._redlinePolyline=new a.Markup.Redline.RedlinePolyline(this._viewer);this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlinePolyline);c=b.getCamera().getCameraPlaneIntersectionPoint(c,b);null!==c&&this._redlinePolyline.addPoint(c);return this._redlinePolyline};
d.prototype.updateRedlineItem=function(a){if(this._redlinePolyline){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&(this._redlinePolyline.addPoint(a),this._viewer.markupManager.refreshMarkup())}};d.prototype.finalizeRedlineItem=function(a){a;a=this._viewer.markupManager;var b=null;this._redlinePolyline&&(this._redlinePolyline.isValid()&&(b=this._redlinePolyline),this._redlinePolyline=null,null!==this._previewHandle&&(a.unregisterMarkup(this._previewHandle),
this._previewHandle=null),a.refreshMarkup());return b};return d}(a.RedlineOperator);h.RedlinePolylineOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a){a=e.call(this,a)||this;a._redlineRectangle=null;a._previewHandle=null;return a}__extends(d,e);d.prototype.createRedlineItem=function(c){var b=this._viewer.view;c=b.getCamera().getCameraPlaneIntersectionPoint(c,b);this._redlineRectangle=new a.Markup.Redline.RedlineRectangle(this._viewer);null!==c&&(this._redlineRectangle.setPoint1(c),this._redlineRectangle.setPoint2(c));this._previewHandle=this._viewer.markupManager.registerMarkup(this._redlineRectangle);
return this._redlineRectangle};d.prototype.updateRedlineItem=function(a){if(this._redlineRectangle){var b=this._viewer.view;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&this._redlineRectangle.setPoint2(a);this._viewer.markupManager.refreshMarkup()}};d.prototype.finalizeRedlineItem=function(a){a;a=null;if(this._redlineRectangle&&this._previewHandle){var b=this._viewer.markupManager;this._redlineRectangle.isValid()&&(a=this._redlineRectangle);b.unregisterMarkup(this._previewHandle);
this._redlineRectangle=this._previewHandle=null;b.refreshMarkup()}return a};return d}(a.RedlineOperator);h.RedlineRectangleOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));
(function(a){(function(h){var e=function(e){function d(a){a=e.call(this,a)||this;a._redlineText=null;return a}__extends(d,e);d.prototype.createRedlineItem=function(c){c;return this._redlineText=new a.Markup.Redline.RedlineText(this._viewer)};d.prototype.finalizeRedlineItem=function(a){a;if(null===this._redlineText)return null;var b=this._viewer.view,d=this._redlineText;a=b.getCamera().getCameraPlaneIntersectionPoint(a,b);null!==a&&d.setPosition(a);this._redlineText=null;return d};return d}(a.RedlineOperator);
h.RedlineTextOperator=e})(a.Operator||(a.Operator={}))})(Communicator||(Communicator={}));

var _SC = {
	_deferredInstances: [],

	_loadEngine: function (enginePath, onError) {
		if (this._engineLoaded) {
			return;
		}
		this._engineLoaded = true;
		this._enginePath = enginePath;

		var hasWebAssembly = (function () {
			try {
				if (typeof WebAssembly === "object" && typeof WebAssembly.instantiate === "function") {
					var module = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));
					if (module instanceof WebAssembly.Module) {
						return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;
					}
				}
			} catch (e) {
				//
			}
			return false;
		})();

		var engineJs = hasWebAssembly ? "engine-wasm.js" : "engine-asmjs.js";
		if (enginePath) {
			engineJs = enginePath + "/" + engineJs;
		}

		var engineScript = document.createElement("script");
		engineScript.type = "text/javascript";

		if (typeof onError === "function") {
			engineScript.onerror = function (e) {
				onError("failed to load " + e.target.src);
			};
		}

		document.head.appendChild(engineScript);
		engineScript.src = engineJs;
	},

	_defaultEnginePath: (function () {
		// paths are normally relative to HTML, but we want a path relative to current JS file
		var scriptElements = document.getElementsByTagName("script");
		var path = scriptElements[scriptElements.length - 1].src; // URL of current script
		path = path.split("?")[0]; // remove query string
		path = path.split("/").slice(0, -1).join("/"); // remove filename
		return path;
	})(),

	// store instance arguments and return empty base object that will
	// be populated asynchronously
	createInstance: function (instanceArgs) {
		var enginePath = instanceArgs.enginePath;
		if (typeof enginePath !== "string") { // allow empty string, which means relative to HTML
			enginePath = this._defaultEnginePath;
		}

		this._loadEngine(enginePath, instanceArgs.onError);

		var argWrapper = {
			isWrapper: true,
			base: {},
			args: instanceArgs,
			enginePath: enginePath
		};

		this._deferredInstances.push (argWrapper);
		return argWrapper.base;
	}
};
(function(m,r,R,S,E,L){function Ka(a,b,c,d,e){return ha(a,a,c,d,b,a.defaultView.pageXOffset,a.defaultView.pageYOffset).then(function(f){q("Document cloned");var g="data-html2canvas-node"+e,h="["+g+"='"+e+"']";a.querySelector(h).removeAttribute(g);var g=f.contentWindow,k=g.document.querySelector(h);return("function"===typeof b.onclone?Promise.resolve(b.onclone(g.document)):Promise.resolve(!0)).then(function(){return ia(k,f,b,c,d)})})}function ia(a,b,c,d,e){var f=b.contentWindow,g=new T(f.document),
h=new u(c,g),k=U(a);d="view"===c.type?d:La(f.document);e="view"===c.type?e:Ma(f.document);var F=new c.renderer(d,e,h,c,r);return(new n(a,F,g,h,c)).ready.then(function(){q("Finished rendering");var d;d="view"===c.type?ja(F.canvas,{width:F.canvas.width,height:F.canvas.height,top:0,left:0,x:0,y:0}):a===f.document.body||a===f.document.documentElement||null!=c.canvas?F.canvas:ja(F.canvas,{width:null!=c.width?c.width:k.width,height:null!=c.height?c.height:k.height,top:k.top,left:k.left,x:f.pageXOffset,
y:f.pageYOffset});c.removeContainer&&(b.parentNode.removeChild(b),q("Cleaned up container"));return d})}function ja(a,b){var c=r.createElement("canvas"),d=Math.min(a.width-1,Math.max(0,b.left)),e=Math.min(a.width,Math.max(1,b.left+b.width)),f=Math.min(a.height-1,Math.max(0,b.top)),g=Math.min(a.height,Math.max(1,b.top+b.height));c.width=b.width;c.height=b.height;q("Cropping canvas at:","left:",b.left,"top:",b.top,"width:",e-d,"height:",g-f);q("Resulting crop with width",b.width,"and height",b.height,
" with x",d,"and y",f);c.getContext("2d").drawImage(a,d,f,e-d,g-f,b.x,b.y,e-d,g-f);return c}function La(a){return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function Ma(a){return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}
function ka(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}function la(a,b){for(var c=3===a.nodeType?r.createTextNode(a.nodeValue):a.cloneNode(!1),d=a.firstChild;d;)!0!==b&&1===d.nodeType&&"SCRIPT"===d.nodeName||c.appendChild(la(d,b)),d=d.nextSibling;return c}function ha(a,b,c,d,e,f,g){Na(a);var h=r.documentMode&&9>=r.documentMode?la(a.documentElement,e.javascriptEnabled):a.documentElement.cloneNode(!0),k=b.createElement("iframe");k.className="html2canvas-container";
k.style.visibility="hidden";k.style.position="fixed";k.style.left="-10000px";k.style.top="0px";k.style.border="0";k.width=c;k.height=d;k.scrolling="no";b.body.appendChild(k);return new Promise(function(b){var c=k.contentWindow.document;ma(a.documentElement,h,"textarea");ma(a.documentElement,h,"select");k.contentWindow.onload=k.onload=function(){var d=setInterval(function(){0<c.body.childNodes.length&&(Oa(a,c),clearInterval(d),"view"===e.type&&k.contentWindow.scrollTo(f,g),b(k))},50)};c.open();c.write("<!DOCTYPE html><html></html>");
!a.defaultView||f===a.defaultView.pageXOffset&&g===a.defaultView.pageYOffset||a.defaultView.scrollTo(f,g);c.replaceChild(!0===e.javascriptEnabled?c.adoptNode(h):na(c.adoptNode(h)),c.documentElement);c.close()})}function ma(a,b,c){a=a.getElementsByTagName(c);b=b.getElementsByTagName(c);c=a.length;for(var d=0;d<c;d++)b[d].value=a[d].value}function oa(a,b,c,d,e,f){return(new Pa(a,b,m.document)).then(Qa(a)).then(function(a){return ha(a,c,d,e,f,0,0)})}function Qa(a){return function(b){var c=new DOMParser,
d;try{d=c.parseFromString(b,"text/html")}catch(e){q("DOMParser not supported, falling back to createHTMLDocument");d=r.implementation.createHTMLDocument("");try{d.open(),d.write(b),d.close()}catch(f){q("createHTMLDocument write not supported, falling back to document.body.innerHTML"),d.body.innerHTML=b}}b=d.querySelector("base");b&&b.href.host||(b=d.createElement("base"),b.href=a,d.head.insertBefore(b,d.head.firstChild));return d}}function Na(a){[].slice.call(a.querySelectorAll("canvas"),0).forEach(function(a){a.setAttribute("data-html2canvas-canvas-clone",
"canvas-"+Ra++)})}function Oa(a,b){[].slice.call(a.querySelectorAll("[data-html2canvas-canvas-clone]"),0).forEach(function(a){try{var d=b.querySelector('[data-html2canvas-canvas-clone="'+a.getAttribute("data-html2canvas-canvas-clone")+'"]');d&&(d.width=a.width,d.height=a.height,d.getContext("2d").putImageData(a.getContext("2d").getImageData(0,0,a.width,a.height),0,0))}catch(e){q("Unable to copy canvas content from",a,e)}a.removeAttribute("data-html2canvas-canvas-clone")})}function na(a){[].slice.call(a.childNodes,
0).filter(Sa).forEach(function(b){"SCRIPT"===b.tagName?a.removeChild(b):na(b)});return a}function Sa(a){return a.nodeType===Node.ELEMENT_NODE}function Ta(a){var b=r.createElement("a");b.href=a;b.href=b.href;return b}function t(a){this.b=this.g=this.r=0;this.a=null;this.fromArray(a)||this.namedColor(a)||this.rgb(a)||this.rgba(a)||this.hex6(a)||this.hex3(a)}function M(a){this.src=a;q("DummyImageContainer for",a);if(!this.promise||!this.image){q("Initiating DummyImageContainer");M.prototype.image=new Image;
var b=this.image;M.prototype.promise=new Promise(function(a,d){b.onload=a;b.onerror=d;b.src=ka();!0===b.complete&&a(b)})}}function Ua(a,b){var c=r.createElement("div"),d=r.createElement("img"),e=r.createElement("span"),f;c.style.visibility="hidden";c.style.fontFamily=a;c.style.fontSize=b;c.style.margin=0;c.style.padding=0;r.body.appendChild(c);d.src=ka();d.width=1;d.height=1;d.style.margin=0;d.style.padding=0;d.style.verticalAlign="baseline";e.style.fontFamily=a;e.style.fontSize=b;e.style.margin=
0;e.style.padding=0;e.appendChild(r.createTextNode("Hidden Text"));c.appendChild(e);c.appendChild(d);f=d.offsetTop-e.offsetTop+1;c.removeChild(e);c.appendChild(r.createTextNode("Hidden Text"));c.style.lineHeight="normal";d.style.verticalAlign="super";d=d.offsetTop-c.offsetTop+1;r.body.removeChild(c);this.baseline=f;this.lineWidth=1;this.middle=d}function pa(){this.data={}}function qa(a,b,c){this.image=null;this.src=a;var d=this,e=U(a);this.promise=(b?new Promise(function(b){"about:blank"===a.contentWindow.document.URL||
null==a.contentWindow.document.documentElement?a.contentWindow.onload=a.onload=function(){b(a)}:b(a)}):this.proxyLoad(c.proxy,e,c)).then(function(a){return html2canvas(a.contentWindow.document.documentElement,{type:"view",width:a.width,height:a.height,proxy:c.proxy,javascriptEnabled:c.javascriptEnabled,removeContainer:c.removeContainer,allowTaint:c.allowTaint,imageTimeout:c.imageTimeout/2})}).then(function(a){return d.image=a})}function N(a){this.src=a.value;this.colorStops=[];this.type=null;this.y1=
this.x1=this.y0=this.x0=.5;this.promise=Promise.resolve(!0)}function ba(a,b){this.src=a;this.image=new Image;var c=this;this.tainted=null;this.promise=new Promise(function(d,e){c.image.onload=d;c.image.onerror=e;b&&(c.image.crossOrigin="anonymous");c.image.src=a;!0===c.image.complete&&d(c.image)})}function u(a,b){this.link=null;this.options=a;this.support=b;this.origin=this.getOrigin(m.location.href)}function V(a){N.apply(this,arguments);this.type=this.TYPES.LINEAR;var b=null===a.args[0].match(this.stepRegExp);
b?a.args[0].split(" ").reverse().forEach(function(a){switch(a){case "left":this.x0=0;this.x1=1;break;case "top":this.y0=0;this.y1=1;break;case "right":this.x0=1;this.x1=0;break;case "bottom":this.y0=1;this.y1=0;break;case "to":a=this.y0;var b=this.x0;this.y0=this.y1;this.x0=this.x1;this.x1=b;this.y1=a}},this):(this.y0=0,this.y1=1);this.colorStops=a.args.slice(b?1:0).map(function(a){a=a.match(this.stepRegExp);return{color:new t(a[1]),stop:"%"===a[3]?a[2]/100:null}},this);null===this.colorStops[0].stop&&
(this.colorStops[0].stop=0);null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1);this.colorStops.forEach(function(a,b){null===a.stop&&this.colorStops.slice(b).some(function(e,f){return null!==e.stop?(a.stop=(e.stop-this.colorStops[b-1].stop)/(f+1)+this.colorStops[b-1].stop,!0):!1},this)},this)}function q(){m.html2canvas.logging&&m.console&&m.console.log&&Function.prototype.bind.call(m.console.log,m.console).apply(m.console,[Date.now()-m.html2canvas.start+
"ms","html2canvas:"].concat([].slice.call(arguments,0)))}function l(a,b){this.node=a;this.parent=b;this.borders=this.bounds=this.stack=null;this.clip=[];this.backgroundClip=[];this.computedStyles=this.visible=this.offsetBounds=null;this.colors={};this.styles={};this.transformMatrix=this.transformData=this.backgroundImages=null;this.isPseudoElement=!1;this.opacity=null}function Va(a){if(a&&"matrix"===a[1])return a[2].split(",").map(function(a){return parseFloat(a.trim())})}function W(a){return-1!==
a.toString().indexOf("%")}function ra(a){var b,c,d,e,f,g=[],h=0,k=0,l,m,q=function(){b&&('"'===c.substr(0,1)&&(c=c.substr(1,c.length-2)),c&&m.push(c),"-"===b.substr(0,1)&&0<(e=b.indexOf("-",1)+1)&&(d=b.substr(0,e),b=b.substr(e)),g.push({prefix:d,method:b.toLowerCase(),value:f,args:m,image:null}));m=[];b=d=c=f=""};m=[];b=d=c=f="";a.split("").forEach(function(a){if(!(0===h&&-1<" \r\n\t".indexOf(a))){switch(a){case '"':l?l===a&&(l=null):l=a;break;case "(":if(!l){if(0===h){h=1;f+=a;return}k++}break;case ")":if(!l&&
1===h){if(0===k){h=0;f+=a;q();return}k--}break;case ",":if(!l){if(0===h){q();return}if(1===h&&0===k&&!b.match(/^url$/i)){m.push(c);c="";f+=a;return}}}f+=a;0===h?b+=a:c+=a}});q();return g}function Wa(a){return a.replace("px","")}function Xa(a){return parseFloat(a)}function U(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect(),c=null==a.offsetWidth?b.width:a.offsetWidth;return{top:b.top,bottom:b.bottom||b.top+b.height,right:b.left+c,left:b.left,width:c,height:null==a.offsetHeight?b.height:
a.offsetHeight}}return{}}function ca(a){var b=a.offsetParent?ca(a.offsetParent):{top:0,left:0};return{top:a.offsetTop+b.top,bottom:a.offsetTop+a.offsetHeight+b.top,right:a.offsetLeft+b.left+a.offsetWidth,left:a.offsetLeft+b.left,width:a.offsetWidth,height:a.offsetHeight}}function n(a,b,c,d,e){q("Starting NodeParser");this.renderer=b;this.options=e;this.range=null;this.support=c;this.renderQueue=[];this.stack=new G(!0,1,a.ownerDocument,null);c=new l(a,null);e.background&&b.rectangle(0,0,b.width,b.height,
new t(e.background));if(a===a.ownerDocument.documentElement){var f=new l(c.color("backgroundColor").isTransparent()?a.ownerDocument.body:a.ownerDocument.documentElement,null);b.rectangle(0,0,b.width,b.height,f.color("backgroundColor"))}c.visibile=c.isElementVisible();this.createPseudoHideStyles(a.ownerDocument);this.disableAnimations(a.ownerDocument);this.nodes=[].concat.apply([],[c].concat(this.getChildren(c)).filter(function(a){return a.visible=a.isElementVisible()}).map(this.getPseudoElements,
this));this.fontMetrics=new pa;q("Fetched nodes, total:",this.nodes.length);q("Calculate overflow clips");this.calculateOverflowClips();q("Start fetching images");this.images=d.fetch(this.nodes.filter(O));this.ready=this.images.ready.then(X(function(){q("Images loaded, starting parsing");q("Creating stacking contexts");this.createStackingContexts();q("Sorting stacking contexts");this.sortStackingContexts(this.stack);this.parse(this.stack);q("Render queue created with "+this.renderQueue.length+" items");
return new Promise(X(function(a){e.async?"function"===typeof e.async?e.async.call(this,this.renderQueue,a):0<this.renderQueue.length?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,a)):a():(this.renderQueue.forEach(this.paint,this),a())},this))},this))}function Ya(a){return a.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})}function sa(){}function ta(a,b,c,d){return a.map(function(e,f){if(0<e.width){var g=b.left,h=b.top,k=b.width,l=b.height-a[2].width;switch(f){case 0:l=
a[0].width;e.args=Y({c1:[g,h],c2:[g+k,h],c3:[g+k-a[1].width,h+l],c4:[g+a[3].width,h+l]},d[0],d[1],c.topLeftOuter,c.topLeftInner,c.topRightOuter,c.topRightInner);break;case 1:g=b.left+b.width-a[1].width;k=a[1].width;e.args=Y({c1:[g+k,h],c2:[g+k,h+l+a[2].width],c3:[g,h+l],c4:[g,h+a[0].width]},d[1],d[2],c.topRightOuter,c.topRightInner,c.bottomRightOuter,c.bottomRightInner);break;case 2:h=h+b.height-a[2].width;l=a[2].width;e.args=Y({c1:[g+k,h+l],c2:[g,h+l],c3:[g+a[3].width,h],c4:[g+k-a[3].width,h]},d[2],
d[3],c.bottomRightOuter,c.bottomRightInner,c.bottomLeftOuter,c.bottomLeftInner);break;case 3:k=a[3].width,e.args=Y({c1:[g,h+l+a[2].width],c2:[g,h],c3:[g+k,h+a[0].width],c4:[g+k,h+l]},d[3],d[0],c.bottomLeftOuter,c.bottomLeftInner,c.topLeftOuter,c.topLeftInner)}}return e})}function C(a,b,c,d){var e=(Math.sqrt(2)-1)/3*4,f=c*e,e=d*e;c=a+c;d=b+d;return{topLeft:H({x:a,y:d},{x:a,y:d-e},{x:c-f,y:b},{x:c,y:b}),topRight:H({x:a,y:b},{x:a+f,y:b},{x:c,y:d-e},{x:c,y:d}),bottomRight:H({x:c,y:b},{x:c,y:b+e},{x:a+
f,y:d},{x:a,y:d}),bottomLeft:H({x:c,y:d},{x:c-f,y:d},{x:a,y:b+e},{x:a,y:b})}}function ua(a,b,c){var d=a.left,e=a.top,f=a.width;a=a.height;var g=b[0][0],h=b[0][1],k=b[1][0],l=b[1][1],m=b[2][0],q=b[2][1],r=b[3][0];b=b[3][1];var n=f-k,t=a-q,p=f-m,u=a-b;return{topLeftOuter:C(d,e,g,h).topLeft.subdivide(.5),topLeftInner:C(d+c[3].width,e+c[0].width,Math.max(0,g-c[3].width),Math.max(0,h-c[0].width)).topLeft.subdivide(.5),topRightOuter:C(d+n,e,k,l).topRight.subdivide(.5),topRightInner:C(d+Math.min(n,f+c[3].width),
e+c[0].width,n>f+c[3].width?0:k-c[3].width,l-c[0].width).topRight.subdivide(.5),bottomRightOuter:C(d+p,e+t,m,q).bottomRight.subdivide(.5),bottomRightInner:C(d+Math.min(p,f-c[3].width),e+Math.min(t,a+c[0].width),Math.max(0,m-c[1].width),q-c[2].width).bottomRight.subdivide(.5),bottomLeftOuter:C(d,e+u,r,b).bottomLeft.subdivide(.5),bottomLeftInner:C(d+c[3].width,e+u,Math.max(0,r-c[3].width),b-c[2].width).bottomLeft.subdivide(.5)}}function H(a,b,c,d){var e=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+
(b.y-a.y)*c}};return{start:a,startControl:b,endControl:c,end:d,subdivide:function(f){var g=e(a,b,f),h=e(b,c,f),k=e(c,d,f),l=e(g,h,f),h=e(h,k,f);f=e(l,h,f);return[H(a,g,l,f),H(f,h,k,d)]},curveTo:function(a){a.push(["bezierCurve",b.x,b.y,c.x,c.y,d.x,d.y])},curveToReversed:function(d){d.push(["bezierCurve",c.x,c.y,b.x,b.y,a.x,a.y])}}}function Y(a,b,c,d,e,f,g){var h=[];0<b[0]||0<b[1]?(h.push(["line",d[1].start.x,d[1].start.y]),d[1].curveTo(h)):h.push(["line",a.c1[0],a.c1[1]]);0<c[0]||0<c[1]?(h.push(["line",
f[0].start.x,f[0].start.y]),f[0].curveTo(h),h.push(["line",g[0].end.x,g[0].end.y]),g[0].curveToReversed(h)):(h.push(["line",a.c2[0],a.c2[1]]),h.push(["line",a.c3[0],a.c3[1]]));0<b[0]||0<b[1]?(h.push(["line",e[1].end.x,e[1].end.y]),e[1].curveToReversed(h)):h.push(["line",a.c4[0],a.c4[1]]);return h}function D(a,b,c,d,e,f,g){0<b[0]||0<b[1]?(a.push(["line",d[0].start.x,d[0].start.y]),d[0].curveTo(a),d[1].curveTo(a)):a.push(["line",f,g]);(0<c[0]||0<c[1])&&a.push(["line",e[0].start.x,e[0].start.y])}function Za(a){return 0>
a.cssInt("zIndex")}function $a(a){return 0<a.cssInt("zIndex")}function va(a){return 0===a.cssInt("zIndex")}function wa(a){return-1!==["inline","inline-block","inline-table"].indexOf(a.css("display"))}function ab(a){return 0<a.node.data.trim().length}function bb(a){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(b){b=a.css("border"+b+"Radius").split(" ");1>=b.length&&(b[1]=b[0]);return b.map(cb)})}function db(a){return a.nodeType===Node.TEXT_NODE||a.nodeType===Node.ELEMENT_NODE}
function P(a){return"static"!==a.css("position")}function da(a){return"none"!==a.css("float")}function Q(a){var b=this;return function(){return!a.apply(b,arguments)}}function O(a){return a.node.nodeType===Node.ELEMENT_NODE}function ea(a){return a.node.nodeType===Node.TEXT_NODE}function eb(a){return function(b,c){return b.cssInt("zIndex")+a.indexOf(b)/a.length-(c.cssInt("zIndex")+a.indexOf(c)/a.length)}}function X(a,b){return function(){return a.apply(b,arguments)}}function cb(a){return parseInt(a,
10)}function fb(a){return a.width}function gb(a){return a.node.nodeType!==Node.ELEMENT_NODE||-1==="SCRIPT HEAD TITLE OBJECT BR OPTION".split(" ").indexOf(a.node.nodeName)}function hb(a){for(var b=[],c=0,d=!1,e;a.length;)-1!==[32,13,10,9,45].indexOf(a[c])===d?(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)),d=!d,c=0):c++,c>=a.length&&(e=a.splice(0,c),e.length&&b.push(m.html2canvas.punycode.ucs2.encode(e)));return b}function Pa(a,b,c){if(!b)return Promise.reject("No proxy configured");
var d=xa(ya);a=za(b,a,d);return ya?Aa(a):Ba(c,a,d).then(function(a){return Ca(a.content)})}function ib(a,b,c){var d=xa(Da);a=za(b,a,d);return Da?Promise.resolve(a):Ba(c,a,d).then(function(a){return"data:"+a.type+";base64,"+a.content})}function Ba(a,b,c){return new Promise(function(d,e){var f=a.createElement("script"),g=function(){delete m.html2canvas.proxy[c];a.body.removeChild(f)};m.html2canvas.proxy[c]=function(a){g();d(a)};f.src=b;f.onerror=function(a){g();e(a)};a.body.appendChild(f)})}function xa(a){return a?
"":"html2canvas_"+Date.now()+"_"+ ++jb+"_"+Math.round(1E5*Math.random())}function za(a,b,c){return a+"?url="+encodeURIComponent(b)+(c.length?"&callback=html2canvas.proxy."+c:"")}function kb(a,b){r.createElement("script");var c=r.createElement("a");c.href=a;this.src=a=c.href;this.image=new Image;var d=this;this.promise=new Promise(function(c,f){d.image.crossOrigin="Anonymous";d.image.onload=c;d.image.onerror=f;(new ib(a,b,r)).then(function(a){d.image.src=a})["catch"](f)})}function v(a,b,c){l.call(this,
a,b);this.isPseudoElement=!0;this.before=":before"===c}function x(a,b,c,d,e){this.width=a;this.height=b;this.images=c;this.options=d;this.document=e}function G(a,b,c,d){l.call(this,c,d);this.ownStacking=a;this.contexts=[];this.children=[];this.opacity=(this.parent?this.parent.stack.opacity:1)*b}function T(a){this.rangeBounds=this.testRangeBounds(a);this.cors=this.testCORS();this.svg=this.testSVG()}function A(a){this.src=a;this.image=null;var b=this;this.promise=this.hasFabric().then(function(){return b.isInline(a)?
Promise.resolve(b.inlineFormatting(a)):Aa(a)}).then(function(a){return new Promise(function(d){html2canvas.fabric.loadSVGFromString(a,b.createCanvas.call(b,d))})})}function Ca(a){var b=a.length,c,d,e,f,g,h,k="";for(c=0;c<b;c+=4)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c]),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+1]),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+2]),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[c+
3]),d=d<<2|e>>4,e=(e&15)<<4|f>>2,h=(f&3)<<6|g,k=64===f?k+String.fromCharCode(d):64===g||-1===g?k+String.fromCharCode(d,e):k+String.fromCharCode(d,e,h);return k}function Ea(a,b){this.src=a;this.image=null;var c=this;this.promise=b?new Promise(function(b,e){c.image=new Image;c.image.onload=b;c.image.onerror=e;c.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(a);!0===c.image.complete&&b(c.image)}):this.hasFabric().then(function(){return new Promise(function(b){html2canvas.fabric.parseSVGDocument(a,
c.createCanvas.call(c,b))})})}function I(a,b){l.call(this,a,b)}function lb(a,b,c){if(0<a.length)return b+c.toUpperCase()}function Fa(a){N.apply(this,arguments);this.type="linear"===a.args[0]?this.TYPES.LINEAR:this.TYPES.RADIAL}function Aa(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("GET",a);d.onload=function(){200===d.status?b(d.responseText):c(Error(d.statusText))};d.onerror=function(){c(Error("Network Error"))};d.send()})}function p(a,b){x.apply(this,arguments);this.canvas=
this.options.canvas||this.document.createElement("canvas");this.options.canvas||(this.canvas.width=a,this.canvas.height=b);this.ctx=this.canvas.getContext("2d");this.taintCtx=this.document.createElement("canvas").getContext("2d");this.ctx.textBaseline="bottom";this.variables={};q("Initialized CanvasRenderer with size",a,"x",b)}function mb(a){return 0<a.length}(function(){function a(a,b){J[K]=a;J[K+1]=b;K+=2;2===K&&Ga()}function b(a){return"function"===typeof a}function c(){return function(){process.nextTick(g)}}
function d(){var a=0,b=new Ha(g),c=r.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function e(){var a=new MessageChannel;a.port1.onmessage=g;return function(){a.port2.postMessage(0)}}function f(){return function(){setTimeout(g,1)}}function g(){for(var a=0;a<K;a+=2)(0,J[a])(J[a+1]),J[a]=void 0,J[a+1]=void 0;K=0}function h(){}function k(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function l(b,c,d){a(function(a){var b=!1,e=k(d,c,function(d){b||(b=!0,c!==d?n(a,
d):p(a,d))},function(c){b||(b=!0,w(a,c))});!b&&e&&(b=!0,w(a,e))},b)}function q(a,b){1===b.a?p(a,b.b):2===a.a?w(a,b.b):u(b,void 0,function(b){n(a,b)},function(b){w(a,b)})}function n(a,c){if(a===c)w(a,new TypeError("You cannot resolve a promise with itself"));else if("function"===typeof c||"object"===typeof c&&null!==c)if(c.constructor===a.constructor)q(a,c);else{var d;try{d=c.then}catch(e){Z.error=e,d=Z}d===Z?w(a,Z.error):void 0===d?p(a,c):b(d)?l(a,c,d):p(a,c)}else p(a,c)}function t(a){a.f&&a.f(a.b);
v(a)}function p(b,c){void 0===b.a&&(b.b=c,b.a=1,0!==b.e.length&&a(v,b))}function w(b,c){void 0===b.a&&(b.a=2,b.b=c,a(t,b))}function u(b,c,d,e){var f=b.e,g=f.length;b.f=null;f[g]=c;f[g+1]=d;f[g+2]=e;0===g&&b.a&&a(v,b)}function v(a){var b=a.e,c=a.a;if(0!==b.length){for(var d,e,f=a.b,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?z(c,d,e,f):e(f);a.e.length=0}}function x(){this.error=null}function z(a,c,d,e){var f=b(d),g,h,k,l;if(f){try{g=d(e)}catch(B){fa.error=B,g=fa}g===fa?(l=!0,h=g.error,g=null):k=!0;if(c===
g){w(c,new TypeError("A promises callback cannot return that same promise."));return}}else g=e,k=!0;void 0===c.a&&(f&&k?n(c,g):l?w(c,h):1===a?p(c,g):2===a&&w(c,g))}function A(a,b){try{b(function(b){n(a,b)},function(b){w(a,b)})}catch(c){w(a,c)}}function y(a,b,c,d){this.n=a;this.c=new a(h,d);this.i=c;this.o(b)?(this.m=b,this.d=this.length=b.length,this.l(),0===this.length?p(this.c,this.b):(this.length=this.length||0,this.k(),0===this.d&&p(this.c,this.b))):w(this.c,this.p())}function B(a){nb++;this.b=
this.a=void 0;this.e=[];if(h!==a){if(!b(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof B))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");A(this,a)}}var Ia=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},K=0,aa="undefined"!==typeof m?m:{},Ha=aa.MutationObserver||aa.WebKitMutationObserver,
aa="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,J=Array(1E3),Ga;Ga="undefined"!==typeof process&&"[object process]"==={}.toString.call(process)?c():Ha?d():aa?e():f();var Z=new x,fa=new x;y.prototype.o=function(a){return Ia(a)};y.prototype.p=function(){return Error("Array Methods must be provided an Array")};y.prototype.l=function(){this.b=Array(this.length)};y.prototype.k=function(){for(var a=this.length,b=this.c,c=this.m,d=0;void 0===
b.a&&d<a;d++)this.j(c[d],d)};y.prototype.j=function(a,b){var c=this.n;"object"===typeof a&&null!==a?a.constructor===c&&void 0!==a.a?(a.f=null,this.g(a.a,b,a.b)):this.q(c.resolve(a),b):(this.d--,this.b[b]=this.h(a))};y.prototype.g=function(a,b,c){var d=this.c;void 0===d.a&&(this.d--,this.i&&2===a?w(d,c):this.b[b]=this.h(c));0===this.d&&p(d,this.b)};y.prototype.h=function(a){return a};y.prototype.q=function(a,b){var c=this;u(a,void 0,function(a){c.g(1,b,a)},function(a){c.g(2,b,a)})};var nb=0;B.all=
function(a,b){return(new y(this,a,!0,b)).c};B.race=function(a,b){function c(a){n(e,a)}function d(a){w(e,a)}var e=new this(h,b);if(!Ia(a))return w(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;void 0===e.a&&g<f;g++)u(this.resolve(a[g]),void 0,c,d);return e};B.resolve=function(a,b){if(a&&"object"===typeof a&&a.constructor===this)return a;var c=new this(h,b);n(c,a);return c};B.reject=function(a,b){var c=new this(h,b);w(c,a);return c};B.prototype={constructor:B,then:function(b,
c){var d=this.a;if(1===d&&!b||2===d&&!c)return this;var e=new this.constructor(h),f=this.b;if(d){var g=arguments[d-1];a(function(){z(d,e,g,f)})}else u(this,e,b,c);return e},"catch":function(a){return this.then(null,a)}};var ga={Promise:B,polyfill:function(){var a;a="undefined"!==typeof S?S:"undefined"!==typeof m&&m.document?m:self;"Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var c;new a.Promise(function(a){c=a});return b(c)}()||(a.Promise=
B)}};"function"===typeof E&&E.amd?E(function(){return ga}):"undefined"!==typeof module&&module.exports?module.exports=ga:"undefined"!==typeof this&&(this.ES6Promise=ga)}).call(m);m&&m.ES6Promise.polyfill();if("undefined"===typeof r||"function"!==typeof Object.create||"function"!==typeof r.createElement("canvas").getContext)(m||module.exports).html2canvas=function(){return Promise.reject("No canvas support")};else{(function(a){function b(a){throw RangeError(v[a]);}function c(a,b){for(var c=a.length,
d=[];c--;)d[c]=b(a[c]);return d}function d(a,b){var d=a.split("@"),e="";1<d.length&&(e=d[0]+"@",a=d[1]);d=a.split(u);d=c(d,b).join(".");return e+d}function e(a){for(var b=[],c=0,d=a.length,e,f;c<d;)e=a.charCodeAt(c++),55296<=e&&56319>=e&&c<d?(f=a.charCodeAt(c++),56320==(f&64512)?b.push(((e&1023)<<10)+(f&1023)+65536):(b.push(e),c--)):b.push(e);return b}function f(a){return c(a,function(a){var b="";65535<a&&(a-=65536,b+=x(a>>>10&1023|55296),a=56320|a&1023);return b+=x(a)}).join("")}function g(a,b){return a+
22+75*(26>a)-((0!=b)<<5)}function h(a,b,c){var d=0;a=c?z(a/700):a>>1;for(a+=z(a/b);455<a;d+=36)a=z(a/35);return z(d+36*a/(a+38))}function k(a){var c=[],d=a.length,e,g=0,k=128,l=72,m,n,q,p,r;m=a.lastIndexOf("-");0>m&&(m=0);for(n=0;n<m;++n)128<=a.charCodeAt(n)&&b("not-basic"),c.push(a.charCodeAt(n));for(m=0<m?m+1:0;m<d;){n=g;e=1;for(q=36;;q+=36){m>=d&&b("invalid-input");p=a.charCodeAt(m++);p=10>p-48?p-22:26>p-65?p-65:26>p-97?p-97:36;(36<=p||p>z((2147483647-g)/e))&&b("overflow");g+=p*e;r=q<=l?1:q>=l+
26?26:q-l;if(p<r)break;p=36-r;e>z(2147483647/p)&&b("overflow");e*=p}e=c.length+1;l=h(g-n,e,0==n);z(g/e)>2147483647-k&&b("overflow");k+=z(g/e);g%=e;c.splice(g++,0,k)}return f(c)}function l(a){var c,d,f,k,p,m,n,q,r,t=[],u,v,w;a=e(a);u=a.length;c=128;d=0;p=72;for(m=0;m<u;++m)r=a[m],128>r&&t.push(x(r));for((f=k=t.length)&&t.push("-");f<u;){n=2147483647;for(m=0;m<u;++m)r=a[m],r>=c&&r<n&&(n=r);v=f+1;n-c>z((2147483647-d)/v)&&b("overflow");d+=(n-c)*v;c=n;for(m=0;m<u;++m)if(r=a[m],r<c&&2147483647<++d&&b("overflow"),
r==c){q=d;for(n=36;;n+=36){r=n<=p?1:n>=p+26?26:n-p;if(q<r)break;w=q-r;q=36-r;t.push(x(g(r+w%q,0)));q=z(w/q)}t.push(x(g(q,0)));p=h(d,v,f==k);d=0;++f}++d;++c}return t.join("")}var m="object"==typeof R&&R&&!R.nodeType&&R,q="object"==typeof module&&module&&!module.nodeType&&module,n="object"==typeof S&&S;if(n.global===n||n.window===n||n.self===n)a=n;var p,r=/^xn--/,t=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)",
"invalid-input":"Invalid input"},z=Math.floor,x=String.fromCharCode,y;p={version:"1.3.1",ucs2:{decode:e,encode:f},decode:k,encode:l,toASCII:function(a){return d(a,function(a){return t.test(a)?"xn--"+l(a):a})},toUnicode:function(a){return d(a,function(a){return r.test(a)?k(a.slice(4).toLowerCase()):a})}};if("function"==typeof E&&"object"==typeof E.amd&&E.amd)E("punycode",function(){return p});else if(m&&q)if(module.exports==m)q.exports=p;else for(y in p)p.hasOwnProperty(y)&&(m[y]=p[y]);else a.punycode=
p})(this);var Ra=0,ob=0;m.html2canvas=function(a,b){var c=ob++;b=b||{};b.logging&&(m.html2canvas.logging=!0,m.html2canvas.start=Date.now());b.async="undefined"===typeof b.async?!0:b.async;b.allowTaint="undefined"===typeof b.allowTaint?!1:b.allowTaint;b.removeContainer="undefined"===typeof b.removeContainer?!0:b.removeContainer;b.javascriptEnabled="undefined"===typeof b.javascriptEnabled?!1:b.javascriptEnabled;b.imageTimeout="undefined"===typeof b.imageTimeout?1E4:b.imageTimeout;b.renderer="function"===
typeof b.renderer?b.renderer:p;b.strict=!!b.strict;if("string"===typeof a){if("string"!==typeof b.proxy)return Promise.reject("Proxy must be used when rendering url");var d=null!=b.width?b.width:m.innerWidth,e=null!=b.height?b.height:m.innerHeight;return oa(Ta(a),b.proxy,r,d,e,b).then(function(a){return ia(a.contentWindow.document.documentElement,a,b,d,e)})}var f=(a===L?[r.documentElement]:a.length?a:[a])[0];f.setAttribute("data-html2canvas-node"+c,c);return Ka(f.ownerDocument,b,f.ownerDocument.defaultView.innerWidth,
f.ownerDocument.defaultView.innerHeight,c).then(function(a){"function"===typeof b.onrendered&&(q("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),b.onrendered(a));return a})};m.html2canvas.punycode=this.punycode;m.html2canvas.proxy={};t.prototype.darken=function(a){a=1-a;return new t([Math.round(this.r*a),Math.round(this.g*a),Math.round(this.b*a),this.a])};t.prototype.isTransparent=function(){return 0===this.a};t.prototype.isBlack=function(){return 0===this.r&&
0===this.g&&0===this.b};t.prototype.fromArray=function(a){Array.isArray(a)&&(this.r=Math.min(a[0],255),this.g=Math.min(a[1],255),this.b=Math.min(a[2],255),3<a.length&&(this.a=a[3]));return Array.isArray(a)};var pb=/^#([a-f0-9]{3})$/i;t.prototype.hex3=function(a){null!==(a=a.match(pb))&&(this.r=parseInt(a[1][0]+a[1][0],16),this.g=parseInt(a[1][1]+a[1][1],16),this.b=parseInt(a[1][2]+a[1][2],16));return null!==a};var qb=/^#([a-f0-9]{6})$/i;t.prototype.hex6=function(a){null!==(a=a.match(qb))&&(this.r=
parseInt(a[1].substring(0,2),16),this.g=parseInt(a[1].substring(2,4),16),this.b=parseInt(a[1].substring(4,6),16));return null!==a};var rb=/^rgb\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3})\)$/;t.prototype.rgb=function(a){null!==(a=a.match(rb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]));return null!==a};var sb=/^rgba\((\d{1,3}) *, *(\d{1,3}) *, *(\d{1,3}) *, *(\d+\.?\d*)\)$/;t.prototype.rgba=function(a){null!==(a=a.match(sb))&&(this.r=Number(a[1]),this.g=Number(a[2]),this.b=Number(a[3]),
this.a=Number(a[4]));return null!==a};t.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join()+")":"rgb("+[this.r,this.g,this.b].join()+")"};t.prototype.namedColor=function(a){var b=tb[a.toLowerCase()];if(b)this.r=b[0],this.g=b[1],this.b=b[2];else if("transparent"===a.toLowerCase())return this.r=this.g=this.b=this.a=0,!0;return!!b};t.prototype.isColor=!0;var tb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,
255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],
darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],
fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,
250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,
179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,
239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,
255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};pa.prototype.getMetrics=function(a,b){this.data[a+"-"+b]===L&&(this.data[a+"-"+b]=new Ua(a,b));return this.data[a+"-"+b]};qa.prototype.proxyLoad=function(a,b,c){var d=this.src;return oa(d.src,a,d.ownerDocument,b.width,b.height,c)};N.prototype.TYPES=
{LINEAR:1,RADIAL:2};u.prototype.findImages=function(a){var b=[];a.reduce(function(a,b){switch(b.node.nodeName){case "IMG":return a.concat([{args:[b.node.src],method:"url"}]);case "svg":case "IFRAME":return a.concat([{args:[b.node],method:b.node.nodeName}])}return a},[]).forEach(this.addImage(b,this.loadImage),this);return b};u.prototype.findBackgroundImage=function(a,b){b.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(a,this.loadImage),this);return a};u.prototype.addImage=
function(a,b){return function(c){c.args.forEach(function(d){this.imageExists(a,d)||(a.splice(0,0,b.call(this,c)),q("Added image #"+a.length,"string"===typeof d?d.substring(0,100):d))},this)}};u.prototype.hasImageBackground=function(a){return"none"!==a.method};u.prototype.loadImage=function(a){return"url"===a.method?(a=a.args[0],!this.isSVG(a)||this.support.svg||this.options.allowTaint?a.match(/data:image\/.*;base64,/i)?new ba(a.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),!1):this.isSameOrigin(a)||!0===
this.options.allowTaint||this.isSVG(a)?new ba(a,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new ba(a,!0):this.options.proxy?new kb(a,this.options.proxy):new M(a):new A(a)):"linear-gradient"===a.method?new V(a):"gradient"===a.method?new Fa(a):"svg"===a.method?new Ea(a.args[0],this.support.svg):"IFRAME"===a.method?new qa(a.args[0],this.isSameOrigin(a.args[0].src),this.options):new M(a)};u.prototype.isSVG=function(a){return"svg"===a.substring(a.length-3).toLowerCase()||A.prototype.isInline(a)};
u.prototype.imageExists=function(a,b){return a.some(function(a){return a.src===b})};u.prototype.isSameOrigin=function(a){return this.getOrigin(a)===this.origin};u.prototype.getOrigin=function(a){var b=this.link||(this.link=r.createElement("a"));b.href=a;b.href=b.href;return b.protocol+b.hostname+b.port};u.prototype.getPromise=function(a){return this.timeout(a,this.options.imageTimeout)["catch"](function(){return(new M(a.src)).promise.then(function(b){a.image=b})})};u.prototype.get=function(a){var b=
null;return this.images.some(function(c){return(b=c).src===a})?b:null};u.prototype.fetch=function(a){this.images=a.reduce(X(this.findBackgroundImage,this),this.findImages(a));this.images.forEach(function(a,c){a.promise.then(function(){q("Succesfully loaded image #"+(c+1),a)},function(d){q("Failed loading image #"+(c+1),a,d)})});this.ready=Promise.all(this.images.map(this.getPromise,this));q("Finished searching images");return this};u.prototype.timeout=function(a,b){var c,d=Promise.race([a.promise,
new Promise(function(d,f){c=setTimeout(function(){q("Timed out loading image",a);f(a)},b)})]).then(function(a){clearTimeout(c);return a});d["catch"](function(){clearTimeout(c)});return d};V.prototype=Object.create(N.prototype);V.prototype.stepRegExp=/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;l.prototype.cloneTo=function(a){a.visible=this.visible;a.borders=this.borders;a.bounds=this.bounds;a.clip=this.clip;a.backgroundClip=this.backgroundClip;a.computedStyles=
this.computedStyles;a.styles=this.styles;a.backgroundImages=this.backgroundImages;a.opacity=this.opacity};l.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity};l.prototype.assignStack=function(a){this.stack=a;a.children.push(this)};l.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&
("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))};l.prototype.css=function(a){this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null));return this.styles[a]||(this.styles[a]=this.computedStyles[a])};l.prototype.prefixedCss=function(a){var b=["webkit","moz","ms","o"],c=this.css(a);c===L&&b.some(function(b){c=this.css(b+a.substr(0,1).toUpperCase()+a.substr(1));return c!==L},this);return c===
L?null:c};l.prototype.computedStyle=function(a){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,a)};l.prototype.cssInt=function(a){a=parseInt(this.css(a),10);return isNaN(a)?0:a};l.prototype.color=function(a){return this.colors[a]||(this.colors[a]=new t(this.css(a)))};l.prototype.cssFloat=function(a){a=parseFloat(this.css(a));return isNaN(a)?0:a};l.prototype.fontWeight=function(){var a=this.css("fontWeight");switch(parseInt(a,10)){case 401:a="bold";break;case 400:a="normal"}return a};
l.prototype.parseClip=function(){var a=this.css("clip").match(this.CLIP);return a?{top:parseInt(a[1],10),right:parseInt(a[2],10),bottom:parseInt(a[3],10),left:parseInt(a[4],10)}:null};l.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=ra(this.css("backgroundImage")))};l.prototype.cssList=function(a,b){var c=(this.css(a)||"").split(","),c=c[b||0]||c[0]||"auto",c=c.trim().split(" ");1===c.length&&(c=[c[0],c[0]]);return c};l.prototype.parseBackgroundSize=
function(a,b,c){c=this.cssList("backgroundSize",c);var d;if(W(c[0]))d=a.width*parseFloat(c[0])/100;else{if(/contain|cover/.test(c[0]))return b=b.width/b.height,a.width/a.height<b^"contain"===c[0]?{width:a.height*b,height:a.height}:{width:a.width,height:a.width/b};d=parseInt(c[0],10)}a="auto"===c[0]&&"auto"===c[1]?b.height:"auto"===c[1]?d/b.width*b.height:W(c[1])?a.height*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(d=a/b.height*b.width);return{width:d,height:a}};l.prototype.parseBackgroundPosition=
function(a,b,c,d){c=this.cssList("backgroundPosition",c);var e;e=W(c[0])?(a.width-(d||b).width)*(parseFloat(c[0])/100):parseInt(c[0],10);a="auto"===c[1]?e/b.width*b.height:W(c[1])?(a.height-(d||b).height)*parseFloat(c[1])/100:parseInt(c[1],10);"auto"===c[0]&&(e=a/b.height*b.width);return{left:e,top:a}};l.prototype.parseBackgroundRepeat=function(a){return this.cssList("backgroundRepeat",a)[0]};l.prototype.parseTextShadows=function(){var a=this.css("textShadow"),b=[];if(a&&"none"!==a)for(var a=a.match(this.TEXT_SHADOW_PROPERTY),
c=0;a&&c<a.length;c++){var d=a[c].match(this.TEXT_SHADOW_VALUES);b.push({color:new t(d[0]),offsetX:d[1]?parseFloat(d[1].replace("px","")):0,offsetY:d[2]?parseFloat(d[2].replace("px","")):0,blur:d[3]?d[3].replace("px",""):0})}return b};l.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var a=this.parseBounds(),b=this.prefixedCss("transformOrigin").split(" ").map(Wa).map(Xa);b[0]+=a.left;b[1]+=a.top;this.transformData={origin:b,matrix:this.parseTransformMatrix()}}else this.transformData=
{origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData};l.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var a=this.prefixedCss("transform");this.transformMatrix=(a=a?Va(a.match(this.MATRIX_PROPERTY)):null)?a:[1,0,0,1,0,0]}return this.transformMatrix};l.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?ca(this.node):U(this.node))};l.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&
this.parent.hasTransform()};l.prototype.getValue=function(){var a=this.node.value||"";"SELECT"===this.node.tagName?(a=this.node,a=(a=a.options[a.selectedIndex||0])?a.text||"":""):"password"===this.node.type&&(a=Array(a.length+1).join("\u2022"));return 0===a.length?this.node.placeholder||"":a};l.prototype.MATRIX_PROPERTY=/(matrix)\((.+)\)/;l.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;l.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;l.prototype.CLIP=
/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;n.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(a){if(O(a)){!0===a.isPseudoElement&&a.appendToDOM();a.borders=this.parseBorders(a);var b="hidden"===a.css("overflow")?[a.borders.clip]:[],c=a.parseClip();c&&-1!==["absolute","fixed"].indexOf(a.css("position"))&&b.push([["rect",a.bounds.left+c.left,a.bounds.top+c.top,c.right-c.left,c.bottom-c.top]]);a.clip=a.parent&&a.parent.clip.length?a.parent.clip.concat(b):b;a.backgroundClip=
"hidden"!==a.css("overflow")?a.clip.concat([a.borders.clip]):a.clip;!0===a.isPseudoElement&&a.cleanDOM()}else ea(a)&&(a.clip=a.parent&&a.parent.clip.length?a.parent.clip:[]);!0!==a.isPseudoElement&&(a.bounds=null)},this)};n.prototype.asyncRenderer=function(a,b,c){c=c||Date.now();this.paint(a[this.renderIndex++]);a.length===this.renderIndex?b():c+20>Date.now()?this.asyncRenderer(a,b,c):setTimeout(X(function(){this.asyncRenderer(a,b)},this),0)};n.prototype.createPseudoHideStyles=function(a){this.createStyles(a,
"."+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')};n.prototype.disableAnimations=function(a){this.createStyles(a,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")};
n.prototype.createStyles=function(a,b){var c=a.createElement("style");c.innerHTML=b;a.body.appendChild(c)};n.prototype.getPseudoElements=function(a){var b=[[a]];if(a.node.nodeType===Node.ELEMENT_NODE){var c=this.getPseudoElement(a,":before");a=this.getPseudoElement(a,":after");c&&b.push(c);a&&b.push(a)}return[].concat.apply([],b)};n.prototype.getPseudoElement=function(a,b){var c=a.computedStyle(b);if(!c||!c.content||"none"===c.content||"-moz-alt-content"===c.content||"none"===c.display)return null;
var d,e=c.content,f=e.substr(0,1);d=f===e.substr(e.length-1)&&f.match(/'|"/)?e.substr(1,e.length-2):e;for(var g="url"===d.substr(0,3),e=r.createElement(g?"img":"html2canvaspseudoelement"),f=new v(e,a,b),h=c.length-1;0<=h;h--){var k=Ya(c.item(h));e.style[k]=c[k]}e.className=v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;if(g)return e.src=ra(d)[0].args[0],[f];c=r.createTextNode(d);e.appendChild(c);return[f,new I(c,f)]};n.prototype.getChildren=function(a){return[].concat.apply([],
[].filter.call(a.node.childNodes,db).map(function(b){var c=[b.nodeType===Node.TEXT_NODE?new I(b,a):new l(b,a)].filter(gb);return b.nodeType===Node.ELEMENT_NODE&&c.length&&"TEXTAREA"!==b.tagName?c[0].isElementVisible()?c.concat(this.getChildren(c[0])):[]:c},this))};n.prototype.newStackingContext=function(a,b){var c=new G(b,a.getOpacity(),a.node,a.parent);a.cloneTo(c);(b?c.getParentStack(this):c.parent.stack).contexts.push(c);a.stack=c};n.prototype.createStackingContexts=function(){this.nodes.forEach(function(a){var b;
if(b=O(a))(b=this.isRootElement(a)||1>a.getOpacity())||(b=a.css("position"),b="auto"!==(-1!==["absolute","relative","fixed"].indexOf(b)?a.css("zIndex"):"auto")),b=b||this.isBodyWithTransparentRoot(a)||a.hasTransform();b?this.newStackingContext(a,!0):O(a)&&(P(a)&&va(a)||-1!==["inline-block","inline-table"].indexOf(a.css("display"))||da(a))?this.newStackingContext(a,!1):a.assignStack(a.parent.stack)},this)};n.prototype.isBodyWithTransparentRoot=function(a){return"BODY"===a.node.nodeName&&a.parent.color("backgroundColor").isTransparent()};
n.prototype.isRootElement=function(a){return null===a.parent};n.prototype.sortStackingContexts=function(a){a.contexts.sort(eb(a.contexts.slice(0)));a.contexts.forEach(this.sortStackingContexts,this)};n.prototype.parseTextBounds=function(a){return function(b,c,d){if("none"!==a.parent.css("textDecoration").substr(0,4)||0!==b.trim().length){if(this.support.rangeBounds&&!a.parent.hasTransform())return c=d.slice(0,c).join("").length,this.getRangeBounds(a.node,c,b.length);if(a.node&&"string"===typeof a.node.data)return b=
a.node.splitText(b.length),c=this.getWrapperBounds(a.node,a.parent.hasTransform()),a.node=b,c}else if(!this.support.rangeBounds||a.parent.hasTransform())a.node=a.node.splitText(b.length);return{}}};n.prototype.getWrapperBounds=function(a,b){var c=a.ownerDocument.createElement("html2canvaswrapper"),d=a.parentNode,e=a.cloneNode(!0);c.appendChild(a.cloneNode(!0));d.replaceChild(c,a);var f=b?ca(c):U(c);d.replaceChild(e,c);return f};n.prototype.getRangeBounds=function(a,b,c){var d=this.range||(this.range=
a.ownerDocument.createRange());d.setStart(a,b);d.setEnd(a,b+c);return d.getBoundingClientRect()};n.prototype.parse=function(a){var b=a.contexts.filter(Za),c=a.children.filter(O),d=c.filter(Q(da)),e=d.filter(Q(P)).filter(Q(wa)),c=c.filter(Q(P)).filter(da),f=d.filter(Q(P)).filter(wa),d=a.contexts.concat(d.filter(P)).filter(va),g=a.children.filter(ea).filter(ab);a=a.contexts.filter($a);b.concat(e).concat(c).concat(f).concat(d).concat(g).concat(a).forEach(function(a){this.renderQueue.push(a);a instanceof
G&&(this.parse(a),this.renderQueue.push(new sa))},this)};n.prototype.paint=function(a){try{a instanceof sa?this.renderer.ctx.restore():ea(a)?(!0===a.parent.isPseudoElement&&a.parent.appendToDOM(),this.paintText(a),!0===a.parent.isPseudoElement&&a.parent.cleanDOM()):this.paintNode(a)}catch(b){if(q(b),this.options.strict)throw b;}};n.prototype.paintNode=function(a){a instanceof G&&(this.renderer.setOpacity(a.opacity),this.renderer.ctx.save(),a.hasTransform()&&this.renderer.setTransform(a.parseTransform()));
"INPUT"===a.node.nodeName&&"checkbox"===a.node.type?this.paintCheckbox(a):"INPUT"===a.node.nodeName&&"radio"===a.node.type?this.paintRadio(a):this.paintElement(a)};n.prototype.paintElement=function(a){var b=a.parseBounds();this.renderer.clip(a.backgroundClip,function(){this.renderer.renderBackground(a,b,a.borders.borders.map(fb))},this);this.renderer.clip(a.clip,function(){this.renderer.renderBorders(a.borders.borders)},this);this.renderer.clip(a.backgroundClip,function(){switch(a.node.nodeName){case "svg":case "IFRAME":var c=
this.images.get(a.node);c?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <"+a.node.nodeName+">",a.node);break;case "IMG":(c=this.images.get(a.node.src))?this.renderer.renderImage(a,b,a.borders,c):q("Error loading <img>",a.node.src);break;case "CANVAS":this.renderer.renderImage(a,b,a.borders,{image:a.node});break;case "SELECT":case "INPUT":case "TEXTAREA":this.paintFormValue(a)}},this)};n.prototype.paintCheckbox=function(a){var b=a.parseBounds(),c=Math.min(b.width,b.height),d={width:c-
1,height:c-1,top:b.top,left:b.left},b=[3,3],e=[b,b,b,b],f=[1,1,1,1].map(function(a){return{color:new t("#A5A5A5"),width:a}}),g=ua(d,e,f);this.renderer.clip(a.backgroundClip,function(){this.renderer.rectangle(d.left+1,d.top+1,d.width-2,d.height-2,new t("#DEDEDE"));this.renderer.renderBorders(ta(f,d,g,e));a.node.checked&&(this.renderer.font(new t("#424242"),"normal","normal","bold",c-3+"px","arial"),this.renderer.text("\u2714",d.left+c/6,d.top+c-1))},this)};n.prototype.paintRadio=function(a){var b=
a.parseBounds(),c=Math.min(b.width,b.height)-2;this.renderer.clip(a.backgroundClip,function(){this.renderer.circleStroke(b.left+1,b.top+1,c,new t("#DEDEDE"),1,new t("#A5A5A5"));a.node.checked&&this.renderer.circle(Math.ceil(b.left+c/4)+1,Math.ceil(b.top+c/4)+1,Math.floor(c/2),new t("#424242"))},this)};n.prototype.paintFormValue=function(a){var b=a.getValue();if(0<b.length){var c=a.node.ownerDocument,d=c.createElement("html2canvaswrapper");"lineHeight textAlign fontFamily fontWeight fontSize color paddingLeft paddingTop paddingRight paddingBottom width height borderLeftStyle borderTopStyle borderLeftWidth borderTopWidth boxSizing whiteSpace wordWrap".split(" ").forEach(function(b){try{d.style[b]=
a.css(b)}catch(c){q("html2canvas: Parse: Exception caught in renderFormValue: "+c.message)}});var e=a.parseBounds();d.style.position="fixed";d.style.left=e.left+"px";d.style.top=e.top+"px";d.textContent=b;c.body.appendChild(d);this.paintText(new I(d.firstChild,a));c.body.removeChild(d)}};n.prototype.paintText=function(a){a.applyTextTransform();var b=m.html2canvas.punycode.ucs2.decode(a.node.data),c=this.options.letterRendering&&!/^(normal|none|0px)$/.test(a.parent.css("letterSpacing"))||/[^\u0000-\u00ff]/.test(a.node.data)?
b.map(function(a){return m.html2canvas.punycode.ucs2.encode([a])}):hb(b),b=a.parent.fontWeight(),d=a.parent.css("fontSize"),e=a.parent.css("fontFamily"),f=a.parent.parseTextShadows();this.renderer.font(a.parent.color("color"),a.parent.css("fontStyle"),a.parent.css("fontVariant"),b,d,e);f.length?this.renderer.fontShadow(f[0].color,f[0].offsetX,f[0].offsetY,f[0].blur):this.renderer.clearShadow();this.renderer.clip(a.parent.clip,function(){c.map(this.parseTextBounds(a),this).forEach(function(b,f){b&&
(this.renderer.text(c[f],b.left,b.bottom),this.renderTextDecoration(a.parent,b,this.fontMetrics.getMetrics(e,d)))},this)},this)};n.prototype.renderTextDecoration=function(a,b,c){switch(a.css("textDecoration").split(" ")[0]){case "underline":this.renderer.rectangle(b.left,Math.round(b.top+c.baseline+c.lineWidth),b.width,1,a.color("color"));break;case "overline":this.renderer.rectangle(b.left,Math.round(b.top),b.width,1,a.color("color"));break;case "line-through":this.renderer.rectangle(b.left,Math.ceil(b.top+
c.middle+c.lineWidth),b.width,1,a.color("color"))}};var Ja={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};n.prototype.parseBorders=function(a){var b=a.parseBounds(),c=bb(a),d=["Top","Right","Bottom","Left"].map(function(b,c){var d=a.css("border"+b+"Style"),e=a.color("border"+b+"Color");"inset"===d&&e.isBlack()&&(e=new t([255,255,255,e.a]));d=Ja[d]?Ja[d][c]:null;return{width:a.cssInt("border"+b+"Width"),color:d?e[d[0]](d[1]):e,args:null}}),e=ua(b,c,d);return{clip:this.parseBackgroundClip(a,
e,d,c,b),borders:ta(d,b,e,c)}};n.prototype.parseBackgroundClip=function(a,b,c,d,e){var f=[];switch(a.css("backgroundClip")){case "content-box":case "padding-box":D(f,d[0],d[1],b.topLeftInner,b.topRightInner,e.left+c[3].width,e.top+c[0].width);D(f,d[1],d[2],b.topRightInner,b.bottomRightInner,e.left+e.width-c[1].width,e.top+c[0].width);D(f,d[2],d[3],b.bottomRightInner,b.bottomLeftInner,e.left+e.width-c[1].width,e.top+e.height-c[2].width);D(f,d[3],d[0],b.bottomLeftInner,b.topLeftInner,e.left+c[3].width,
e.top+e.height-c[2].width);break;default:D(f,d[0],d[1],b.topLeftOuter,b.topRightOuter,e.left,e.top),D(f,d[1],d[2],b.topRightOuter,b.bottomRightOuter,e.left+e.width,e.top),D(f,d[2],d[3],b.bottomRightOuter,b.bottomLeftOuter,e.left+e.width,e.top+e.height),D(f,d[3],d[0],b.bottomLeftOuter,b.topLeftOuter,e.left,e.top+e.height)}return f};var jb=0,ya="withCredentials"in new XMLHttpRequest,Da="crossOrigin"in new Image;v.prototype.cloneTo=function(a){v.prototype.cloneTo.call(this,a);a.isPseudoElement=!0;a.before=
this.before};v.prototype=Object.create(l.prototype);v.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node);this.parent.node.className+=" "+this.getHideClass()};v.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node);this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")};v.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+
(this.before?"BEFORE":"AFTER")]};v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before";v.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after";x.prototype.renderImage=function(a,b,c,d){var e=a.cssInt("paddingLeft"),f=a.cssInt("paddingTop"),g=a.cssInt("paddingRight");a=a.cssInt("paddingBottom");c=c.borders;g=b.width-(c[1].width+c[3].width+e+g);a=b.height-(c[0].width+c[2].width+f+a);this.drawImage(d,0,0,d.image.width||g,d.image.height||a,b.left+
e+c[3].width,b.top+f+c[0].width,g,a)};x.prototype.renderBackground=function(a,b,c){0<b.height&&0<b.width&&(this.renderBackgroundColor(a,b),this.renderBackgroundImage(a,b,c))};x.prototype.renderBackgroundColor=function(a,b){var c=a.color("backgroundColor");c.isTransparent()||this.rectangle(b.left,b.top,b.width,b.height,c)};x.prototype.renderBorders=function(a){a.forEach(this.renderBorder,this)};x.prototype.renderBorder=function(a){a.color.isTransparent()||null===a.args||this.drawShape(a.args,a.color)};
x.prototype.renderBackgroundImage=function(a,b,c){a.parseBackgroundImages().reverse().forEach(function(d,e,f){switch(d.method){case "url":var g=this.images.get(d.args[0]);g?this.renderBackgroundRepeating(a,b,g,f.length-(e+1),c):q("Error loading background-image",d.args[0]);break;case "linear-gradient":case "gradient":(e=this.images.get(d.value))?this.renderBackgroundGradient(e,b,c):q("Error loading background-image",d.args[0]);break;case "none":break;default:q("Unknown background-image type",d.args[0])}},
this)};x.prototype.renderBackgroundRepeating=function(a,b,c,d,e){var f=a.parseBackgroundSize(b,c.image,d),g=a.parseBackgroundPosition(b,c.image,d,f);switch(a.parseBackgroundRepeat(d)){case "repeat-x":case "repeat no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+e[3],b.top+g.top+e[0],99999,f.height,e);break;case "repeat-y":case "no-repeat repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+e[3],b.top+e[0],f.width,99999,e);break;case "no-repeat":this.backgroundRepeatShape(c,g,f,b,b.left+g.left+
e[3],b.top+g.top+e[0],f.width,f.height,e);break;default:this.renderBackgroundRepeat(c,g,f,{top:b.top,left:b.left},e[3],e[0])}};G.prototype=Object.create(l.prototype);G.prototype.getParentStack=function(a){var b=this.parent?this.parent.stack:null;return b?b.ownStacking?b:b.getParentStack(a):a.stack};T.prototype.testRangeBounds=function(a){var b,c,d=!1;a.createRange&&(b=a.createRange(),b.getBoundingClientRect&&(c=a.createElement("boundtest"),c.style.height="123px",c.style.display="block",a.body.appendChild(c),
b.selectNode(c),b=b.getBoundingClientRect(),b=b.height,123===b&&(d=!0),a.body.removeChild(c)));return d};T.prototype.testCORS=function(){return"undefined"!==typeof(new Image).crossOrigin};T.prototype.testSVG=function(){var a=new Image,b=r.createElement("canvas"),c=b.getContext("2d");a.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{c.drawImage(a,0,0),b.toDataURL()}catch(d){return!1}return!0};A.prototype.hasFabric=function(){return html2canvas.fabric?Promise.resolve():Promise.reject(Error("html2canvas.svg.js is not loaded, cannot render svg"))};
A.prototype.inlineFormatting=function(a){return/^data:image\/svg\+xml;base64,/.test(a)?this.decode64(this.removeContentType(a)):this.removeContentType(a)};A.prototype.removeContentType=function(a){return a.replace(/^data:image\/svg\+xml(;base64)?,/,"")};A.prototype.isInline=function(a){return/^data:image\/svg\+xml/i.test(a)};A.prototype.createCanvas=function(a){var b=this;return function(c,d){var e=new html2canvas.fabric.StaticCanvas("c");b.image=e.lowerCanvasEl;e.setWidth(d.width).setHeight(d.height).add(html2canvas.fabric.util.groupSVGElements(c,
d)).renderAll();a(e.lowerCanvasEl)}};A.prototype.decode64=function(a){return"function"===typeof m.atob?m.atob(a):Ca(a)};Ea.prototype=Object.create(A.prototype);I.prototype=Object.create(l.prototype);I.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))};I.prototype.transform=function(a){var b=this.node.data;switch(a){case "lowercase":return b.toLowerCase();case "capitalize":return b.replace(/(^|\s|:|-|\(|\))([a-z])/g,lb);case "uppercase":return b.toUpperCase();
default:return b}};Fa.prototype=Object.create(N.prototype);p.prototype=Object.create(x.prototype);p.prototype.setFillStyle=function(a){this.ctx.fillStyle="object"===typeof a&&a.isColor?a.toString():a;return this.ctx};p.prototype.rectangle=function(a,b,c,d,e){this.setFillStyle(e).fillRect(a,b,c,d)};p.prototype.circle=function(a,b,c,d){this.setFillStyle(d);this.ctx.beginPath();this.ctx.arc(a+c/2,b+c/2,c/2,0,2*Math.PI,!0);this.ctx.closePath();this.ctx.fill()};p.prototype.circleStroke=function(a,b,c,
d,e,f){this.circle(a,b,c,d);this.ctx.strokeStyle=f.toString();this.ctx.stroke()};p.prototype.drawShape=function(a,b){this.shape(a);this.setFillStyle(b).fill()};p.prototype.taints=function(a){if(null===a.tainted){this.taintCtx.drawImage(a.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),a.tainted=!1}catch(b){this.taintCtx=r.createElement("canvas").getContext("2d"),a.tainted=!0}}return a.tainted};p.prototype.drawImage=function(a,b,c,d,e,f,g,h,k){this.taints(a)&&!this.options.allowTaint||this.ctx.drawImage(a.image,
b,c,d,e,f,g,h,k)};p.prototype.clip=function(a,b,c){this.ctx.save();a.filter(mb).forEach(function(a){this.shape(a).clip()},this);b.call(c);this.ctx.restore()};p.prototype.shape=function(a){this.ctx.beginPath();a.forEach(function(a,c){"rect"===a[0]?this.ctx.rect.apply(this.ctx,a.slice(1)):this.ctx[0===c?"moveTo":a[0]+"To"].apply(this.ctx,a.slice(1))},this);this.ctx.closePath();return this.ctx};p.prototype.font=function(a,b,c,d,e,f){this.setFillStyle(a).font=[b,c,d,e,f].join(" ").split(",")[0]};p.prototype.fontShadow=
function(a,b,c,d){this.setVariable("shadowColor",a.toString()).setVariable("shadowOffsetY",b).setVariable("shadowOffsetX",c).setVariable("shadowBlur",d)};p.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")};p.prototype.setOpacity=function(a){this.ctx.globalAlpha=a};p.prototype.setTransform=function(a){this.ctx.translate(a.origin[0],a.origin[1]);this.ctx.transform.apply(this.ctx,a.matrix);this.ctx.translate(-a.origin[0],-a.origin[1])};p.prototype.setVariable=function(a,
b){this.variables[a]!==b&&(this.variables[a]=this.ctx[a]=b);return this};p.prototype.text=function(a,b,c){this.ctx.fillText(a,b,c)};p.prototype.backgroundRepeatShape=function(a,b,c,d,e,f,g,h,k){this.clip([[["line",Math.round(e),Math.round(f)],["line",Math.round(e+g),Math.round(f)],["line",Math.round(e+g),Math.round(h+f)],["line",Math.round(e),Math.round(h+f)]]],function(){this.renderBackgroundRepeat(a,b,c,d,k[3],k[0])},this)};p.prototype.renderBackgroundRepeat=function(a,b,c,d,e,f){e=Math.round(d.left+
b.left+e);b=Math.round(d.top+b.top+f);this.setFillStyle(this.ctx.createPattern(this.resizeImage(a,c),"repeat"));this.ctx.translate(e,b);this.ctx.fill();this.ctx.translate(-e,-b)};p.prototype.renderBackgroundGradient=function(a,b){if(a instanceof V){var c=this.ctx.createLinearGradient(b.left+b.width*a.x0,b.top+b.height*a.y0,b.left+b.width*a.x1,b.top+b.height*a.y1);a.colorStops.forEach(function(a){c.addColorStop(a.stop,a.color.toString())});this.rectangle(b.left,b.top,b.width,b.height,c)}};p.prototype.resizeImage=
function(a,b){var c=a.image;if(c.width===b.width&&c.height===b.height)return c;var d=r.createElement("canvas");d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(c,0,0,c.width,c.height,0,0,b.width,b.height);return d}}}).call({},"undefined"!==typeof window?window:void 0,"undefined"!==typeof document?document:void 0);

/*
 Use it if you like it
*/
(function(A){function E(K){this.ok=!1;"#"==K.charAt(0)&&(K=K.substr(1,6));K=K.replace(/ /g,"");K=K.toLowerCase();var A={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",
darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",
gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",
lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},O;for(O in A)K==O&&(K=A[O]);var L=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,
example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}];for(O=0;O<L.length;O++){var W=L[O].process,M=L[O].re.exec(K);M&&(channels=W(M),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=0>this.r||isNaN(this.r)?0:255<this.r?255:this.r;this.g=0>this.g||isNaN(this.g)?0:
255<this.g?255:this.g;this.b=0>this.b||isNaN(this.b)?0:255<this.b?255:this.b;this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var u=this.r.toString(16),B=this.g.toString(16),p=this.b.toString(16);1==u.length&&(u="0"+u);1==B.length&&(B="0"+B);1==p.length&&(p="0"+p);return"#"+u+B+p};this.getHelpXML=function(){for(var u=[],B=0;B<L.length;B++)for(var p=L[B].example,C=0;C<p.length;C++)u[u.length]=p[C];for(var w in A)u[u.length]=w;p=document.createElement("ul");
p.setAttribute("id","rgbcolor-examples");for(B=0;B<u.length;B++)try{var h=document.createElement("li"),a=new E(u[B]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+a.toHex()+"; color:"+a.toHex();l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+u[B]+" -> "+a.toRGB()+" -> "+a.toHex());h.appendChild(l);h.appendChild(c);p.appendChild(h)}catch(b){}return p}}"undefined"!==typeof define&&define.amd?define(function(){return E}):
"undefined"!==typeof module&&module.exports&&(module.exports=E);A.RGBColor=E})("undefined"!==typeof window?window:this);
(function(A){function E(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(A){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(K){throw alert("Cannot access local image"),Error("unable to access local image data: "+K);}}}catch(A){throw alert("Cannot access image"),Error("unable to access image data: "+A);}for(var a=h.data,l=h.width*h.height*4,c=0;c<l;c+=4){var b=
a[c+3]/255;a[c]*=b;a[c+1]*=b;a[c+2]*=b}var a=h.data,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N,P,S,y,I,J,t,E;e=w+w+1;var R=p-1,l=C-1,c=w+1,b=c*(c+1)/2,Q=new X,x=Q;for(k=1;k<e;k++)if(x=x.next=new X,k==c)var T=x;x.next=Q;n=g=0;var U=O[w],V=L[w];for(d=0;d<C;d++){D=N=P=S=m=v=z=H=0;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;for(k=1;k<c;k++)f=g+((R<k?R:k)<<2),m+=(x.r=y=a[f])*(E=c-k),v+=(x.g=I=a[f+1])*E,z+=(x.b=J=a[f+2])*
E,H+=(x.a=t=a[f+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next;k=Q;x=T;for(e=0;e<p;e++)a[g]=m*U>>V,a[g+1]=v*U>>V,a[g+2]=z*U>>V,a[g+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=n+((f=e+w+1)<R?f:R)<<2,D+=k.r=a[f],N+=k.g=a[f+1],P+=k.b=a[f+2],S+=k.a=a[f+3],m+=D,v+=N,z+=P,H+=S,k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=4;n+=p}for(e=0;e<p;e++){N=P=S=D=v=z=H=m=0;g=e<<2;q=c*(y=a[g]);F=c*(I=a[g+1]);r=c*(J=a[g+2]);G=c*(t=a[g+3]);m+=b*y;v+=b*I;z+=b*J;H+=b*t;x=Q;for(k=0;k<
c;k++)x.r=y,x.g=I,x.b=J,x.a=t,x=x.next;f=p;for(k=1;k<=w;k++)g=f+e<<2,m+=(x.r=y=a[g])*(E=c-k),v+=(x.g=I=a[g+1])*E,z+=(x.b=J=a[g+2])*E,H+=(x.a=t=a[g+3])*E,D+=y,N+=I,P+=J,S+=t,x=x.next,k<l&&(f+=p);g=e;k=Q;x=T;for(d=0;d<C;d++)f=g<<2,a[f]=m*U>>V,a[f+1]=v*U>>V,a[f+2]=z*U>>V,a[f+3]=H*U>>V,m-=q,v-=F,z-=r,H-=G,q-=k.r,F-=k.g,r-=k.b,G-=k.a,f=e+((f=d+c)<l?f:l)*p<<2,m+=D+=k.r=a[f],v+=N+=k.g=a[f+1],z+=P+=k.b=a[f+2],H+=S+=k.a=a[f+3],k=k.next,q+=y=x.r,F+=I=x.g,r+=J=x.b,G+=t=x.a,D-=y,N-=I,P-=J,S-=t,x=x.next,g+=p}p=
h.data;C=h.width*h.height*4;for(w=0;w<C;w+=4)T=p[w+3],0!=T&&(T=255/T,p[w]*=T,p[w+1]*=T,p[w+2]*=T);M.putImageData(h,u,B)}}function K(M,u,B,p,C,w){if(!(isNaN(w)||1>w)){w|=0;M=document.getElementById(M).getContext("2d");var h;try{try{h=M.getImageData(u,B,p,C)}catch(x){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),h=M.getImageData(u,B,p,C)}catch(E){throw alert("Cannot access local image"),Error("unable to access local image data: "+E);}}}catch(x){throw alert("Cannot access image"),
Error("unable to access image data: "+x);}var a=h.data,l,c,b,e,d,k,f,g,n,m,v,z,H,q,F,r,G,D,N;l=w+w+1;var P=p-1,A=C-1,y=w+1,I=y*(y+1)/2,J=new X,t=J;for(b=1;b<l;b++)if(t=t.next=new X,b==y)var K=t;t.next=J;k=d=0;var R=O[w],Q=L[w];for(c=0;c<C;c++){H=q=F=f=g=n=0;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;for(b=1;b<y;b++)e=d+((P<b?P:b)<<2),f+=(t.r=r=a[e])*(N=y-b),g+=(t.g=G=a[e+1])*N,n+=(t.b=D=a[e+2])*N,H+=r,q+=G,F+=D,t=t.next;b=J;t=K;for(l=
0;l<p;l++)a[d]=f*R>>Q,a[d+1]=g*R>>Q,a[d+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=k+((e=l+w+1)<P?e:P)<<2,H+=b.r=a[e],q+=b.g=a[e+1],F+=b.b=a[e+2],f+=H,g+=q,n+=F,b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=4;k+=p}for(l=0;l<p;l++){q=F=H=g=n=f=0;d=l<<2;m=y*(r=a[d]);v=y*(G=a[d+1]);z=y*(D=a[d+2]);f+=I*r;g+=I*G;n+=I*D;t=J;for(b=0;b<y;b++)t.r=r,t.g=G,t.b=D,t=t.next;e=p;for(b=1;b<=w;b++)d=e+l<<2,f+=(t.r=r=a[d])*(N=y-b),g+=(t.g=G=a[d+1])*N,n+=(t.b=D=a[d+2])*N,H+=r,q+=G,F+=D,t=t.next,
b<A&&(e+=p);d=l;b=J;t=K;for(c=0;c<C;c++)e=d<<2,a[e]=f*R>>Q,a[e+1]=g*R>>Q,a[e+2]=n*R>>Q,f-=m,g-=v,n-=z,m-=b.r,v-=b.g,z-=b.b,e=l+((e=c+y)<A?e:A)*p<<2,f+=H+=b.r=a[e],g+=q+=b.g=a[e+1],n+=F+=b.b=a[e+2],b=b.next,m+=r=t.r,v+=G=t.g,z+=D=t.b,H-=r,q-=G,F-=D,t=t.next,d+=p}M.putImageData(h,u,B)}}function X(){this.a=this.b=this.g=this.r=0;this.next=null}var O=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,
345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,
309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],L=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,
20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,
24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],W={image:function(A,u,B,p){A=document.getElementById(A);var C=A.naturalWidth,w=A.naturalHeight,h=document.getElementById(u);h.style.width=C+"px";h.style.height=w+"px";h.width=C;h.height=w;h=h.getContext("2d");h.clearRect(0,0,C,w);h.drawImage(A,0,0);isNaN(B)||1>B||(p?E(u,0,0,C,w,B):K(u,0,0,C,w,B))},canvasRGBA:E,canvasRGB:K};"undefined"!==typeof define&&define.amd?define(function(){return W}):
"undefined"!==typeof module&&module.exports&&(module.exports=W);A.stackBlur=W})("undefined"!==typeof window?window:this);
(function(A,E){A.canvg=E(A.RGBColor,A.stackBlur)})("undefined"!==typeof window?window:this,function(A,E){function K(h){var a=[0,0,0],l=function(c,b){var e=h.match(c);null!=e&&(a[b]+=e.length,h=h.replace(c," "))};h=h.replace(/:not\(([^\)]*)\)/g,"     $1 ");h=h.replace(/{[\s\S]*/gm," ");l(W,1);l(M,0);l(u,1);l(B,2);l(p,1);l(C,1);h=h.replace(/[\*\s\+>~]/g," ");h=h.replace(/[#\.]/g," ");l(w,2);return a.join("")}function X(h){var a={opts:h,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3E4,log:function(a){}};1==a.opts.log&&
"undefined"!=typeof console&&(a.log=function(a){console.log(a)});a.init=function(c){var b=0;a.UniqueId=function(){b++;return"canvg"+b};a.Definitions={};a.Styles={};a.StylesSpecificity={};a.Animations=[];a.Images=[];a.ctx=c;a.ViewPort=new function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};
this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}};a.init();a.ImagesLoaded=function(){for(var c=0;c<a.Images.length;c++)if(!a.Images[c].loaded)return!1;return!0};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm,
" ")};a.ajax=function(a){var b;b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",a,!1);b.send(null);return b.responseText};a.parseXml=function(a){if("undefined"!=typeof Windows&&"undefined"!=typeof Windows.Data&&"undefined"!=typeof Windows.Data.Xml){var b=new Windows.Data.Xml.Dom.XmlDocument,e=new Windows.Data.Xml.Dom.XmlLoadSettings;e.prohibitDtd=!1;b.loadXml(a,e);return b}if(window.DOMParser)return(new DOMParser).parseFromString(a,"text/xml");a=a.replace(/<!DOCTYPE svg[^>]*>/,
"");b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);return b};a.Property=function(a,b){this.name=a;this.value=b};a.Property.prototype.getValue=function(){return this.value};a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value};a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);(this.value+"").match(/%$/)&&(a/=100);return a};a.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:
a};a.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a};a.Property.prototype.addOpacity=function(c){var b=this.value;if(null!=c.value&&""!=c.value&&"string"==typeof this.value){var e=new A(this.value);e.ok&&(b="rgba("+e.r+", "+e.g+", "+e.b+", "+c.numValue()+")")}return new a.Property(this.name,b)};a.Property.prototype.getDefinition=function(){var c=this.value.match(/#([^\)'"]+)/);c&&(c=c[1]);c||(c=this.value);return a.Definitions[c]};a.Property.prototype.isUrlDefinition=
function(){return 0==this.value.indexOf("url(")};a.Property.prototype.getFillStyleDefinition=function(c,b){var e=this.getDefinition();if(null!=e&&e.createGradient)return e.createGradient(a.ctx,c,b);if(null!=e&&e.createPattern){if(e.getHrefAttribute().hasValue()){var d=e.attribute("patternTransform"),e=e.getHrefAttribute().getDefinition();d.hasValue()&&(e.attribute("patternTransform",!0).value=d.value)}return e.createPattern(a.ctx,c)}return null};a.Property.prototype.getDPI=function(a){return 96};
a.Property.prototype.getEM=function(c){var b=12,e=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);e.hasValue()&&(b=e.toPixels(c));return b};a.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")};a.Property.prototype.toPixels=function(c,b){if(!this.hasValue())return 0;var e=this.value+"";if(e.match(/em$/))return this.numValue()*this.getEM(c);if(e.match(/ex$/))return this.numValue()*this.getEM(c)/2;if(e.match(/px$/))return this.numValue();if(e.match(/pt$/))return this.numValue()*
this.getDPI(c)*(1/72);if(e.match(/pc$/))return 15*this.numValue();if(e.match(/cm$/))return this.numValue()*this.getDPI(c)/2.54;if(e.match(/mm$/))return this.numValue()*this.getDPI(c)/25.4;if(e.match(/in$/))return this.numValue()*this.getDPI(c);if(e.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(c);e=this.numValue();return b&&1>e?e*a.ViewPort.ComputeSize(c):e};a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";if(a.match(/s$/))return 1E3*this.numValue();
a.match(/ms$/);return this.numValue()};a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var l={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",
mathematical:"alphabetic"};a.Property.prototype.toTextBaseline=function(){return this.hasValue()?l[this.value]:null};a.Font=new function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(b,e,d,c,f,g){g=null!=g?this.Parse(g):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:f||g.fontFamily,fontSize:c||g.fontSize,fontStyle:b||g.fontStyle,fontWeight:d||
g.fontWeight,fontVariant:e||g.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var c=this;this.Parse=function(b){var e={};b=a.trim(a.compressSpaces(b||"")).split(" ");for(var d=!1,k=!1,f=!1,g=!1,n="",m=0;m<b.length;m++)k||-1==c.Styles.indexOf(b[m])?g||-1==c.Variants.indexOf(b[m])?f||-1==c.Weights.indexOf(b[m])?d?"inherit"!=b[m]&&(n+=b[m]):("inherit"!=b[m]&&(e.fontSize=b[m].split("/")[0]),k=g=f=d=!0):("inherit"!=b[m]&&
(e.fontWeight=b[m]),k=g=f=!0):("inherit"!=b[m]&&(e.fontVariant=b[m]),k=g=!0):("inherit"!=b[m]&&(e.fontStyle=b[m]),k=!0);""!=n&&(e.fontFamily=n);return e}};a.ToNumberArray=function(c){c=a.trim(a.compressSpaces((c||"").replace(/,/g," "))).split(" ");for(var b=0;b<c.length;b++)c[b]=parseFloat(c[b]);return c};a.Point=function(a,b){this.x=a;this.y=b};a.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};a.Point.prototype.applyTransform=function(a){var b=this.x*a[1]+this.y*a[3]+
a[5];this.x=this.x*a[0]+this.y*a[2]+a[4];this.y=b};a.CreatePoint=function(c){c=a.ToNumberArray(c);return new a.Point(c[0],c[1])};a.CreatePath=function(c){c=a.ToNumberArray(c);for(var b=[],e=0;e<c.length;e+=2)b.push(new a.Point(c[e],c[e+1]));return b};a.BoundingBox=function(a,b,e,d){this.y2=this.x2=this.y1=this.x1=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=
function(a,b){if(null!=a){if(isNaN(this.x1)||isNaN(this.x2))this.x2=this.x1=a;a<this.x1&&(this.x1=a);a>this.x2&&(this.x2=a)}if(null!=b){if(isNaN(this.y1)||isNaN(this.y2))this.y2=this.y1=b;b<this.y1&&(this.y1=b);b>this.y2&&(this.y2=b)}};this.addX=function(a){this.addPoint(a,null)};this.addY=function(a){this.addPoint(null,a)};this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1);this.addPoint(a.x2,a.y2)};this.addQuadraticCurve=function(a,b,e,d,c,v){e=a+2/3*(e-a);d=b+2/3*(d-b);this.addBezierCurve(a,
b,e,e+1/3*(c-a),d,d+1/3*(v-b),c,v)};this.addBezierCurve=function(a,b,e,d,c,v,z,h){var q=[a,b],F=[e,d],r=[c,v],l=[z,h];this.addPoint(q[0],q[1]);this.addPoint(l[0],l[1]);for(i=0;1>=i;i++)a=function(a){return Math.pow(1-a,3)*q[i]+3*Math.pow(1-a,2)*a*F[i]+3*(1-a)*Math.pow(a,2)*r[i]+Math.pow(a,3)*l[i]},b=6*q[i]-12*F[i]+6*r[i],e=-3*q[i]+9*F[i]-9*r[i]+3*l[i],d=3*F[i]-3*q[i],0==e?0!=b&&(b=-d/b,0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))):(d=Math.pow(b,2)-4*d*e,0>d||(c=(-b+Math.sqrt(d))/(2*e),
0<c&&1>c&&(0==i&&this.addX(a(c)),1==i&&this.addY(a(c))),b=(-b-Math.sqrt(d))/(2*e),0<b&&1>b&&(0==i&&this.addX(a(b)),1==i&&this.addY(a(b)))))};this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2};this.addPoint(a,b);this.addPoint(e,d)};a.Transform=function(c){var b=this;this.Type={};this.Type.translate=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)};this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)};
this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(b){b=a.ToNumberArray(b);this.angle=new a.Property("angle",b[0]);this.cx=b[1]||0;this.cy=b[2]||0;this.apply=function(a){a.translate(this.cx,this.cy);a.rotate(this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.unapply=function(a){a.translate(this.cx,this.cy);a.rotate(-1*this.angle.toRadians());a.translate(-this.cx,-this.cy)};this.applyToPoint=function(a){var b=this.angle.toRadians();
a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]);a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(b){this.p=a.CreatePoint(b);this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(b){this.m=a.ToNumberArray(b);
this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(a){var b=this.m[0],e=this.m[2],d=this.m[4],c=this.m[1],f=this.m[3],g=this.m[5],k=1/(b*(1*f-0*g)-e*(1*c-0*g)+d*(0*c-0*f));a.transform(k*(1*f-0*g),k*(0*g-1*c),k*(0*d-1*e),k*(1*b-0*d),k*(e*g-d*f),k*(d*c-b*g))};this.applyToPoint=function(a){a.applyTransform(this.m)}};this.Type.SkewBase=function(e){this.base=b.Type.matrix;this.base(e);this.angle=new a.Property("angle",e)};this.Type.SkewBase.prototype=
new this.Type.matrix;this.Type.skewX=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(a){this.base=b.Type.SkewBase;this.base(a);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)};this.unapply=function(a){for(var b=
this.transforms.length-1;0<=b;b--)this.transforms[b].unapply(a)};this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};c=a.trim(a.compressSpaces(c)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var e=0;e<c.length;e++){var d=a.trim(c[e].split("(")[0]),k=c[e].split("(")[1].replace(")",""),f=this.Type[d];"undefined"!=typeof f&&(k=new f(k),k.type=d,this.transforms.push(k))}};a.AspectRatio=function(c,b,e,d,k,
f,g,n,m,v){b=a.compressSpaces(b);b=b.replace(/^defer\s/,"");var z=b.split(" ")[0]||"xMidYMid";b=b.split(" ")[1]||"meet";var h=e/d,q=k/f,l=Math.min(h,q),r=Math.max(h,q);"meet"==b&&(d*=l,f*=l);"slice"==b&&(d*=r,f*=r);m=new a.Property("refX",m);v=new a.Property("refY",v);m.hasValue()&&v.hasValue()?c.translate(-l*m.toPixels("x"),-l*v.toPixels("y")):(z.match(/^xMid/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e/2-d/2,0),z.match(/YMid$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k/2-f/
2),z.match(/^xMax/)&&("meet"==b&&l==q||"slice"==b&&r==q)&&c.translate(e-d,0),z.match(/YMax$/)&&("meet"==b&&l==h||"slice"==b&&r==h)&&c.translate(0,k-f));"none"==z?c.scale(h,q):"meet"==b?c.scale(l,l):"slice"==b&&c.scale(r,r);c.translate(null==g?0:-g,null==n?0:-n)};a.Element={};a.EmptyProperty=new a.Property("EMPTY","");a.Element.ElementBase=function(c){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(b,e){var d=this.attributes[b];if(null!=d)return d;
1==e&&(d=new a.Property(b,""),this.attributes[b]=d);return d||a.EmptyProperty};this.getHrefAttribute=function(){for(var b in this.attributes)if("href"==b||b.match(/:href$/))return this.attributes[b];return a.EmptyProperty};this.style=function(b,e,d){var c=this.styles[b];if(null!=c)return c;var f=this.attribute(b);if(null!=f&&f.hasValue())return this.styles[b]=f;if(1!=d&&(d=this.parent,null!=d&&(d=d.style(b),null!=d&&d.hasValue())))return d;1==e&&(c=new a.Property(b,""),this.styles[b]=c);return c||
a.EmptyProperty};this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){a.save();if(this.style("mask").hasValue()){var b=this.style("mask").getDefinition();null!=b&&b.apply(a,this)}else this.style("filter").hasValue()?(b=this.style("filter").getDefinition(),null!=b&&b.apply(a,this)):(this.setContext(a),this.renderChildren(a),this.clearContext(a));a.restore()}};this.setContext=function(a){};this.clearContext=function(a){};this.renderChildren=function(a){for(var b=
0;b<this.children.length;b++)this.children[b].render(a)};this.addChild=function(b,e){var d=b;e&&(d=a.CreateElement(b));d.parent=this;"title"!=d.type&&this.children.push(d)};this.addStylesFromStyleDefinition=function(){for(var b in a.Styles)if("@"!=b[0]&&L(c,b)){var e=a.Styles[b],d=a.StylesSpecificity[b];if(null!=e)for(var f in e){var k=this.stylesSpecificity[f];"undefined"==typeof k&&(k="000");d>k&&(this.styles[f]=e[f],this.stylesSpecificity[f]=d)}}};var b=/^[A-Z-]+$/,e=function(a){return b.test(a)?
a.toLowerCase():a};if(null!=c&&1==c.nodeType){for(var d=0;d<c.attributes.length;d++){var k=c.attributes[d],f=e(k.nodeName);this.attributes[f]=new a.Property(f,k.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue())for(e=this.attribute("style").value.split(";"),d=0;d<e.length;d++)""!=a.trim(e[d])&&(f=e[d].split(":"),k=a.trim(f[0]),f=a.trim(f[1]),this.styles[k]=new a.Property(k,f));this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=
this);for(d=0;d<c.childNodes.length;d++)e=c.childNodes[d],1==e.nodeType&&this.addChild(e,!0),!this.captureTextNodes||3!=e.nodeType&&4!=e.nodeType||""!=a.compressSpaces(e.value||e.text||e.textContent||"")&&this.addChild(new a.Element.tspan(e),!1)}};a.Element.RenderedElementBase=function(c){this.base=a.Element.ElementBase;this.base(c);this.setContext=function(b){if(this.style("fill").isUrlDefinition()){var e=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=e&&(b.fillStyle=
e)}else this.style("fill").hasValue()&&(e=this.style("fill"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.fillStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("fill-opacity").hasValue()&&(e=new a.Property("fill",b.fillStyle),e=e.addOpacity(this.style("fill-opacity")),b.fillStyle=e.value);this.style("stroke").isUrlDefinition()?(e=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")),null!=e&&(b.strokeStyle=e)):this.style("stroke").hasValue()&&
(e=this.style("stroke"),"currentColor"==e.value&&(e.value=this.style("color").value),"inherit"!=e.value&&(b.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value));this.style("stroke-opacity").hasValue()&&(e=new a.Property("stroke",b.strokeStyle),e=e.addOpacity(this.style("stroke-opacity")),b.strokeStyle=e.value);this.style("stroke-width").hasValue()&&(e=this.style("stroke-width").toPixels(),b.lineWidth=0==e?.001:e);this.style("stroke-linecap").hasValue()&&(b.lineCap=this.style("stroke-linecap").value);
this.style("stroke-linejoin").hasValue()&&(b.lineJoin=this.style("stroke-linejoin").value);this.style("stroke-miterlimit").hasValue()&&(b.miterLimit=this.style("stroke-miterlimit").value);this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value&&(e=a.ToNumberArray(this.style("stroke-dasharray").value),"undefined"!=typeof b.setLineDash?b.setLineDash(e):"undefined"!=typeof b.webkitLineDash?b.webkitLineDash=e:"undefined"==typeof b.mozDash||1==e.length&&0==e[0]||(b.mozDash=
e),e=this.style("stroke-dashoffset").numValueOrDefault(1),"undefined"!=typeof b.lineDashOffset?b.lineDashOffset=e:"undefined"!=typeof b.webkitLineDashOffset?b.webkitLineDashOffset=e:"undefined"!=typeof b.mozDashOffset&&(b.mozDashOffset=e));"undefined"!=typeof b.font&&(b.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString());
this.style("transform",!1,!0).hasValue()&&(new a.Transform(this.style("transform",!1,!0).value)).apply(b);this.style("clip-path",!1,!0).hasValue()&&(e=this.style("clip-path",!1,!0).getDefinition(),null!=e&&e.apply(b));this.style("opacity").hasValue()&&(b.globalAlpha=this.style("opacity").numValue())}};a.Element.RenderedElementBase.prototype=new a.Element.ElementBase;a.Element.PathElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.path=function(b){null!=b&&b.beginPath();
return new a.BoundingBox};this.renderChildren=function(b){this.path(b);a.Mouse.checkPath(this,b);""!=b.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?b.fill(this.style("fill-rule").value):b.fill());""!=b.strokeStyle&&b.stroke();var e=this.getMarkers();if(null!=e){if(this.style("marker-start").isUrlDefinition()){var d=this.style("marker-start").getDefinition();d.render(b,e[0][0],e[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var d=this.style("marker-mid").getDefinition(),
c=1;c<e.length-1;c++)d.render(b,e[c][0],e[c][1]);this.style("marker-end").isUrlDefinition()&&(d=this.style("marker-end").getDefinition(),d.render(b,e[e.length-1][0],e[e.length-1][1]))}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase;a.Element.svg=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseClearContext=this.clearContext;this.clearContext=function(b){this.baseClearContext(b);
a.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(b){b.strokeStyle="rgba(0,0,0,0)";b.lineCap="butt";b.lineJoin="miter";b.miterLimit=4;"undefined"!=typeof b.font&&"undefined"!=typeof window.getComputedStyle&&(b.font=window.getComputedStyle(b.canvas).getPropertyValue("font"));this.baseSetContext(b);this.attribute("x").hasValue()||(this.attribute("x",!0).value=0);this.attribute("y").hasValue()||(this.attribute("y",!0).value=0);b.translate(this.attribute("x").toPixels("x"),
this.attribute("y").toPixels("y"));var e=a.ViewPort.width(),d=a.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%");this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%");if("undefined"==typeof this.root){var e=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y"),c=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(c=-this.attribute("refX").toPixels("x"),f=-this.attribute("refY").toPixels("y"));
"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(b.beginPath(),b.moveTo(c,f),b.lineTo(e,f),b.lineTo(e,d),b.lineTo(c,d),b.closePath(),b.clip())}a.ViewPort.SetCurrent(e,d);if(this.attribute("viewBox").hasValue()){var c=a.ToNumberArray(this.attribute("viewBox").value),f=c[0],g=c[1],e=c[2],d=c[3];a.AspectRatio(b,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),e,a.ViewPort.height(),d,f,g,this.attribute("refX").value,this.attribute("refY").value);a.ViewPort.RemoveCurrent();
a.ViewPort.SetCurrent(c[2],c[3])}}};a.Element.svg.prototype=new a.Element.RenderedElementBase;a.Element.rect=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),c=this.attribute("width").toPixels("x"),f=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),n=this.attribute("ry").toPixels("y");this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(n=g);this.attribute("ry").hasValue()&&
!this.attribute("rx").hasValue()&&(g=n);g=Math.min(g,c/2);n=Math.min(n,f/2);null!=b&&(b.beginPath(),b.moveTo(e+g,d),b.lineTo(e+c-g,d),b.quadraticCurveTo(e+c,d,e+c,d+n),b.lineTo(e+c,d+f-n),b.quadraticCurveTo(e+c,d+f,e+c-g,d+f),b.lineTo(e+g,d+f),b.quadraticCurveTo(e,d+f,e,d+f-n),b.lineTo(e,d+n),b.quadraticCurveTo(e,d,e+g,d),b.closePath());return new a.BoundingBox(e,d,e+c,d+f)}};a.Element.rect.prototype=new a.Element.PathElementBase;a.Element.circle=function(c){this.base=a.Element.PathElementBase;this.base(c);
this.path=function(b){var e=this.attribute("cx").toPixels("x"),d=this.attribute("cy").toPixels("y"),c=this.attribute("r").toPixels();null!=b&&(b.beginPath(),b.arc(e,d,c,0,2*Math.PI,!0),b.closePath());return new a.BoundingBox(e-c,d-c,e+c,d+c)}};a.Element.circle.prototype=new a.Element.PathElementBase;a.Element.ellipse=function(c){this.base=a.Element.PathElementBase;this.base(c);this.path=function(b){var e=(Math.sqrt(2)-1)/3*4,d=this.attribute("rx").toPixels("x"),c=this.attribute("ry").toPixels("y"),
f=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");null!=b&&(b.beginPath(),b.moveTo(f,g-c),b.bezierCurveTo(f+e*d,g-c,f+d,g-e*c,f+d,g),b.bezierCurveTo(f+d,g+e*c,f+e*d,g+c,f,g+c),b.bezierCurveTo(f-e*d,g+c,f-d,g+e*c,f-d,g),b.bezierCurveTo(f-d,g-e*c,f-e*d,g-c,f,g-c),b.closePath());return new a.BoundingBox(f-d,g-c,f+d,g+c)}};a.Element.ellipse.prototype=new a.Element.PathElementBase;a.Element.line=function(c){this.base=a.Element.PathElementBase;this.base(c);this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),
this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(b){var e=this.getPoints();null!=b&&(b.beginPath(),b.moveTo(e[0].x,e[0].y),b.lineTo(e[1].x,e[1].y));return new a.BoundingBox(e[0].x,e[0].y,e[1].x,e[1].y)};this.getMarkers=function(){var a=this.getPoints(),e=a[0].angleTo(a[1]);return[[a[0],e],[a[1],e]]}};a.Element.line.prototype=new a.Element.PathElementBase;a.Element.polyline=function(c){this.base=a.Element.PathElementBase;
this.base(c);this.points=a.CreatePath(this.attribute("points").value);this.path=function(b){var e=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=b&&(b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)e.addPoint(this.points[d].x,this.points[d].y),null!=b&&b.lineTo(this.points[d].x,this.points[d].y);return e};this.getMarkers=function(){for(var a=[],e=0;e<this.points.length-1;e++)a.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);
0<a.length&&a.push([this.points[this.points.length-1],a[a.length-1][1]]);return a}};a.Element.polyline.prototype=new a.Element.PathElementBase;a.Element.polygon=function(c){this.base=a.Element.polyline;this.base(c);this.basePath=this.path;this.path=function(a){var e=this.basePath(a);null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath());return e}};a.Element.polygon.prototype=new a.Element.polyline;a.Element.path=function(c){this.base=a.Element.PathElementBase;this.base(c);c=this.attribute("d").value;
c=c.replace(/,/gm," ");for(var b=0;2>b;b++)c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");c=c.replace(/([0-9])([+\-])/gm,"$1 $2");for(b=0;2>b;b++)c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");c=a.compressSpaces(c);c=a.trim(c);this.PathParser=new function(b){this.tokens=b.split(" ");this.reset=function(){this.i=-1;this.previousCommand=this.command="";this.start=new a.Point(0,
0);this.control=new a.Point(0,0);this.current=new a.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)};this.isRelativeCommand=function(){switch(this.command){case "m":case "l":case "h":case "v":case "c":case "s":case "q":case "t":case "a":case "z":return!0}return!1};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};
this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var b=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(b)};this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a};this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a};this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&
"t"!=this.previousCommand.toLowerCase()?this.current:new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)};this.makeAbsolute=function(a){this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y);return a};this.addMarker=function(a,b,e){null!=e&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(e));this.addMarkerAngle(a,null==b?null:b.angleTo(a))};this.addMarkerAngle=function(a,
b){this.points.push(a);this.angles.push(b)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c);this.path=function(b){var d=this.PathParser;d.reset();var c=new a.BoundingBox;for(null!=b&&b.beginPath();!d.isEnd();)switch(d.nextCommand(),d.command){case "M":case "m":var f=d.getAsCurrentPoint();
d.addMarker(f);c.addPoint(f.x,f.y);null!=b&&b.moveTo(f.x,f.y);for(d.start=d.current;!d.isCommandOrEnd();)f=d.getAsCurrentPoint(),d.addMarker(f,d.start),c.addPoint(f.x,f.y),null!=b&&b.lineTo(f.x,f.y);break;case "L":case "l":for(;!d.isCommandOrEnd();){var g=d.current,f=d.getAsCurrentPoint();d.addMarker(f,g);c.addPoint(f.x,f.y);null!=b&&b.lineTo(f.x,f.y)}break;case "H":case "h":for(;!d.isCommandOrEnd();)f=new a.Point((d.isRelativeCommand()?d.current.x:0)+d.getScalar(),d.current.y),d.addMarker(f,d.current),
d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "V":case "v":for(;!d.isCommandOrEnd();)f=new a.Point(d.current.x,(d.isRelativeCommand()?d.current.y:0)+d.getScalar()),d.addMarker(f,d.current),d.current=f,c.addPoint(d.current.x,d.current.y),null!=b&&b.lineTo(d.current.x,d.current.y);break;case "C":case "c":for(;!d.isCommandOrEnd();){var n=d.current,g=d.getPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint();d.addMarker(f,m,g);c.addBezierCurve(n.x,
n.y,g.x,g.y,m.x,m.y,f.x,f.y);null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y)}break;case "S":case "s":for(;!d.isCommandOrEnd();)n=d.current,g=d.getReflectedControlPoint(),m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,g),c.addBezierCurve(n.x,n.y,g.x,g.y,m.x,m.y,f.x,f.y),null!=b&&b.bezierCurveTo(g.x,g.y,m.x,m.y,f.x,f.y);break;case "Q":case "q":for(;!d.isCommandOrEnd();)n=d.current,m=d.getAsControlPoint(),f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,
f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "T":case "t":for(;!d.isCommandOrEnd();)n=d.current,m=d.getReflectedControlPoint(),d.control=m,f=d.getAsCurrentPoint(),d.addMarker(f,m,m),c.addQuadraticCurve(n.x,n.y,m.x,m.y,f.x,f.y),null!=b&&b.quadraticCurveTo(m.x,m.y,f.x,f.y);break;case "A":case "a":for(;!d.isCommandOrEnd();){var n=d.current,v=d.getScalar(),h=d.getScalar(),g=d.getScalar()*(Math.PI/180),l=d.getScalar(),m=d.getScalar(),f=d.getAsCurrentPoint(),q=new a.Point(Math.cos(g)*
(n.x-f.x)/2+Math.sin(g)*(n.y-f.y)/2,-Math.sin(g)*(n.x-f.x)/2+Math.cos(g)*(n.y-f.y)/2),p=Math.pow(q.x,2)/Math.pow(v,2)+Math.pow(q.y,2)/Math.pow(h,2);1<p&&(v*=Math.sqrt(p),h*=Math.sqrt(p));l=(l==m?-1:1)*Math.sqrt((Math.pow(v,2)*Math.pow(h,2)-Math.pow(v,2)*Math.pow(q.y,2)-Math.pow(h,2)*Math.pow(q.x,2))/(Math.pow(v,2)*Math.pow(q.y,2)+Math.pow(h,2)*Math.pow(q.x,2)));isNaN(l)&&(l=0);var r=new a.Point(l*v*q.y/h,l*-h*q.x/v),n=new a.Point((n.x+f.x)/2+Math.cos(g)*r.x-Math.sin(g)*r.y,(n.y+f.y)/2+Math.sin(g)*
r.x+Math.cos(g)*r.y),u=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))*Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)))},w=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(u(a,b))},l=w([1,0],[(q.x-r.x)/v,(q.y-r.y)/h]),p=[(q.x-r.x)/v,(q.y-r.y)/h],r=[(-q.x-r.x)/v,(-q.y-r.y)/h],q=w(p,r);-1>=u(p,r)&&(q=Math.PI);1<=u(p,r)&&(q=0);p=1-m?1:-1;r=l+q/2*p;w=new a.Point(n.x+v*Math.cos(r),n.y+h*Math.sin(r));d.addMarkerAngle(w,r-p*Math.PI/2);d.addMarkerAngle(f,r-p*Math.PI);
c.addPoint(f.x,f.y);null!=b&&(u=v>h?v:h,f=v>h?1:v/h,v=v>h?h/v:1,b.translate(n.x,n.y),b.rotate(g),b.scale(f,v),b.arc(0,0,u,l,l+q,1-m),b.scale(1/f,1/v),b.rotate(-g),b.translate(-n.x,-n.y))}break;case "Z":case "z":null!=b&&b.closePath(),d.current=d.start}return c};this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],f=0;f<a.length;f++)c.push([a[f],b[f]]);return c}};a.Element.path.prototype=new a.Element.PathElementBase;a.Element.pattern=function(c){this.base=
a.Element.ElementBase;this.base(c);this.createPattern=function(b,e){var d=this.attribute("width").toPixels("x",!0),c=this.attribute("height").toPixels("y",!0),f=new a.Element.svg;f.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);f.attributes.width=new a.Property("width",d+"px");f.attributes.height=new a.Property("height",c+"px");f.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value);f.children=this.children;var g=document.createElement("canvas");
g.width=d;g.height=c;d=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&d.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(c=-1;1>=c;c++)for(var n=-1;1>=n;n++)d.save(),f.attributes.x=new a.Property("x",c*g.width),f.attributes.y=new a.Property("y",n*g.height),f.render(d),d.restore();return b.createPattern(g,"repeat")}};a.Element.pattern.prototype=new a.Element.ElementBase;a.Element.marker=function(c){this.base=a.Element.ElementBase;
this.base(c);this.baseRender=this.render;this.render=function(b,e,d){b.translate(e.x,e.y);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(d);"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(b.lineWidth,b.lineWidth);b.save();var c=new a.Element.svg;c.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value);c.attributes.refX=new a.Property("refX",this.attribute("refX").value);c.attributes.refY=new a.Property("refY",this.attribute("refY").value);
c.attributes.width=new a.Property("width",this.attribute("markerWidth").value);c.attributes.height=new a.Property("height",this.attribute("markerHeight").value);c.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black"));c.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none"));c.children=this.children;var f=0,g=0;this.attribute("refX").hasValue()&&(f=-parseFloat(this.attribute("refX").value));this.attribute("refY").hasValue()&&(g=-parseFloat(this.attribute("refY").value));
b.translate(f,g);c.render(b);b.restore();"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(1/b.lineWidth,1/b.lineWidth);"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(-d);b.translate(-e.x,-e.y)}};a.Element.marker.prototype=new a.Element.ElementBase;a.Element.defs=function(c){this.base=a.Element.ElementBase;this.base(c);this.render=function(a){}};a.Element.defs.prototype=new a.Element.ElementBase;a.Element.GradientBase=function(c){this.base=a.Element.ElementBase;
this.base(c);this.stops=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"stop"==b.type&&this.stops.push(b)}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(a){for(var b=0;b<this.attributesToInherit.length;b++){var c=this.attributesToInherit[b];!this.attribute(c).hasValue()&&a.attribute(c).hasValue()&&(this.attribute(c,!0).value=
a.attribute(c).value)}};this.createGradient=function(b,d,c){var f=this;this.getHrefAttribute().hasValue()&&(f=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(f));var g=function(b){return c.hasValue()?(new a.Property("color",b)).addOpacity(c).value:b};b=this.getGradient(b,d);if(null==b)return g(f.stops[f.stops.length-1].color);for(d=0;d<f.stops.length;d++)b.addColorStop(f.stops[d].offset,g(f.stops[d].color));return this.attribute("gradientTransform").hasValue()?(f=a.ViewPort.viewPorts[0],
g=new a.Element.rect,g.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),g.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),g.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS),d=new a.Element.g,d.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),d.children=[g],g=new a.Element.svg,g.attributes.x=new a.Property("x",0),g.attributes.y=new a.Property("y",0),g.attributes.width=
new a.Property("width",f.width),g.attributes.height=new a.Property("height",f.height),g.children=[d],d=document.createElement("canvas"),d.width=f.width,d.height=f.height,f=d.getContext("2d"),f.fillStyle=b,g.render(f),f.createPattern(d,"no-repeat")):b}};a.Element.GradientBase.prototype=new a.Element.ElementBase;a.Element.linearGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");
this.attributesToInherit.push("y2");this.getGradient=function(a,e){var c="objectBoundingBox"==this.gradientUnits()?e.getBoundingBox():null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var k="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),
f="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),g="objectBoundingBox"==this.gradientUnits()?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),c="objectBoundingBox"==this.gradientUnits()?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return k==g&&f==c?null:a.createLinearGradient(k,f,g,c)}};a.Element.linearGradient.prototype=new a.Element.GradientBase;
a.Element.radialGradient=function(c){this.base=a.Element.GradientBase;this.base(c);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(a,c){var d=c.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%");this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%");this.attribute("r").hasValue()||(this.attribute("r",
!0).value="50%");var k="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),f="objectBoundingBox"==this.gradientUnits()?d.y()+d.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),g=k,n=f;this.attribute("fx").hasValue()&&(g="objectBoundingBox"==this.gradientUnits()?d.x()+d.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"));this.attribute("fy").hasValue()&&(n="objectBoundingBox"==
this.gradientUnits()?d.y()+d.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));d="objectBoundingBox"==this.gradientUnits()?(d.width()+d.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(g,n,0,k,f,d)}};a.Element.radialGradient.prototype=new a.Element.GradientBase;a.Element.stop=function(c){this.base=a.Element.ElementBase;this.base(c);this.offset=this.attribute("offset").numValue();0>this.offset&&(this.offset=0);1<this.offset&&
(this.offset=1);c=this.style("stop-color",!0);""===c.value&&(c.value="#000");this.style("stop-opacity").hasValue()&&(c=c.addOpacity(this.style("stop-opacity")));this.color=c.value};a.Element.stop.prototype=new a.Element.ElementBase;a.Element.AnimateBase=function(c){this.base=a.Element.ElementBase;this.base(c);a.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var a=
this.attribute("attributeType").value,c=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(c,!0):this.parent.attribute(c,!0)};this.initialValue=null;this.initialUnits="";this.removed=!1;this.calcValue=function(){return""};this.update=function(a){null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits());if(this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=
0;else if("freeze"==this.attribute("fill").valueOrDefault("remove")&&!this.frozen)this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;else if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0;return!1}this.duration+=a;a=!1;this.begin<this.duration&&(a=this.calcValue(),this.attribute("type").hasValue()&&
(a=this.attribute("type").value+"("+a+")"),this.getProperty().value=a,a=!0);return a};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");this.values.hasValue()&&(this.values.value=this.values.value.split(";"));this.progress=function(){var b={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var c=b.progress*(this.values.value.length-1),d=Math.floor(c),k=Math.ceil(c);b.from=new a.Property("from",parseFloat(this.values.value[d]));
b.to=new a.Property("to",parseFloat(this.values.value[k]));b.progress=(c-d)/(k-d)}else b.from=this.from,b.to=this.to;return b}};a.Element.AnimateBase.prototype=new a.Element.ElementBase;a.Element.animate=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){var a=this.progress();return a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress+this.initialUnits}};a.Element.animate.prototype=new a.Element.AnimateBase;a.Element.animateColor=function(c){this.base=a.Element.AnimateBase;
this.base(c);this.calcValue=function(){var a=this.progress(),c=new A(a.from.value),d=new A(a.to.value);if(c.ok&&d.ok){var k=c.g+(d.g-c.g)*a.progress,f=c.b+(d.b-c.b)*a.progress;return"rgb("+parseInt(c.r+(d.r-c.r)*a.progress,10)+","+parseInt(k,10)+","+parseInt(f,10)+")"}return this.attribute("from").value}};a.Element.animateColor.prototype=new a.Element.AnimateBase;a.Element.animateTransform=function(c){this.base=a.Element.AnimateBase;this.base(c);this.calcValue=function(){for(var b=this.progress(),
c=a.ToNumberArray(b.from.value),d=a.ToNumberArray(b.to.value),k="",f=0;f<c.length;f++)k+=c[f]+(d[f]-c[f])*b.progress+" ";return k}};a.Element.animateTransform.prototype=new a.Element.animate;a.Element.font=function(c){this.base=a.Element.ElementBase;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isArabic=this.isRTL=!1;this.missingGlyph=this.fontFace=null;this.glyphs=[];for(c=0;c<this.children.length;c++){var b=this.children[c];"font-face"==b.type?(this.fontFace=b,b.style("font-family").hasValue()&&
(a.Definitions[b.style("font-family").value]=this)):"missing-glyph"==b.type?this.missingGlyph=b:"glyph"==b.type&&(""!=b.arabicForm?(this.isArabic=this.isRTL=!0,"undefined"==typeof this.glyphs[b.unicode]&&(this.glyphs[b.unicode]=[]),this.glyphs[b.unicode][b.arabicForm]=b):this.glyphs[b.unicode]=b)}};a.Element.font.prototype=new a.Element.ElementBase;a.Element.fontface=function(c){this.base=a.Element.ElementBase;this.base(c);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;
this.unitsPerEm=this.attribute("units-per-em").numValue()};a.Element.fontface.prototype=new a.Element.ElementBase;a.Element.missingglyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=0};a.Element.missingglyph.prototype=new a.Element.path;a.Element.glyph=function(c){this.base=a.Element.path;this.base(c);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};a.Element.glyph.prototype=
new a.Element.path;a.Element.text=function(c){this.captureTextNodes=!0;this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);var c=this.style("dominant-baseline").toTextBaseline();null==c&&(c=this.style("alignment-baseline").toTextBaseline());null!=c&&(a.textBaseline=c)};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);
return new a.BoundingBox(b,c-d,b+Math.floor(2*d/3)*this.children[0].getText().length,c)};this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x"));this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y"));this.x+=this.getAnchorDelta(a,this,0);for(var c=0;c<this.children.length;c++)this.renderChild(a,this,this,c)};this.getAnchorDelta=function(a,c,
d){var k=this.style("text-anchor").valueOrDefault("start");if("start"!=k){for(var f=0,g=d;g<c.children.length;g++){var n=c.children[g];if(g>d&&n.attribute("x").hasValue())break;f+=n.measureTextRecursive(a)}return-1*("end"==k?f:f/2)}return 0};this.renderChild=function(a,c,d,k){var f=d.children[k];f.attribute("x").hasValue()?(f.x=f.attribute("x").toPixels("x")+c.getAnchorDelta(a,d,k),f.attribute("dx").hasValue()&&(f.x+=f.attribute("dx").toPixels("x"))):(f.attribute("dx").hasValue()&&(c.x+=f.attribute("dx").toPixels("x")),
f.x=c.x);c.x=f.x+f.measureText(a);f.attribute("y").hasValue()?(f.y=f.attribute("y").toPixels("y"),f.attribute("dy").hasValue()&&(f.y+=f.attribute("dy").toPixels("y"))):(f.attribute("dy").hasValue()&&(c.y+=f.attribute("dy").toPixels("y")),f.y=c.y);c.y=f.y;f.render(a);for(k=0;k<f.children.length;k++)c.renderChild(a,c,f,k)}};a.Element.text.prototype=new a.Element.RenderedElementBase;a.Element.TextElementBase=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getGlyph=function(a,c,
d){var k=c[d],f=null;if(a.isArabic){var g="isolated";(0==d||" "==c[d-1])&&d<c.length-2&&" "!=c[d+1]&&(g="terminal");0<d&&" "!=c[d-1]&&d<c.length-2&&" "!=c[d+1]&&(g="medial");0<d&&" "!=c[d-1]&&(d==c.length-1||" "==c[d+1])&&(g="initial");"undefined"!=typeof a.glyphs[k]&&(f=a.glyphs[k][g],null==f&&"glyph"==a.glyphs[k].type&&(f=a.glyphs[k]))}else f=a.glyphs[k];null==f&&(f=a.missingGlyph);return f};this.renderChildren=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){var d=
this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),k=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),n=0;n<f.length;n++){var m=this.getGlyph(c,f,n),h=d/c.fontFace.unitsPerEm;b.translate(this.x,this.y);b.scale(h,-h);var l=b.lineWidth;b.lineWidth=b.lineWidth*c.fontFace.unitsPerEm/d;"italic"==k&&b.transform(1,0,.4,
1,0,0);m.render(b);"italic"==k&&b.transform(1,0,-.4,1,0,0);b.lineWidth=l;b.scale(1/h,-1/h);b.translate(-this.x,-this.y);this.x+=d*(m.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm;"undefined"==typeof g[n]||isNaN(g[n])||(this.x+=g[n])}}else""!=b.fillStyle&&b.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=b.strokeStyle&&b.strokeText(a.compressSpaces(this.getText()),this.x,this.y)};this.getText=function(){};this.measureTextRecursive=function(a){for(var c=this.measureText(a),d=0;d<this.children.length;d++)c+=
this.children[d].measureTextRecursive(a);return c};this.measureText=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){b=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize);var d=0,k=this.getText();c.isRTL&&(k=k.split("").reverse().join(""));for(var f=a.ToNumberArray(this.parent.attribute("dx").value),g=0;g<k.length;g++){var n=this.getGlyph(c,k,g),d=d+(n.horizAdvX||c.horizAdvX)*b/c.fontFace.unitsPerEm;"undefined"==typeof f[g]||isNaN(f[g])||
(d+=f[g])}return d}c=a.compressSpaces(this.getText());if(!b.measureText)return 10*c.length;b.save();this.setContext(b);c=b.measureText(c).width;b.restore();return c}};a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase;a.Element.tspan=function(c){this.captureTextNodes=!0;this.base=a.Element.TextElementBase;this.base(c);this.text=a.compressSpaces(c.value||c.text||c.textContent||"");this.getText=function(){return 0<this.children.length?"":this.text}};a.Element.tspan.prototype=new a.Element.TextElementBase;
a.Element.tref=function(c){this.base=a.Element.TextElementBase;this.base(c);this.getText=function(){var a=this.getHrefAttribute().getDefinition();if(null!=a)return a.children[0].getText()}};a.Element.tref.prototype=new a.Element.TextElementBase;a.Element.a=function(c){this.base=a.Element.TextElementBase;this.base(c);this.hasText=0<c.childNodes.length;for(var b=0;b<c.childNodes.length;b++)3!=c.childNodes[b].nodeType&&(this.hasText=!1);this.text=this.hasText?c.childNodes[0].value:"";this.getText=function(){return this.text};
this.baseRenderChildren=this.renderChildren;this.renderChildren=function(b){if(this.hasText){this.baseRenderChildren(b);var c=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-c.toPixels("y"),this.x+this.measureText(b),this.y))}else 0<this.children.length&&(c=new a.Element.g,c.children=this.children,c.parent=this,c.render(b))};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){a.ctx.canvas.style.cursor=
"pointer"}};a.Element.a.prototype=new a.Element.TextElementBase;a.Element.image=function(c){this.base=a.Element.RenderedElementBase;this.base(c);var b=this.getHrefAttribute().value;if(""!=b){var e=b.match(/\.svg$/);a.Images.push(this);this.loaded=!1;if(e)this.img=a.ajax(b),this.loaded=!0;else{this.img=document.createElement("img");1==a.opts.useCORS&&(this.img.crossOrigin="Anonymous");var d=this;this.img.onload=function(){d.loaded=!0};this.img.onerror=function(){a.log('ERROR: image "'+b+'" not found');
d.loaded=!0};this.img.src=b}this.renderChildren=function(b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),m=this.attribute("height").toPixels("y");0!=n&&0!=m&&(b.save(),e?b.drawSvg(this.img,c,d,n,m):(b.translate(c,d),a.AspectRatio(b,this.attribute("preserveAspectRatio").value,n,this.img.width,m,this.img.height,0,0),b.drawImage(this.img,0,0)),b.restore())};this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=
this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y");return new a.BoundingBox(b,c,b+d,c+e)}}};a.Element.image.prototype=new a.Element.RenderedElementBase;a.Element.g=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.getBoundingBox=function(){for(var b=new a.BoundingBox,c=0;c<this.children.length;c++)b.addBoundingBox(this.children[c].getBoundingBox());return b}};a.Element.g.prototype=new a.Element.RenderedElementBase;
a.Element.symbol=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.render=function(a){}};a.Element.symbol.prototype=new a.Element.RenderedElementBase;a.Element.style=function(c){this.base=a.Element.ElementBase;this.base(c);for(var b="",e=0;e<c.childNodes.length;e++)b+=c.childNodes[e].data;b=b.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");b=a.compressSpaces(b);c=b.split("}");for(e=0;e<c.length;e++)if(""!=a.trim(c[e]))for(var d=c[e].split("{"),b=d[0].split(","),
d=d[1].split(";"),k=0;k<b.length;k++){var f=a.trim(b[k]);if(""!=f){for(var g=a.Styles[f]||{},n=0;n<d.length;n++){var m=d[n].indexOf(":"),h=d[n].substr(0,m),m=d[n].substr(m+1,d[n].length-m);null!=h&&null!=m&&(g[a.trim(h)]=new a.Property(a.trim(h),a.trim(m)))}a.Styles[f]=g;a.StylesSpecificity[f]=K(f);if("@font-face"==f)for(f=g["font-family"].value.replace(/"/g,""),g=g.src.value.split(","),n=0;n<g.length;n++)if(0<g[n].indexOf('format("svg")'))for(h=g[n].indexOf("url"),m=g[n].indexOf(")",h),h=g[n].substr(h+
5,m-h-6),h=a.parseXml(a.ajax(h)).getElementsByTagName("font"),m=0;m<h.length;m++){var l=a.CreateElement(h[m]);a.Definitions[f]=l}}}};a.Element.style.prototype=new a.Element.ElementBase;a.Element.use=function(c){this.base=a.Element.RenderedElementBase;this.base(c);this.baseSetContext=this.setContext;this.setContext=function(a){this.baseSetContext(a);this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0);this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))};
var b=this.getHrefAttribute().getDefinition();this.path=function(a){null!=b&&b.path(a)};this.getBoundingBox=function(){if(null!=b)return b.getBoundingBox()};this.renderChildren=function(c){if(null!=b){var d=b;"symbol"==b.type&&(d=new a.Element.svg,d.type="svg",d.attributes.viewBox=new a.Property("viewBox",b.attribute("viewBox").value),d.attributes.preserveAspectRatio=new a.Property("preserveAspectRatio",b.attribute("preserveAspectRatio").value),d.attributes.overflow=new a.Property("overflow",b.attribute("overflow").value),
d.children=b.children);"svg"==d.type&&(this.attribute("width").hasValue()&&(d.attributes.width=new a.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(d.attributes.height=new a.Property("height",this.attribute("height").value)));var k=d.parent;d.parent=null;d.render(c);d.parent=k}}};a.Element.use.prototype=new a.Element.RenderedElementBase;a.Element.mask=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b,c){var d=this.attribute("x").toPixels("x"),
k=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==f&&0==g){g=new a.BoundingBox;for(d=0;d<this.children.length;d++)g.addBoundingBox(this.children[d].getBoundingBox());d=Math.floor(g.x1);k=Math.floor(g.y1);f=Math.floor(g.width());g=Math.floor(g.height())}var n=c.attribute("mask").value;c.attribute("mask").value="";var m=document.createElement("canvas");m.width=d+f;m.height=k+g;var h=m.getContext("2d");this.renderChildren(h);var l=
document.createElement("canvas");l.width=d+f;l.height=k+g;var p=l.getContext("2d");c.render(p);p.globalCompositeOperation="destination-in";p.fillStyle=h.createPattern(m,"no-repeat");p.fillRect(0,0,d+f,k+g);b.fillStyle=p.createPattern(l,"no-repeat");b.fillRect(0,0,d+f,k+g);c.attribute("mask").value=n};this.render=function(a){}};a.Element.mask.prototype=new a.Element.ElementBase;a.Element.clipPath=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(b){var c=CanvasRenderingContext2D.prototype.beginPath;
CanvasRenderingContext2D.prototype.beginPath=function(){};var d=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};c.call(b);for(var k=0;k<this.children.length;k++){var f=this.children[k];if("undefined"!=typeof f.path){var g=null;f.style("transform",!1,!0).hasValue()&&(g=new a.Transform(f.style("transform",!1,!0).value),g.apply(b));f.path(b);CanvasRenderingContext2D.prototype.closePath=d;g&&g.unapply(b)}}d.call(b);b.clip();CanvasRenderingContext2D.prototype.beginPath=
c;CanvasRenderingContext2D.prototype.closePath=d};this.render=function(a){}};a.Element.clipPath.prototype=new a.Element.ElementBase;a.Element.filter=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c){var d=c.getBoundingBox(),k=Math.floor(d.x1),f=Math.floor(d.y1),g=Math.floor(d.width()),d=Math.floor(d.height()),n=c.style("filter").value;c.style("filter").value="";for(var m=0,h=0,l=0;l<this.children.length;l++)var p=this.children[l].extraFilterDistance||0,m=Math.max(m,
p),h=Math.max(h,p);p=document.createElement("canvas");p.width=g+2*m;p.height=d+2*h;var q=p.getContext("2d");q.translate(-k+m,-f+h);c.render(q);for(l=0;l<this.children.length;l++)"function"==typeof this.children[l].apply&&this.children[l].apply(q,0,0,g+2*m,d+2*h);a.drawImage(p,0,0,g+2*m,d+2*h,k-m,f-h,g+2*m,d+2*h);c.style("filter",!0).value=n};this.render=function(a){}};a.Element.filter.prototype=new a.Element.ElementBase;a.Element.feMorphology=function(c){this.base=a.Element.ElementBase;this.base(c);
this.apply=function(a,c,d,k,f){}};a.Element.feMorphology.prototype=new a.Element.ElementBase;a.Element.feComposite=function(c){this.base=a.Element.ElementBase;this.base(c);this.apply=function(a,c,d,k,f){}};a.Element.feComposite.prototype=new a.Element.ElementBase;a.Element.feColorMatrix=function(c){function b(a,b){var c=e[a];return c*(0>c?b-255:b)}this.base=a.Element.ElementBase;this.base(c);var e=a.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case "saturate":c=
e[0];e=[.213+.787*c,.715-.715*c,.072-.072*c,0,0,.213-.213*c,.715+.285*c,.072-.072*c,0,0,.213-.213*c,.715-.715*c,.072+.928*c,0,0,0,0,0,1,0,0,0,0,0,1];break;case "hueRotate":var d=e[0]*Math.PI/180;c=function(a,b,c){return a+Math.cos(d)*b+Math.sin(d)*c};e=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case "luminanceToAlpha":e=[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}this.apply=function(a,c,d,e,h){var l=a.getImageData(0,0,e,h);for(d=0;d<h;d++)for(c=0;c<e;c++){var p=l.data[d*e*4+4*c+0],u=l.data[d*e*4+4*c+1],q=l.data[d*e*4+4*c+2],w=l.data[d*e*4+4*c+3],r=b(0,p)+b(1,u)+b(2,q)+b(3,w)+b(4,1);l.data[d*e*4+4*c+0]=r;r=b(5,p)+b(6,u)+b(7,q)+b(8,w)+b(9,1);l.data[d*e*4+4*c+1]=r;r=b(10,p)+b(11,u)+b(12,q)+b(13,w)+b(14,1);l.data[d*e*4+4*c+2]=r;p=b(15,p)+b(16,u)+b(17,q)+b(18,w)+b(19,1);l.data[d*e*4+4*c+3]=p}a.clearRect(0,0,
e,h);a.putImageData(l,0,0)}};a.Element.feColorMatrix.prototype=new a.Element.ElementBase;a.Element.feGaussianBlur=function(c){this.base=a.Element.ElementBase;this.base(c);this.extraFilterDistance=this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.apply=function(b,c,d,k,f){"undefined"==typeof E.canvasRGBA?a.log("ERROR: StackBlur.js must be included for blur to work"):(b.canvas.id=a.UniqueId(),b.canvas.style.display="none",document.body.appendChild(b.canvas),E.canvasRGBA(b.canvas.id,
c,d,k,f,this.blurRadius),document.body.removeChild(b.canvas))}};a.Element.feGaussianBlur.prototype=new a.Element.ElementBase;a.Element.title=function(a){};a.Element.title.prototype=new a.Element.ElementBase;a.Element.desc=function(a){};a.Element.desc.prototype=new a.Element.ElementBase;a.Element.MISSING=function(c){a.log("ERROR: Element '"+c.nodeName+"' not yet implemented.")};a.Element.MISSING.prototype=new a.Element.ElementBase;a.CreateElement=function(c){var b=c.nodeName.replace(/^[^:]+:/,""),
b=b.replace(/\-/g,""),b="undefined"!=typeof a.Element[b]?new a.Element[b](c):new a.Element.MISSING(c);b.type=c.nodeName;return b};a.load=function(c,b){a.loadXml(c,a.ajax(b))};a.loadXml=function(c,b){a.loadXmlDoc(c,a.parseXml(b))};a.loadXmlDoc=function(c,b){a.init(c);var e=function(a){for(var b=c.canvas;b;)a.x-=b.offsetLeft,a.y-=b.offsetTop,b=b.offsetParent;window.scrollX&&(a.x+=window.scrollX);window.scrollY&&(a.y+=window.scrollY);return a};1!=a.opts.ignoreMouse&&(c.canvas.onclick=function(b){b=e(new a.Point(null!=
b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onclick(b.x,b.y)},c.canvas.onmousemove=function(b){b=e(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onmousemove(b.x,b.y)});var d=a.CreateElement(b.documentElement);d.root=!0;d.addStylesFromStyleDefinition();var k=!0,f=function(){a.ViewPort.Clear();c.canvas.parentNode&&a.ViewPort.SetCurrent(c.canvas.parentNode.clientWidth,c.canvas.parentNode.clientHeight);1!=a.opts.ignoreDimensions&&(d.style("width").hasValue()&&
(c.canvas.width=d.style("width").toPixels("x"),c.canvas.style.width=c.canvas.width+"px"),d.style("height").hasValue()&&(c.canvas.height=d.style("height").toPixels("y"),c.canvas.style.height=c.canvas.height+"px"));var e=c.canvas.clientWidth||c.canvas.width,f=c.canvas.clientHeight||c.canvas.height;1==a.opts.ignoreDimensions&&d.style("width").hasValue()&&d.style("height").hasValue()&&(e=d.style("width").toPixels("x"),f=d.style("height").toPixels("y"));a.ViewPort.SetCurrent(e,f);null!=a.opts.offsetX&&
(d.attribute("x",!0).value=a.opts.offsetX);null!=a.opts.offsetY&&(d.attribute("y",!0).value=a.opts.offsetY);if(null!=a.opts.scaleWidth||null!=a.opts.scaleHeight){var g=null,h=null,l=a.ToNumberArray(d.attribute("viewBox").value);null!=a.opts.scaleWidth&&(d.attribute("width").hasValue()?g=d.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(l[2])||(g=l[2]/a.opts.scaleWidth));null!=a.opts.scaleHeight&&(d.attribute("height").hasValue()?h=d.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(l[3])||
(h=l[3]/a.opts.scaleHeight));null==g&&(g=h);null==h&&(h=g);d.attribute("width",!0).value=a.opts.scaleWidth;d.attribute("height",!0).value=a.opts.scaleHeight;d.style("transform",!0,!0).value+=" scale("+1/g+","+1/h+")"}1!=a.opts.ignoreClear&&c.clearRect(0,0,e,f);d.render(c);k&&(k=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(b))},g=!0;a.ImagesLoaded()&&(g=!1,f());a.intervalID=setInterval(function(){var b=!1;g&&a.ImagesLoaded()&&(g=!1,b=!0);1!=a.opts.ignoreMouse&&(b|=a.Mouse.hasEvents());
if(1!=a.opts.ignoreAnimation)for(var c=0;c<a.Animations.length;c++)b|=a.Animations[c].update(1E3/a.FRAMERATE);"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(b=!0);b&&(f(),a.Mouse.runEvents())},1E3/a.FRAMERATE)};a.stop=function(){a.intervalID&&clearInterval(a.intervalID)};a.Mouse=new function(){this.events=[];this.hasEvents=function(){return 0!=this.events.length};this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){if(a.onclick)a.onclick()}})};this.onmousemove=
function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){if(a.onmousemove)a.onmousemove()}})};this.eventElements=[];this.checkPath=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[e]=a)}};this.checkBoundingBox=function(a,b){for(var e=0;e<this.events.length;e++){var d=this.events[e];b.isPointInBox(d.x,d.y)&&(this.eventElements[e]=a)}};this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var c=
0;c<this.events.length;c++)for(var b=this.events[c],e=this.eventElements[c];e;)b.run(e),e=e.parent;this.events=[];this.eventElements=[]}};return a}var O=function(h,a,l){if(null==h&&null==a&&null==l)for(a=document.querySelectorAll("svg"),h=0;h<a.length;h++){l=a[h];var c=document.createElement("canvas");c.width=l.clientWidth;c.height=l.clientHeight;l.parentNode.insertBefore(c,l);l.parentNode.removeChild(l);var b=document.createElement("div");b.appendChild(l);O(c,b.innerHTML)}else{"string"==typeof h&&
(h=document.getElementById(h));null!=h.svg&&h.svg.stop();l=X(l||{});if(1!=h.childNodes.length||"OBJECT"!=h.childNodes[0].nodeName)h.svg=l;h=h.getContext("2d");"undefined"!=typeof a.documentElement?l.loadXmlDoc(h,a):"<"==a.substr(0,1)?l.loadXml(h,a):l.load(h,a)}},L;if("undefined"!=typeof Element.prototype.matches)L=function(h,a){return h.matches(a)};else if("undefined"!=typeof Element.prototype.webkitMatchesSelector)L=function(h,a){return h.webkitMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.mozMatchesSelector)L=
function(h,a){return h.mozMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.msMatchesSelector)L=function(h,a){return h.msMatchesSelector(a)};else if("undefined"!=typeof Element.prototype.oMatchesSelector)L=function(h,a){return h.oMatchesSelector(a)};else{if("function"===typeof jQuery||"function"===typeof Zepto)L=function(h,a){return $(h).is(a)};"undefined"===typeof L&&(L=Sizzle.matchesSelector)}var W=/(\[[^\]]+\])/g,M=/(#[^\s\+>~\.\[:]+)/g,u=/(\.[^\s\+>~\.\[:]+)/g,B=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,
p=/(:[\w-]+\([^\)]*\))/gi,C=/(:[^\s\+>~\.\[:]+)/g,w=/([^\s\+>~\.\[:]+)/g;"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(h,a,l,c,b,e){a={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:a,offsetY:l,scaleWidth:c,scaleHeight:b};for(var d in e)e.hasOwnProperty(d)&&(a[d]=e[d]);O(this.canvas,h,a)});return O});

/*!

JSZip v3.1.5 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=a("./utils"),e=a("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o="string"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join("")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0,m="data:";if(a.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");var n=3*a.length/4;if(a.charAt(a.length-1)===f.charAt(64)&&n--,a.charAt(a.length-2)===f.charAt(64)&&n--,n%1!==0)throw new Error("Invalid base64 input, bad content length.");var o;for(o=e.uint8array?new Uint8Array(0|n):new Array(0|n);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,o[l++]=b,64!==i&&(o[l++]=c),64!==j&&(o[l++]=d);return o}},{"./support":30,"./utils":32}],2:[function(a,b,c){"use strict";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a("./external"),f=a("./stream/DataWorker"),g=a("./stream/DataLengthProbe"),h=a("./stream/Crc32Probe"),g=a("./stream/DataLengthProbe");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),b=this;return a.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g("uncompressedSize")).pipe(b.compressWorker(c)).pipe(new g("compressedSize")).withStreamInfo("compression",b)},b.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(a,b,c){"use strict";var d=a("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(a){return new d("STORE compression")},uncompressWorker:function(){return new d("STORE decompression")}},c.DEFLATE=a("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a("./utils"),h=d();b.exports=function(a,b){if("undefined"==typeof a||!a.length)return 0;var c="string"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{"./utils":32}],5:[function(a,b,c){"use strict";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){"use strict";var d=null;d="undefined"!=typeof Promise?Promise:a("lie"),b.exports={Promise:d}},{lie:58}],7:[function(a,b,c){"use strict";function d(a,b){h.call(this,"FlateWorker/"+a),this._pako=null,this._pakoAction=a,this._pakoOptions=b,this.meta={}}var e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,f=a("pako"),g=a("./utils"),h=a("./stream/GenericWorker"),i=e?"uint8array":"array";c.magic="\b\0",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,null===this._pako&&this._createPako(),this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var a=this;this._pako.onData=function(b){a.push({data:b,meta:a.meta})}},c.compressWorker=function(a){return new d("Deflate",a)},c.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(a,b,c){"use strict";function d(a,b,c,d){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a("../utils"),f=a("../stream/GenericWorker"),g=a("../utf8"),h=a("../crc32"),i=a("../signature"),j=function(a,b){var c,d="";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo("string",m(p.name)),t=e.transformTo("string",g.utf8encode(p.name)),u=p.comment,v=e.transformTo("string",m(u)),w=e.transformTo("string",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z="",A="",B="",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),"UNIX"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+="up"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+="uc"+j(B.length,2)+B);var I="";I+="\n\0",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+"\0\0\0\0"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g="",h=e.transformTo("string",f(d));return g=i.CENTRAL_DIRECTORY_END+"\0\0\0\0"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b="";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){var c=m(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=m(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),b)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on("error",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(a,b,c){"use strict";var d=a("../compressions"),e=a("./ZipFileWorker"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+" is not a valid compression method !");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(h){d.error(h)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(a,b,c){"use strict";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var a=new d;for(var b in this)"function"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a("./object"),d.prototype.loadAsync=a("./load"),d.support=a("./support"),d.defaults=a("./defaults"),d.version="3.1.5",d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a("./external"),b.exports=d},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(a,b,c){"use strict";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}var e=a("./utils"),f=a("./external"),g=a("./utf8"),e=a("./utils"),h=a("./zipEntries"),i=a("./stream/Crc32Probe"),j=a("./nodejsUtils");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):e.prepareContent("the loaded zip file",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(a,b,c){"use strict";function d(a,b){f.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(b)}var e=a("../utils"),f=a("../stream/GenericWorker");e.inherits(d,f),d.prototype._bindStream=function(a){var b=this;this._stream=a,a.pause(),a.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},d.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},b.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(a,b,c){"use strict";function d(a,b,c){e.call(this,b),this._helper=a;var d=this;a.on("data",function(a,b){d.push(a)||d._helper.pause(),c&&c(b)}).on("error",function(a){d.emit("error",a)}).on("end",function(){d.push(null)})}var e=a("readable-stream").Readable,f=a("../utils");f.inherits(d,e),d.prototype._read=function(){this._helper.resume()},b.exports=d},{"../utils":32,"readable-stream":16}],14:[function(a,b,c){"use strict";b.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(a,b){return new Buffer(a,b)},allocBuffer:function(a){return Buffer.alloc?Buffer.alloc(a):new Buffer(a)},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&"function"==typeof a.on&&"function"==typeof a.pause&&"function"==typeof a.resume}}},{}],15:[function(a,b,c){"use strict";function d(a){return"[object RegExp]"===Object.prototype.toString.call(a)}var e=a("./utf8"),f=a("./utils"),g=a("./stream/GenericWorker"),h=a("./stream/StreamHelper"),i=a("./defaults"),j=a("./compressedObject"),k=a("./zipObject"),l=a("./generate"),m=a("./nodejsUtils"),n=a("./nodejs/NodejsStreamInputAdapter"),o=function(a,b,c){var d,e=f.getTypeOf(b),h=f.extend(c||{},i);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(a=q(a)),h.createFolders&&(d=p(a))&&r.call(this,d,!0);var l="string"===e&&h.binary===!1&&h.base64===!1;c&&"undefined"!=typeof c.binary||(h.binary=!l);var o=b instanceof j&&0===b.uncompressedSize;(o||h.dir||!b||0===b.length)&&(h.base64=!1,h.binary=!0,b="",h.compression="STORE",e="string");var s=null;s=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,h.binary,h.optimizedBinaryString,h.base64);var t=new k(a,s,h);this.files[a]=t},p=function(a){"/"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},q=function(a){return"/"!==a.slice(-1)&&(a+="/"),a},r=function(a,b){return b="undefined"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||("/"!==a.slice(-1)&&(a+="/"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),"binarystring"===c.type&&(c.type="string"),!c.type)throw new Error("No output type specified.");f.checkSupport(c.type),"darwin"!==c.platform&&"freebsd"!==c.platform&&"linux"!==c.platform&&"sunos"!==c.platform||(c.platform="UNIX"),"win32"===c.platform&&(c.platform="DOS");var d=c.comment||this.comment||"";b=l.generateWorker(this,c,d)}catch(i){b=new g("error"),b.error(i)}return new h(b,c.type||"string",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type="nodebuffer"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(a,b,c){b.exports=a("stream")},{stream:void 0}],17:[function(a,b,c){"use strict";function d(a){e.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],18:[function(a,b,c){"use strict";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a("../utils");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo("string",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{"../utils":32}],19:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./Uint8ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./DataReader"),f=a("../utils");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./DataReader":18}],21:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./ArrayReader"),f=a("../utils");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(a,b,c){"use strict";var d=a("../utils"),e=a("../support"),f=a("./ArrayReader"),g=a("./StringReader"),h=a("./NodeBufferReader"),i=a("./Uint8ArrayReader");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),"string"!==b||e.uint8array?"nodebuffer"===b?new h(a):e.uint8array?new i(d.transformTo("uint8array",a)):new f(d.transformTo("array",a)):new g(a)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(a,b,c){"use strict";c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\b"},{}],24:[function(a,b,c){"use strict";function d(a){e.call(this,"ConvertWorker to "+a),this.destType=a}var e=a("./GenericWorker"),f=a("../utils");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(a,b,c){"use strict";function d(){e.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var e=a("./GenericWorker"),f=a("../crc32"),g=a("../utils");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(a,b,c){"use strict";function d(a){f.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}var e=a("../utils"),f=a("./GenericWorker");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(a,b,c){"use strict";function d(a){f.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a("../utils"),f=a("./GenericWorker"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":b=this.data.substring(this.index,c);break;case"uint8array":b=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(a,b,c){"use strict";function d(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on("data",function(a){b.processChunk(a)}),a.on("end",function(){b.end()}),a.on("error",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},b.exports=d},{}],29:[function(a,b,c){"use strict";function d(a,b,c){switch(a){case"blob":return h.newBlob(h.transformTo("arraybuffer",b),c);case"base64":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":for(e=new Uint8Array(f),c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case"nodebuffer":return Buffer.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on("data",function(a,c){g.push(a),b&&b(c)}).on("error",function(a){g=[],f(a)}).on("end",function(){try{var a=d(i,e(h,g),j);c(a)}catch(b){f(b)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(e){this._worker=new j("error"),this._worker.error(e)}}var h=a("../utils"),i=a("./ConvertWorker"),j=a("./GenericWorker"),k=a("../base64"),l=a("../support"),m=a("../external"),n=null;if(l.nodestream)try{n=a("../nodejs/NodejsStreamOutputAdapter")}catch(o){}g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return"data"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new n(this,{objectMode:"nodebuffer"!==this._outputType},a)}},b.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(a,b,c){"use strict";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,c.nodebuffer="undefined"!=typeof Buffer,c.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:"application/zip"}).size}catch(e){try{var f=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,g=new f;g.append(d),c.blob=0===g.getBlob("application/zip").size}catch(e){c.blob=!1}}}try{c.nodestream=!!a("readable-stream").Readable}catch(e){c.nodestream=!1}},{"readable-stream":16}],31:[function(a,b,c){"use strict";function d(){i.call(this,"utf-8 decode"),this.leftOver=null}function e(){i.call(this,"utf-8 encode")}for(var f=a("./utils"),g=a("./support"),h=a("./nodejsUtils"),i=a("./stream/GenericWorker"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBufferFrom(a,"utf-8"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo("nodebuffer",a).toString("utf-8"):(a=f.transformTo(g.uint8array?"uint8array":"array",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?"uint8array":"array",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(a,b,c){"use strict";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if("uint8array"===d?e=n.applyCanBeUsed.uint8array:"nodebuffer"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];
return b}var i=a("./support"),j=a("./base64"),k=a("./nodejsUtils"),l=a("core-js/library/fn/set-immediate"),m=a("./external");c.newBlob=function(a,b){c.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var e=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,f=new e;return f.append(a),f.getBlob(b)}catch(d){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)"array"===b||"nodebuffer"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.allocBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.allocBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBufferFrom(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=""),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return"string"==typeof a?"string":"[object Array]"===Object.prototype.toString.call(a)?"array":i.nodebuffer&&k.isBuffer(a)?"nodebuffer":i.uint8array&&a instanceof Uint8Array?"uint8array":i.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d="";for(c=0;c<(a||"").length;c++)b=a.charCodeAt(c),d+="\\x"+(b<16?"0":"")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&"undefined"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=m.Promise.resolve(b).then(function(a){var b=i.blob&&(a instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(a))!==-1);return b&&"undefined"!=typeof FileReader?new m.Promise(function(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(a)}):a});return h.then(function(b){var h=c.getTypeOf(b);return h?("arraybuffer"===h?b=c.transformTo("uint8array",b):"string"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error("Can't read the data of '"+a+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(a,b,c){"use strict";function d(a){this.files=[],this.loadOptions=a}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./signature"),h=a("./zipEntry"),i=(a("./utf8"),a("./support"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(b)+", expected "+f.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?"uint8array":"array",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(a,b,c){"use strict";function d(a,b){this.options=a,this.loadOptions=b}var e=a("./reader/readerFor"),f=a("./utils"),g=a("./compressedObject"),h=a("./crc32"),i=a("./utf8"),j=a("./compressions"),k=a("./support"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(b=n(this.compressionMethod),null===b)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(a,b,c){"use strict";var d=a("./stream/StreamHelper"),e=a("./stream/DataWorker"),f=a("./utf8"),g=a("./compressedObject"),h=a("./stream/GenericWorker"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=null,c="string";try{if(!a)throw new Error("No output type specified.");c=a.toLowerCase();var e="string"===c||"text"===c;"binarystring"!==c&&"text"!==c||(c="string"),b=this._decompressWorker();var g=!this._dataBinary;g&&!e&&(b=b.pipe(new f.Utf8EncodeWorker)),!g&&e&&(b=b.pipe(new f.Utf8DecodeWorker))}catch(i){b=new h("error"),b.error(i)}return new d(b,c,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],k=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(a,b,c){a("../modules/web.immediate"),b.exports=a("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(a,b,c){b.exports=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a}},{}],38:[function(a,b,c){var d=a("./_is-object");b.exports=function(a){if(!d(a))throw TypeError(a+" is not an object!");return a}},{"./_is-object":51}],39:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],40:[function(a,b,c){var d=b.exports={version:"2.3.0"};"number"==typeof __e&&(__e=d)},{}],41:[function(a,b,c){var d=a("./_a-function");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{"./_a-function":37}],42:[function(a,b,c){b.exports=!a("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(a,b,c){var d=a("./_is-object"),e=a("./_global").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{"./_global":46,"./_is-object":51}],44:[function(a,b,c){var d=a("./_global"),e=a("./_core"),f=a("./_ctx"),g=a("./_hide"),h="prototype",i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s[h],u=n?d:o?d[b]:(d[b]||{})[h];n&&(c=b);for(j in c)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:c[j],s[j]=n&&"function"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(l):p&&"function"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(b){return!0}}},{}],46:[function(a,b,c){var d=b.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=d)},{}],47:[function(a,b,c){var d=a("./_object-dp"),e=a("./_property-desc");b.exports=a("./_descriptors")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(a,b,c){b.exports=a("./_global").document&&document.documentElement},{"./_global":46}],49:[function(a,b,c){b.exports=!a("./_descriptors")&&!a("./_fails")(function(){return 7!=Object.defineProperty(a("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],51:[function(a,b,c){b.exports=function(a){return"object"==typeof a?null!==a:"function"==typeof a}},{}],52:[function(a,b,c){var d=a("./_an-object"),e=a("./_ie8-dom-define"),f=a("./_to-primitive"),g=Object.defineProperty;c.f=a("./_descriptors")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(h){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],54:[function(a,b,c){var d,e,f,g=a("./_ctx"),h=a("./_invoke"),i=a("./_html"),j=a("./_dom-create"),k=a("./_global"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=0,q={},r="onreadystatechange",s=function(){var a=+this;if(q.hasOwnProperty(a)){var b=q[a];delete q[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return q[++p]=function(){h("function"==typeof a?a:Function(a),b)},d(p),p},n=function(a){delete q[a]},"process"==a("./_cof")(l)?d=function(a){l.nextTick(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+"","*")},k.addEventListener("message",t,!1)):d=r in j("script")?function(a){i.appendChild(j("script"))[r]=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(a,b,c){var d=a("./_is-object");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if("function"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&"function"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(a,b,c){var d=a("./_export"),e=a("./_task");d(d.G+d.B,{setImmediate:e.set,clearImmediate:e.clear})},{"./_export":44,"./_task":54}],57:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(d){c.status="error",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a("immediate"),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype["catch"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{immediate:57}],59:[function(a,b,c){"use strict";var d=a("./lib/utils/common").assign,e=a("./lib/deflate"),f=a("./lib/inflate"),g=a("./lib/zlib/constants"),h={};d(h,e,f,g),b.exports=h},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:""},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e="string"==typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a("./zlib/deflate"),i=a("./utils/common"),j=a("./utils/strings"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,"string"==typeof a?e.input=j.string2buf(a):"[object ArrayBuffer]"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||("string"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:""},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a("./zlib/inflate"),h=a("./utils/common"),i=a("./utils/strings"),j=a("./zlib/constants"),k=a("./zlib/messages"),l=a("./zlib/zstream"),m=a("./zlib/gzheader"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,"string"==typeof a?m.input=i.binstring2buf(a):"[object ArrayBuffer]"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l="string"==typeof p?i.string2buf(p):"[object ArrayBuffer]"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||("string"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(a,b,c){"use strict";var d="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],63:[function(a,b,c){"use strict";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c="",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a("./common"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;j<256;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;c<h;)if(f=a[c++],f<128)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<h;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+i[a[c]]>b?c:b}},{"./common":62}],64:[function(a,b,c){"use strict";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0;
}b.exports=d},{}],65:[function(a,b,c){"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(a,b,c){"use strict";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],67:[function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a("../utils/common"),F=a("./trees"),G=a("./adler32"),H=a("./crc32"),I=a("./messages"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(a,b,c){"use strict";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}b.exports=d},{}],69:[function(a,b,c){"use strict";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg="invalid literal/length code",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg="invalid distance code",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg="invalid distance too far back",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg="invalid distance too far back",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],70:[function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a("../utils/common"),t=a("./adler32"),u=a("./crc32"),v=a("./inffast"),w=a("./inftrees"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(a,b,c){"use strict";var d=a("../utils/common"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(;;){z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{"../utils/common":62}],72:[function(a,b,c){"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,
c=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a("../utils/common"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{"../utils/common":62}],74:[function(a,b,c){"use strict";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)});
/*!

JSZipUtils - A collection of cross-browser utilities to go along with JSZip.
<http://stuk.github.io/jszip-utils>

(c) 2014 Stuart Knightley, David Duponchel
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip-utils/master/LICENSE.markdown.

*/
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.JSZipUtils=a():"undefined"!=typeof global?global.JSZipUtils=a():"undefined"!=typeof self&&(self.JSZipUtils=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(){try{return new window.XMLHttpRequest}catch(a){}}function d(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}var e={};e._getBinaryFromXHR=function(a){return a.response||a.responseText};var f=window.ActiveXObject?function(){return c()||d()}:c;e.getBinaryContent=function(a,b){try{var c=f();c.open("GET",a,!0),"responseType"in c&&(c.responseType="arraybuffer"),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),c.onreadystatechange=function(){var d,f;if(4===c.readyState)if(200===c.status||0===c.status){d=null,f=null;try{d=e._getBinaryFromXHR(c)}catch(g){f=new Error(g)}b(f,d)}else b(new Error("Ajax error for "+a+" : "+this.status+" "+this.statusText),null)},c.send()}catch(d){b(new Error(d),null)}},b.exports=e},{}]},{},[1])(1)});
/*
* FileSaver.js
* A saveAs() FileSaver implementation.
*
* By Eli Grey, http://eligrey.com
*
* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)
* source  : http://purl.eligrey.com/github/FileSaver.js
*/


// The one and only way of getting global scope in all environments
// https://stackoverflow.com/q/3277182/1008999
var _global = typeof window === 'object' && window.window === window
  ? window : typeof self === 'object' && self.self === self
  ? self : typeof global === 'object' && global.global === global
  ? global
  : this

function bom (blob, opts) {
  if (typeof opts === 'undefined') opts = { autoBom: false }
  else if (typeof opts !== 'object') {
    console.warn('Depricated: Expected third argument to be a object')
    opts = { autoBom: !opts }
  }

  // prepend BOM for UTF-8 XML and text/* types (including HTML)
  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF
  if (opts.autoBom && /^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)) {
    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })
  }
  return blob
}

function download (url, name, opts) {
  var xhr = new XMLHttpRequest()
  xhr.open('GET', url)
  xhr.responseType = 'blob'
  xhr.onload = function () {
    saveAs(xhr.response, name, opts)
  }
  xhr.onerror = function () {
    console.error('could not download file')
  }
  xhr.send()
}

function corsEnabled (url) {
  var xhr = new XMLHttpRequest()
  // use sync to avoid popup blocker
  xhr.open('HEAD', url, false)
  xhr.send()
  return xhr.status >= 200 && xhr.status <= 299
}

// `a.click()` doesn't work for all browsers (#465)
function click(node) {
  try {
    node.dispatchEvent(new MouseEvent('click'))
  } catch (e) {
    var evt = document.createEvent('MouseEvents')
    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,
                          20, false, false, false, false, 0, null)
    node.dispatchEvent(evt)
  }
}

var saveAs = _global.saveAs ||
// probably in some web worker
(typeof window !== 'object' || window !== _global)
  ? function saveAs () { /* noop */ }

// Use download attribute first if possible (#193 Lumia mobile)
: 'download' in HTMLAnchorElement.prototype
? function saveAs (blob, name, opts) {
  var URL = _global.URL || _global.webkitURL
  var a = document.createElement('a')
  name = name || blob.name || 'download'

  a.download = name
  a.rel = 'noopener' // tabnabbing

  // TODO: detect chrome extensions & packaged apps
  // a.target = '_blank'

  if (typeof blob === 'string') {
    // Support regular links
    a.href = blob
    if (a.origin !== location.origin) {
      corsEnabled(a.href)
        ? download(blob, name, opts)
        : click(a, a.target = '_blank')
    } else {
      click(a)
    }
  } else {
    // Support blobs
    a.href = URL.createObjectURL(blob)
    setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s
    setTimeout(function () { click(a) }, 0)
  }
}

// Use msSaveOrOpenBlob as a second approach
: 'msSaveOrOpenBlob' in navigator
? function saveAs (blob, name, opts) {
  name = name || blob.name || 'download'

  if (typeof blob === 'string') {
    if (corsEnabled(blob)) {
      download(blob, name, opts)
    } else {
      var a = document.createElement('a')
      a.href = blob
      a.target = '_blank'
      setTimeout(function () { click(a) })
    }
  } else {
    navigator.msSaveOrOpenBlob(bom(blob, opts), name)
  }
}

// Fallback to using FileReader and a popup
: function saveAs (blob, name, opts, popup) {
  // Open a popup immediately do go around popup blocker
  // Mostly only avalible on user interaction and the fileReader is async so...
  popup = popup || open('', '_blank')
  if (popup) {
    popup.document.title =
    popup.document.body.innerText = 'downloading...'
  }

  if (typeof blob === 'string') return download(blob, name, opts)

  var force = blob.type === 'application/octet-stream'
  var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari
  var isChromeIOS = /CriOS\/[\d]+/.test(navigator.userAgent)

  if ((isChromeIOS || (force && isSafari)) && typeof FileReader === 'object') {
    // Safari doesn't allow downloading of blob urls
    var reader = new FileReader()
    reader.onloadend = function () {
      var url = reader.result
      url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')
      if (popup) popup.location.href = url
      else location = url
      popup = null // reverse-tabnabbing #460
    }
    reader.readAsDataURL(blob)
  } else {
    var URL = _global.URL || _global.webkitURL
    var url = URL.createObjectURL(blob)
    if (popup) popup.location = url
    else location.href = url
    popup = null // reverse-tabnabbing #460
    setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s
  }
}

_global.saveAs = saveAs.saveAs = saveAs

if (typeof module !== 'undefined') {
  module.exports = saveAs;
}
